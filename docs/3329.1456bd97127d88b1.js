(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3329],{297:(Ve,A,U)=>{"use strict";U.d(A,{mb:()=>Rt,Ao:()=>$e,vZ:()=>mt,pV:()=>Eu,D8:()=>Ts,IN:()=>Ze,jL:()=>Ie,lH:()=>Su,dC:()=>ki});var V=U(467);Symbol();const _e=Symbol(),we=Object.getPrototypeOf,he=new WeakMap,ie=(v,H=!0)=>{he.set(v,H)},m=v=>"object"==typeof v&&null!==v,q=new WeakMap,ue=new WeakSet,[fe]=((v=Object.is,H=(ke,it)=>new Proxy(ke,it),ye=ke=>m(ke)&&!ue.has(ke)&&(Array.isArray(ke)||!(Symbol.iterator in ke))&&!(ke instanceof WeakMap)&&!(ke instanceof WeakSet)&&!(ke instanceof Error)&&!(ke instanceof Number)&&!(ke instanceof Date)&&!(ke instanceof String)&&!(ke instanceof RegExp)&&!(ke instanceof ArrayBuffer),Oe=ke=>{switch(ke.status){case"fulfilled":return ke.value;case"rejected":throw ke.reason;default:throw ke}},Ge=new WeakMap,Ue=(ke,it,xt=Oe)=>{const st=Ge.get(ke);if(st?.[0]===it)return st[1];const ht=Array.isArray(ke)?[]:Object.create(Object.getPrototypeOf(ke));return ie(ht,!0),Ge.set(ke,[it,ht]),Reflect.ownKeys(ke).forEach(yt=>{if(Object.getOwnPropertyDescriptor(ht,yt))return;const gt=Reflect.get(ke,yt),Kt={value:gt,enumerable:!0,configurable:!0};if(ue.has(gt))ie(gt,!1);else if(gt instanceof Promise)delete Kt.value,Kt.get=()=>xt(gt);else if(q.has(gt)){const[Dt,di]=q.get(gt);Kt.value=Ue(Dt,di(),xt)}Object.defineProperty(ht,yt,Kt)}),Object.preventExtensions(ht)},Ne=new WeakMap,Ke=[1,1],at=ke=>{if(!m(ke))throw new Error("object required");const it=Ne.get(ke);if(it)return it;let xt=Ke[0];const st=new Set,ht=(Je,Ye=++Ke[0])=>{xt!==Ye&&(xt=Ye,st.forEach(He=>He(Je,Ye)))};let yt=Ke[1];const Kt=Je=>(Ye,He)=>{const Nt=[...Ye];Nt[1]=[Je,...Nt[1]],ht(Nt,He)},Dt=new Map,Rs=Je=>{var Ye;const He=Dt.get(Je);He&&(Dt.delete(Je),null==(Ye=He[1])||Ye.call(He))},Li=Array.isArray(ke)?[]:Object.create(Object.getPrototypeOf(ke)),Qn=H(Li,{deleteProperty(Je,Ye){const He=Reflect.get(Je,Ye);Rs(Ye);const Nt=Reflect.deleteProperty(Je,Ye);return Nt&&ht(["delete",[Ye],He]),Nt},set(Je,Ye,He,Nt){const er=Reflect.has(Je,Ye),Vr=Reflect.get(Je,Ye,Nt);if(er&&(v(Vr,He)||Ne.has(He)&&v(Vr,Ne.get(He))))return!0;Rs(Ye),m(He)&&(He=(v=>(v=>v&&(he.has(v)?he.get(v):we(v)===Object.prototype||we(v)===Array.prototype))(v)&&v[_e]||null)(He)||He);let fi=He;if(He instanceof Promise)He.then(Mn=>{He.status="fulfilled",He.value=Mn,ht(["resolve",[Ye],Mn])}).catch(Mn=>{He.status="rejected",He.reason=Mn,ht(["reject",[Ye],Mn])});else{!q.has(He)&&ye(He)&&(fi=at(He));const Mn=!ue.has(fi)&&q.get(fi);Mn&&((Je,Ye)=>{if(Dt.has(Je))throw new Error("prop listener already exists");if(st.size){const He=Ye[3](Kt(Je));Dt.set(Je,[Ye,He])}else Dt.set(Je,[Ye])})(Ye,Mn)}return Reflect.set(Je,Ye,fi,Nt),ht(["set",[Ye],He,Vr]),!0}});return Ne.set(ke,Qn),q.set(Qn,[Li,(Je=++Ke[1])=>(yt!==Je&&!st.size&&(yt=Je,Dt.forEach(([Ye])=>{const He=Ye[1](Je);He>xt&&(xt=He)})),xt),Ue,Je=>(st.add(Je),1===st.size&&Dt.forEach(([He,Nt],er)=>{if(Nt)throw new Error("remove already exists");const Vr=He[3](Kt(er));Dt.set(er,[He,Vr])}),()=>{st.delete(Je),0===st.size&&Dt.forEach(([He,Nt],er)=>{Nt&&(Nt(),Dt.set(er,[He]))})})]),Reflect.ownKeys(ke).forEach(Je=>{const Ye=Object.getOwnPropertyDescriptor(ke,Je);"value"in Ye&&(Qn[Je]=ke[Je],delete Ye.value,delete Ye.writable),Object.defineProperty(Li,Je,Ye)}),Qn})=>[at,q,ue,v,H,ye,Oe,Ge,Ue,Ne,Ke])();function _(v={}){return fe(v)}function b(v,H,ye){const Oe=q.get(v);let Ge;Oe||console.warn("Please use proxy object");const Ue=[];let Ke=!1;const ke=(0,Oe[3])(it=>{Ue.push(it),ye?H(Ue.splice(0)):Ge||(Ge=Promise.resolve().then(()=>{Ge=void 0,Ke&&H(Ue.splice(0))}))});return Ke=!0,()=>{Ke=!1,ke()}}const R=_({history:["ConnectWallet"],view:"ConnectWallet",data:void 0}),Ie={state:R,subscribe:v=>b(R,()=>v(R)),push(v,H){v!==R.view&&(R.view=v,H&&(R.data=H),R.history.push(v))},reset(v){R.view=v,R.history=[v]},replace(v){R.history.length>1&&(R.history[R.history.length-1]=v,R.view=v)},goBack(){if(R.history.length>1){R.history.pop();const[v]=R.history.slice(-1);R.view=v}},setData(v){R.data=v}},$e={WALLETCONNECT_DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",WCM_VERSION:"WCM_VERSION",RECOMMENDED_WALLET_AMOUNT:9,isMobile:()=>typeof window<"u"&&!(!window.matchMedia("(pointer:coarse)").matches&&!/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)),isAndroid:()=>$e.isMobile()&&navigator.userAgent.toLowerCase().includes("android"),isIos(){const v=navigator.userAgent.toLowerCase();return $e.isMobile()&&(v.includes("iphone")||v.includes("ipad"))},isHttpUrl:v=>v.startsWith("http://")||v.startsWith("https://"),isArray:v=>Array.isArray(v)&&v.length>0,isTelegram:()=>typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto),formatNativeUrl(v,H,ye){if($e.isHttpUrl(v))return this.formatUniversalUrl(v,H,ye);let Oe=v;return Oe.includes("://")||(Oe=v.replaceAll("/","").replaceAll(":",""),Oe=`${Oe}://`),Oe.endsWith("/")||(Oe=`${Oe}/`),this.setWalletConnectDeepLink(Oe,ye),`${Oe}wc?uri=${encodeURIComponent(H)}`},formatUniversalUrl(v,H,ye){if(!$e.isHttpUrl(v))return this.formatNativeUrl(v,H,ye);let Oe=v;if(Oe.startsWith("https://t.me")){const Ue=Buffer.from(H).toString("base64").replace(/[=]/g,"");Oe.endsWith("/")&&(Oe=Oe.slice(0,-1)),this.setWalletConnectDeepLink(Oe,ye);const Ne=new URL(Oe);return Ne.searchParams.set("startapp",Ue),Ne.toString()}return Oe.endsWith("/")||(Oe=`${Oe}/`),this.setWalletConnectDeepLink(Oe,ye),`${Oe}wc?uri=${encodeURIComponent(H)}`},wait:v=>(0,V.A)(function*(){return new Promise(H=>{setTimeout(H,v)})})(),openHref(v,H){const ye=this.isTelegram()?"_blank":H;window.open(v,ye,"noreferrer noopener")},setWalletConnectDeepLink(v,H){try{localStorage.setItem($e.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:v,name:H}))}catch{console.info("Unable to set WalletConnect deep link")}},setWalletConnectAndroidDeepLink(v){try{const[H]=v.split("?");localStorage.setItem($e.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:H,name:"Android"}))}catch{console.info("Unable to set WalletConnect android deep link")}},removeWalletConnectDeepLink(){try{localStorage.removeItem($e.WALLETCONNECT_DEEPLINK_CHOICE)}catch{console.info("Unable to remove WalletConnect deep link")}},setModalVersionInStorage(){try{typeof localStorage<"u"&&localStorage.setItem($e.WCM_VERSION,"2.7.0")}catch{console.info("Unable to set Web3Modal version in storage")}},getWalletRouterData(){var v;const H=null==(v=Ie.state.data)?void 0:v.Wallet;if(!H)throw new Error('Missing "Wallet" view data');return H}},Me=_({enabled:typeof location<"u"&&(location.hostname.includes("localhost")||location.protocol.includes("https")),userSessionId:"",events:[],connectedWalletId:void 0}),mt={state:Me,subscribe:v=>b(Me.events,()=>v(function x(v,H){const ye=q.get(v);ye||console.warn("Please use proxy object");const[Oe,Ge,Ue]=ye;return Ue(Oe,Ge(),H)}(Me.events[Me.events.length-1]))),initialize(){Me.enabled&&typeof(null==crypto?void 0:crypto.randomUUID)<"u"&&(Me.userSessionId=crypto.randomUUID())},setConnectedWalletId(v){Me.connectedWalletId=v},click(v){if(Me.enabled){const H={type:"CLICK",name:v.name,userSessionId:Me.userSessionId,timestamp:Date.now(),data:v};Me.events.push(H)}},track(v){if(Me.enabled){const H={type:"TRACK",name:v.name,userSessionId:Me.userSessionId,timestamp:Date.now(),data:v};Me.events.push(H)}},view(v){if(Me.enabled){const H={type:"VIEW",name:v.name,userSessionId:Me.userSessionId,timestamp:Date.now(),data:v};Me.events.push(H)}}},Se=_({chains:void 0,walletConnectUri:void 0,isAuth:!1,isCustomDesktop:!1,isCustomMobile:!1,isDataLoaded:!1,isUiLoaded:!1}),Ze={state:Se,subscribe:v=>b(Se,()=>v(Se)),setChains(v){Se.chains=v},setWalletConnectUri(v){Se.walletConnectUri=v},setIsCustomDesktop(v){Se.isCustomDesktop=v},setIsCustomMobile(v){Se.isCustomMobile=v},setIsDataLoaded(v){Se.isDataLoaded=v},setIsUiLoaded(v){Se.isUiLoaded=v},setIsAuth(v){Se.isAuth=v}},Bt=_({projectId:"",mobileWallets:void 0,desktopWallets:void 0,walletImages:void 0,chains:void 0,enableAuthMode:!1,enableExplorer:!0,explorerExcludedWalletIds:void 0,explorerRecommendedWalletIds:void 0,termsOfServiceUrl:void 0,privacyPolicyUrl:void 0}),Rt={state:Bt,subscribe:v=>b(Bt,()=>v(Bt)),setConfig(v){var H,ye;mt.initialize(),Ze.setChains(v.chains),Ze.setIsAuth(!!v.enableAuthMode),Ze.setIsCustomMobile(!(null==(H=v.mobileWallets)||!H.length)),Ze.setIsCustomDesktop(!(null==(ye=v.desktopWallets)||!ye.length)),$e.setModalVersionInStorage(),Object.assign(Bt,v)}};var $r=Object.defineProperty,Jn=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable,qe=(v,H,ye)=>H in v?$r(v,H,{enumerable:!0,configurable:!0,writable:!0,value:ye}):v[H]=ye;const lt="https://explorer-api.walletconnect.com",_r="js-2.7.0";function mr(v,H){return zr.apply(this,arguments)}function zr(){return(zr=(0,V.A)(function*(v,H){const ye=((v,H)=>{for(var ye in H||(H={}))z.call(H,ye)&&qe(v,ye,H[ye]);if(Jn)for(var ye of Jn(H))Te.call(H,ye)&&qe(v,ye,H[ye]);return v})({sdkType:"wcm",sdkVersion:_r},H),Oe=new URL(v,lt);return Oe.searchParams.append("projectId",Rt.state.projectId),Object.entries(ye).forEach(([Ue,Ne])=>{Ne&&Oe.searchParams.append(Ue,String(Ne))}),(yield fetch(Oe)).json()})).apply(this,arguments)}const Zn_getDesktopListings=v=>(0,V.A)(function*(){return mr("/w3m/v1/getDesktopListings",v)})(),Zn_getMobileListings=v=>(0,V.A)(function*(){return mr("/w3m/v1/getMobileListings",v)})(),Zn_getAllListings=v=>(0,V.A)(function*(){return mr("/w3m/v1/getAllListings",v)})(),Zn_getWalletImageUrl=v=>`${lt}/w3m/v1/getWalletImage/${v}?projectId=${Rt.state.projectId}&sdkType=wcm&sdkVersion=${_r}`,Zn_getAssetImageUrl=v=>`${lt}/w3m/v1/getAssetImage/${v}?projectId=${Rt.state.projectId}&sdkType=wcm&sdkVersion=${_r}`;var Jo=Object.defineProperty,Zo=Object.getOwnPropertySymbols,Fi=Object.prototype.hasOwnProperty,xu=Object.prototype.propertyIsEnumerable,li=(v,H,ye)=>H in v?Jo(v,H,{enumerable:!0,configurable:!0,writable:!0,value:ye}):v[H]=ye;const Ui=$e.isMobile(),sn=_({wallets:{listings:[],total:0,page:1},search:{listings:[],total:0,page:1},recomendedWallets:[]}),Eu={state:sn,getRecomendedWallets:()=>(0,V.A)(function*(){const{explorerRecommendedWalletIds:v,explorerExcludedWalletIds:H}=Rt.state;if("NONE"===v||"ALL"===H&&!v)return sn.recomendedWallets;if($e.isArray(v)){const Oe={recommendedIds:v.join(",")},{listings:Ge}=yield Zn_getAllListings(Oe),Ue=Object.values(Ge);Ue.sort((Ne,Ke)=>v.indexOf(Ne.id)-v.indexOf(Ke.id)),sn.recomendedWallets=Ue}else{const{chains:ye,isAuth:Oe}=Ze.state,Ge=ye?.join(","),Ue=$e.isArray(H),Ne={page:1,sdks:Oe?"auth_v1":void 0,entries:$e.RECOMMENDED_WALLET_AMOUNT,chains:Ge,version:2,excludedIds:Ue?H.join(","):void 0},{listings:Ke}=Ui?yield Zn_getMobileListings(Ne):yield Zn_getDesktopListings(Ne);sn.recomendedWallets=Object.values(Ke)}return sn.recomendedWallets})(),getWallets:v=>(0,V.A)(function*(){const H=((v,H)=>{for(var ye in H||(H={}))Fi.call(H,ye)&&li(v,ye,H[ye]);if(Zo)for(var ye of Zo(H))xu.call(H,ye)&&li(v,ye,H[ye]);return v})({},v),{explorerRecommendedWalletIds:ye,explorerExcludedWalletIds:Oe}=Rt.state,{recomendedWallets:Ge}=sn;if("ALL"===Oe)return sn.wallets;Ge.length?H.excludedIds=Ge.map(xt=>xt.id).join(","):$e.isArray(ye)&&(H.excludedIds=ye.join(",")),$e.isArray(Oe)&&(H.excludedIds=[H.excludedIds,Oe].filter(Boolean).join(",")),Ze.state.isAuth&&(H.sdks="auth_v1");const{page:Ue,search:Ne}=v,{listings:Ke,total:at}=Ui?yield Zn_getMobileListings(H):yield Zn_getDesktopListings(H),ke=Object.values(Ke),it=Ne?"search":"wallets";return sn[it]={listings:[...sn[it].listings,...ke],total:at,page:Ue??1},{listings:ke,total:at}})(),getWalletImageUrl:v=>Zn_getWalletImageUrl(v),getAssetImageUrl:v=>Zn_getAssetImageUrl(v),resetSearch(){sn.search={listings:[],total:0,page:1}}},bt=_({open:!1}),Ts={state:bt,subscribe:v=>b(bt,()=>v(bt)),open:v=>(0,V.A)(function*(){return new Promise(H=>{const{isUiLoaded:ye,isDataLoaded:Oe}=Ze.state;if($e.removeWalletConnectDeepLink(),Ze.setWalletConnectUri(v?.uri),Ze.setChains(v?.chains),Ie.reset("ConnectWallet"),ye&&Oe)bt.open=!0,H();else{const Ge=setInterval(()=>{const Ue=Ze.state;Ue.isUiLoaded&&Ue.isDataLoaded&&(clearInterval(Ge),bt.open=!0,H())},200)}})})(),close(){bt.open=!1}};var Ni=Object.defineProperty,on=Object.getOwnPropertySymbols,Bs=Object.prototype.hasOwnProperty,Xo=Object.prototype.propertyIsEnumerable,Qo=(v,H,ye)=>H in v?Ni(v,H,{enumerable:!0,configurable:!0,writable:!0,value:ye}):v[H]=ye;const qr=_({themeMode:function Iu(){return typeof matchMedia<"u"&&matchMedia("(prefers-color-scheme: dark)").matches}()?"dark":"light"}),Su={state:qr,subscribe:v=>b(qr,()=>v(qr)),setThemeConfig(v){const{themeMode:H,themeVariables:ye}=v;H&&(qr.themeMode=H),ye&&(qr.themeVariables=((v,H)=>{for(var ye in H||(H={}))Bs.call(H,ye)&&Qo(v,ye,H[ye]);if(on)for(var ye of on(H))Xo.call(H,ye)&&Qo(v,ye,H[ye]);return v})({},ye))}},Xn=_({open:!1,message:"",variant:"success"}),ki={state:Xn,subscribe:v=>b(Xn,()=>v(Xn)),openToast(v,H){Xn.open=!0,Xn.message=v,Xn.variant=H},closeToast(){Xn.open=!1}}},504:Ve=>{function C(ve){return(4294967296+ve).toString(16).substring(1)}Ve.exports={normalizeInput:function U(ve){let be;if(ve instanceof Uint8Array)be=ve;else{if("string"!=typeof ve)throw new Error("Input must be an string, Buffer or Uint8Array");be=(new TextEncoder).encode(ve)}return be},toHex:function V(ve){return Array.prototype.map.call(ve,function(be){return(be<16?"0":"")+be.toString(16)}).join("")},debugPrint:function _e(ve,be,we){let he="\n"+ve+" = ";for(let oe=0;oe<be.length;oe+=2){if(32===we)he+=C(be[oe]).toUpperCase(),he+=" ",he+=C(be[oe+1]).toUpperCase();else{if(64!==we)throw new Error("Invalid size "+we);he+=C(be[oe+1]).toUpperCase(),he+=C(be[oe]).toUpperCase()}oe%6==4?he+="\n"+new Array(ve.length+4).join(" "):oe<be.length-2&&(he+=" ")}console.log(he)},testSpeed:function de(ve,be,we){let he=(new Date).getTime();const oe=new Uint8Array(be);for(let le=0;le<be;le++)oe[le]=le%256;const Pe=(new Date).getTime();console.log("Generated random input in "+(Pe-he)+"ms"),he=Pe;for(let le=0;le<we;le++){const Z=ve(oe),me=(new Date).getTime(),xe=me-he;he=me,console.log("Hashed in "+xe+"ms: "+Z.substring(0,20)+"..."),console.log(Math.round(be/(1<<20)/(xe/1e3)*100)/100+" MB PER SECOND")}}}},584:(Ve,A,U)=>{"use strict";U.r(A),U.d(A,{__assign:()=>_e,__asyncDelegator:()=>Y,__asyncGenerator:()=>ie,__asyncValues:()=>M,__await:()=>pe,__awaiter:()=>he,__classPrivateFieldGet:()=>B,__classPrivateFieldSet:()=>fe,__createBinding:()=>Pe,__decorate:()=>ve,__exportStar:()=>le,__extends:()=>C,__generator:()=>oe,__importDefault:()=>ue,__importStar:()=>q,__makeTemplateObject:()=>m,__metadata:()=>we,__param:()=>be,__read:()=>me,__rest:()=>de,__spread:()=>xe,__spreadArrays:()=>h,__values:()=>Z});var V=function(_,I){return(V=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,x){b.__proto__=x}||function(b,x){for(var S in x)x.hasOwnProperty(S)&&(b[S]=x[S])})(_,I)};function C(_,I){function b(){this.constructor=_}V(_,I),_.prototype=null===I?Object.create(I):(b.prototype=I.prototype,new b)}var _e=function(){return _e=Object.assign||function(I){for(var b,x=1,S=arguments.length;x<S;x++)for(var P in b=arguments[x])Object.prototype.hasOwnProperty.call(b,P)&&(I[P]=b[P]);return I},_e.apply(this,arguments)};function de(_,I){var b={};for(var x in _)Object.prototype.hasOwnProperty.call(_,x)&&I.indexOf(x)<0&&(b[x]=_[x]);if(null!=_&&"function"==typeof Object.getOwnPropertySymbols){var S=0;for(x=Object.getOwnPropertySymbols(_);S<x.length;S++)I.indexOf(x[S])<0&&Object.prototype.propertyIsEnumerable.call(_,x[S])&&(b[x[S]]=_[x[S]])}return b}function ve(_,I,b,x){var R,S=arguments.length,P=S<3?I:null===x?x=Object.getOwnPropertyDescriptor(I,b):x;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)P=Reflect.decorate(_,I,b,x);else for(var Ie=_.length-1;Ie>=0;Ie--)(R=_[Ie])&&(P=(S<3?R(P):S>3?R(I,b,P):R(I,b))||P);return S>3&&P&&Object.defineProperty(I,b,P),P}function be(_,I){return function(b,x){I(b,x,_)}}function we(_,I){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(_,I)}function he(_,I,b,x){return new(b||(b=Promise))(function(P,R){function Ie(Me){try{ne(x.next(Me))}catch(mt){R(mt)}}function $e(Me){try{ne(x.throw(Me))}catch(mt){R(mt)}}function ne(Me){Me.done?P(Me.value):function S(P){return P instanceof b?P:new b(function(R){R(P)})}(Me.value).then(Ie,$e)}ne((x=x.apply(_,I||[])).next())})}function oe(_,I){var x,S,P,R,b={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return R={next:Ie(0),throw:Ie(1),return:Ie(2)},"function"==typeof Symbol&&(R[Symbol.iterator]=function(){return this}),R;function Ie(ne){return function(Me){return function $e(ne){if(x)throw new TypeError("Generator is already executing.");for(;b;)try{if(x=1,S&&(P=2&ne[0]?S.return:ne[0]?S.throw||((P=S.return)&&P.call(S),0):S.next)&&!(P=P.call(S,ne[1])).done)return P;switch(S=0,P&&(ne=[2&ne[0],P.value]),ne[0]){case 0:case 1:P=ne;break;case 4:return b.label++,{value:ne[1],done:!1};case 5:b.label++,S=ne[1],ne=[0];continue;case 7:ne=b.ops.pop(),b.trys.pop();continue;default:if(!(P=(P=b.trys).length>0&&P[P.length-1])&&(6===ne[0]||2===ne[0])){b=0;continue}if(3===ne[0]&&(!P||ne[1]>P[0]&&ne[1]<P[3])){b.label=ne[1];break}if(6===ne[0]&&b.label<P[1]){b.label=P[1],P=ne;break}if(P&&b.label<P[2]){b.label=P[2],b.ops.push(ne);break}P[2]&&b.ops.pop(),b.trys.pop();continue}ne=I.call(_,b)}catch(Me){ne=[6,Me],S=0}finally{x=P=0}if(5&ne[0])throw ne[1];return{value:ne[0]?ne[1]:void 0,done:!0}}([ne,Me])}}}function Pe(_,I,b,x){void 0===x&&(x=b),_[x]=I[b]}function le(_,I){for(var b in _)"default"!==b&&!I.hasOwnProperty(b)&&(I[b]=_[b])}function Z(_){var I="function"==typeof Symbol&&Symbol.iterator,b=I&&_[I],x=0;if(b)return b.call(_);if(_&&"number"==typeof _.length)return{next:function(){return _&&x>=_.length&&(_=void 0),{value:_&&_[x++],done:!_}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")}function me(_,I){var b="function"==typeof Symbol&&_[Symbol.iterator];if(!b)return _;var S,R,x=b.call(_),P=[];try{for(;(void 0===I||I-- >0)&&!(S=x.next()).done;)P.push(S.value)}catch(Ie){R={error:Ie}}finally{try{S&&!S.done&&(b=x.return)&&b.call(x)}finally{if(R)throw R.error}}return P}function xe(){for(var _=[],I=0;I<arguments.length;I++)_=_.concat(me(arguments[I]));return _}function h(){for(var _=0,I=0,b=arguments.length;I<b;I++)_+=arguments[I].length;var x=Array(_),S=0;for(I=0;I<b;I++)for(var P=arguments[I],R=0,Ie=P.length;R<Ie;R++,S++)x[S]=P[R];return x}function pe(_){return this instanceof pe?(this.v=_,this):new pe(_)}function ie(_,I,b){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var S,x=b.apply(_,I||[]),P=[];return S={},R("next"),R("throw"),R("return"),S[Symbol.asyncIterator]=function(){return this},S;function R(Se){x[Se]&&(S[Se]=function(Ze){return new Promise(function(Bt,Rt){P.push([Se,Ze,Bt,Rt])>1||Ie(Se,Ze)})})}function Ie(Se,Ze){try{!function $e(Se){Se.value instanceof pe?Promise.resolve(Se.value.v).then(ne,Me):mt(P[0][2],Se)}(x[Se](Ze))}catch(Bt){mt(P[0][3],Bt)}}function ne(Se){Ie("next",Se)}function Me(Se){Ie("throw",Se)}function mt(Se,Ze){Se(Ze),P.shift(),P.length&&Ie(P[0][0],P[0][1])}}function Y(_){var I,b;return I={},x("next"),x("throw",function(S){throw S}),x("return"),I[Symbol.iterator]=function(){return this},I;function x(S,P){I[S]=_[S]?function(R){return(b=!b)?{value:pe(_[S](R)),done:"return"===S}:P?P(R):R}:P}}function M(_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b,I=_[Symbol.asyncIterator];return I?I.call(_):(_=Z(_),b={},x("next"),x("throw"),x("return"),b[Symbol.asyncIterator]=function(){return this},b);function x(P){b[P]=_[P]&&function(R){return new Promise(function(Ie,$e){!function S(P,R,Ie,$e){Promise.resolve($e).then(function(ne){P({value:ne,done:Ie})},R)}(Ie,$e,(R=_[P](R)).done,R.value)})}}}function m(_,I){return Object.defineProperty?Object.defineProperty(_,"raw",{value:I}):_.raw=I,_}function q(_){if(_&&_.__esModule)return _;var I={};if(null!=_)for(var b in _)Object.hasOwnProperty.call(_,b)&&(I[b]=_[b]);return I.default=_,I}function ue(_){return _&&_.__esModule?_:{default:_}}function B(_,I){if(!I.has(_))throw new TypeError("attempted to get private field on non-instance");return I.get(_)}function fe(_,I,b){if(!I.has(_))throw new TypeError("attempted to set private field on non-instance");return I.set(_,b),b}},998:(Ve,A)=>{"use strict";function U(){return typeof document>"u"&&typeof navigator<"u"&&"ReactNative"===navigator.product}function V(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Object.defineProperty(A,"__esModule",{value:!0}),A.isBrowser=A.isNode=A.isReactNative=void 0,A.isReactNative=U,A.isNode=V,A.isBrowser=function C(){return!U()&&!V()}},1105:(Ve,A,U)=>{"use strict";const V=U(4384);Ve.exports=ve;const C=function ue(){function B(fe){return typeof fe<"u"&&fe}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return B(self)||B(window)||B(this)||{}}}().console||{},_e={mapHttpRequest:h,mapHttpResponse:h,wrapRequestSerializer:pe,wrapResponseSerializer:pe,wrapErrorSerializer:pe,req:h,res:h,err:function me(B){const fe={type:B.constructor.name,msg:B.message,stack:B.stack};for(const _ in B)void 0===fe[_]&&(fe[_]=B[_]);return fe}};function ve(B){(B=B||{}).browser=B.browser||{};const fe=B.browser.transmit;if(fe&&"function"!=typeof fe.send)throw Error("pino: transmit option must have a send function");const _=B.browser.write||C;B.browser.write&&(B.browser.asObject=!0);const I=B.serializers||{},b=function de(B,fe){return Array.isArray(B)?B.filter(function(I){return"!stdSerializers.err"!==I}):!0===B&&Object.keys(fe)}(B.browser.serialize,I);let x=B.browser.serialize;Array.isArray(B.browser.serialize)&&B.browser.serialize.indexOf("!stdSerializers.err")>-1&&(x=!1),"function"==typeof _&&(_.error=_.fatal=_.warn=_.info=_.debug=_.trace=_),!1===B.enabled&&(B.level="silent");const P=B.level||"info",R=Object.create(_);R.log||(R.log=ie),Object.defineProperty(R,"levelVal",{get:function $e(){return"silent"===this.level?1/0:this.levels.values[this.level]}}),Object.defineProperty(R,"level",{get:function ne(){return this._level},set:function Me(Se){if("silent"!==Se&&!this.levels.values[Se])throw Error("unknown level "+Se);this._level=Se,be(Ie,R,"error","log"),be(Ie,R,"fatal","error"),be(Ie,R,"warn","error"),be(Ie,R,"info","log"),be(Ie,R,"debug","log"),be(Ie,R,"trace","log")}});const Ie={transmit:fe,serialize:b,asObject:B.browser.asObject,levels:["error","fatal","warn","info","debug","trace"],timestamp:xe(B)};return R.levels=ve.levels,R.level=P,R.setMaxListeners=R.getMaxListeners=R.emit=R.addListener=R.on=R.prependListener=R.once=R.prependOnceListener=R.removeListener=R.removeAllListeners=R.listeners=R.listenerCount=R.eventNames=R.write=R.flush=ie,R.serializers=I,R._serialize=b,R._stdErrSerialize=x,R.child=function mt(Se,Ze){if(!Se)throw new Error("missing bindings for child Pino");Ze=Ze||{},b&&Se.serializers&&(Ze.serializers=Se.serializers);const Bt=Ze.serializers;if(b&&Bt){var Rt=Object.assign({},I,Bt),$r=!0===B.browser.serialize?Object.keys(Rt):b;delete Se.serializers,oe([Se],$r,Rt,this._stdErrSerialize)}function Jn(z){this._childLevel=1+(0|z._childLevel),this.error=Pe(z,Se,"error"),this.fatal=Pe(z,Se,"fatal"),this.warn=Pe(z,Se,"warn"),this.info=Pe(z,Se,"info"),this.debug=Pe(z,Se,"debug"),this.trace=Pe(z,Se,"trace"),Rt&&(this.serializers=Rt,this._serialize=$r),fe&&(this._logEvent=Z([].concat(z._logEvent.bindings,Se)))}return Jn.prototype=this,new Jn(this)},fe&&(R._logEvent=Z()),R}function be(B,fe,_,I){const b=Object.getPrototypeOf(fe);fe[_]=fe.levelVal>fe.levels.values[_]?ie:b[_]?b[_]:C[_]||C[I]||ie,function we(B,fe,_){!B.transmit&&fe[_]===ie||(fe[_]=function(I){return function(){const x=B.timestamp(),S=new Array(arguments.length),P=Object.getPrototypeOf&&Object.getPrototypeOf(this)===C?C:this;for(var R=0;R<S.length;R++)S[R]=arguments[R];if(B.serialize&&!B.asObject&&oe(S,this._serialize,this.serializers,this._stdErrSerialize),B.asObject?I.call(P,function he(B,fe,_,I){B._serialize&&oe(_,B._serialize,B.serializers,B._stdErrSerialize);const b=_.slice();let x=b[0];const S={};I&&(S.time=I),S.level=ve.levels.values[fe];let P=1+(0|B._childLevel);if(P<1&&(P=1),null!==x&&"object"==typeof x){for(;P--&&"object"==typeof b[0];)Object.assign(S,b.shift());x=b.length?V(b.shift(),b):void 0}else"string"==typeof x&&(x=V(b.shift(),b));return void 0!==x&&(S.msg=x),S}(this,_,S,x)):I.apply(P,S),B.transmit){const Ie=B.transmit.level||fe.level,ne=ve.levels.values[_];if(ne<ve.levels.values[Ie])return;!function le(B,fe,_){const I=fe.send,b=fe.ts,x=fe.methodLevel,S=fe.methodValue,P=fe.val,R=B._logEvent.bindings;oe(_,B._serialize||Object.keys(B.serializers),B.serializers,void 0===B._stdErrSerialize||B._stdErrSerialize),B._logEvent.ts=b,B._logEvent.messages=_.filter(function(Ie){return-1===R.indexOf(Ie)}),B._logEvent.level.label=x,B._logEvent.level.value=S,I(x,B._logEvent,P),B._logEvent=Z(R)}(this,{ts:x,methodLevel:_,methodValue:ne,transmitLevel:Ie,transmitValue:ve.levels.values[B.transmit.level||fe.level],send:B.transmit.send,val:fe.levelVal},S)}}}(fe[_]))}(B,fe,_)}function oe(B,fe,_,I){for(const b in B)if(I&&B[b]instanceof Error)B[b]=ve.stdSerializers.err(B[b]);else if("object"==typeof B[b]&&!Array.isArray(B[b]))for(const x in B[b])fe&&fe.indexOf(x)>-1&&x in _&&(B[b][x]=_[x](B[b][x]))}function Pe(B,fe,_){return function(){const I=new Array(1+arguments.length);I[0]=fe;for(var b=1;b<I.length;b++)I[b]=arguments[b-1];return B[_].apply(this,I)}}function Z(B){return{ts:0,messages:[],bindings:B||[],level:{label:"",value:0}}}function xe(B){return"function"==typeof B.timestamp?B.timestamp:!1===B.timestamp?Y:M}function h(){return{}}function pe(B){return B}function ie(){}function Y(){return!1}function M(){return Date.now()}ve.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},ve.stdSerializers=_e,ve.stdTimeFunctions=Object.assign({},{nullTime:Y,epochTime:M,unixTime:function m(){return Math.round(Date.now()/1e3)},isoTime:function q(){return new Date(Date.now()).toISOString()}})},1387:(Ve,A,U)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),U(584).__exportStar(U(5424),A)},2552:(Ve,A,U)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.fromMiliseconds=A.toMiliseconds=void 0;const V=U(9083);A.toMiliseconds=function C(de){return de*V.ONE_THOUSAND},A.fromMiliseconds=function _e(de){return Math.floor(de/V.ONE_THOUSAND)}},2596:(Ve,A,U)=>{"use strict";A.g=void 0;const C=U(7793);A.g=function _e(){let de,ve;try{de=C.getDocumentOrThrow(),ve=C.getLocationOrThrow()}catch{return null}function we(...h){const pe=de.getElementsByTagName("meta");for(let ie=0;ie<pe.length;ie++){const Y=pe[ie],M=["itemprop","property","name"].map(m=>Y.getAttribute(m)).filter(m=>!!m&&h.includes(m));if(M.length&&M){const m=Y.getAttribute("content");if(m)return m}}return""}const Pe=function he(){let h=we("name","og:site_name","og:title","twitter:title");return h||(h=de.title),h}();return{description:function oe(){return we("description","og:description","twitter:description","keywords")}(),url:ve.origin,icons:function be(){const h=de.getElementsByTagName("link"),pe=[];for(let ie=0;ie<h.length;ie++){const Y=h[ie],M=Y.getAttribute("rel");if(M&&M.toLowerCase().indexOf("icon")>-1){const m=Y.getAttribute("href");if(m)if(-1===m.toLowerCase().indexOf("https:")&&-1===m.toLowerCase().indexOf("http:")&&0!==m.indexOf("//")){let q=ve.protocol+"//"+ve.host;if(0===m.indexOf("/"))q+=m;else{const ue=ve.pathname.split("/");ue.pop(),q+=ue.join("/")+"/"+m}pe.push(q)}else 0===m.indexOf("//")?pe.push(ve.protocol+m):pe.push(m)}}return pe}(),name:Pe}}},2684:(Ve,A)=>{"use strict";function U(){return(null==global?void 0:global.crypto)||(null==global?void 0:global.msCrypto)||{}}function V(){const _e=U();return _e.subtle||_e.webkitSubtle}Object.defineProperty(A,"__esModule",{value:!0}),A.isBrowserCryptoAvailable=A.getSubtleCrypto=A.getBrowerCrypto=void 0,A.getBrowerCrypto=U,A.getSubtleCrypto=V,A.isBrowserCryptoAvailable=function C(){return!!U()&&!!V()}},2950:(Ve,A,U)=>{const V=U(9823),C=U(5880);Ve.exports={blake2b:V.blake2b,blake2bHex:V.blake2bHex,blake2bInit:V.blake2bInit,blake2bUpdate:V.blake2bUpdate,blake2bFinal:V.blake2bFinal,blake2s:C.blake2s,blake2sHex:C.blake2sHex,blake2sInit:C.blake2sInit,blake2sUpdate:C.blake2sUpdate,blake2sFinal:C.blake2sFinal}},3601:(Ve,A,U)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});const V=U(8186);V.__exportStar(U(2684),A),V.__exportStar(U(998),A)},3806:Ve=>{"use strict";Ve.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},4122:(Ve,A,U)=>{"use strict";U.d(A,{Vw:()=>Me,DO:()=>de,CC:()=>be,sd:()=>ve,Fe:()=>_e,Ht:()=>we,My:()=>ue,uH:()=>Pe,Id:()=>$e,qj:()=>mt,O8:()=>le,aT:()=>_,aY:()=>C,po:()=>Jn,Ow:()=>Z,fd:()=>M,ZJ:()=>R,DH:()=>oe,AI:()=>S});const V="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function C(z){return z instanceof Uint8Array||ArrayBuffer.isView(z)&&"Uint8Array"===z.constructor.name}function _e(z){if(!Number.isSafeInteger(z)||z<0)throw new Error("positive integer expected, got "+z)}function de(z,...Te){if(!C(z))throw new Error("Uint8Array expected");if(Te.length>0&&!Te.includes(z.length))throw new Error("Uint8Array expected of length "+Te+", got length="+z.length)}function ve(z){if("function"!=typeof z||"function"!=typeof z.create)throw new Error("Hash should be wrapped by utils.createHasher");_e(z.outputLen),_e(z.blockLen)}function be(z,Te=!0){if(z.destroyed)throw new Error("Hash instance has been destroyed");if(Te&&z.finished)throw new Error("Hash#digest() has already been called")}function we(z,Te){de(z);const qe=Te.outputLen;if(z.length<qe)throw new Error("digestInto() expects output buffer of length at least "+qe)}function oe(z){return new Uint32Array(z.buffer,z.byteOffset,Math.floor(z.byteLength/4))}function Pe(...z){for(let Te=0;Te<z.length;Te++)z[Te].fill(0)}function le(z){return new DataView(z.buffer,z.byteOffset,z.byteLength)}function Z(z,Te){return z<<32-Te|z>>>Te}function h(z){return z<<24&4278190080|z<<8&16711680|z>>>8&65280|z>>>24&255}const M=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]?z=>z:function Y(z){for(let Te=0;Te<z.length;Te++)z[Te]=h(z[Te]);return z},m="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,q=Array.from({length:256},(z,Te)=>Te.toString(16).padStart(2,"0"));function ue(z){if(de(z),m)return z.toHex();let Te="";for(let qe=0;qe<z.length;qe++)Te+=q[z[qe]];return Te}const B={_0:48,_9:57,A:65,F:70,a:97,f:102};function fe(z){return z>=B._0&&z<=B._9?z-B._0:z>=B.A&&z<=B.F?z-(B.A-10):z>=B.a&&z<=B.f?z-(B.a-10):void 0}function _(z){if("string"!=typeof z)throw new Error("hex string expected, got "+typeof z);if(m)return Uint8Array.fromHex(z);const Te=z.length,qe=Te/2;if(Te%2)throw new Error("hex string expected, got unpadded hex of length "+Te);const ut=new Uint8Array(qe);for(let lt=0,St=0;lt<qe;lt++,St+=2){const _r=fe(z.charCodeAt(St)),mr=fe(z.charCodeAt(St+1));if(void 0===_r||void 0===mr)throw new Error('hex string expected, got non-hex character "'+(z[St]+z[St+1])+'" at index '+St);ut[lt]=16*_r+mr}return ut}function S(z){if("string"!=typeof z)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(z))}function R(z){return"string"==typeof z&&(z=S(z)),de(z),z}function $e(...z){let Te=0;for(let ut=0;ut<z.length;ut++){const lt=z[ut];de(lt),Te+=lt.length}const qe=new Uint8Array(Te);for(let ut=0,lt=0;ut<z.length;ut++){const St=z[ut];qe.set(St,lt),lt+=St.length}return qe}class Me{}function mt(z){const Te=ut=>z().update(R(ut)).digest(),qe=z();return Te.outputLen=qe.outputLen,Te.blockLen=qe.blockLen,Te.create=()=>z(),Te}function Jn(z=32){if(V&&"function"==typeof V.getRandomValues)return V.getRandomValues(new Uint8Array(z));if(V&&"function"==typeof V.randomBytes)return Uint8Array.from(V.randomBytes(z));throw new Error("crypto.getRandomValues must be defined")}},4356:Ve=>{"use strict";var V,A="object"==typeof Reflect?Reflect:null,U=A&&"function"==typeof A.apply?A.apply:function(m,q,ue){return Function.prototype.apply.call(m,q,ue)};V=A&&"function"==typeof A.ownKeys?A.ownKeys:Object.getOwnPropertySymbols?function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:function(m){return Object.getOwnPropertyNames(m)};var _e=Number.isNaN||function(m){return m!=m};function de(){de.init.call(this)}Ve.exports=de,Ve.exports.once=function pe(M,m){return new Promise(function(q,ue){function B(_){M.removeListener(m,fe),ue(_)}function fe(){"function"==typeof M.removeListener&&M.removeListener("error",B),q([].slice.call(arguments))}Y(M,m,fe,{once:!0}),"error"!==m&&function ie(M,m,q){"function"==typeof M.on&&Y(M,"error",m,q)}(M,B,{once:!0})})},de.EventEmitter=de,de.prototype._events=void 0,de.prototype._eventsCount=0,de.prototype._maxListeners=void 0;var ve=10;function be(M){if("function"!=typeof M)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof M)}function we(M){return void 0===M._maxListeners?de.defaultMaxListeners:M._maxListeners}function he(M,m,q,ue){var B,fe,_;if(be(q),void 0===(fe=M._events)?(fe=M._events=Object.create(null),M._eventsCount=0):(void 0!==fe.newListener&&(M.emit("newListener",m,q.listener?q.listener:q),fe=M._events),_=fe[m]),void 0===_)_=fe[m]=q,++M._eventsCount;else if("function"==typeof _?_=fe[m]=ue?[q,_]:[_,q]:ue?_.unshift(q):_.push(q),(B=we(M))>0&&_.length>B&&!_.warned){_.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=M,I.type=m,I.count=_.length,function C(M){console&&console.warn&&console.warn(M)}(I)}return M}function oe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Pe(M,m,q){var ue={fired:!1,wrapFn:void 0,target:M,type:m,listener:q},B=oe.bind(ue);return B.listener=q,ue.wrapFn=B,B}function le(M,m,q){var ue=M._events;if(void 0===ue)return[];var B=ue[m];return void 0===B?[]:"function"==typeof B?q?[B.listener||B]:[B]:q?function h(M){for(var m=new Array(M.length),q=0;q<m.length;++q)m[q]=M[q].listener||M[q];return m}(B):me(B,B.length)}function Z(M){var m=this._events;if(void 0!==m){var q=m[M];if("function"==typeof q)return 1;if(void 0!==q)return q.length}return 0}function me(M,m){for(var q=new Array(m),ue=0;ue<m;++ue)q[ue]=M[ue];return q}function Y(M,m,q,ue){if("function"==typeof M.on)ue.once?M.once(m,q):M.on(m,q);else{if("function"!=typeof M.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof M);M.addEventListener(m,function B(fe){ue.once&&M.removeEventListener(m,B),q(fe)})}}Object.defineProperty(de,"defaultMaxListeners",{enumerable:!0,get:function(){return ve},set:function(M){if("number"!=typeof M||M<0||_e(M))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+M+".");ve=M}}),de.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},de.prototype.setMaxListeners=function(m){if("number"!=typeof m||m<0||_e(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this},de.prototype.getMaxListeners=function(){return we(this)},de.prototype.emit=function(m){for(var q=[],ue=1;ue<arguments.length;ue++)q.push(arguments[ue]);var B="error"===m,fe=this._events;if(void 0!==fe)B=B&&void 0===fe.error;else if(!B)return!1;if(B){var _;if(q.length>0&&(_=q[0]),_ instanceof Error)throw _;var I=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw I.context=_,I}var b=fe[m];if(void 0===b)return!1;if("function"==typeof b)U(b,this,q);else{var x=b.length,S=me(b,x);for(ue=0;ue<x;++ue)U(S[ue],this,q)}return!0},de.prototype.on=de.prototype.addListener=function(m,q){return he(this,m,q,!1)},de.prototype.prependListener=function(m,q){return he(this,m,q,!0)},de.prototype.once=function(m,q){return be(q),this.on(m,Pe(this,m,q)),this},de.prototype.prependOnceListener=function(m,q){return be(q),this.prependListener(m,Pe(this,m,q)),this},de.prototype.off=de.prototype.removeListener=function(m,q){var ue,B,fe,_,I;if(be(q),void 0===(B=this._events))return this;if(void 0===(ue=B[m]))return this;if(ue===q||ue.listener===q)0===--this._eventsCount?this._events=Object.create(null):(delete B[m],B.removeListener&&this.emit("removeListener",m,ue.listener||q));else if("function"!=typeof ue){for(fe=-1,_=ue.length-1;_>=0;_--)if(ue[_]===q||ue[_].listener===q){I=ue[_].listener,fe=_;break}if(fe<0)return this;0===fe?ue.shift():function xe(M,m){for(;m+1<M.length;m++)M[m]=M[m+1];M.pop()}(ue,fe),1===ue.length&&(B[m]=ue[0]),void 0!==B.removeListener&&this.emit("removeListener",m,I||q)}return this},de.prototype.removeAllListeners=function(m){var q,ue,B;if(void 0===(ue=this._events))return this;if(void 0===ue.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==ue[m]&&(0===--this._eventsCount?this._events=Object.create(null):delete ue[m]),this;if(0===arguments.length){var _,fe=Object.keys(ue);for(B=0;B<fe.length;++B)"removeListener"!==(_=fe[B])&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(q=ue[m]))this.removeListener(m,q);else if(void 0!==q)for(B=q.length-1;B>=0;B--)this.removeListener(m,q[B]);return this},de.prototype.listeners=function(m){return le(this,m,!0)},de.prototype.rawListeners=function(m){return le(this,m,!1)},de.listenerCount=function(M,m){return"function"==typeof M.listenerCount?M.listenerCount(m):Z.call(M,m)},de.prototype.listenerCount=Z,de.prototype.eventNames=function(){return this._eventsCount>0?V(this._events):[]}},4384:Ve=>{"use strict";function A(V){try{return JSON.stringify(V)}catch{return'"[Circular]"'}}Ve.exports=function U(V,C,_e){var de=_e&&_e.stringify||A;if("object"==typeof V&&null!==V){var be=C.length+1;if(1===be)return V;var we=new Array(be);we[0]=de(V);for(var he=1;he<be;he++)we[he]=de(C[he]);return we.join(" ")}if("string"!=typeof V)return V;var oe=C.length;if(0===oe)return V;for(var Pe="",le=0,Z=-1,me=V&&V.length||0,xe=0;xe<me;){if(37===V.charCodeAt(xe)&&xe+1<me){switch(Z=Z>-1?Z:0,V.charCodeAt(xe+1)){case 100:case 102:if(le>=oe||null==C[le])break;Z<xe&&(Pe+=V.slice(Z,xe)),Pe+=Number(C[le]),Z=xe+2,xe++;break;case 105:if(le>=oe||null==C[le])break;Z<xe&&(Pe+=V.slice(Z,xe)),Pe+=Math.floor(Number(C[le])),Z=xe+2,xe++;break;case 79:case 111:case 106:if(le>=oe||void 0===C[le])break;Z<xe&&(Pe+=V.slice(Z,xe));var h=typeof C[le];if("string"===h){Pe+="'"+C[le]+"'",Z=xe+2,xe++;break}if("function"===h){Pe+=C[le].name||"<anonymous>",Z=xe+2,xe++;break}Pe+=de(C[le]),Z=xe+2,xe++;break;case 115:if(le>=oe)break;Z<xe&&(Pe+=V.slice(Z,xe)),Pe+=String(C[le]),Z=xe+2,xe++;break;case 37:Z<xe&&(Pe+=V.slice(Z,xe)),Pe+="%",Z=xe+2,xe++,le--}++le}++xe}return-1===Z?V:(Z<me&&(Pe+=V.slice(Z)),Pe)}},4997:(Ve,A,U)=>{"use strict";U.d(A,{G:()=>we});var V=U(9330),C=U(4412),_e=U(9437),de=U(8141),ve=U(5312),be=U(2615);let we=(()=>{var he;class oe{constructor(le){this.http=le,this.baseUrl=ve.c.apiUrl||"http://localhost:1337/parse",this.appId=ve.c.appId||"haraas-app-id",this.currentUserSubject=new C.t(null),this.currentUser$=this.currentUserSubject.asObservable(),this.isAuthenticatedSubject=new C.t(!1),this.isAuthenticated$=this.isAuthenticatedSubject.asObservable(),this.sessionToken=null,this.initializeAuth()}initializeAuth(){const le=localStorage.getItem("haraas_user"),Z=localStorage.getItem("haraas_session_token");if(le&&Z)try{const me=JSON.parse(le);this.sessionToken=Z,this.currentUserSubject.next(me),this.isAuthenticatedSubject.next(!0)}catch(me){console.error("Error parsing stored user data:",me),this.clearAuthData()}}getHeaders(){let le=new V.Lr({"Content-Type":"application/json","X-Parse-Application-Id":this.appId});return this.sessionToken&&(le=le.set("X-Parse-Session-Token",this.sessionToken)),le}storeAuthData(le,Z,me=!1){this.sessionToken=Z,this.currentUserSubject.next(le),this.isAuthenticatedSubject.next(!0),me?(localStorage.setItem("haraas_user",JSON.stringify(le)),localStorage.setItem("haraas_session_token",Z)):(sessionStorage.setItem("haraas_user",JSON.stringify(le)),sessionStorage.setItem("haraas_session_token",Z))}clearAuthData(){this.sessionToken=null,this.currentUserSubject.next(null),this.isAuthenticatedSubject.next(!1),localStorage.removeItem("haraas_user"),localStorage.removeItem("haraas_session_token"),sessionStorage.removeItem("haraas_user"),sessionStorage.removeItem("haraas_session_token")}registerUser(le){return this.http.post(`${this.baseUrl}/functions/registerUser`,le,{headers:this.getHeaders()}).pipe((0,de.M)(me=>{me.success&&me.user&&me.sessionToken&&this.storeAuthData(me.user,me.sessionToken,!1)}),(0,_e.W)(me=>{throw console.error("Registration error:",me),me}))}loginUser(le){return this.http.post(`${this.baseUrl}/functions/loginUser`,le,{headers:this.getHeaders()}).pipe((0,de.M)(me=>{me.success&&me.user&&me.sessionToken&&this.storeAuthData(me.user,me.sessionToken,le.rememberMe||!1)}),(0,_e.W)(me=>{throw console.error("Login error:",me),me}))}logoutUser(){return this.http.post(`${this.baseUrl}/functions/logoutUser`,{},{headers:this.getHeaders()}).pipe((0,de.M)(()=>{this.clearAuthData()}),(0,_e.W)(Z=>{throw console.error("Logout error:",Z),this.clearAuthData(),Z}))}getCurrentUser(){return this.http.post(`${this.baseUrl}/functions/getCurrentUser`,{},{headers:this.getHeaders()}).pipe((0,de.M)(Z=>{Z.success&&Z.user&&this.currentUserSubject.next(Z.user)}),(0,_e.W)(Z=>{throw console.error("Get current user error:",Z),401===Z.status&&this.clearAuthData(),Z}))}updateUserProfile(le){return this.http.post(`${this.baseUrl}/functions/updateUserProfile`,le,{headers:this.getHeaders()}).pipe((0,de.M)(me=>{me.success&&me.user&&(this.currentUserSubject.next(me.user),(localStorage.getItem("haraas_user")||sessionStorage.getItem("haraas_user"))&&(localStorage.getItem("haraas_user")?localStorage:sessionStorage).setItem("haraas_user",JSON.stringify(me.user)))}),(0,_e.W)(me=>{throw console.error("Update profile error:",me),me}))}isAuthenticated(){return this.isAuthenticatedSubject.value}getCurrentUserSync(){return this.currentUserSubject.value}getSessionToken(){return this.sessionToken}static#e=he=()=>(this.\u0275fac=function(Z){return new(Z||oe)(be.KVO(V.Qq))},this.\u0275prov=be.jDH({token:oe,factory:oe.\u0275fac,providedIn:"root"}))}return he(),oe})()},5295:(Ve,A,U)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});const V=U(584);V.__exportStar(U(5784),A),V.__exportStar(U(2552),A)},5312:(Ve,A,U)=>{"use strict";U.d(A,{c:()=>V});const V={production:!0,apiUrl:"https://your-heroku-app.herokuapp.com/parse",appId:"haraas-app-id"}},5421:(Ve,A,U)=>{"use strict";U.d(A,{W:()=>Pe});var V=U(2615),C=U(3664),_e=U(9893),de=U(8909),ve=U(2200);function be(le,Z){if(1&le){const me=C.RV6();C.j41(0,"ion-item",3),C.bIt("click",function(){V.eBV(me);const h=C.XpG();return V.Njj(h.selectOption("connect-wallet"))}),C.nrm(1,"ion-icon",13),C.j41(2,"ion-label",14),C.EFF(3,"Connect Wallet"),C.k0s()()}}function we(le,Z){if(1&le){const me=C.RV6();C.j41(0,"ion-item",3),C.bIt("click",function(){V.eBV(me);const h=C.XpG();return V.Njj(h.selectOption("disconnect-wallet"))}),C.nrm(1,"ion-icon",15),C.j41(2,"ion-label",16),C.EFF(3,"Disconnect Wallet"),C.k0s()()}}function he(le,Z){1&le&&(C.j41(0,"ion-item"),C.nrm(1,"ion-icon",17),C.j41(2,"ion-label",18),C.EFF(3,"Connecting..."),C.k0s(),C.nrm(4,"ion-spinner",19),C.k0s())}function oe(le,Z){if(1&le&&(C.j41(0,"ion-item"),C.nrm(1,"ion-icon",20),C.j41(2,"div",21)(3,"h3"),C.EFF(4,"Connected"),C.k0s(),C.j41(5,"p"),C.EFF(6),C.nI1(7,"slice"),C.nI1(8,"slice"),C.k0s()()()),2&le){const me=C.XpG();C.R7$(6),C.Lme("",C.brH(7,2,me.walletAddress,0,8),"...",C.i5U(8,6,me.walletAddress,-6))}}let Pe=(()=>{var le;class Z{constructor(xe,h){this.popoverController=xe,this.walletConnectService=h,this.connectionStatus="disconnected",this.walletAddress=null,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.walletConnectService.connectionStatus$.subscribe(xe=>{this.connectionStatus=xe})),this.subscriptions.push(this.walletConnectService.accounts$.subscribe(xe=>{this.walletAddress=xe.length>0?xe[0].address:null}))}ngOnDestroy(){this.subscriptions.forEach(xe=>xe.unsubscribe())}selectOption(xe){this.popoverController.dismiss(xe)}static#e=le=()=>(this.\u0275fac=function(h){return new(h||Z)(C.rXU(_e.IE),C.rXU(de.D))},this.\u0275cmp=C.VBU({type:Z,selectors:[["app-settings-popover"]],standalone:!1,decls:36,vars:4,consts:[[1,"settings-popover-content"],["button","",3,"click",4,"ngIf"],[4,"ngIf"],["button","",3,"click"],["name","person-outline","slot","start"],["name","options-outline","slot","start"],["name","help-circle-outline","slot","start"],["name","information-circle-outline","slot","start"],["lines","none"],[1,"divider"],["button","",1,"logout-item",3,"click"],["name","log-out-outline","slot","start","color","danger"],["color","danger"],["name","wallet-outline","slot","start","color","primary"],["color","primary"],["name","unlink-outline","slot","start","color","warning"],["color","warning"],["name","hourglass-outline","slot","start","color","medium"],["color","medium"],["name","crescent","slot","end","color","medium"],["name","checkmark-circle-outline","slot","start","color","success"],[1,"wallet-status"]],template:function(h,pe){1&h&&(C.j41(0,"ion-content",0)(1,"ion-list")(2,"ion-item-group")(3,"ion-item-divider")(4,"ion-label"),C.EFF(5,"Wallet"),C.k0s()(),C.DNE(6,be,4,0,"ion-item",1)(7,we,4,0,"ion-item",1)(8,he,5,0,"ion-item",2)(9,oe,9,9,"ion-item",2),C.k0s(),C.j41(10,"ion-item-group")(11,"ion-item-divider")(12,"ion-label"),C.EFF(13,"Settings"),C.k0s()(),C.j41(14,"ion-item",3),C.bIt("click",function(){return pe.selectOption("profile")}),C.nrm(15,"ion-icon",4),C.j41(16,"ion-label"),C.EFF(17,"Profile"),C.k0s()(),C.j41(18,"ion-item",3),C.bIt("click",function(){return pe.selectOption("preferences")}),C.nrm(19,"ion-icon",5),C.j41(20,"ion-label"),C.EFF(21,"Preferences"),C.k0s()(),C.j41(22,"ion-item",3),C.bIt("click",function(){return pe.selectOption("help")}),C.nrm(23,"ion-icon",6),C.j41(24,"ion-label"),C.EFF(25,"Help & Support"),C.k0s()(),C.j41(26,"ion-item",3),C.bIt("click",function(){return pe.selectOption("about")}),C.nrm(27,"ion-icon",7),C.j41(28,"ion-label"),C.EFF(29,"About"),C.k0s()()(),C.j41(30,"ion-item",8),C.nrm(31,"div",9),C.k0s(),C.j41(32,"ion-item",10),C.bIt("click",function(){return pe.selectOption("logout")}),C.nrm(33,"ion-icon",11),C.j41(34,"ion-label",12),C.EFF(35,"Logout"),C.k0s()()()()),2&h&&(C.R7$(6),C.Y8G("ngIf","disconnected"===pe.connectionStatus),C.R7$(),C.Y8G("ngIf","connected"===pe.connectionStatus),C.R7$(),C.Y8G("ngIf","connecting"===pe.connectionStatus),C.R7$(),C.Y8G("ngIf","connected"===pe.connectionStatus&&pe.walletAddress))},dependencies:[_e.W9,_e.iq,_e.uz,_e.Dg,_e.jh,_e.he,_e.nf,_e.w2,ve.bT,ve.P9],styles:[".settings-popover-content[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;--background: #ffffff}ion-list[_ngcontent-%COMP%]{padding:0;background:transparent}ion-item[_ngcontent-%COMP%]{--padding-start: 16px;--padding-end: 16px;--min-height: 48px;--background: transparent;--color: var(--ion-text-color);--border-color: var(--ion-color-step-150);--inner-border-width: 0 0 1px 0}ion-item[_ngcontent-%COMP%]:hover{--background: var(--ion-color-primary-tint)}ion-item.logout-item[_ngcontent-%COMP%]{--color: var(--ion-color-danger)}ion-item.logout-item[_ngcontent-%COMP%]:hover{--background: var(--ion-color-danger-tint)}.divider[_ngcontent-%COMP%]{width:100%;height:1px;background:var(--ion-color-primary-shade);margin:8px 0}ion-icon[_ngcontent-%COMP%]{margin-right:12px}ion-item-divider[_ngcontent-%COMP%]{--background: var(--ion-color-primary);--color: var(--ion-color-primary-contrast);font-weight:600;font-size:.9em;text-transform:uppercase;letter-spacing:.5px;--padding-start: 16px;--padding-end: 16px}ion-item-group[_ngcontent-%COMP%]{margin-bottom:12px}ion-item-group[_ngcontent-%COMP%]:last-of-type{margin-bottom:0}.wallet-address[_ngcontent-%COMP%]{font-family:monospace;font-size:.85em;color:var(--ion-color-medium)}ion-item[color=primary][_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], ion-item[color=primary][_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--ion-color-secondary)}ion-item[color=warning][_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], ion-item[color=warning][_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--ion-color-warning)}ion-item[color=success][_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], ion-item[color=success][_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--ion-color-success)}ion-item[color=medium][_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], ion-item[color=medium][_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--ion-color-medium)}ion-item[_ngcontent-%COMP%]   .wallet-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}ion-item[_ngcontent-%COMP%]   .wallet-status[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:1rem;font-weight:600;color:var(--ion-color-success)}ion-item[_ngcontent-%COMP%]   .wallet-status[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.85em;font-family:monospace;color:var(--ion-color-tertiary);background:var(--ion-color-primary-tint);padding:2px 6px;border-radius:4px}ion-spinner[_ngcontent-%COMP%]{--color: var(--ion-color-secondary)}ion-item[button][_ngcontent-%COMP%]:hover{--background: var(--ion-color-primary-tint);transition:all .2s ease-in-out}ion-item[button][_ngcontent-%COMP%]:active{--background: var(--ion-color-primary-shade)}ion-icon[name=wallet-outline][_ngcontent-%COMP%]{color:var(--ion-color-secondary)}ion-icon[name=unlink-outline][_ngcontent-%COMP%]{color:var(--ion-color-tertiary)}ion-icon[name=checkmark-circle-outline][_ngcontent-%COMP%]{color:var(--ion-color-success)}ion-icon[name=hourglass-outline][_ngcontent-%COMP%]{color:var(--ion-color-tertiary)}ion-icon[name=person-outline][_ngcontent-%COMP%], ion-icon[name=options-outline][_ngcontent-%COMP%], ion-icon[name=help-circle-outline][_ngcontent-%COMP%], ion-icon[name=information-circle-outline][_ngcontent-%COMP%]{color:var(--ion-color-secondary)}ion-icon[name=log-out-outline][_ngcontent-%COMP%]{color:var(--ion-color-danger)}"]}))}return le(),Z})()},5424:(Ve,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.IWatch=void 0,A.IWatch=class U{}},5543:(Ve,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.ONE_THOUSAND=A.ONE_HUNDRED=void 0,A.ONE_HUNDRED=100,A.ONE_THOUSAND=1e3},5784:(Ve,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.delay=void 0,A.delay=function U(V){return new Promise(C=>{setTimeout(()=>{C(!0)},V)})}},5880:(Ve,A,U)=>{const V=U(504);function C(h,pe){return h[pe]^h[pe+1]<<8^h[pe+2]<<16^h[pe+3]<<24}function _e(h,pe,ie,Y,M,m){we[h]=we[h]+we[pe]+M,we[Y]=de(we[Y]^we[h],16),we[ie]=we[ie]+we[Y],we[pe]=de(we[pe]^we[ie],12),we[h]=we[h]+we[pe]+m,we[Y]=de(we[Y]^we[h],8),we[ie]=we[ie]+we[Y],we[pe]=de(we[pe]^we[ie],7)}function de(h,pe){return h>>>pe^h<<32-pe}const ve=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),be=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),we=new Uint32Array(16),he=new Uint32Array(16);function oe(h,pe){let ie=0;for(ie=0;ie<8;ie++)we[ie]=h.h[ie],we[ie+8]=ve[ie];for(we[12]^=h.t,we[13]^=h.t/4294967296,pe&&(we[14]=~we[14]),ie=0;ie<16;ie++)he[ie]=C(h.b,4*ie);for(ie=0;ie<10;ie++)_e(0,4,8,12,he[be[16*ie+0]],he[be[16*ie+1]]),_e(1,5,9,13,he[be[16*ie+2]],he[be[16*ie+3]]),_e(2,6,10,14,he[be[16*ie+4]],he[be[16*ie+5]]),_e(3,7,11,15,he[be[16*ie+6]],he[be[16*ie+7]]),_e(0,5,10,15,he[be[16*ie+8]],he[be[16*ie+9]]),_e(1,6,11,12,he[be[16*ie+10]],he[be[16*ie+11]]),_e(2,7,8,13,he[be[16*ie+12]],he[be[16*ie+13]]),_e(3,4,9,14,he[be[16*ie+14]],he[be[16*ie+15]]);for(ie=0;ie<8;ie++)h.h[ie]^=we[ie]^we[ie+8]}function Pe(h,pe){if(!(h>0&&h<=32))throw new Error("Incorrect output length, should be in [1, 32]");const ie=pe?pe.length:0;if(pe&&!(ie>0&&ie<=32))throw new Error("Incorrect key length, should be in [1, 32]");const Y={h:new Uint32Array(ve),b:new Uint8Array(64),c:0,t:0,outlen:h};return Y.h[0]^=16842752^ie<<8^h,ie>0&&(le(Y,pe),Y.c=64),Y}function le(h,pe){for(let ie=0;ie<pe.length;ie++)64===h.c&&(h.t+=h.c,oe(h,!1),h.c=0),h.b[h.c++]=pe[ie]}function Z(h){for(h.t+=h.c;h.c<64;)h.b[h.c++]=0;oe(h,!0);const pe=new Uint8Array(h.outlen);for(let ie=0;ie<h.outlen;ie++)pe[ie]=h.h[ie>>2]>>8*(3&ie)&255;return pe}function me(h,pe,ie){ie=ie||32,h=V.normalizeInput(h);const Y=Pe(ie,pe);return le(Y,h),Z(Y)}Ve.exports={blake2s:me,blake2sHex:function xe(h,pe,ie){const Y=me(h,pe,ie);return V.toHex(Y)},blake2sInit:Pe,blake2sUpdate:le,blake2sFinal:Z}},6555:(Ve,A,U)=>{"use strict";U.d(A,{B4:()=>h,CQ:()=>ue,CW:()=>q,Ei:()=>le,F8:()=>B,P5:()=>xe,TH:()=>fe,Vl:()=>M,Vr:()=>m,WM:()=>pe,WQ:()=>Y,im:()=>ie,jm:()=>we,lD:()=>de,qh:()=>Pe,rE:()=>he,ry:()=>oe,xn:()=>be});const V=BigInt(2**32-1),C=BigInt(32);function _e(b,x=!1){return x?{h:Number(b&V),l:Number(b>>C&V)}:{h:0|Number(b>>C&V),l:0|Number(b&V)}}function de(b,x=!1){const S=b.length;let P=new Uint32Array(S),R=new Uint32Array(S);for(let Ie=0;Ie<S;Ie++){const{h:$e,l:ne}=_e(b[Ie],x);[P[Ie],R[Ie]]=[$e,ne]}return[P,R]}const be=(b,x,S)=>b>>>S,we=(b,x,S)=>b<<32-S|x>>>S,he=(b,x,S)=>b>>>S|x<<32-S,oe=(b,x,S)=>b<<32-S|x>>>S,Pe=(b,x,S)=>b<<64-S|x>>>S-32,le=(b,x,S)=>b>>>S-32|x<<64-S,xe=(b,x,S)=>b<<S|x>>>32-S,h=(b,x,S)=>x<<S|b>>>32-S,pe=(b,x,S)=>x<<S-32|b>>>64-S,ie=(b,x,S)=>b<<S-32|x>>>64-S;function Y(b,x,S,P){const R=(x>>>0)+(P>>>0);return{h:b+S+(R/2**32|0)|0,l:0|R}}const M=(b,x,S)=>(b>>>0)+(x>>>0)+(S>>>0),m=(b,x,S,P)=>x+S+P+(b/2**32|0)|0,q=(b,x,S,P)=>(b>>>0)+(x>>>0)+(S>>>0)+(P>>>0),ue=(b,x,S,P,R)=>x+S+P+R+(b/2**32|0)|0,B=(b,x,S,P,R)=>(b>>>0)+(x>>>0)+(S>>>0)+(P>>>0)+(R>>>0),fe=(b,x,S,P,R,Ie)=>x+S+P+R+Ie+(b/2**32|0)|0},6669:(Ve,A,U)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});const V=U(584);V.__exportStar(U(5295),A),V.__exportStar(U(7486),A),V.__exportStar(U(1387),A),V.__exportStar(U(9083),A)},7486:(Ve,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.Watch=void 0;class U{constructor(){this.timestamps=new Map}start(C){if(this.timestamps.has(C))throw new Error(`Watch already started for label: ${C}`);this.timestamps.set(C,{started:Date.now()})}stop(C){const _e=this.get(C);if(typeof _e.elapsed<"u")throw new Error(`Watch already stopped for label: ${C}`);const de=Date.now()-_e.started;this.timestamps.set(C,{started:_e.started,elapsed:de})}get(C){const _e=this.timestamps.get(C);if(typeof _e>"u")throw new Error(`No timestamp found for label: ${C}`);return _e}elapsed(C){const _e=this.get(C);return _e.elapsed||Date.now()-_e.started}}A.Watch=U,A.default=U},7793:(Ve,A)=>{"use strict";function U(Z){let me;return typeof window<"u"&&typeof window[Z]<"u"&&(me=window[Z]),me}function V(Z){const me=U(Z);if(!me)throw new Error(`${Z} is not defined in Window`);return me}Object.defineProperty(A,"__esModule",{value:!0}),A.getLocalStorage=A.getLocalStorageOrThrow=A.getCrypto=A.getCryptoOrThrow=A.getLocation=A.getLocationOrThrow=A.getNavigator=A.getNavigatorOrThrow=A.getDocument=A.getDocumentOrThrow=A.getFromWindowOrThrow=A.getFromWindow=void 0,A.getFromWindow=U,A.getFromWindowOrThrow=V,A.getDocumentOrThrow=function C(){return V("document")},A.getDocument=function _e(){return U("document")},A.getNavigatorOrThrow=function de(){return V("navigator")},A.getNavigator=function ve(){return U("navigator")},A.getLocationOrThrow=function be(){return V("location")},A.getLocation=function we(){return U("location")},A.getCryptoOrThrow=function he(){return V("crypto")},A.getCrypto=function oe(){return U("crypto")},A.getLocalStorageOrThrow=function Pe(){return V("localStorage")},A.getLocalStorage=function le(){return U("localStorage")}},8186:(Ve,A,U)=>{"use strict";U.r(A),U.d(A,{__assign:()=>_e,__asyncDelegator:()=>Y,__asyncGenerator:()=>ie,__asyncValues:()=>M,__await:()=>pe,__awaiter:()=>he,__classPrivateFieldGet:()=>B,__classPrivateFieldSet:()=>fe,__createBinding:()=>Pe,__decorate:()=>ve,__exportStar:()=>le,__extends:()=>C,__generator:()=>oe,__importDefault:()=>ue,__importStar:()=>q,__makeTemplateObject:()=>m,__metadata:()=>we,__param:()=>be,__read:()=>me,__rest:()=>de,__spread:()=>xe,__spreadArrays:()=>h,__values:()=>Z});var V=function(_,I){return(V=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,x){b.__proto__=x}||function(b,x){for(var S in x)x.hasOwnProperty(S)&&(b[S]=x[S])})(_,I)};function C(_,I){function b(){this.constructor=_}V(_,I),_.prototype=null===I?Object.create(I):(b.prototype=I.prototype,new b)}var _e=function(){return _e=Object.assign||function(I){for(var b,x=1,S=arguments.length;x<S;x++)for(var P in b=arguments[x])Object.prototype.hasOwnProperty.call(b,P)&&(I[P]=b[P]);return I},_e.apply(this,arguments)};function de(_,I){var b={};for(var x in _)Object.prototype.hasOwnProperty.call(_,x)&&I.indexOf(x)<0&&(b[x]=_[x]);if(null!=_&&"function"==typeof Object.getOwnPropertySymbols){var S=0;for(x=Object.getOwnPropertySymbols(_);S<x.length;S++)I.indexOf(x[S])<0&&Object.prototype.propertyIsEnumerable.call(_,x[S])&&(b[x[S]]=_[x[S]])}return b}function ve(_,I,b,x){var R,S=arguments.length,P=S<3?I:null===x?x=Object.getOwnPropertyDescriptor(I,b):x;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)P=Reflect.decorate(_,I,b,x);else for(var Ie=_.length-1;Ie>=0;Ie--)(R=_[Ie])&&(P=(S<3?R(P):S>3?R(I,b,P):R(I,b))||P);return S>3&&P&&Object.defineProperty(I,b,P),P}function be(_,I){return function(b,x){I(b,x,_)}}function we(_,I){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(_,I)}function he(_,I,b,x){return new(b||(b=Promise))(function(P,R){function Ie(Me){try{ne(x.next(Me))}catch(mt){R(mt)}}function $e(Me){try{ne(x.throw(Me))}catch(mt){R(mt)}}function ne(Me){Me.done?P(Me.value):function S(P){return P instanceof b?P:new b(function(R){R(P)})}(Me.value).then(Ie,$e)}ne((x=x.apply(_,I||[])).next())})}function oe(_,I){var x,S,P,R,b={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]};return R={next:Ie(0),throw:Ie(1),return:Ie(2)},"function"==typeof Symbol&&(R[Symbol.iterator]=function(){return this}),R;function Ie(ne){return function(Me){return function $e(ne){if(x)throw new TypeError("Generator is already executing.");for(;b;)try{if(x=1,S&&(P=2&ne[0]?S.return:ne[0]?S.throw||((P=S.return)&&P.call(S),0):S.next)&&!(P=P.call(S,ne[1])).done)return P;switch(S=0,P&&(ne=[2&ne[0],P.value]),ne[0]){case 0:case 1:P=ne;break;case 4:return b.label++,{value:ne[1],done:!1};case 5:b.label++,S=ne[1],ne=[0];continue;case 7:ne=b.ops.pop(),b.trys.pop();continue;default:if(!(P=(P=b.trys).length>0&&P[P.length-1])&&(6===ne[0]||2===ne[0])){b=0;continue}if(3===ne[0]&&(!P||ne[1]>P[0]&&ne[1]<P[3])){b.label=ne[1];break}if(6===ne[0]&&b.label<P[1]){b.label=P[1],P=ne;break}if(P&&b.label<P[2]){b.label=P[2],b.ops.push(ne);break}P[2]&&b.ops.pop(),b.trys.pop();continue}ne=I.call(_,b)}catch(Me){ne=[6,Me],S=0}finally{x=P=0}if(5&ne[0])throw ne[1];return{value:ne[0]?ne[1]:void 0,done:!0}}([ne,Me])}}}function Pe(_,I,b,x){void 0===x&&(x=b),_[x]=I[b]}function le(_,I){for(var b in _)"default"!==b&&!I.hasOwnProperty(b)&&(I[b]=_[b])}function Z(_){var I="function"==typeof Symbol&&Symbol.iterator,b=I&&_[I],x=0;if(b)return b.call(_);if(_&&"number"==typeof _.length)return{next:function(){return _&&x>=_.length&&(_=void 0),{value:_&&_[x++],done:!_}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")}function me(_,I){var b="function"==typeof Symbol&&_[Symbol.iterator];if(!b)return _;var S,R,x=b.call(_),P=[];try{for(;(void 0===I||I-- >0)&&!(S=x.next()).done;)P.push(S.value)}catch(Ie){R={error:Ie}}finally{try{S&&!S.done&&(b=x.return)&&b.call(x)}finally{if(R)throw R.error}}return P}function xe(){for(var _=[],I=0;I<arguments.length;I++)_=_.concat(me(arguments[I]));return _}function h(){for(var _=0,I=0,b=arguments.length;I<b;I++)_+=arguments[I].length;var x=Array(_),S=0;for(I=0;I<b;I++)for(var P=arguments[I],R=0,Ie=P.length;R<Ie;R++,S++)x[S]=P[R];return x}function pe(_){return this instanceof pe?(this.v=_,this):new pe(_)}function ie(_,I,b){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var S,x=b.apply(_,I||[]),P=[];return S={},R("next"),R("throw"),R("return"),S[Symbol.asyncIterator]=function(){return this},S;function R(Se){x[Se]&&(S[Se]=function(Ze){return new Promise(function(Bt,Rt){P.push([Se,Ze,Bt,Rt])>1||Ie(Se,Ze)})})}function Ie(Se,Ze){try{!function $e(Se){Se.value instanceof pe?Promise.resolve(Se.value.v).then(ne,Me):mt(P[0][2],Se)}(x[Se](Ze))}catch(Bt){mt(P[0][3],Bt)}}function ne(Se){Ie("next",Se)}function Me(Se){Ie("throw",Se)}function mt(Se,Ze){Se(Ze),P.shift(),P.length&&Ie(P[0][0],P[0][1])}}function Y(_){var I,b;return I={},x("next"),x("throw",function(S){throw S}),x("return"),I[Symbol.iterator]=function(){return this},I;function x(S,P){I[S]=_[S]?function(R){return(b=!b)?{value:pe(_[S](R)),done:"return"===S}:P?P(R):R}:P}}function M(_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var b,I=_[Symbol.asyncIterator];return I?I.call(_):(_=Z(_),b={},x("next"),x("throw"),x("return"),b[Symbol.asyncIterator]=function(){return this},b);function x(P){b[P]=_[P]&&function(R){return new Promise(function(Ie,$e){!function S(P,R,Ie,$e){Promise.resolve($e).then(function(ne){P({value:ne,done:Ie})},R)}(Ie,$e,(R=_[P](R)).done,R.value)})}}}function m(_,I){return Object.defineProperty?Object.defineProperty(_,"raw",{value:I}):_.raw=I,_}function q(_){if(_&&_.__esModule)return _;var I={};if(null!=_)for(var b in _)Object.hasOwnProperty.call(_,b)&&(I[b]=_[b]);return I.default=_,I}function ue(_){return _&&_.__esModule?_:{default:_}}function B(_,I){if(!I.has(_))throw new TypeError("attempted to get private field on non-instance");return I.get(_)}function fe(_,I,b){if(!I.has(_))throw new TypeError("attempted to set private field on non-instance");return I.set(_,b),b}},8909:(Ve,A,U)=>{"use strict";U.d(A,{D:()=>$I});var V={};U.r(V),U.d(V,{identity:()=>lb});var C={};U.r(C),U.d(C,{base2:()=>db});var _e={};U.r(_e),U.d(_e,{base8:()=>fb});var de={};U.r(de),U.d(de,{base10:()=>hb});var ve={};U.r(ve),U.d(ve,{base16:()=>pb,base16upper:()=>gb});var be={};U.r(be),U.d(be,{base32:()=>es,base32hex:()=>bb,base32hexpad:()=>vb,base32hexpadupper:()=>xb,base32hexupper:()=>wb,base32pad:()=>_b,base32padupper:()=>mb,base32upper:()=>yb,base32z:()=>Eb});var we={};U.r(we),U.d(we,{base36:()=>Ab,base36upper:()=>Ib});var he={};U.r(he),U.d(he,{base58btc:()=>or,base58flickr:()=>Sb});var oe={};U.r(oe),U.d(oe,{base64:()=>Db,base64pad:()=>Ob,base64url:()=>Cb,base64urlpad:()=>Pb});var Pe={};U.r(Pe),U.d(Pe,{base256emoji:()=>Ub});var le={};U.r(le),U.d(le,{sha256:()=>r1,sha512:()=>i1});var Z={};U.r(Z),U.d(Z,{identity:()=>o1});var me={};U.r(me),U.d(me,{code:()=>c1,decode:()=>l1,encode:()=>u1,name:()=>a1});var xe={};U.r(xe),U.d(xe,{code:()=>p1,decode:()=>y1,encode:()=>g1,name:()=>h1});var h=U(467),pe=U(4412),ie=U(1413),Y=U(4356),M=U.n(Y),m=U(6669);class q{}class ue extends q{constructor(e){super()}}const B=m.FIVE_SECONDS,fe_pulse="heartbeat_pulse";class _ extends ue{constructor(e){super(e),this.events=new Y.EventEmitter,this.interval=B,this.interval=e?.interval||B}static init(e){return(0,h.A)(function*(){const t=new _(e);return yield t.init(),t})()}init(){var e=this;return(0,h.A)(function*(){yield e.initialize()})()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}initialize(){var e=this;return(0,h.A)(function*(){e.intervalRef=setInterval(()=>e.pulse(),(0,m.toMiliseconds)(e.interval))})()}pulse(){this.events.emit(fe_pulse)}}const I=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,b=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,x=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function S(n,e){if(!("__proto__"===n||"constructor"===n&&e&&"object"==typeof e&&"prototype"in e))return e;!function P(n){console.warn(`[destr] Dropping "${n}" key to prevent prototype pollution.`)}(n)}function R(n,e={}){if("string"!=typeof n)return n;if('"'===n[0]&&'"'===n[n.length-1]&&-1===n.indexOf("\\"))return n.slice(1,-1);const t=n.trim();if(t.length<=9)switch(t.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!x.test(n)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return n}try{if(I.test(n)||b.test(n)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(n,S)}return JSON.parse(n)}catch(r){if(e.strict)throw r;return n}}function ne(n,...e){try{return function $e(n){return n&&"function"==typeof n.then?n:Promise.resolve(n)}(n(...e))}catch(t){return Promise.reject(t)}}function Se(n){if(function Me(n){const e=typeof n;return null===n||"object"!==e&&"function"!==e}(n))return String(n);if(function mt(n){const e=Object.getPrototypeOf(n);return!e||e.isPrototypeOf(Object)}(n)||Array.isArray(n))return JSON.stringify(n);if("function"==typeof n.toJSON)return Se(n.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Ze="base64:";function qe(n){return n&&n.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function ut(...n){return qe(n.join(":"))}function lt(n){return(n=qe(n))?n+":":""}const Zn=()=>{const n=new Map;return{name:"memory",getInstance:()=>n,hasItem:e=>n.has(e),getItem:e=>n.get(e)??null,getItemRaw:e=>n.get(e)??null,setItem(e,t){n.set(e,t)},setItemRaw(e,t){n.set(e,t)},removeItem(e){n.delete(e)},getKeys:()=>[...n.keys()],clear(){n.clear()},dispose(){n.clear()}}};function Ps(n,e,t){return n.watch?n.watch((r,i)=>e(r,t+i)):()=>{}}function Ui(n){return sn.apply(this,arguments)}function sn(){return(sn=(0,h.A)(function*(n){"function"==typeof n.dispose&&(yield ne(n.dispose))})).apply(this,arguments)}function bt(n){return new Promise((e,t)=>{n.oncomplete=n.onsuccess=()=>e(n.result),n.onabort=n.onerror=()=>t(n.error)})}function Ts(n,e){let t;return(i,s)=>(()=>{if(t)return t;const i=indexedDB.open(n);return i.onupgradeneeded=()=>i.result.createObjectStore(e),t=bt(i),t.then(s=>{s.onclose=()=>t=void 0},()=>{}),t})().then(o=>s(o.transaction(e,i).objectStore(e)))}let Ni;function on(){return Ni||(Ni=Ts("keyval-store","keyval")),Ni}function Bs(n,e=on()){return e("readonly",t=>bt(t.get(n)))}function Ue(n){if("string"!=typeof n)throw new Error("Cannot safe json parse value of type "+typeof n);try{return(n=>{const t=n.replace(/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,'$1"$2n"$3');return JSON.parse(t,(r,i)=>"string"==typeof i&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)})(n)}catch{return n}}function Ne(n){return"string"==typeof n?n:(n=>JSON.stringify(n,(e,t)=>"bigint"==typeof t?t.toString()+"n":t))(n)||""}var ke=(n={})=>{const e=n.base&&n.base.length>0?`${n.base}:`:"",t=i=>e+i;let r;return n.dbName&&n.storeName&&(r=Ts(n.dbName,n.storeName)),{name:"idb-keyval",options:n,hasItem:i=>(0,h.A)(function*(){return!(typeof(yield Bs(t(i),r))>"u")})(),getItem:i=>(0,h.A)(function*(){return(yield Bs(t(i),r))??null})(),setItem:(i,s)=>function Xo(n,e,t=on()){return t("readwrite",r=>(r.put(e,n),bt(r.transaction)))}(t(i),s,r),removeItem:i=>function qr(n,e=on()){return e("readwrite",t=>(t.delete(n),bt(t.transaction)))}(t(i),r),getKeys:()=>function v(n=on()){return n("readonly",e=>{if(e.getAllKeys)return bt(e.getAllKeys());const t=[];return function ki(n,e){return n.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},bt(n.transaction)}(e,r=>t.push(r.key)).then(()=>t)})}(r),clear:()=>function Xn(n=on()){return n("readwrite",e=>(e.clear(),bt(e.transaction)))}(r)}};class st{constructor(){this.indexedDb=function Jo(n={}){const e={mounts:{"":n.driver||Zn()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},r=(u,l)=>e.mountpoints.filter(d=>d.startsWith(u)||l&&u.startsWith(d)).map(d=>({relativeBase:u.length>d.length?u.slice(d.length):void 0,mountpoint:d,driver:e.mounts[d]})),i=(u,l)=>{if(e.watching){l=qe(l);for(const d of e.watchListeners)d(u,l)}},s=function(){var u=(0,h.A)(function*(){if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=yield Ps(e.mounts[l],i,l)}});return function(){return u.apply(this,arguments)}}(),o=function(){var u=(0,h.A)(function*(){if(e.watching){for(const l in e.unwatch)yield e.unwatch[l]();e.unwatch={},e.watching=!1}});return function(){return u.apply(this,arguments)}}(),a=(u,l,d)=>{const f=new Map,p=g=>{let y=f.get(g.base);return y||(y={driver:g.driver,base:g.base,items:[]},f.set(g.base,y)),y};for(const g of u){const y="string"==typeof g,w=qe(y?g:g.key),T=y?void 0:g.value,N=y||!g.options?l:{...l,...g.options},E=t(w);p(E).items.push({key:w,value:T,relativeKey:E.relativeKey,options:N})}return Promise.all([...f.values()].map(g=>d(g))).then(g=>g.flat())},c={hasItem(u,l={}){u=qe(u);const{relativeKey:d,driver:f}=t(u);return ne(f.hasItem,d,l)},getItem(u,l={}){u=qe(u);const{relativeKey:d,driver:f}=t(u);return ne(f.getItem,d,l).then(p=>R(p))},getItems:(u,l={})=>a(u,l,d=>d.driver.getItems?ne(d.driver.getItems,d.items.map(f=>({key:f.relativeKey,options:f.options})),l).then(f=>f.map(p=>({key:ut(d.base,p.key),value:R(p.value)}))):Promise.all(d.items.map(f=>ne(d.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:R(p)}))))),getItemRaw(u,l={}){u=qe(u);const{relativeKey:d,driver:f}=t(u);return f.getItemRaw?ne(f.getItemRaw,d,l):ne(f.getItem,d,l).then(p=>function Rt(n){return"string"==typeof n&&n.startsWith(Ze)?function $r(n){return globalThis.Buffer?Buffer.from(n,"base64"):Uint8Array.from(globalThis.atob(n),e=>e.codePointAt(0))}(n.slice(7)):n}(p))},setItem(u,l){return(0,h.A)(function*(d,f,p={}){if(void 0===f)return c.removeItem(d);d=qe(d);const{relativeKey:g,driver:y}=t(d);y.setItem&&(yield ne(y.setItem,g,Se(f),p),y.watch||i("update",d))}).apply(this,arguments)},setItems:(u,l)=>(0,h.A)(function*(){yield a(u,l,function(){var d=(0,h.A)(function*(f){if(f.driver.setItems)return ne(f.driver.setItems,f.items.map(p=>({key:p.relativeKey,value:Se(p.value),options:p.options})),l);f.driver.setItem&&(yield Promise.all(f.items.map(p=>ne(f.driver.setItem,p.relativeKey,Se(p.value),p.options))))});return function(f){return d.apply(this,arguments)}}())})(),setItemRaw(u,l){return(0,h.A)(function*(d,f,p={}){if(void 0===f)return c.removeItem(d,p);d=qe(d);const{relativeKey:g,driver:y}=t(d);if(y.setItemRaw)yield ne(y.setItemRaw,g,f,p);else{if(!y.setItem)return;yield ne(y.setItem,g,function Bt(n){return"string"==typeof n?n:Ze+function Jn(n){return globalThis.Buffer?Buffer.from(n).toString("base64"):globalThis.btoa(String.fromCodePoint(...n))}(n)}(f),p)}y.watch||i("update",d)}).apply(this,arguments)},removeItem(u){return(0,h.A)(function*(l,d={}){"boolean"==typeof d&&(d={removeMeta:d}),l=qe(l);const{relativeKey:f,driver:p}=t(l);p.removeItem&&(yield ne(p.removeItem,f,d),(d.removeMeta||d.removeMata)&&(yield ne(p.removeItem,f+"$",d)),p.watch||i("remove",l))}).apply(this,arguments)},getMeta(u){return(0,h.A)(function*(l,d={}){"boolean"==typeof d&&(d={nativeOnly:d}),l=qe(l);const{relativeKey:f,driver:p}=t(l),g=Object.create(null);if(p.getMeta&&Object.assign(g,yield ne(p.getMeta,f,d)),!d.nativeOnly){const y=yield ne(p.getItem,f+"$",d).then(w=>R(w));y&&"object"==typeof y&&("string"==typeof y.atime&&(y.atime=new Date(y.atime)),"string"==typeof y.mtime&&(y.mtime=new Date(y.mtime)),Object.assign(g,y))}return g}).apply(this,arguments)},setMeta(u,l,d={}){return this.setItem(u+"$",l,d)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},getKeys(u){return(0,h.A)(function*(l,d={}){l=lt(l);const f=r(l,!0);let p=[];const g=[];let y=!0;for(const T of f){T.driver.flags?.maxDepth||(y=!1);const N=yield ne(T.driver.getKeys,T.relativeBase,d);for(const E of N){const k=T.mountpoint+qe(E);p.some(X=>k.startsWith(X))||g.push(k)}p=[T.mountpoint,...p.filter(E=>!E.startsWith(T.mountpoint))]}const w=void 0!==d.maxDepth&&!y;return g.filter(T=>(!w||function St(n,e){if(void 0===e)return!0;let t=0,r=n.indexOf(":");for(;r>-1;)t++,r=n.indexOf(":",r+1);return t<=e}(T,d.maxDepth))&&function _r(n,e){return e?n.startsWith(e)&&"$"!==n[n.length-1]:"$"!==n[n.length-1]}(T,l))}).apply(this,arguments)},clear(u){return(0,h.A)(function*(l,d={}){l=lt(l),yield Promise.all(r(l,!1).map(function(){var f=(0,h.A)(function*(p){if(p.driver.clear)return ne(p.driver.clear,p.relativeBase,d);if(p.driver.removeItem){const g=yield p.driver.getKeys(p.relativeBase||"",d);return Promise.all(g.map(y=>p.driver.removeItem(y,d)))}});return function(p){return f.apply(this,arguments)}}()))}).apply(this,arguments)},dispose:()=>(0,h.A)(function*(){yield Promise.all(Object.values(e.mounts).map(u=>Ui(u)))})(),watch:u=>(0,h.A)(function*(){return yield s(),e.watchListeners.push(u),(0,h.A)(function*(){e.watchListeners=e.watchListeners.filter(l=>l!==u),0===e.watchListeners.length&&(yield o())})})(),unwatch:()=>(0,h.A)(function*(){e.watchListeners=[],yield o()})(),mount(u,l){if((u=lt(u))&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((d,f)=>f.length-d.length)),e.mounts[u]=l,e.watching&&Promise.resolve(Ps(l,i,u)).then(d=>{e.unwatch[u]=d}).catch(console.error),c},unmount(u){return(0,h.A)(function*(l,d=!0){(l=lt(l))&&e.mounts[l]&&(e.watching&&l in e.unwatch&&(e.unwatch[l]?.(),delete e.unwatch[l]),d&&(yield Ui(e.mounts[l])),e.mountpoints=e.mountpoints.filter(f=>f!==l),delete e.mounts[l])}).apply(this,arguments)},getMount(u=""){u=qe(u)+":";const l=t(u);return{driver:l.driver,base:l.base}},getMounts:(u="",l={})=>(u=qe(u),r(u,l.parents).map(f=>({driver:f.driver,base:f.mountpoint}))),keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,d={})=>c.setItem(u,l,d),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}({driver:ke({dbName:"WALLET_CONNECT_V2_INDEXED_DB",storeName:"keyvaluestorage"})})}getKeys(){var e=this;return(0,h.A)(function*(){return e.indexedDb.getKeys()})()}getEntries(){var e=this;return(0,h.A)(function*(){return(yield e.indexedDb.getItems(yield e.indexedDb.getKeys())).map(t=>[t.key,t.value])})()}getItem(e){var t=this;return(0,h.A)(function*(){const r=yield t.indexedDb.getItem(e);if(null!==r)return r})()}setItem(e,t){var r=this;return(0,h.A)(function*(){yield r.indexedDb.setItem(e,Ne(t))})()}removeItem(e){var t=this;return(0,h.A)(function*(){yield t.indexedDb.removeItem(e)})()}}var ht=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yt={exports:{}};function gt(n){var e;return[n[0],Ue(null!=(e=n[1])?e:"")]}!function(){let n;function e(){}n=e,n.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},n.prototype.setItem=function(t,r){this[t]=String(r)},n.prototype.removeItem=function(t){delete this[t]},n.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(r){t[r]=void 0,delete t[r]})},n.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},n.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),yt.exports=typeof ht<"u"&&ht.localStorage?ht.localStorage:typeof window<"u"&&window.localStorage?window.localStorage:new e}();class Kt{constructor(){this.localStorage=yt.exports}getKeys(){var e=this;return(0,h.A)(function*(){return Object.keys(e.localStorage)})()}getEntries(){var e=this;return(0,h.A)(function*(){return Object.entries(e.localStorage).map(gt)})()}getItem(e){var t=this;return(0,h.A)(function*(){const r=t.localStorage.getItem(e);if(null!==r)return Ue(r)})()}setItem(e,t){var r=this;return(0,h.A)(function*(){r.localStorage.setItem(e,Ne(t))})()}removeItem(e){var t=this;return(0,h.A)(function*(){t.localStorage.removeItem(e)})()}}const Rs=function(){var n=(0,h.A)(function*(e,t,r){const i="wc_storage_version",s=yield t.getItem(i);if(s&&s>=1)return void r(t);const o=yield e.getKeys();if(!o.length)return void r(t);const a=[];for(;o.length;){const c=o.shift();if(!c)continue;const u=c.toLowerCase();if(u.includes("wc@")||u.includes("walletconnect")||u.includes("wc_")||u.includes("wallet_connect")){const l=yield e.getItem(c);yield t.setItem(c,l),a.push(c)}}yield t.setItem(i,1),r(t),ea(e,a)});return function(t,r,i){return n.apply(this,arguments)}}(),ea=function(){var n=(0,h.A)(function*(e,t){t.length&&t.forEach(function(){var r=(0,h.A)(function*(i){yield e.removeItem(i)});return function(i){return r.apply(this,arguments)}}())});return function(t,r){return n.apply(this,arguments)}}();class Li{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new Kt;this.storage=e;try{const t=new st;Rs(e,t,this.setInitialized)}catch{this.initialized=!0}}getKeys(){var e=this;return(0,h.A)(function*(){return yield e.initialize(),e.storage.getKeys()})()}getEntries(){var e=this;return(0,h.A)(function*(){return yield e.initialize(),e.storage.getEntries()})()}getItem(e){var t=this;return(0,h.A)(function*(){return yield t.initialize(),t.storage.getItem(e)})()}setItem(e,t){var r=this;return(0,h.A)(function*(){return yield r.initialize(),r.storage.setItem(e,t)})()}removeItem(e){var t=this;return(0,h.A)(function*(){return yield t.initialize(),t.storage.removeItem(e)})()}initialize(){var e=this;return(0,h.A)(function*(){e.initialized||(yield new Promise(t=>{const r=setInterval(()=>{e.initialized&&(clearInterval(r),t())},20)}))})()}}var Kr=U(1105),Qn=U.n(Kr);const Je="custom_context",Ye=1024e3;class He{constructor(e){this.nodeValue=e,this.sizeInBytes=(new TextEncoder).encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class Nt{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new He(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;null!==t;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}}class er{constructor(e,t=Ye){this.level=e??"error",this.levelValue=Kr.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new Nt(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Kr.levels.values.error?console.error(e):t===Kr.levels.values.warn?console.warn(e):t===Kr.levels.values.debug?console.debug(e):t===Kr.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Ne({timestamp:(new Date).toISOString(),log:e}));const t="string"==typeof e?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new Nt(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(Ne({extraMetadata:e})),new Blob(t,{type:"application/json"})}}class Vr{constructor(e,t=Ye){this.baseChunkLogger=new er(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=t,r.download=`walletconnect-logs-${(new Date).toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}}class fi{constructor(e,t=Ye){this.baseChunkLogger=new er(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var Mn=Object.defineProperty,rg=Object.defineProperties,ig=Object.getOwnPropertyDescriptors,Du=Object.getOwnPropertySymbols,sg=Object.prototype.hasOwnProperty,og=Object.prototype.propertyIsEnumerable,Ou=(n,e,t)=>e in n?Mn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Fs=(n,e)=>{for(var t in e||(e={}))sg.call(e,t)&&Ou(n,t,e[t]);if(Du)for(var t of Du(e))og.call(e,t)&&Ou(n,t,e[t]);return n},Us=(n,e)=>rg(n,ig(e));function na(n){return Us(Fs({},n),{level:n?.level||"info"})}function an(n,e=Je){let t="";return t=typeof n.bindings>"u"?function ag(n,e=Je){return n[e]||""}(n,e):n.bindings().context||"",t}function Xt(n,e,t=Je){const r=function ug(n,e,t=Je){const r=an(n,t);return r.trim()?`${r}/${e}`:e}(n,e,t);return function cg(n,e,t=Je){return n[t]=e,n}(n.child({context:r}),r,t)}var hg=Object.defineProperty,Cu=(n,e,t)=>((n,e,t)=>e in n?hg(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class gg extends q{constructor(e){super(),this.opts=e,Cu(this,"protocol","wc"),Cu(this,"version",2)}}var yg=Object.defineProperty;class bg extends q{constructor(e,t){super(),this.core=e,this.logger=t,((n,e,t)=>{((n,e,t)=>{e in n?yg(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t})(n,"symbol"!=typeof e?e+"":e,t)})(this,"records",new Map)}}class wg{constructor(e,t){this.logger=e,this.core=t}}class vg extends q{constructor(e,t){super(),this.relayer=e,this.logger=t}}class xg extends q{constructor(e){super()}}class Eg{constructor(e,t,r,i){this.core=e,this.logger=t,this.name=r}}class Dg extends q{constructor(e,t){super(),this.relayer=e,this.logger=t}}class Og extends q{constructor(e,t){super(),this.core=e,this.logger=t}}class Cg{constructor(e,t,r){this.core=e,this.logger=t,this.store=r}}class Pg{constructor(e,t){this.projectId=e,this.logger=t}}class Tg{constructor(e,t,r){this.core=e,this.logger=t,this.telemetryEnabled=r}}var Bg=Object.defineProperty,Pu=(n,e,t)=>((n,e,t)=>e in n?Bg(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);M();class Fg{constructor(e){this.opts=e,Pu(this,"protocol","wc"),Pu(this,"version",2)}}class Ug{constructor(e){this.client=e}}function Tu(n,...e){if(!function Ng(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&"Uint8Array"===n.constructor.name}(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function Bu(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}const hi="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,ra=n=>new DataView(n.buffer,n.byteOffset,n.byteLength);function Ru(n){return"string"==typeof n&&(n=function Lg(n){if("string"!=typeof n)throw new Error("utf8ToBytes expected string, got "+typeof n);return new Uint8Array((new TextEncoder).encode(n))}(n)),Tu(n),n}class Mg{clone(){return this._cloneInto()}}function Fu(n=32){if(hi&&"function"==typeof hi.getRandomValues)return hi.getRandomValues(new Uint8Array(n));if(hi&&"function"==typeof hi.randomBytes)return hi.randomBytes(n);throw new Error("crypto.getRandomValues must be defined")}class zg extends Mg{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ra(this.buffer)}update(e){Bu(this);const{view:t,buffer:r,blockLen:i}=this,s=(e=Ru(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=ra(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Bu(this),function kg(n,e){Tu(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)t[d]=0;(function $g(n,e,t,r){if("function"==typeof n.setBigUint64)return n.setBigUint64(e,t,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),u=r?0:4;n.setUint32(e+(r?4:0),o,r),n.setUint32(e+u,a,r)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=ra(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,l[d],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(r),e}}const Ns=BigInt(2**32-1),ia=BigInt(32);function Uu(n,e=!1){return e?{h:Number(n&Ns),l:Number(n>>ia&Ns)}:{h:0|Number(n>>ia&Ns),l:0|Number(n&Ns)}}const We_split=function qg(n,e=!1){let t=new Uint32Array(n.length),r=new Uint32Array(n.length);for(let i=0;i<n.length;i++){const{h:s,l:o}=Uu(n[i],e);[t[i],r[i]]=[s,o]}return[t,r]},We_shrSH=(n,e,t)=>n>>>t,We_shrSL=(n,e,t)=>n<<32-t|e>>>t,We_rotrSH=(n,e,t)=>n>>>t|e<<32-t,We_rotrSL=(n,e,t)=>n<<32-t|e>>>t,We_rotrBH=(n,e,t)=>n<<64-t|e>>>t-32,We_rotrBL=(n,e,t)=>n>>>t-32|e<<64-t,We_add=function ry(n,e,t,r){const i=(e>>>0)+(r>>>0);return{h:n+t+(i/2**32|0)|0,l:0|i}},We_add3L=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),We_add3H=(n,e,t,r)=>e+t+r+(n/2**32|0)|0,We_add4L=(n,e,t,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0),We_add4H=(n,e,t,r,i)=>e+t+r+i+(n/2**32|0)|0,We_add5H=(n,e,t,r,i,s)=>e+t+r+i+s+(n/2**32|0)|0,We_add5L=(n,e,t,r,i)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),[ly,dy]=We_split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),br=new Uint32Array(80),wr=new Uint32Array(80);class fy extends zg{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:d,Fl:f,Gh:p,Gl:g,Hh:y,Hl:w}=this;return[e,t,r,i,s,o,a,c,u,l,d,f,p,g,y,w]}set(e,t,r,i,s,o,a,c,u,l,d,f,p,g,y,w){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|i,this.Ch=0|s,this.Cl=0|o,this.Dh=0|a,this.Dl=0|c,this.Eh=0|u,this.El=0|l,this.Fh=0|d,this.Fl=0|f,this.Gh=0|p,this.Gl=0|g,this.Hh=0|y,this.Hl=0|w}process(e,t){for(let E=0;E<16;E++,t+=4)br[E]=e.getUint32(t),wr[E]=e.getUint32(t+=4);for(let E=16;E<80;E++){const k=0|br[E-15],X=0|wr[E-15],ce=We_rotrSH(k,X,1)^We_rotrSH(k,X,8)^We_shrSH(k,X,7),J=We_rotrSL(k,X,1)^We_rotrSL(k,X,8)^We_shrSL(k,X,7),Q=0|br[E-2],W=0|wr[E-2],Fe=We_rotrSH(Q,W,19)^We_rotrBH(Q,W,61)^We_shrSH(Q,W,6),Ae=We_rotrSL(Q,W,19)^We_rotrBL(Q,W,61)^We_shrSL(Q,W,6),ae=We_add4L(J,Ae,wr[E-7],wr[E-16]),F=We_add4H(ae,ce,Fe,br[E-7],br[E-16]);br[E]=0|F,wr[E]=0|ae}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:d,El:f,Fh:p,Fl:g,Gh:y,Gl:w,Hh:T,Hl:N}=this;for(let E=0;E<80;E++){const k=We_rotrSH(d,f,14)^We_rotrSH(d,f,18)^We_rotrBH(d,f,41),X=We_rotrSL(d,f,14)^We_rotrSL(d,f,18)^We_rotrBL(d,f,41),ce=d&p^~d&y,Q=We_add5L(N,X,f&g^~f&w,dy[E],wr[E]),W=We_add5H(Q,T,k,ce,ly[E],br[E]),Fe=0|Q,Ae=We_rotrSH(r,i,28)^We_rotrBH(r,i,34)^We_rotrBH(r,i,39),ae=We_rotrSL(r,i,28)^We_rotrBL(r,i,34)^We_rotrBL(r,i,39),F=r&s^r&a^s&a,L=i&o^i&c^o&c;T=0|y,N=0|w,y=0|p,w=0|g,p=0|d,g=0|f,({h:d,l:f}=We_add(0|u,0|l,0|W,0|Fe)),u=0|a,l=0|c,a=0|s,c=0|o,s=0|r,o=0|i;const D=We_add3L(Fe,ae,L);r=We_add3H(D,W,Ae,F),i=0|D}({h:r,l:i}=We_add(0|this.Ah,0|this.Al,0|r,0|i)),({h:s,l:o}=We_add(0|this.Bh,0|this.Bl,0|s,0|o)),({h:a,l:c}=We_add(0|this.Ch,0|this.Cl,0|a,0|c)),({h:u,l}=We_add(0|this.Dh,0|this.Dl,0|u,0|l)),({h:d,l:f}=We_add(0|this.Eh,0|this.El,0|d,0|f)),({h:p,l:g}=We_add(0|this.Fh,0|this.Fl,0|p,0|g)),({h:y,l:w}=We_add(0|this.Gh,0|this.Gl,0|y,0|w)),({h:T,l:N}=We_add(0|this.Hh,0|this.Hl,0|T,0|N)),this.set(r,i,s,o,a,c,u,l,d,f,p,g,y,w,T,N)}roundClean(){br.fill(0),wr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const hy=function jg(n){const e=r=>n().update(Ru(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}(()=>new fy),sa=BigInt(0),Nu=BigInt(1),py=BigInt(2);function oa(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&"Uint8Array"===n.constructor.name}function aa(n){if(!oa(n))throw new Error("Uint8Array expected")}function ca(n,e){if("boolean"!=typeof e)throw new Error(n+" boolean expected, got "+e)}const gy=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function ua(n){aa(n);let e="";for(let t=0;t<n.length;t++)e+=gy[n[t]];return e}function ku(n){if("string"!=typeof n)throw new Error("hex string expected, got "+typeof n);return""===n?sa:BigInt("0x"+n)}function Lu(n){return n>=48&&n<=57?n-48:n>=65&&n<=70?n-55:n>=97&&n<=102?n-87:void 0}function Mu(n){if("string"!=typeof n)throw new Error("hex string expected, got "+typeof n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=Lu(n.charCodeAt(s)),a=Lu(n.charCodeAt(s+1));if(void 0===o||void 0===a)throw new Error('hex string expected, got non-hex character "'+(n[s]+n[s+1])+'" at index '+s);r[i]=16*o+a}return r}function ks(n){return aa(n),ku(ua(Uint8Array.from(n).reverse()))}function ju(n,e){return Mu(n.toString(16).padStart(2*e,"0"))}function la(n,e){return ju(n,e).reverse()}function nr(n,e,t){let r;if("string"==typeof e)try{r=Mu(e)}catch(s){throw new Error(n+" must be hex string or Uint8Array, cause: "+s)}else{if(!oa(e))throw new Error(n+" must be hex string or Uint8Array");r=Uint8Array.from(e)}const i=r.length;if("number"==typeof t&&i!==t)throw new Error(n+" of length "+t+" expected, got "+i);return r}function $u(...n){let e=0;for(let r=0;r<n.length;r++){const i=n[r];aa(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}const da=n=>"bigint"==typeof n&&sa<=n;function Mi(n,e,t,r){if(!function _y(n,e,t){return da(n)&&da(e)&&da(t)&&e<=n&&n<t}(e,t,r))throw new Error("expected valid "+n+": "+t+" <= n < "+r+", got "+e)}const by=n=>(py<<BigInt(n-1))-Nu,wy={bigint:n=>"bigint"==typeof n,function:n=>"function"==typeof n,boolean:n=>"boolean"==typeof n,string:n=>"string"==typeof n,stringOrUint8Array:n=>"string"==typeof n||oa(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>"function"==typeof n&&Number.isSafeInteger(n.outputLen)};function fa(n,e,t={}){const r=(i,s,o)=>{const a=wy[s];if("function"!=typeof a)throw new Error("invalid validator function");const c=n[i];if(!(o&&void 0===c||a(c,n)))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(t))r(i,s,!0);return n}function zu(n){const e=new WeakMap;return(t,...r)=>{const i=e.get(t);if(void 0!==i)return i;const s=n(t,...r);return e.set(t,s),s}}const Ft=BigInt(0),wt=BigInt(1),Hr=BigInt(2),vy=BigInt(3),ha=BigInt(4),qu=BigInt(5),Ku=BigInt(8);function Ot(n,e){const t=n%e;return t>=Ft?t:e+t}function xy(n,e,t){if(e<Ft)throw new Error("invalid exponent, negatives unsupported");if(t<=Ft)throw new Error("invalid modulus");if(t===wt)return Ft;let r=wt;for(;e>Ft;)e&wt&&(r=r*n%t),n=n*n%t,e>>=wt;return r}function jn(n,e,t){let r=n;for(;e-- >Ft;)r*=r,r%=t;return r}function Vu(n,e){if(n===Ft)throw new Error("invert: expected non-zero number");if(e<=Ft)throw new Error("invert: expected positive modulus, got "+e);let t=Ot(n,e),r=e,i=Ft,s=wt;for(;t!==Ft;){const a=r%t,c=i-s*(r/t);r=t,t=a,i=s,s=c}if(r!==wt)throw new Error("invert: does not exist");return Ot(i,e)}const Sy=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Hu(n,e){const t=void 0!==e?e:n.toString(2).length;return{nBitLength:t,nByteLength:Math.ceil(t/8)}}function Wu(n,e,t=!1,r={}){if(n<=Ft)throw new Error("invalid field: expected ORDER > 0, got "+n);const{nBitLength:i,nByteLength:s}=Hu(n,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:n,isLE:t,BITS:i,BYTES:s,MASK:by(i),ZERO:Ft,ONE:wt,create:c=>Ot(c,n),isValid:c=>{if("bigint"!=typeof c)throw new Error("invalid field element: expected bigint, got "+typeof c);return Ft<=c&&c<n},is0:c=>c===Ft,isOdd:c=>(c&wt)===wt,neg:c=>Ot(-c,n),eql:(c,u)=>c===u,sqr:c=>Ot(c*c,n),add:(c,u)=>Ot(c+u,n),sub:(c,u)=>Ot(c-u,n),mul:(c,u)=>Ot(c*u,n),pow:(c,u)=>function Oy(n,e,t){if(t<Ft)throw new Error("invalid exponent, negatives unsupported");if(t===Ft)return n.ONE;if(t===wt)return e;let r=n.ONE,i=e;for(;t>Ft;)t&wt&&(r=n.mul(r,i)),i=n.sqr(i),t>>=wt;return r}(a,c,u),div:(c,u)=>Ot(c*Vu(u,n),n),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Vu(c,n),sqrt:r.sqrt||(c=>(o||(o=function Ay(n){if(n%ha===vy){const e=(n+wt)/ha;return function(t,r){const i=t.pow(r,e);if(!t.eql(t.sqr(i),r))throw new Error("Cannot find square root");return i}}if(n%Ku===qu){const e=(n-qu)/Ku;return function(t,r){const i=t.mul(r,Hr),s=t.pow(i,e),o=t.mul(r,s),a=t.mul(t.mul(o,Hr),s),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),r))throw new Error("Cannot find square root");return c}}return function Ey(n){const e=(n-wt)/Hr;let t,r,i;for(t=n-wt,r=0;t%Hr===Ft;t/=Hr,r++);for(i=Hr;i<n&&xy(i,e,n)!==n-wt;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===r){const o=(n+wt)/ha;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(t+wt)/Hr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,u=o.pow(o.mul(o.ONE,i),t),l=o.pow(a,s),d=o.pow(a,t);for(;!o.eql(d,o.ONE);){if(o.eql(d,o.ZERO))return o.ZERO;let f=1;for(let g=o.sqr(d);f<c&&!o.eql(g,o.ONE);f++)g=o.sqr(g);const p=o.pow(u,wt<<BigInt(c-f-1));u=o.sqr(p),l=o.mul(l,p),d=o.mul(d,u),c=f}return l}}(n)}(n)),o(a,c))),invertBatch:c=>function Cy(n,e){const t=new Array(e.length),r=e.reduce((s,o,a)=>n.is0(o)?s:(t[a]=s,n.mul(s,o)),n.ONE),i=n.inv(r);return e.reduceRight((s,o,a)=>n.is0(o)?s:(t[a]=n.mul(s,t[a]),n.mul(s,o)),i),t}(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>t?la(c,s):ju(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return t?ks(c):function yy(n){return ku(ua(n))}(c)}});return Object.freeze(a)}const Gu=BigInt(0),Ls=BigInt(1);function pa(n,e){const t=e.negate();return n?t:e}function Yu(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function ga(n,e){return Yu(n,e),{windows:Math.ceil(e/n)+1,windowSize:2**(n-1)}}const ya=new WeakMap,Ju=new WeakMap;function _a(n){return Ju.get(n)||1}const Bn=BigInt(0),cn=BigInt(1),Ms=BigInt(2),Uy=BigInt(8),Ny={zip215:!0};BigInt(0),BigInt(1);const ma=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Zu=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const My=BigInt(1),Xu=BigInt(2);BigInt(3);const jy=BigInt(5),$y=BigInt(8),Vy=Wu(ma,void 0,!0),Hy={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Vy,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:$y,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:hy,randomBytes:Fu,adjustScalarBytes:function qy(n){return n[0]&=248,n[31]&=127,n[31]|=64,n},uvRatio:function Ky(n,e){const t=ma,r=Ot(e*e*e,t),s=function zy(n){const e=BigInt(10),t=BigInt(20),r=BigInt(40),i=BigInt(80),s=ma,o=n*n%s*n%s,a=jn(o,Xu,s)*o%s,c=jn(a,My,s)*n%s,u=jn(c,jy,s)*c%s,l=jn(u,e,s)*u%s,d=jn(l,t,s)*l%s,f=jn(d,r,s)*d%s,p=jn(f,i,s)*f%s,g=jn(p,i,s)*f%s,y=jn(g,e,s)*u%s;return{pow_p_5_8:jn(y,Xu,s)*n%s,b2:o}}(n*Ot(r*r*e,t)).pow_p_5_8;let o=Ot(n*r*s,t);const a=Ot(e*o*o,t),c=o,u=Ot(o*Zu,t),l=a===n,d=a===Ot(-n,t),f=a===Ot(-n*Zu,t);return l&&(o=c),(d||f)&&(o=u),((n,e)=>(Ot(n,e)&wt)===wt)(o,t)&&(o=Ot(-o,t)),{isValid:l||d,value:o}}},ba=function Ly(n){const e=function ky(n){const e=function Fy(n){return function Dy(n){fa(n,Sy.reduce((r,i)=>(r[i]="function",r),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}(n.Fp),fa(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Hu(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}(n);return fa(n,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}(n),{Fp:t,n:r,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=Ms<<BigInt(8*a)-cn,l=t.create,d=Wu(e.n,e.nBitLength),f=e.uvRatio||((D,O)=>{try{return{isValid:!0,value:t.sqrt(D*t.inv(O))}}catch{return{isValid:!1,value:Bn}}}),p=e.adjustScalarBytes||(D=>D),g=e.domain||((D,O,$)=>{if(ca("phflag",$),O.length||$)throw new Error("Contexts/pre-hash are not supported");return D});function y(D,O){Mi("coordinate "+D,O,Bn,u)}function w(D){if(!(D instanceof E))throw new Error("ExtendedPoint expected")}const T=zu((D,O)=>{const{ex:$,ey:K,ez:j}=D,G=D.is0();null==O&&(O=G?Uy:t.inv(j));const te=l($*O),ee=l(K*O),De=l(j*O);if(G)return{x:Bn,y:cn};if(De!==cn)throw new Error("invZ was invalid");return{x:te,y:ee}}),N=zu(D=>{const{a:O,d:$}=e;if(D.is0())throw new Error("bad point: ZERO");const{ex:K,ey:j,ez:G,et:te}=D,ee=l(K*K),De=l(j*j),Be=l(G*G),Ce=l(Be*Be),Le=l(ee*O);if(l(Be*l(Le+De))!==l(Ce+l($*l(ee*De))))throw new Error("bad point: equation left != right (1)");if(l(K*j)!==l(G*te))throw new Error("bad point: equation left != right (2)");return!0});class E{constructor(O,$,K,j){this.ex=O,this.ey=$,this.ez=K,this.et=j,y("x",O),y("y",$),y("z",K),y("t",j),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(O){if(O instanceof E)throw new Error("extended point not allowed");const{x:$,y:K}=O||{};return y("x",$),y("y",K),new E($,K,cn,l($*K))}static normalizeZ(O){const $=t.invertBatch(O.map(K=>K.ez));return O.map((K,j)=>K.toAffine($[j])).map(E.fromAffine)}static msm(O,$){return function Ry(n,e,t,r){if(function Py(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}(t,n),function Ty(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}(r,e),t.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=n.ZERO,s=function my(n){let e;for(e=0;n>sa;n>>=Nu,e+=1);return e}(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i);let l=i;for(let d=Math.floor((e.BITS-1)/o)*o;d>=0;d-=o){c.fill(i);for(let p=0;p<r.length;p++){const y=Number(r[p]>>BigInt(d)&BigInt(a));c[y]=c[y].add(t[p])}let f=i;for(let p=c.length-1,g=i;p>0;p--)g=g.add(c[p]),f=f.add(g);if(l=l.add(f),0!==d)for(let p=0;p<o;p++)l=l.double()}return l}(E,d,O,$)}_setWindowSize(O){ce.setWindowSize(this,O)}assertValidity(){N(this)}equals(O){w(O);const{ex:$,ey:K,ez:j}=this,{ex:G,ey:te,ez:ee}=O,De=l($*ee),Be=l(G*j),Ce=l(K*ee),Le=l(te*j);return De===Be&&Ce===Le}is0(){return this.equals(E.ZERO)}negate(){return new E(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:O}=e,{ex:$,ey:K,ez:j}=this,G=l($*$),te=l(K*K),ee=l(Ms*l(j*j)),De=l(O*G),Be=$+K,Ce=l(l(Be*Be)-G-te),Le=De+te,je=Le-ee,et=De-te,ze=l(Ce*je),rt=l(Le*et),It=l(Ce*et),Zt=l(je*Le);return new E(ze,rt,Zt,It)}add(O){w(O);const{a:$,d:K}=e,{ex:j,ey:G,ez:te,et:ee}=this,{ex:De,ey:Be,ez:Ce,et:Le}=O;if($===BigInt(-1)){const Jp=l((G-j)*(Be+De)),Zp=l((G+j)*(Be-De)),vu=l(Zp-Jp);if(vu===Bn)return this.double();const Xp=l(te*Ms*Le),Qp=l(ee*Ms*Ce),eg=Qp+Xp,tg=Zp+Jp,ng=Qp-Xp,zI=l(eg*vu),qI=l(tg*ng),KI=l(eg*ng),VI=l(vu*tg);return new E(zI,qI,VI,KI)}const je=l(j*De),et=l(G*Be),ze=l(ee*K*Le),rt=l(te*Ce),It=l((j+G)*(De+Be)-je-et),Zt=rt-ze,Tn=rt+ze,yr=l(et-$*je),Yo=l(It*Zt),bu=l(Tn*yr),Cs=l(It*yr),wu=l(Zt*Tn);return new E(Yo,bu,wu,Cs)}subtract(O){return this.add(O.negate())}wNAF(O){return ce.wNAFCached(this,O,E.normalizeZ)}multiply(O){const $=O;Mi("scalar",$,cn,r);const{p:K,f:j}=this.wNAF($);return E.normalizeZ([K,j])[0]}multiplyUnsafe(O,$=E.ZERO){const K=O;return Mi("scalar",K,Bn,r),K===Bn?X:this.is0()||K===cn?this:ce.wNAFCachedUnsafe(this,K,E.normalizeZ,$)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return ce.unsafeLadder(this,r).is0()}toAffine(O){return T(this,O)}clearCofactor(){const{h:O}=e;return O===cn?this:this.multiplyUnsafe(O)}static fromHex(O,$=!1){const{d:K,a:j}=e,G=t.BYTES;O=nr("pointHex",O,G),ca("zip215",$);const te=O.slice(),ee=O[G-1];te[G-1]=-129&ee;const De=ks(te);Mi("pointHex.y",De,Bn,$?u:t.ORDER);const Ce=l(De*De),Le=l(Ce-cn),je=l(K*Ce-j);let{isValid:et,value:ze}=f(Le,je);if(!et)throw new Error("Point.fromHex: invalid y coordinate");const rt=(ze&cn)===cn,It=!!(128&ee);if(!$&&ze===Bn&&It)throw new Error("Point.fromHex: x=0 and x_0=1");return It!==rt&&(ze=l(-ze)),E.fromAffine({x:ze,y:De})}static fromPrivateKey(O){return W(O).point}toRawBytes(){const{x:O,y:$}=this.toAffine(),K=la($,t.BYTES);return K[K.length-1]|=O&cn?128:0,K}toHex(){return ua(this.toRawBytes())}}E.BASE=new E(e.Gx,e.Gy,cn,l(e.Gx*e.Gy)),E.ZERO=new E(Bn,cn,cn,Bn);const{BASE:k,ZERO:X}=E,ce=function By(n,e){return{constTimeNegate:pa,hasPrecomputes:t=>1!==_a(t),unsafeLadder(t,r,i=n.ZERO){let s=t;for(;r>Gu;)r&Ls&&(i=i.add(s)),s=s.double(),r>>=Ls;return i},precomputeWindow(t,r){const{windows:i,windowSize:s}=ga(r,e),o=[];let a=t,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,r,i){const{windows:s,windowSize:o}=ga(t,e);let a=n.ZERO,c=n.BASE;const u=BigInt(2**t-1),l=2**t,d=BigInt(t);for(let f=0;f<s;f++){const p=f*o;let g=Number(i&u);i>>=d,g>o&&(g-=l,i+=Ls);const y=p,w=p+Math.abs(g)-1,N=g<0;0===g?c=c.add(pa(f%2!=0,r[y])):a=a.add(pa(N,r[w]))}return{p:a,f:c}},wNAFUnsafe(t,r,i,s=n.ZERO){const{windows:o,windowSize:a}=ga(t,e),c=BigInt(2**t-1),u=2**t,l=BigInt(t);for(let d=0;d<o;d++){const f=d*a;if(i===Gu)break;let p=Number(i&c);if(i>>=l,p>a&&(p-=u,i+=Ls),0===p)continue;let g=r[f+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(t,r,i){let s=ya.get(r);return s||(s=this.precomputeWindow(r,t),1!==t&&ya.set(r,i(s))),s},wNAFCached(t,r,i){const s=_a(t);return this.wNAF(s,this.getPrecomputes(s,t,i),r)},wNAFCachedUnsafe(t,r,i,s){const o=_a(t);return 1===o?this.unsafeLadder(t,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),r,s)},setWindowSize(t,r){Yu(r,e),Ju.set(t,r),ya.delete(t)}}}(E,8*a);function J(D){return Ot(D,r)}function Q(D){return J(ks(D))}function W(D){const O=t.BYTES;D=nr("private key",D,O);const $=nr("hashed private key",s(D),2*O),K=p($.slice(0,O)),j=$.slice(O,2*O),G=Q(K),te=k.multiply(G),ee=te.toRawBytes();return{head:K,prefix:j,scalar:G,point:te,pointBytes:ee}}function Ae(D=new Uint8Array,...O){const $=$u(...O);return Q(s(g($,nr("context",D),!!i)))}const F=Ny;return k._setWindowSize(8),{CURVE:e,getPublicKey:function Fe(D){return W(D).pointBytes},sign:function ae(D,O,$={}){D=nr("message",D),i&&(D=i(D));const{prefix:K,scalar:j,pointBytes:G}=W(O),te=Ae($.context,K,D),ee=k.multiply(te).toRawBytes(),Be=J(te+Ae($.context,ee,G,D)*j);return Mi("signature.s",Be,Bn,r),nr("result",$u(ee,la(Be,t.BYTES)),2*t.BYTES)},verify:function L(D,O,$,K=F){const{context:j,zip215:G}=K,te=t.BYTES;D=nr("signature",D,2*te),O=nr("message",O),$=nr("publicKey",$,te),void 0!==G&&ca("zip215",G),i&&(O=i(O));const ee=ks(D.slice(te,2*te));let De,Be,Ce;try{De=E.fromHex($,G),Be=E.fromHex(D.slice(0,te),G),Ce=k.multiplyUnsafe(ee)}catch{return!1}if(!G&&De.isSmallOrder())return!1;const Le=Ae(j,Be.toRawBytes(),De.toRawBytes(),O);return Be.add(De.multiplyUnsafe(Le)).subtract(Ce).clearCofactor().equals(E.ZERO)},ExtendedPoint:E,utils:{getExtendedPublicKey:W,randomPrivateKey:()=>o(t.BYTES),precompute:(D=8,O=E.BASE)=>(O._setWindowSize(D),O.multiply(BigInt(3)),O)}}}(Hy),js="base64url",rl="did",il="key",$s="base58btc";function va(n){return null!=globalThis.Buffer?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function al(n=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?va(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function cl(n,e){e||(e=n.reduce((i,s)=>i+s.length,0));const t=al(e);let r=0;for(const i of n)t.set(i,r),r+=i.length;return va(t)}var Zy=function Yy(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<n.length;i++){var s=n.charAt(i),o=s.charCodeAt(0);if(255!==t[o])throw new TypeError(s+" is ambiguous");t[o]=i}var a=n.length,c=n.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(g){if("string"!=typeof g)throw new TypeError("Expected String");if(0===g.length)return new Uint8Array;var y=0;if(" "!==g[y]){for(var w=0,T=0;g[y]===c;)w++,y++;for(var N=(g.length-y)*u+1>>>0,E=new Uint8Array(N);g[y];){var k=t[g.charCodeAt(y)];if(255===k)return;for(var X=0,ce=N-1;(0!==k||X<T)&&-1!==ce;ce--,X++)E[ce]=(k+=a*E[ce]>>>0)%256>>>0,k=k/256>>>0;if(0!==k)throw new Error("Non-zero carry");T=X,y++}if(" "!==g[y]){for(var J=N-T;J!==N&&0===E[J];)J++;for(var Q=new Uint8Array(w+(N-J)),W=w;J!==N;)Q[W++]=E[J++];return Q}}}return{encode:function d(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===g.length)return"";for(var y=0,w=0,T=0,N=g.length;T!==N&&0===g[T];)T++,y++;for(var E=(N-T)*l+1>>>0,k=new Uint8Array(E);T!==N;){for(var X=g[T],ce=0,J=E-1;(0!==X||ce<w)&&-1!==J;J--,ce++)k[J]=(X+=256*k[J]>>>0)%a>>>0,X=X/a>>>0;if(0!==X)throw new Error("Non-zero carry");w=ce,T++}for(var Q=E-w;Q!==E&&0===k[Q];)Q++;for(var W=c.repeat(y);Q<E;++Q)W+=n.charAt(k[Q]);return W},decodeUnsafe:f,decode:function p(g){var y=f(g);if(y)return y;throw new Error(`Non-${e} character`)}}};const ul=n=>{if(n instanceof Uint8Array&&"Uint8Array"===n.constructor.name)return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")};class e0{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class t0{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ll(this,e)}}class n0{constructor(e){this.decoders=e}or(e){return ll(this,e)}decode(e){const r=this.decoders[e[0]];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ll=(n,e)=>new n0({...n.decoders||{[n.prefix]:n},...e.decoders||{[e.prefix]:e}});class r0{constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new e0(e,t,r),this.decoder=new t0(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const zs=({name:n,prefix:e,encode:t,decode:r})=>new r0(n,e,t,r),$i=({prefix:n,name:e,alphabet:t})=>{const{encode:r,decode:i}=Zy(t,e);return zs({prefix:n,name:e,encode:r,decode:s=>ul(i(s))})},kt=({name:n,prefix:e,bitsPerChar:t,alphabet:r})=>zs({prefix:e,name:n,encode:i=>((n,e,t)=>{const r="="===e[e.length-1],i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<n.length;++c)for(a=a<<8|n[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),r)for(;s.length*t&7;)s+="=";return s})(i,r,t),decode:i=>((n,e,t,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=n.length;for(;"="===n[s-1];)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const d=i[n[l]];if(void 0===d)throw new SyntaxError(`Non-${r} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(i,r,t,n)}),o0=zs({prefix:"\0",name:"identity",encode:n=>(n=>(new TextDecoder).decode(n))(n),decode:n=>(n=>(new TextEncoder).encode(n))(n)});var a0=Object.freeze({__proto__:null,identity:o0});const c0=kt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var u0=Object.freeze({__proto__:null,base2:c0});const l0=kt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var d0=Object.freeze({__proto__:null,base8:l0});const f0=$i({prefix:"9",name:"base10",alphabet:"0123456789"});var h0=Object.freeze({__proto__:null,base10:f0});const p0=kt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),g0=kt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var y0=Object.freeze({__proto__:null,base16:p0,base16upper:g0});const _0=kt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),m0=kt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),b0=kt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),w0=kt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),v0=kt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),x0=kt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),E0=kt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),A0=kt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),I0=kt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var S0=Object.freeze({__proto__:null,base32:_0,base32upper:m0,base32pad:b0,base32padupper:w0,base32hex:v0,base32hexupper:x0,base32hexpad:E0,base32hexpadupper:A0,base32z:I0});const D0=$i({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),O0=$i({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var C0=Object.freeze({__proto__:null,base36:D0,base36upper:O0});const P0=$i({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),T0=$i({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var B0=Object.freeze({__proto__:null,base58btc:P0,base58flickr:T0});const R0=kt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),F0=kt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),U0=kt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),N0=kt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var k0=Object.freeze({__proto__:null,base64:R0,base64pad:F0,base64url:U0,base64urlpad:N0});const dl=Array.from("\u{1f680}\u{1fa90}\u2604\u{1f6f0}\u{1f30c}\u{1f311}\u{1f312}\u{1f313}\u{1f314}\u{1f315}\u{1f316}\u{1f317}\u{1f318}\u{1f30d}\u{1f30f}\u{1f30e}\u{1f409}\u2600\u{1f4bb}\u{1f5a5}\u{1f4be}\u{1f4bf}\u{1f602}\u2764\u{1f60d}\u{1f923}\u{1f60a}\u{1f64f}\u{1f495}\u{1f62d}\u{1f618}\u{1f44d}\u{1f605}\u{1f44f}\u{1f601}\u{1f525}\u{1f970}\u{1f494}\u{1f496}\u{1f499}\u{1f622}\u{1f914}\u{1f606}\u{1f644}\u{1f4aa}\u{1f609}\u263a\u{1f44c}\u{1f917}\u{1f49c}\u{1f614}\u{1f60e}\u{1f607}\u{1f339}\u{1f926}\u{1f389}\u{1f49e}\u270c\u2728\u{1f937}\u{1f631}\u{1f60c}\u{1f338}\u{1f64c}\u{1f60b}\u{1f497}\u{1f49a}\u{1f60f}\u{1f49b}\u{1f642}\u{1f493}\u{1f929}\u{1f604}\u{1f600}\u{1f5a4}\u{1f603}\u{1f4af}\u{1f648}\u{1f447}\u{1f3b6}\u{1f612}\u{1f92d}\u2763\u{1f61c}\u{1f48b}\u{1f440}\u{1f62a}\u{1f611}\u{1f4a5}\u{1f64b}\u{1f61e}\u{1f629}\u{1f621}\u{1f92a}\u{1f44a}\u{1f973}\u{1f625}\u{1f924}\u{1f449}\u{1f483}\u{1f633}\u270b\u{1f61a}\u{1f61d}\u{1f634}\u{1f31f}\u{1f62c}\u{1f643}\u{1f340}\u{1f337}\u{1f63b}\u{1f613}\u2b50\u2705\u{1f97a}\u{1f308}\u{1f608}\u{1f918}\u{1f4a6}\u2714\u{1f623}\u{1f3c3}\u{1f490}\u2639\u{1f38a}\u{1f498}\u{1f620}\u261d\u{1f615}\u{1f33a}\u{1f382}\u{1f33b}\u{1f610}\u{1f595}\u{1f49d}\u{1f64a}\u{1f639}\u{1f5e3}\u{1f4ab}\u{1f480}\u{1f451}\u{1f3b5}\u{1f91e}\u{1f61b}\u{1f534}\u{1f624}\u{1f33c}\u{1f62b}\u26bd\u{1f919}\u2615\u{1f3c6}\u{1f92b}\u{1f448}\u{1f62e}\u{1f646}\u{1f37b}\u{1f343}\u{1f436}\u{1f481}\u{1f632}\u{1f33f}\u{1f9e1}\u{1f381}\u26a1\u{1f31e}\u{1f388}\u274c\u270a\u{1f44b}\u{1f630}\u{1f928}\u{1f636}\u{1f91d}\u{1f6b6}\u{1f4b0}\u{1f353}\u{1f4a2}\u{1f91f}\u{1f641}\u{1f6a8}\u{1f4a8}\u{1f92c}\u2708\u{1f380}\u{1f37a}\u{1f913}\u{1f619}\u{1f49f}\u{1f331}\u{1f616}\u{1f476}\u{1f974}\u25b6\u27a1\u2753\u{1f48e}\u{1f4b8}\u2b07\u{1f628}\u{1f31a}\u{1f98b}\u{1f637}\u{1f57a}\u26a0\u{1f645}\u{1f61f}\u{1f635}\u{1f44e}\u{1f932}\u{1f920}\u{1f927}\u{1f4cc}\u{1f535}\u{1f485}\u{1f9d0}\u{1f43e}\u{1f352}\u{1f617}\u{1f911}\u{1f30a}\u{1f92f}\u{1f437}\u260e\u{1f4a7}\u{1f62f}\u{1f486}\u{1f446}\u{1f3a4}\u{1f647}\u{1f351}\u2744\u{1f334}\u{1f4a3}\u{1f438}\u{1f48c}\u{1f4cd}\u{1f940}\u{1f922}\u{1f445}\u{1f4a1}\u{1f4a9}\u{1f450}\u{1f4f8}\u{1f47b}\u{1f910}\u{1f92e}\u{1f3bc}\u{1f975}\u{1f6a9}\u{1f34e}\u{1f34a}\u{1f47c}\u{1f48d}\u{1f4e3}\u{1f942}"),L0=dl.reduce((n,e,t)=>(n[t]=e,n),[]),M0=dl.reduce((n,e,t)=>(n[e.codePointAt(0)]=t,n),[]),z0=zs({prefix:"\u{1f680}",name:"base256emoji",encode:function j0(n){return n.reduce((e,t)=>e+L0[t],"")},decode:function $0(n){const e=[];for(const t of n){const r=M0[t.codePointAt(0)];if(void 0===r)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}});var q0=Object.freeze({__proto__:null,base256emoji:z0}),fl=128,H0=-128,W0=Math.pow(2,31),Y0=128,pl=127,J0=Math.pow(2,7),Z0=Math.pow(2,14),X0=Math.pow(2,21),Q0=Math.pow(2,28),e_=Math.pow(2,35),t_=Math.pow(2,42),n_=Math.pow(2,49),r_=Math.pow(2,56),i_=Math.pow(2,63),o_={encode:function hl(n,e,t){e=e||[];for(var r=t=t||0;n>=W0;)e[t++]=255&n|fl,n/=128;for(;n&H0;)e[t++]=255&n|fl,n>>>=7;return e[t]=0|n,hl.bytes=t-r+1,e},decode:function xa(n,r){var o,t=0,i=0,s=r=r||0,a=n.length;do{if(s>=a)throw xa.bytes=0,new RangeError("Could not decode varint");o=n[s++],t+=i<28?(o&pl)<<i:(o&pl)*Math.pow(2,i),i+=7}while(o>=Y0);return xa.bytes=s-r,t},encodingLength:function(n){return n<J0?1:n<Z0?2:n<X0?3:n<Q0?4:n<e_?5:n<t_?6:n<n_?7:n<r_?8:n<i_?9:10}},gl=o_;const yl=(n,e,t=0)=>(gl.encode(n,e,t),e),_l=n=>gl.encodingLength(n),Ea=(n,e)=>{const t=e.byteLength,r=_l(n),i=r+_l(t),s=new Uint8Array(i+t);return yl(n,s,0),yl(t,s,r),s.set(e,i),new a_(n,t,e,s)};class a_{constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}const ml=({name:n,code:e,encode:t})=>new c_(n,e,t);class c_{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ea(this.code,t):t.then(r=>Ea(this.code,r))}throw Error("Unknown type, must be binary type")}}const bl=n=>function(){var e=(0,h.A)(function*(t){return new Uint8Array(yield crypto.subtle.digest(n,t))});return function(t){return e.apply(this,arguments)}}(),u_=ml({name:"sha2-256",code:18,encode:bl("SHA-256")}),l_=ml({name:"sha2-512",code:19,encode:bl("SHA-512")});Object.freeze({__proto__:null,sha256:u_,sha512:l_});const vl=ul;Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:vl,digest:n=>Ea(0,vl(n))}}),new TextEncoder,new TextDecoder;const xl={...a0,...u0,...d0,...h0,...y0,...S0,...C0,...B0,...k0,...q0};function El(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}const Al=El("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>(new TextEncoder).encode(n.substring(1))),Aa=El("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{const e=al((n=n.substring(1)).length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),Il={utf8:Al,"utf-8":Al,hex:xl.base16,latin1:Aa,ascii:Aa,binary:Aa,...xl};function pi(n,e="utf8"){const t=Il[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.encoder.encode(n).substring(1):globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8")}function Wr(n,e="utf8"){const t=Il[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.decoder.decode(`${t.prefix}${n}`):va(globalThis.Buffer.from(n,"utf-8"))}function qs(n){return Ue(pi(Wr(n,js),"utf8"))}function Ks(n){return pi(Wr(Ne(n),"utf8"),js)}function Sl(n){const t="z"+pi(cl([Wr("K36",$s),n]),$s);return[rl,il,t].join(":")}function g_(n){return pi(n,js)}function Vs(n){const e=n.split("."),t=qs(e[0]),r=qs(e[1]),i=function y_(n){return Wr(n,js)}(e[2]);return{header:t,payload:r,signature:i,data:Wr(e.slice(0,2).join("."),"utf8")}}function Dl(n=Fu(32)){const e=ba.getPublicKey(n);return{secretKey:cl([n,e]),publicKey:e}}function Ia(){return(Ia=(0,h.A)(function*(n,e,t,r,i=(0,m.fromMiliseconds)(Date.now())){const s={alg:"EdDSA",typ:"JWT"},c={iss:Sl(r.publicKey),sub:n,aud:e,iat:i,exp:i+t},u=function __(n){return Wr([Ks(n.header),Ks(n.payload)].join("."),"utf8")}({header:s,payload:c});return function m_(n){return[Ks(n.header),Ks(n.payload),g_(n.signature)].join(".")}({header:s,payload:c,signature:ba.sign(u,r.secretKey.slice(0,32))})})).apply(this,arguments)}var Ol=function(n,e,t){if(t||2===arguments.length)for(var s,r=0,i=e.length;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},w_=function(){return function n(e,t,r){this.name=e,this.version=t,this.os=r,this.type="browser"}}(),v_=function(){return function n(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}}(),x_=function(){return function n(e,t,r,i){this.name=e,this.version=t,this.os=r,this.bot=i,this.type="bot-device"}}(),E_=function(){return function n(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}}(),A_=function(){return function n(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}}(),S_=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,D_=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],Pl=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Bl(n){var e=function Tl(n){return""!==n&&D_.reduce(function(e,t){var r=t[0];if(e)return e;var s=t[1].exec(n);return!!s&&[r,s]},!1)}(n);if(!e)return null;var t=e[0],r=e[1];if("searchbot"===t)return new E_;var i=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);i?i.length<3&&(i=Ol(Ol([],i,!0),function T_(n){for(var e=[],t=0;t<n;t++)e.push("0");return e}(3-i.length),!0)):i=[];var s=i.join("."),o=function C_(n){for(var e=0,t=Pl.length;e<t;e++){var r=Pl[e],i=r[0];if(r[1].exec(n))return i}return null}(n),a=S_.exec(n);return a&&a[1]?new x_(t,s,o,a[1]):new w_(t,s,o)}var ir=U(7793),B_=U(2596);let Hs_getDocsUrl=({docsBaseUrl:n,docsPath:e="",docsSlug:t})=>e?`${n??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,Hs_version="viem@2.36.0";class En extends Error{constructor(e,t={}){const r=t.cause instanceof En?t.cause.details:t.cause?.message?t.cause.message:t.details,i=t.cause instanceof En&&t.cause.docsPath||t.docsPath,s=Hs_getDocsUrl?.({...t,docsPath:i});super([e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...r?[`Details: ${r}`]:[],...Hs_version?[`Version: ${Hs_version}`]:[]].join("\n"),t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=i,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version="2.36.0"}walk(e){return Fl(this,e)}}function Fl(n,e){return e?.(n)?n:n&&"object"==typeof n&&"cause"in n&&void 0!==n.cause?Fl(n.cause,e):e?null:n}function zi(n,{strict:e=!0}={}){return!(!n||"string"!=typeof n)&&(e?/^0x[0-9a-fA-F]*$/.test(n):n.startsWith("0x"))}class Ul extends En{constructor({size:e,targetSize:t,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function gi(n,{dir:e,size:t=32}={}){return"string"==typeof n?function R_(n,{dir:e,size:t=32}={}){if(null===t)return n;const r=n.replace("0x","");if(r.length>2*t)throw new Ul({size:Math.ceil(r.length/2),targetSize:t,type:"hex"});return`0x${r["right"===e?"padEnd":"padStart"](2*t,"0")}`}(n,{dir:e,size:t}):function F_(n,{dir:e,size:t=32}={}){if(null===t)return n;if(n.length>t)throw new Ul({size:n.length,targetSize:t,type:"bytes"});const r=new Uint8Array(t);for(let i=0;i<t;i++){const s="right"===e;r[s?i:t-i-1]=n[s?i:n.length-i-1]}return r}(n,{dir:e,size:t})}class U_ extends En{constructor({max:e,min:t,signed:r,size:i,value:s}){super(`Number "${s}" is not in safe ${i?`${8*i}-bit ${r?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class N_ extends En{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Da(n){return zi(n,{strict:!1})?Math.ceil((n.length-2)/2):n.length}function vr(n,{size:e}){if(Da(n)>e)throw new N_({givenSize:Da(n),maxSize:e})}function Ws(n,e={}){const{signed:t}=e;e.size&&vr(n,{size:e.size});const r=BigInt(n);if(!t)return r;const i=(n.length-2)/2;return r<=(1n<<8n*BigInt(i)-1n)-1n?r:r-BigInt(`0x${"f".padStart(2*i,"f")}`)-1n}const M_=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Oa(n,e={}){return"number"==typeof n||"bigint"==typeof n?Ll(n,e):"string"==typeof n?function z_(n,e={}){return kl($_.encode(n),e)}(n,e):"boolean"==typeof n?function j_(n,e={}){const t=`0x${Number(n)}`;return"number"==typeof e.size?(vr(t,{size:e.size}),gi(t,{size:e.size})):t}(n,e):kl(n,e)}function kl(n,e={}){let t="";for(let i=0;i<n.length;i++)t+=M_[n[i]];const r=`0x${t}`;return"number"==typeof e.size?(vr(r,{size:e.size}),gi(r,{dir:"right",size:e.size})):r}function Ll(n,e={}){const{signed:t,size:r}=e,i=BigInt(n);let s;r?s=t?(1n<<8n*BigInt(r)-1n)-1n:2n**(8n*BigInt(r))-1n:"number"==typeof n&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o="bigint"==typeof s&&t?-s-1n:0;if(s&&i>s||i<o){const c="bigint"==typeof n?"n":"";throw new U_({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:t,size:r,value:`${n}${c}`})}const a=`0x${(t&&i<0?(1n<<BigInt(8*r))+BigInt(i):i).toString(16)}`;return r?gi(a,{size:r}):a}const $_=new TextEncoder,q_=new TextEncoder;const sr={zero:48,nine:57,A:65,F:70,a:97,f:102};function Ml(n){return n>=sr.zero&&n<=sr.nine?n-sr.zero:n>=sr.A&&n<=sr.F?n-(sr.A-10):n>=sr.a&&n<=sr.f?n-(sr.a-10):void 0}function jl(n,e={}){let t=n;e.size&&(vr(t,{size:e.size}),t=gi(t,{dir:"right",size:e.size}));let r=t.slice(2);r.length%2&&(r=`0${r}`);const i=r.length/2,s=new Uint8Array(i);for(let o=0,a=0;o<i;o++){const c=Ml(r.charCodeAt(a++)),u=Ml(r.charCodeAt(a++));if(void 0===c||void 0===u)throw new En(`Invalid byte sequence ("${r[a-2]}${r[a-1]}" in "${r}").`);s[o]=16*c+u}return s}function $l(n,e={}){const t=q_.encode(n);return"number"==typeof e.size?(vr(t,{size:e.size}),gi(t,{dir:"right",size:e.size})):t}var qi=U(6555),Qt=U(4122);const W_=BigInt(0),Ki=BigInt(1),G_=BigInt(2),Y_=BigInt(7),J_=BigInt(256),Z_=BigInt(113),zl=[],ql=[],Kl=[];for(let n=0,e=Ki,t=1,r=0;n<24;n++){[t,r]=[r,(2*t+3*r)%5],zl.push(2*(5*r+t)),ql.push((n+1)*(n+2)/2%64);let i=W_;for(let s=0;s<7;s++)e=(e<<Ki^(e>>Y_)*Z_)%J_,e&G_&&(i^=Ki<<(Ki<<BigInt(s))-Ki);Kl.push(i)}const Vl=(0,qi.lD)(Kl,!0),X_=Vl[0],Q_=Vl[1],Hl=(n,e,t)=>t>32?(0,qi.WM)(n,e,t):(0,qi.P5)(n,e,t),Wl=(n,e,t)=>t>32?(0,qi.im)(n,e,t):(0,qi.B4)(n,e,t);class Gs extends Qt.Vw{constructor(e,t,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=s,(0,Qt.Fe)(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=(0,Qt.DH)(this.state)}clone(){return this._cloneInto()}keccak(){(0,Qt.fd)(this.state32),function em(n,e=24){const t=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)t[o]=n[o]^n[o+10]^n[o+20]^n[o+30]^n[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=t[c],l=t[c+1],d=Hl(u,l,1)^t[a],f=Wl(u,l,1)^t[a+1];for(let p=0;p<50;p+=10)n[o+p]^=d,n[o+p+1]^=f}let i=n[2],s=n[3];for(let o=0;o<24;o++){const a=ql[o],c=Hl(i,s,a),u=Wl(i,s,a),l=zl[o];i=n[l],s=n[l+1],n[l]=c,n[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=n[o+a];for(let a=0;a<10;a++)n[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}n[0]^=X_[r],n[1]^=Q_[r]}(0,Qt.uH)(t)}(this.state32,this.rounds),(0,Qt.fd)(this.state32),this.posOut=0,this.pos=0}update(e){(0,Qt.CC)(this),e=(0,Qt.ZJ)(e),(0,Qt.DO)(e);const{blockLen:t,state:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(t-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,!!(128&t)&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){(0,Qt.CC)(this,!1),(0,Qt.DO)(e),this.finish();const t=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(t.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,Qt.Fe)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,Qt.Ht)(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,(0,Qt.uH)(this.state)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Gs(t,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const nm=(n=1,(0,Qt.qj)(()=>new Gs(136,1,32)));var n;function Gl(n,e){const t=e||"hex",r=nm(zi(n,{strict:!1})?function K_(n,e={}){return"number"==typeof n||"bigint"==typeof n?function H_(n,e){return jl(Ll(n,e))}(n,e):"boolean"==typeof n?function V_(n,e={}){const t=new Uint8Array(1);return t[0]=Number(n),"number"==typeof e.size?(vr(t,{size:e.size}),gi(t,{size:e.size})):t}(n,e):zi(n)?jl(n,e):$l(n,e)}(n):n);return"bytes"===t?r:Oa(r)}class rm extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const Ca=new rm(8192);function Pa(){return Pa=(0,h.A)(function*({hash:n,signature:e}){const t=zi(n)?n:Oa(n),{secp256k1:r}=yield U.e(6186).then(U.bind(U,6186));return`0x${(()=>{if("object"==typeof e&&"r"in e&&"s"in e){const{r:u,s:l,v:d,yParity:f}=e,g=Jl(Number(f??d));return new r.Signature(Ws(u),Ws(l)).addRecoveryBit(g)}const o=zi(e)?e:Oa(e);if(65!==Da(o))throw new Error("invalid signature length");const c=Jl(function Nl(n,e={}){return Number(Ws(n,e))}(`0x${o.slice(130)}`));return r.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}),Pa.apply(this,arguments)}function Jl(n){if(0===n||1===n)return n;if(27===n)return 0;if(28===n)return 1;throw new Error("Invalid yParityOrV value")}function Ta(){return Ta=(0,h.A)(function*({hash:n,signature:e}){return function im(n){return function Yl(n,e){if(Ca.has(`${n}.${e}`))return Ca.get(`${n}.${e}`);const t=e?`${e}${n.toLowerCase()}`:n.substring(2).toLowerCase(),r=Gl($l(t),"bytes"),i=(e?t.substring(`${e}0x`.length):t).split("");for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&i[o]&&(i[o]=i[o].toUpperCase()),(15&r[o>>1])>=8&&i[o+1]&&(i[o+1]=i[o+1].toUpperCase());const s=`0x${i.join("")}`;return Ca.set(`${n}.${e}`,s),s}(`0x${Gl(`0x${n.substring(4)}`).substring(26)}`)}(yield function sm(n){return Pa.apply(this,arguments)}({hash:n,signature:e}))}),Ta.apply(this,arguments)}const Vi=function am(n){if(n.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<n.length;u++){const l=n.charAt(u),d=l.charCodeAt(0);if(255!==e[d])throw new TypeError(l+" is ambiguous");e[d]=u}const t=n.length,r=n.charAt(0),i=Math.log(t)/Math.log(256),s=Math.log(256)/Math.log(t);function a(u){if("string"!=typeof u)throw new TypeError("Expected String");if(0===u.length)return new Uint8Array;let l=0,d=0,f=0;for(;u[l]===r;)d++,l++;const p=(u.length-l)*i+1>>>0,g=new Uint8Array(p);for(;l<u.length;){const N=u.charCodeAt(l);if(N>255)return;let E=e[N];if(255===E)return;let k=0;for(let X=p-1;(0!==E||k<f)&&-1!==X;X--,k++)E+=t*g[X]>>>0,g[X]=E%256>>>0,E=E/256>>>0;if(0!==E)throw new Error("Non-zero carry");f=k,l++}let y=p-f;for(;y!==p&&0===g[y];)y++;const w=new Uint8Array(d+(p-y));let T=d;for(;y!==p;)w[T++]=g[y++];return w}return{encode:function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===u.length)return"";let l=0,d=0,f=0;const p=u.length;for(;f!==p&&0===u[f];)f++,l++;const g=(p-f)*s+1>>>0,y=new Uint8Array(g);for(;f!==p;){let N=u[f],E=0;for(let k=g-1;(0!==N||E<d)&&-1!==k;k--,E++)N+=256*y[k]>>>0,y[k]=N%t>>>0,N=N/t>>>0;if(0!==N)throw new Error("Non-zero carry");d=E,f++}let w=g-d;for(;w!==g&&0===y[w];)w++;let T=r.repeat(l);for(;w<g;++w)T+=n.charAt(y[w]);return T},decodeUnsafe:a,decode:function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+t+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");function Ba(n,e){this.v=n,this.k=e}function Hi(n){var e,t;function r(s,o){try{var a=n[s](o),c=a.value,u=c instanceof Ba;Promise.resolve(u?c.v:c).then(function(l){if(u){var d="return"===s?"return":"next";if(!c.k||l.done)return r(d,l);l=n[d](l).value}i(a.done?"return":"normal",l)},function(l){r("throw",l)})}catch(l){i("throw",l)}}function i(s,o){switch(s){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):t=null}this._invoke=function(s,o){return new Promise(function(a,c){var u={key:s,arg:o,resolve:a,reject:c,next:null};t?t=t.next=u:(e=t=u,r(s,o))})},"function"!=typeof n.return&&(this.return=void 0)}function Ra(n){return new Ba(n,0)}function Fa(n){var e,t,r,i=2;for(typeof Symbol<"u"&&(t=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(t&&null!=(e=n[t]))return e.call(n);if(r&&null!=(e=n[r]))return new Ys(e.call(n));t="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Ys(n){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var r=t.done;return Promise.resolve(t.value).then(function(i){return{value:i,done:r}})}return(Ys=function(r){this.s=r,this.n=r.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(r){var i=this.s.return;return void 0===i?Promise.resolve({value:r,done:!0}):e(i.apply(this.s,arguments))},throw:function(r){var i=this.s.return;return void 0===i?Promise.reject(r):e(i.apply(this.s,arguments))}},new Ys(n)}function Ua(n){return`${n<0?"-":""}0x${Math.abs(n).toString(16).padStart(2,"0")}`}Hi.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Hi.prototype.next=function(n){return this._invoke("next",n)},Hi.prototype.throw=function(n){return this._invoke("throw",n)},Hi.prototype.return=function(n){return this._invoke("return",n)};class Js{constructor(e,t){this.type=e,this.data=t}}class mn extends Error{constructor(e){super(e);const t=Object.create(mn.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:mn.name})}}const Wi=4294967295;function Zl(n,e,t){const r=Math.floor(t/4294967296),i=t;n.setUint32(e,r),n.setUint32(e+4,i)}function Xl(n,e){return 4294967296*n.getInt32(e)+n.getUint32(e+4)}const xm={type:-1,encode:function bm(n){if(n instanceof Date){const e=function mm(n){const e=n.getTime(),t=Math.floor(e/1e3),r=1e6*(e-1e3*t),i=Math.floor(r/1e9);return{sec:t+i,nsec:r-1e9*i}}(n);return function _m({sec:n,nsec:e}){if(n>=0&&e>=0&&n<=17179869183){if(0===e&&n<=4294967295){const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,n),t}{const t=n/4294967296,r=4294967295&n,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,e<<2|3&t),s.setUint32(4,r),i}}{const t=new Uint8Array(12),r=new DataView(t.buffer);return r.setUint32(0,e),Zl(r,4,n),t}}(e)}return null},decode:function vm(n){const e=function wm(n){const e=new DataView(n.buffer,n.byteOffset,n.byteLength);switch(n.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const t=e.getUint32(0);return{sec:4294967296*(3&t)+e.getUint32(4),nsec:t>>>2}}case 12:return{sec:Xl(e,4),nsec:e.getUint32(0)};default:throw new mn(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${n.length}`)}}(n);return new Date(1e3*e.sec+e.nsec/1e6)}};class Zs{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(xm)}register({type:e,encode:t,decode:r}){if(e>=0)this.encoders[e]=t,this.decoders[e]=r;else{const i=-1-e;this.builtInEncoders[i]=t,this.builtInDecoders[i]=r}}tryToEncode(e,t){for(let r=0;r<this.builtInEncoders.length;r++){const i=this.builtInEncoders[r];if(null!=i){const s=i(e,t);if(null!=s)return new Js(-1-r,s)}}for(let r=0;r<this.encoders.length;r++){const i=this.encoders[r];if(null!=i){const s=i(e,t);if(null!=s)return new Js(r,s)}}return e instanceof Js?e:null}decode(e,t,r){const i=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return i?i(e,t,r):new Js(t,e)}}Zs.defaultCodec=new Zs;const Im=new TextEncoder;function Ql(n,e,t){let r=e;const i=r+t,s=[];let o="";for(;r<i;){const a=n[r++];if(128&a)if(192==(224&a)){const c=63&n[r++];s.push((31&a)<<6|c)}else if(224==(240&a)){const c=63&n[r++],u=63&n[r++];s.push((31&a)<<12|c<<6|u)}else if(240==(248&a)){let d=(7&a)<<18|(63&n[r++])<<12|(63&n[r++])<<6|63&n[r++];d>65535&&(d-=65536,s.push(d>>>10&1023|55296),d=56320|1023&d),s.push(d)}else s.push(a);else s.push(a);s.length>=4096&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const Pm=new TextDecoder;function Na(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):function Fm(n){return n instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer}(n)?new Uint8Array(n):Uint8Array.from(n)}const ka="array",Gi="map_key",ed="map_value",Lm=n=>{if("string"==typeof n||"number"==typeof n)return n;throw new mn("The type of key must be string or number but "+typeof n)};class Mm{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const t=this.getUninitializedStateFromPool();t.type=ka,t.position=0,t.size=e,t.array=new Array(e)}pushMapState(e){const t=this.getUninitializedStateFromPool();t.type=Gi,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){return this.stackHeadPosition++,this.stackHeadPosition===this.stack.length&&this.stack.push({type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null}),this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===ka){const r=e;r.size=0,r.array=void 0,r.position=0,r.type=void 0}if(e.type===Gi||e.type===ed){const r=e;r.size=0,r.map=void 0,r.readCount=0,r.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const La=new DataView(new ArrayBuffer(0)),jm=new Uint8Array(La.buffer);try{La.getInt8(0)}catch(n){if(!(n instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const td=new RangeError("Insufficient data"),$m=new class km{constructor(e=16,t=16){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,r){const i=this.caches[r-1];e:for(const s of i){const o=s.bytes;for(let a=0;a<r;a++)if(o[a]!==e[t+a])continue e;return s.str}return null}store(e,t){const r=this.caches[e.length-1],i={bytes:e,str:t};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)}decode(e,t,r){const i=this.find(e,t,r);if(null!=i)return this.hit++,i;this.miss++;const s=Ql(e,t,r),o=Uint8Array.prototype.slice.call(e,t,t+r);return this.store(o,s),s}};class Ma{constructor(e){this.totalPos=0,this.pos=0,this.view=La,this.bytes=jm,this.headByte=-1,this.stack=new Mm,this.entered=!1,this.extensionCodec=e?.extensionCodec??Zs.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??Wi,this.maxBinLength=e?.maxBinLength??Wi,this.maxArrayLength=e?.maxArrayLength??Wi,this.maxMapLength=e?.maxMapLength??Wi,this.maxExtLength=e?.maxExtLength??Wi,this.keyDecoder=void 0!==e?.keyDecoder?e.keyDecoder:$m,this.mapKeyConverter=e?.mapKeyConverter??Lm}clone(){return new Ma({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.reset()}setBuffer(e){const t=Na(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(-1!==this.headByte||this.hasRemaining(1)){const t=this.bytes.subarray(this.pos),r=Na(e),i=new Uint8Array(t.length+r.length);i.set(t),i.set(r,t.length),this.setBuffer(i)}else this.setBuffer(e)}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:t,pos:r}=this;return new RangeError(`Extra ${t.byteLength-r} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered)yield*this.clone().decodeMulti(e);else try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}decodeAsync(e){var t=this;return(0,h.A)(function*(){if(t.entered)return t.clone().decodeAsync(e);try{t.entered=!0;let u,c=!1;var s,r=!1,i=!1;try{for(var a,o=Fa(e);r=!(a=yield o.next()).done;r=!1){const p=a.value;if(c)throw t.entered=!1,t.createExtraByteError(t.totalPos);t.appendBuffer(p);try{u=t.doDecodeSync(),c=!0}catch(g){if(!(g instanceof RangeError))throw g}t.totalPos+=t.pos}}catch(p){i=!0,s=p}finally{try{r&&null!=o.return&&(yield o.return())}finally{if(i)throw s}}if(c){if(t.hasRemaining(1))throw t.createExtraByteError(t.totalPos);return u}const{headByte:l,pos:d,totalPos:f}=t;throw new RangeError(`Insufficient data in parsing ${Ua(l)} at ${f} (${d} in the current buffer)`)}finally{t.entered=!1}})()}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}decodeMultiAsync(e,t){var r=this;return function lm(n){return function(){return new Hi(n.apply(this,arguments))}}(function*(){if(r.entered){const u=r.clone();return void(yield*function dm(n){var e={},t=!1;function r(i,s){return t=!0,{done:!1,value:new Ba(s=new Promise(function(o){o(n[i](s))}),1)}}return e[typeof Symbol<"u"&&Symbol.iterator||"@@iterator"]=function(){return this},e.next=function(i){return t?(t=!1,i):r("next",i)},"function"==typeof n.throw&&(e.throw=function(i){if(t)throw t=!1,i;return r("throw",i)}),"function"==typeof n.return&&(e.return=function(i){return t?(t=!1,i):r("return",i)}),e}(Fa(u.decodeMultiAsync(e,t))))}try{r.entered=!0;let u=t,l=-1;var o,i=!1,s=!1;try{for(var c,a=Fa(e);i=!(c=yield Ra(a.next())).done;i=!1){const d=c.value;if(t&&0===l)throw r.createExtraByteError(r.totalPos);r.appendBuffer(d),u&&(l=r.readArraySize(),u=!1,r.complete());try{for(;yield r.doDecodeSync(),0!==--l;);}catch(f){if(!(f instanceof RangeError))throw f}r.totalPos+=r.pos}}catch(d){s=!0,o=d}finally{try{i&&null!=a.return&&(yield Ra(a.return()))}finally{if(s)throw o}}}finally{r.entered=!1}})()}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let t;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){const i=e-128;if(0!==i){this.pushMapState(i),this.complete();continue e}t={}}else if(e<160){const i=e-144;if(0!==i){this.pushArrayState(i),this.complete();continue e}t=[]}else t=this.decodeString(e-160,0);else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===e){const i=this.lookU8();t=this.decodeString(i,1)}else if(218===e){const i=this.lookU16();t=this.decodeString(i,2)}else if(219===e){const i=this.lookU32();t=this.decodeString(i,4)}else if(220===e){const i=this.readU16();if(0!==i){this.pushArrayState(i),this.complete();continue e}t=[]}else if(221===e){const i=this.readU32();if(0!==i){this.pushArrayState(i),this.complete();continue e}t=[]}else if(222===e){const i=this.readU16();if(0!==i){this.pushMapState(i),this.complete();continue e}t={}}else if(223===e){const i=this.readU32();if(0!==i){this.pushMapState(i),this.complete();continue e}t={}}else if(196===e){const i=this.lookU8();t=this.decodeBinary(i,1)}else if(197===e){const i=this.lookU16();t=this.decodeBinary(i,2)}else if(198===e){const i=this.lookU32();t=this.decodeBinary(i,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){const i=this.lookU8();t=this.decodeExtension(i,1)}else if(200===e){const i=this.lookU16();t=this.decodeExtension(i,2)}else{if(201!==e)throw new mn(`Unrecognized type byte: ${Ua(e)}`);{const i=this.lookU32();t=this.decodeExtension(i,4)}}this.complete();const r=this.stack;for(;r.length>0;){const i=r.top();if(i.type===ka){if(i.array[i.position]=t,i.position++,i.position!==i.size)continue e;t=i.array,r.release(i)}else{if(i.type===Gi){if("__proto__"===t)throw new mn("The key __proto__ is not allowed");i.key=this.mapKeyConverter(t),i.type=ed;continue e}if(i.map[i.key]=t,i.readCount++,i.readCount!==i.size){i.key=null,i.type=Gi;continue e}t=i.map,r.release(i)}}return t}}readHeadByte(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new mn(`Unrecognized array type byte: ${Ua(e)}`)}}pushMapState(e){if(e>this.maxMapLength)throw new mn(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new mn(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){if(e>this.maxStrLength)throw new mn(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw td;const r=this.pos+t;let i;return i=this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?this.keyDecoder.decode(this.bytes,r,e):function Rm(n,e,t){return t>200?function Bm(n,e,t){const r=n.subarray(e,e+t);return Pm.decode(r)}(n,e,t):Ql(n,e,t)}(this.bytes,r,e),this.pos+=t+e,i}stateIsMapKey(){return this.stack.length>0&&this.stack.top().type===Gi}decodeBinary(e,t){if(e>this.maxBinLength)throw new mn(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw td;const r=this.pos+t,i=this.bytes.subarray(r,r+e);return this.pos+=t+e,i}decodeExtension(e,t){if(e>this.maxExtLength)throw new mn(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const r=this.view.getInt8(this.pos+t),i=this.decodeBinary(e,t+1);return this.extensionCodec.decode(i,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=function hm(n,e){return 4294967296*n.getUint32(e)+n.getUint32(e+4)}(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Xl(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}class ja{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??Zs.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??100,this.initialBufferSize=e?.initialBufferSize??2048,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new ja({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.useBigInt64&&"bigint"==typeof e?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){const t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)}resizeBuffer(e){const t=new ArrayBuffer(e),r=new Uint8Array(t),i=new DataView(t);r.set(this.bytes),this.view=i,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){this.writeU8(!1===e?194:195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error(`Too long string: ${e} bytes in UTF-8`);this.writeU8(219),this.writeU32(e)}}encodeString(e){const r=function Em(n){const e=n.length;let t=0,r=0;for(;r<e;){let i=n.charCodeAt(r++);if(4294967168&i)if(4294965248&i){if(i>=55296&&i<=56319&&r<e){const s=n.charCodeAt(r);56320==(64512&s)&&(++r,i=((1023&i)<<10)+(1023&s)+65536)}t+=4294901760&i?4:3}else t+=2;else t++}return t}(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),function Om(n,e,t){n.length>50?function Dm(n,e,t){Im.encodeInto(n,e.subarray(t))}(n,e,t):function Am(n,e,t){const r=n.length;let i=t,s=0;for(;s<r;){let o=n.charCodeAt(s++);if(4294967168&o){if(4294965248&o){if(o>=55296&&o<=56319&&s<r){const a=n.charCodeAt(s);56320==(64512&a)&&(++s,o=((1023&o)<<10)+(1023&a)+65536)}4294901760&o?(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128):(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128)}else e[i++]=o>>6&31|192;e[i++]=63&o|128}else e[i++]=o}}(n,e,t)}(e,this.bytes,this.pos),this.pos+=r}encodeObject(e,t){const r=this.extensionCodec.tryToEncode(e,this.context);if(null!=r)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else{if("object"!=typeof e)throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`);this.encodeMap(e,t)}}encodeBinary(e){const t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large binary: ${t}`);this.writeU8(198),this.writeU32(t)}const r=Na(e);this.writeU8a(r)}encodeArray(e,t){const r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else{if(!(r<4294967296))throw new Error(`Too large array: ${r}`);this.writeU8(221),this.writeU32(r)}for(const i of e)this.doEncode(i,t+1)}countWithoutUndefined(e,t){let r=0;for(const i of t)void 0!==e[i]&&r++;return r}encodeMap(e,t){const r=Object.keys(e);this.sortKeys&&r.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else{if(!(i<4294967296))throw new Error(`Too large map object: ${i}`);this.writeU8(223),this.writeU32(i)}for(const s of r){const o=e[s];this.ignoreUndefined&&void 0===o||(this.encodeString(s),this.doEncode(o,t+1))}}encodeExtension(e){if("function"==typeof e.data){const r=e.data(this.pos+6),i=r.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);return this.writeU8(201),this.writeU32(i),this.writeI8(e.type),void this.writeU8a(r)}const t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large extension object: ${t}`);this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),function fm(n,e,t){const i=t;n.setUint32(e,t/4294967296),n.setUint32(e+4,i)}(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Zl(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function Gr(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&"Uint8Array"===n.constructor.name}function nd(n,e){return!!Array.isArray(e)&&(0===e.length||e.every(n?t=>"string"==typeof t:t=>Number.isSafeInteger(t)))}function xr(n,e){if("string"!=typeof e)throw new Error(`${n}: string expected`);return!0}function yi(n){if(!Number.isSafeInteger(n))throw new Error(`invalid integer: ${n}`)}function Xs(n){if(!Array.isArray(n))throw new Error("array expected")}function Qs(n,e){if(!nd(!0,e))throw new Error(`${n}: array of strings expected`)}function qa(n,e){if(!nd(!1,e))throw new Error(`${n}: array of numbers expected`)}function en(...n){const e=s=>s,t=(s,o)=>a=>s(o(a));return{encode:n.map(s=>s.encode).reduceRight(t,e),decode:n.map(s=>s.decode).reduce(t,e)}}function un(n){const e="string"==typeof n?n.split(""):n,t=e.length;Qs("alphabet",e);const r=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(Xs(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=t)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${n}`);return e[s]})),decode:i=>(Xs(i),i.map(s=>{xr("alphabet.decode",s);const o=r.get(s);if(void 0===o)throw new Error(`Unknown letter: "${s}". Allowed: ${n}`);return o}))}}function ln(n=""){return xr("join",n),{encode:e=>(Qs("join.decode",e),e.join(n)),decode:e=>(xr("join.decode",e),e.split(n))}}function Ji(n,e="="){return yi(n),xr("padding",e),{encode(t){for(Qs("padding.encode",t);t.length*n%8;)t.push(e);return t},decode(t){Qs("padding.decode",t);let r=t.length;if(r*n%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&t[r-1]===e;r--)if((r-1)*n%8==0)throw new Error("padding: invalid, string has too much padding");return t.slice(0,r)}}}const id=(n,e)=>0===e?n:id(e,n%e),eo=(n,e)=>n+(e-id(n,e)),to=(()=>{let n=[];for(let e=0;e<40;e++)n.push(2**e);return n})();function no(n,e,t,r){if(Xs(n),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(eo(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${eo(e,t)}`);let i=0,s=0;const o=to[e],a=to[t]-1,c=[];for(const u of n){if(yi(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(i=i<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=t;s-=t)c.push((i>>s-t&a)>>>0);const l=to[s];if(void 0===l)throw new Error("invalid carry");i&=l-1}if(i=i<<t-s&a,!r&&s>=e)throw new Error("Excess padding");if(!r&&i>0)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&c.push(i>>>0),c}function bn(n,e=!1){if(yi(n),n<=0||n>32)throw new Error("radix2: bits should be in (0..32]");if(eo(8,n)>32||eo(n,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!Gr(t))throw new Error("radix2.encode input should be Uint8Array");return no(Array.from(t),8,n,!e)},decode:t=>(qa("radix2.decode",t),Uint8Array.from(no(t,n,8,e)))}}const cd=en(bn(5),un("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Ji(5),ln(""));"function"==typeof Uint8Array.from([]).toBase64&&Uint8Array;function Wa(n){return null!=globalThis.Buffer?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function yd(n=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?Wa(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function Xi(n,e){e||(e=n.reduce((i,s)=>i+s.length,0));const t=yd(e);let r=0;for(const i of n)t.set(i,r),r+=i.length;return Wa(t)}"function"==typeof Uint8Array.from([]).toHex&&Uint8Array;const Qm=function Jm(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<n.length;i++){var s=n.charAt(i),o=s.charCodeAt(0);if(255!==t[o])throw new TypeError(s+" is ambiguous");t[o]=i}var a=n.length,c=n.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(g){if("string"!=typeof g)throw new TypeError("Expected String");if(0===g.length)return new Uint8Array;var y=0;if(" "!==g[y]){for(var w=0,T=0;g[y]===c;)w++,y++;for(var N=(g.length-y)*u+1>>>0,E=new Uint8Array(N);g[y];){var k=t[g.charCodeAt(y)];if(255===k)return;for(var X=0,ce=N-1;(0!==k||X<T)&&-1!==ce;ce--,X++)E[ce]=(k+=a*E[ce]>>>0)%256>>>0,k=k/256>>>0;if(0!==k)throw new Error("Non-zero carry");T=X,y++}if(" "!==g[y]){for(var J=N-T;J!==N&&0===E[J];)J++;for(var Q=new Uint8Array(w+(N-J)),W=w;J!==N;)Q[W++]=E[J++];return Q}}}return{encode:function d(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===g.length)return"";for(var y=0,w=0,T=0,N=g.length;T!==N&&0===g[T];)T++,y++;for(var E=(N-T)*l+1>>>0,k=new Uint8Array(E);T!==N;){for(var X=g[T],ce=0,J=E-1;(0!==X||ce<w)&&-1!==J;J--,ce++)k[J]=(X+=256*k[J]>>>0)%a>>>0,X=X/a>>>0;if(0!==X)throw new Error("Non-zero carry");w=ce,T++}for(var Q=E-w;Q!==E&&0===k[Q];)Q++;for(var W=c.repeat(y);Q<E;++Q)W+=n.charAt(k[Q]);return W},decodeUnsafe:f,decode:function p(g){var y=f(g);if(y)return y;throw new Error(`Non-${e} character`)}}},_i=(new Uint8Array(0),n=>{if(n instanceof Uint8Array&&"Uint8Array"===n.constructor.name)return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")});class ib{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class sb{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return _d(this,e)}}class ob{constructor(e){this.decoders=e}or(e){return _d(this,e)}decode(e){const r=this.decoders[e[0]];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const _d=(n,e)=>new ob({...n.decoders||{[n.prefix]:n},...e.decoders||{[e.prefix]:e}});class ab{constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new ib(e,t,r),this.decoder=new sb(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const so=({name:n,prefix:e,encode:t,decode:r})=>new ab(n,e,t,r),Qi=({prefix:n,name:e,alphabet:t})=>{const{encode:r,decode:i}=Qm(t,e);return so({prefix:n,name:e,encode:r,decode:s=>_i(i(s))})},Lt=({name:n,prefix:e,bitsPerChar:t,alphabet:r})=>so({prefix:e,name:n,encode:i=>((n,e,t)=>{const r="="===e[e.length-1],i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<n.length;++c)for(a=a<<8|n[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),r)for(;s.length*t&7;)s+="=";return s})(i,r,t),decode:i=>((n,e,t,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=n.length;for(;"="===n[s-1];)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const d=i[n[l]];if(void 0===d)throw new SyntaxError(`Non-${r} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(i,r,t,n)}),lb=so({prefix:"\0",name:"identity",encode:n=>(n=>(new TextDecoder).decode(n))(n),decode:n=>(n=>(new TextEncoder).encode(n))(n)}),db=Lt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),fb=Lt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),hb=Qi({prefix:"9",name:"base10",alphabet:"0123456789"}),pb=Lt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),gb=Lt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),es=Lt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),yb=Lt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_b=Lt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),mb=Lt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),bb=Lt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),wb=Lt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),vb=Lt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),xb=Lt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Eb=Lt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Ab=Qi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ib=Qi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),or=Qi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Sb=Qi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Db=Lt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ob=Lt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Cb=Lt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Pb=Lt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),md=Array.from("\u{1f680}\u{1fa90}\u2604\u{1f6f0}\u{1f30c}\u{1f311}\u{1f312}\u{1f313}\u{1f314}\u{1f315}\u{1f316}\u{1f317}\u{1f318}\u{1f30d}\u{1f30f}\u{1f30e}\u{1f409}\u2600\u{1f4bb}\u{1f5a5}\u{1f4be}\u{1f4bf}\u{1f602}\u2764\u{1f60d}\u{1f923}\u{1f60a}\u{1f64f}\u{1f495}\u{1f62d}\u{1f618}\u{1f44d}\u{1f605}\u{1f44f}\u{1f601}\u{1f525}\u{1f970}\u{1f494}\u{1f496}\u{1f499}\u{1f622}\u{1f914}\u{1f606}\u{1f644}\u{1f4aa}\u{1f609}\u263a\u{1f44c}\u{1f917}\u{1f49c}\u{1f614}\u{1f60e}\u{1f607}\u{1f339}\u{1f926}\u{1f389}\u{1f49e}\u270c\u2728\u{1f937}\u{1f631}\u{1f60c}\u{1f338}\u{1f64c}\u{1f60b}\u{1f497}\u{1f49a}\u{1f60f}\u{1f49b}\u{1f642}\u{1f493}\u{1f929}\u{1f604}\u{1f600}\u{1f5a4}\u{1f603}\u{1f4af}\u{1f648}\u{1f447}\u{1f3b6}\u{1f612}\u{1f92d}\u2763\u{1f61c}\u{1f48b}\u{1f440}\u{1f62a}\u{1f611}\u{1f4a5}\u{1f64b}\u{1f61e}\u{1f629}\u{1f621}\u{1f92a}\u{1f44a}\u{1f973}\u{1f625}\u{1f924}\u{1f449}\u{1f483}\u{1f633}\u270b\u{1f61a}\u{1f61d}\u{1f634}\u{1f31f}\u{1f62c}\u{1f643}\u{1f340}\u{1f337}\u{1f63b}\u{1f613}\u2b50\u2705\u{1f97a}\u{1f308}\u{1f608}\u{1f918}\u{1f4a6}\u2714\u{1f623}\u{1f3c3}\u{1f490}\u2639\u{1f38a}\u{1f498}\u{1f620}\u261d\u{1f615}\u{1f33a}\u{1f382}\u{1f33b}\u{1f610}\u{1f595}\u{1f49d}\u{1f64a}\u{1f639}\u{1f5e3}\u{1f4ab}\u{1f480}\u{1f451}\u{1f3b5}\u{1f91e}\u{1f61b}\u{1f534}\u{1f624}\u{1f33c}\u{1f62b}\u26bd\u{1f919}\u2615\u{1f3c6}\u{1f92b}\u{1f448}\u{1f62e}\u{1f646}\u{1f37b}\u{1f343}\u{1f436}\u{1f481}\u{1f632}\u{1f33f}\u{1f9e1}\u{1f381}\u26a1\u{1f31e}\u{1f388}\u274c\u270a\u{1f44b}\u{1f630}\u{1f928}\u{1f636}\u{1f91d}\u{1f6b6}\u{1f4b0}\u{1f353}\u{1f4a2}\u{1f91f}\u{1f641}\u{1f6a8}\u{1f4a8}\u{1f92c}\u2708\u{1f380}\u{1f37a}\u{1f913}\u{1f619}\u{1f49f}\u{1f331}\u{1f616}\u{1f476}\u{1f974}\u25b6\u27a1\u2753\u{1f48e}\u{1f4b8}\u2b07\u{1f628}\u{1f31a}\u{1f98b}\u{1f637}\u{1f57a}\u26a0\u{1f645}\u{1f61f}\u{1f635}\u{1f44e}\u{1f932}\u{1f920}\u{1f927}\u{1f4cc}\u{1f535}\u{1f485}\u{1f9d0}\u{1f43e}\u{1f352}\u{1f617}\u{1f911}\u{1f30a}\u{1f92f}\u{1f437}\u260e\u{1f4a7}\u{1f62f}\u{1f486}\u{1f446}\u{1f3a4}\u{1f647}\u{1f351}\u2744\u{1f334}\u{1f4a3}\u{1f438}\u{1f48c}\u{1f4cd}\u{1f940}\u{1f922}\u{1f445}\u{1f4a1}\u{1f4a9}\u{1f450}\u{1f4f8}\u{1f47b}\u{1f910}\u{1f92e}\u{1f3bc}\u{1f975}\u{1f6a9}\u{1f34e}\u{1f34a}\u{1f47c}\u{1f48d}\u{1f4e3}\u{1f942}"),Tb=md.reduce((n,e,t)=>(n[t]=e,n),[]),Bb=md.reduce((n,e,t)=>(n[e.codePointAt(0)]=t,n),[]),Ub=so({prefix:"\u{1f680}",name:"base256emoji",encode:function Rb(n){return n.reduce((e,t)=>e+Tb[t],"")},decode:function Fb(n){const e=[];for(const t of n){const r=Bb[t.codePointAt(0)];if(void 0===r)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}});var bd=128,Lb=-128,Mb=Math.pow(2,31),$b=128,vd=127,zb=Math.pow(2,7),qb=Math.pow(2,14),Kb=Math.pow(2,21),Vb=Math.pow(2,28),Hb=Math.pow(2,35),Wb=Math.pow(2,42),Gb=Math.pow(2,49),Yb=Math.pow(2,56),Jb=Math.pow(2,63),Xb={encode:function wd(n,e,t){e=e||[];for(var r=t=t||0;n>=Mb;)e[t++]=255&n|bd,n/=128;for(;n&Lb;)e[t++]=255&n|bd,n>>>=7;return e[t]=0|n,wd.bytes=t-r+1,e},decode:function Ga(n,r){var o,t=0,i=0,s=r=r||0,a=n.length;do{if(s>=a)throw Ga.bytes=0,new RangeError("Could not decode varint");o=n[s++],t+=i<28?(o&vd)<<i:(o&vd)*Math.pow(2,i),i+=7}while(o>=$b);return Ga.bytes=s-r,t},encodingLength:function(n){return n<zb?1:n<qb?2:n<Kb?3:n<Vb?4:n<Hb?5:n<Wb?6:n<Gb?7:n<Yb?8:n<Jb?9:10}};const oo=Xb,ao=(n,e,t=0)=>(oo.encode(n,e,t),e),co=n=>oo.encodingLength(n),uo=(n,e)=>{const t=e.byteLength,r=co(n),i=r+co(t),s=new Uint8Array(i+t);return ao(n,s,0),ao(t,s,r),s.set(e,i),new Ja(n,t,e,s)};class Ja{constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}const xd=({name:n,code:e,encode:t})=>new n1(n,e,t);class n1{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?uo(this.code,t):t.then(r=>uo(this.code,r))}throw Error("Unknown type, must be binary type")}}const Ed=n=>function(){var e=(0,h.A)(function*(t){return new Uint8Array(yield crypto.subtle.digest(n,t))});return function(t){return e.apply(this,arguments)}}(),r1=xd({name:"sha2-256",code:18,encode:Ed("SHA-256")}),i1=xd({name:"sha2-512",code:19,encode:Ed("SHA-512")}),Id=_i,o1={code:0,name:"identity",encode:Id,digest:n=>uo(0,Id(n))},a1="raw",c1=85,u1=n=>_i(n),l1=n=>_i(n),d1=new TextEncoder,f1=new TextDecoder,h1="json",p1=512,g1=n=>d1.encode(JSON.stringify(n)),y1=n=>JSON.parse(f1.decode(n));Symbol,Symbol.for("nodejs.util.inspect.custom"),Symbol.for("@ipld/js-cid/CID");const Od={...V,...C,..._e,...de,...ve,...be,...we,...he,...oe,...Pe};function Cd(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}const Pd=Cd("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>(new TextEncoder).encode(n.substring(1))),Za=Cd("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{const e=yd((n=n.substring(1)).length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),Td={utf8:Pd,"utf-8":Pd,hex:Od.base16,latin1:Za,ascii:Za,binary:Za,...Od};function An(n,e="utf8"){const t=Td[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.decoder.decode(`${t.prefix}${n}`):Wa(globalThis.Buffer.from(n,"utf-8"))}function dn(n,e="utf8"){const t=Td[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.encoder.encode(n).substring(1):globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8")}const D1={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var O1=U(2950);function ns(n){const[e,t]=n.split(":");return{namespace:e,reference:t}}function Xa(n,e){return n.includes(":")?[n]:e.chains||[]}var F1=Object.defineProperty,U1=Object.defineProperties,N1=Object.getOwnPropertyDescriptors,zd=Object.getOwnPropertySymbols,k1=Object.prototype.hasOwnProperty,L1=Object.prototype.propertyIsEnumerable,Qa=(n,e,t)=>e in n?F1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,qd=(n,e)=>{for(var t in e||(e={}))k1.call(e,t)&&Qa(n,t,e[t]);if(zd)for(var t of zd(e))L1.call(e,t)&&Qa(n,t,e[t]);return n},Kd=(n,e,t)=>Qa(n,"symbol"!=typeof e?e+"":e,t);const z1="js";function yo(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Er(){return!(0,ir.getDocument)()&&!!(0,ir.getNavigator)()&&"ReactNative"===navigator.product}function mi(){return!yo()&&!!(0,ir.getNavigator)()&&!!(0,ir.getDocument)()}function bi(){return Er()?"react-native":yo()?"node":mi()?"browser":"unknown"}function Hd(){var n;try{return Er()&&typeof global<"u"&&typeof(null==global?void 0:global.Application)<"u"?null==(n=global.Application)?void 0:n.applicationId:void 0}catch{return}}function Wd(){return(0,B_.g)()||{name:"",description:"",url:"",icons:[""]}}function Gd(n,e,t){const r=function W1(){if("react-native"===bi()&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"){const{OS:t,Version:r}=global.Platform;return[t,r].join("-")}const n=function O_(n){return n?Bl(n):typeof document>"u"&&typeof navigator<"u"&&"ReactNative"===navigator.product?new A_:typeof navigator<"u"?Bl(navigator.userAgent):function P_(){return typeof process<"u"&&process.version?new v_(process.version.slice(1)):null}()}();if(null===n)return"unknown";const e=n.os?n.os.replace(" ","").toLowerCase():"unknown";return"browser"===n.type?[e,n.name,n.version].join("-"):[e,n.version].join("-")}(),i=function G1(){var n;const e=bi();return"browser"===e?[e,(null==(n=(0,ir.getLocation)())?void 0:n.host)||"unknown"].join(":"):e}();return[[n,e].join("-"),[z1,t].join("-"),r,i].join("/")}function Jr(n,e){return n.filter(t=>e.includes(t)).length===n.length}function tc(n){return Object.fromEntries(n.entries())}function nc(n){return new Map(Object.entries(n))}function Zr(n=m.FIVE_MINUTES,e){const t=(0,m.toMiliseconds)(n||m.FIVE_MINUTES);let r,i,s,o;return{resolve:a=>{s&&r&&(clearTimeout(s),r(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},t),r=a,i=c})}}function $n(n,e,t){return new Promise(function(){var r=(0,h.A)(function*(i,s){const o=setTimeout(()=>s(new Error(t)),e);try{i(yield n)}catch(a){s(a)}clearTimeout(o)});return function(i,s){return r.apply(this,arguments)}}())}function Yd(n,e){if("string"==typeof e&&e.startsWith(`${n}:`))return e;if("topic"===n.toLowerCase()){if("string"!=typeof e)throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}if("id"===n.toLowerCase()){if("number"!=typeof e)throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${n}`)}function Jd(n){const[e,t]=n.split(":"),r={id:void 0,topic:void 0};if("topic"===e&&"string"==typeof t)r.topic=t;else{if("id"!==e||!Number.isInteger(Number(t)))throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);r.id=Number(t)}return r}function Ct(n,e){return(0,m.fromMiliseconds)((e||Date.now())+(0,m.toMiliseconds)(n))}function Ar(n){return Date.now()>=(0,m.toMiliseconds)(n)}function ot(n,e){return`${n}${e?`:${e}`:""}`}function Rn(n=[],e=[]){return[...new Set([...n,...e])]}function rc(){return rc=(0,h.A)(function*({id:n,topic:e,wcDeepLink:t}){var r;try{if(!t)return;const i="string"==typeof t?JSON.parse(t):t,s=i?.href;if("string"!=typeof s)return;const o=function nw(n,e,t){const r=`requestId=${e}&sessionTopic=${t}`;n.endsWith("/")&&(n=n.slice(0,-1));let i=`${n}`;return i=n.startsWith("https://t.me")?`${i}${n.includes("?")?"&startapp=":"?startapp="}${function aw(n,e=!1){const t=Buffer.from(n).toString("base64");return e?t.replace(/[=]/g,""):t}(r,!0)}`:`${i}/wc?${r}`,i}(s,n,e),a=bi();if("browser"===a){if(null==(r=(0,ir.getDocument)())||!r.hasFocus())return void console.warn("Document does not have focus, skipping deeplink.");!function rw(n){let e="_self";!function ow(){try{return window.self!==window.top}catch{return!1}}()?(function sw(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}()||n.startsWith("https://")||n.startsWith("http://"))&&(e="_blank"):e="_top",window.open(n,e,"noreferrer noopener")}(o)}else"react-native"===a&&typeof(null==global?void 0:global.Linking)<"u"&&(yield global.Linking.openURL(o))}catch(i){console.error(i)}}),rc.apply(this,arguments)}function ic(){return ic=(0,h.A)(function*(n,e){let t="";try{if(mi()&&(t=localStorage.getItem(e),t))return t;t=yield n.getItem(e)}catch(r){console.error(r)}return t}),ic.apply(this,arguments)}function Xd(n,e){if(!n.includes(e))return null;const t=n.split(/([&,?,=])/),r=t.indexOf(e);return t[r+2]}function Qd(){return typeof crypto<"u"&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,n=>{const e=16*Math.random()|0;return("x"===n?e:3&e|8).toString(16)})}function sc(){return typeof process<"u"&&"true"===process.env.IS_VITEST}function ef(n){return Buffer.from(n,"base64").toString("utf-8")}class uw{constructor({limit:e}){Kd(this,"limit"),Kd(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const t=this.set.values().next().value;t&&this.set.delete(t)}this.set.add(e)}}has(e){return this.set.has(e)}}const _o=BigInt(2**32-1),tf=BigInt(32);function nf(n,e=!1){return e?{h:Number(n&_o),l:Number(n>>tf&_o)}:{h:0|Number(n>>tf&_o),l:0|Number(n&_o)}}function rf(n,e=!1){const t=n.length;let r=new Uint32Array(t),i=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=nf(n[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const sf=(n,e,t)=>n>>>t,of=(n,e,t)=>n<<32-t|e>>>t,Ir=(n,e,t)=>n>>>t|e<<32-t,Sr=(n,e,t)=>n<<32-t|e>>>t,rs=(n,e,t)=>n<<64-t|e>>>t-32,is=(n,e,t)=>n>>>t-32|e<<64-t,lw=(n,e)=>e,dw=(n,e)=>n;function Fn(n,e,t,r){const i=(e>>>0)+(r>>>0);return{h:n+t+(i/2**32|0)|0,l:0|i}}const oc=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),ac=(n,e,t,r)=>e+t+r+(n/2**32|0)|0,yw=(n,e,t,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0),_w=(n,e,t,r,i)=>e+t+r+i+(n/2**32|0)|0,mw=(n,e,t,r,i)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),bw=(n,e,t,r,i,s)=>e+t+r+i+s+(n/2**32|0)|0,wi="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function mo(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&"Uint8Array"===n.constructor.name}function ar(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function Un(n,...e){if(!mo(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function bo(n){if("function"!=typeof n||"function"!=typeof n.create)throw new Error("Hash should be wrapped by utils.createHasher");ar(n.outputLen),ar(n.blockLen)}function Dr(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function cc(n,e){Un(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function ss(n){return new Uint32Array(n.buffer,n.byteOffset,Math.floor(n.byteLength/4))}function In(...n){for(let e=0;e<n.length;e++)n[e].fill(0)}function uc(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function zn(n,e){return n<<32-e|n>>>e}const af=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function cf(n){return n<<24&4278190080|n<<8&16711680|n>>>8&65280|n>>>24&255}const cr=af?n=>n:n=>cf(n),Or=af?n=>n:function ww(n){for(let e=0;e<n.length;e++)n[e]=cf(n[e]);return n},uf="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,vw=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function vi(n){if(Un(n),uf)return n.toHex();let e="";for(let t=0;t<n.length;t++)e+=vw[n[t]];return e}function lf(n){return n>=48&&n<=57?n-48:n>=65&&n<=70?n-55:n>=97&&n<=102?n-87:void 0}function wo(n){if("string"!=typeof n)throw new Error("hex string expected, got "+typeof n);if(uf)return Uint8Array.fromHex(n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=lf(n.charCodeAt(s)),a=lf(n.charCodeAt(s+1));if(void 0===o||void 0===a)throw new Error('hex string expected, got non-hex character "'+(n[s]+n[s+1])+'" at index '+s);r[i]=16*o+a}return r}function df(n){if("string"!=typeof n)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(n))}function Nn(n){return"string"==typeof n&&(n=df(n)),Un(n),n}function Cr(...n){let e=0;for(let r=0;r<n.length;r++){const i=n[r];Un(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}class vo{}function os(n){const e=r=>n().update(Nn(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function Xr(n=32){if(wi&&"function"==typeof wi.getRandomValues)return wi.getRandomValues(new Uint8Array(n));if(wi&&"function"==typeof wi.randomBytes)return Uint8Array.from(wi.randomBytes(n));throw new Error("crypto.getRandomValues must be defined")}const Ew=BigInt(0),as=BigInt(1),Aw=BigInt(2),Iw=BigInt(7),Sw=BigInt(256),Dw=BigInt(113),ff=[],hf=[],pf=[];for(let n=0,e=as,t=1,r=0;n<24;n++){[t,r]=[r,(2*t+3*r)%5],ff.push(2*(5*r+t)),hf.push((n+1)*(n+2)/2%64);let i=Ew;for(let s=0;s<7;s++)e=(e<<as^(e>>Iw)*Dw)%Sw,e&Aw&&(i^=as<<(as<<BigInt(s))-as);pf.push(i)}const gf=rf(pf,!0),Ow=gf[0],Cw=gf[1],yf=(n,e,t)=>t>32?((n,e,t)=>e<<t-32|n>>>64-t)(n,e,t):((n,e,t)=>n<<t|e>>>32-t)(n,e,t),_f=(n,e,t)=>t>32?((n,e,t)=>n<<t-32|e>>>64-t)(n,e,t):((n,e,t)=>e<<t|n>>>32-t)(n,e,t);class lc extends vo{constructor(e,t,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=s,ar(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=ss(this.state)}clone(){return this._cloneInto()}keccak(){Or(this.state32),function Pw(n,e=24){const t=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)t[o]=n[o]^n[o+10]^n[o+20]^n[o+30]^n[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=t[c],l=t[c+1],d=yf(u,l,1)^t[a],f=_f(u,l,1)^t[a+1];for(let p=0;p<50;p+=10)n[o+p]^=d,n[o+p+1]^=f}let i=n[2],s=n[3];for(let o=0;o<24;o++){const a=hf[o],c=yf(i,s,a),u=_f(i,s,a),l=ff[o];i=n[l],s=n[l+1],n[l]=c,n[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=n[o+a];for(let a=0;a<10;a++)n[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}n[0]^=Ow[r],n[1]^=Cw[r]}In(t)}(this.state32,this.rounds),Or(this.state32),this.posOut=0,this.pos=0}update(e){Dr(this),Un(e=Nn(e));const{blockLen:t,state:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(t-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,!!(128&t)&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Dr(this,!1),Un(e),this.finish();const t=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(t.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ar(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(cc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,In(this.state)}_cloneInto(e){const{blockLen:t,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new lc(t,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Bw=os(()=>new lc(136,1,32));function Fw(n,e,t){return n&e^~n&t}function Uw(n,e,t){return n&e^n&t^e&t}class mf extends vo{constructor(e,t,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=uc(this.buffer)}update(e){Dr(this),Un(e=Nn(e));const{view:t,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=uc(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Dr(this),cc(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,In(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)t[d]=0;(function Rw(n,e,t,r){if("function"==typeof n.setBigUint64)return n.setBigUint64(e,t,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),u=r?0:4;n.setUint32(e+(r?4:0),o,r),n.setUint32(e+u,a,r)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=uc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,l[d],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const Pr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Vt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Ht=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Nw=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Tr=new Uint32Array(64);class kw extends mf{constructor(e=32){super(64,e,8,!1),this.A=0|Pr[0],this.B=0|Pr[1],this.C=0|Pr[2],this.D=0|Pr[3],this.E=0|Pr[4],this.F=0|Pr[5],this.G=0|Pr[6],this.H=0|Pr[7]}get(){const{A:e,B:t,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,r,i,s,o,a,c]}set(e,t,r,i,s,o,a,c){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|c}process(e,t){for(let d=0;d<16;d++,t+=4)Tr[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const f=Tr[d-15],p=Tr[d-2],g=zn(f,7)^zn(f,18)^f>>>3,y=zn(p,17)^zn(p,19)^p>>>10;Tr[d]=y+Tr[d-7]+g+Tr[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let d=0;d<64;d++){const p=l+(zn(a,6)^zn(a,11)^zn(a,25))+Fw(a,c,u)+Nw[d]+Tr[d]|0,g=(zn(r,2)^zn(r,13)^zn(r,22))+Uw(r,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=r,r=p+g|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,i,s,o,a,c,u,l)}roundClean(){In(Tr)}destroy(){this.set(0,0,0,0,0,0,0,0),In(this.buffer)}}const bf=rf(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),Lw=bf[0],Mw=bf[1],Br=new Uint32Array(80),Rr=new Uint32Array(80);class dc extends mf{constructor(e=64){super(128,e,16,!1),this.Ah=0|Ht[0],this.Al=0|Ht[1],this.Bh=0|Ht[2],this.Bl=0|Ht[3],this.Ch=0|Ht[4],this.Cl=0|Ht[5],this.Dh=0|Ht[6],this.Dl=0|Ht[7],this.Eh=0|Ht[8],this.El=0|Ht[9],this.Fh=0|Ht[10],this.Fl=0|Ht[11],this.Gh=0|Ht[12],this.Gl=0|Ht[13],this.Hh=0|Ht[14],this.Hl=0|Ht[15]}get(){const{Ah:e,Al:t,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:d,Fl:f,Gh:p,Gl:g,Hh:y,Hl:w}=this;return[e,t,r,i,s,o,a,c,u,l,d,f,p,g,y,w]}set(e,t,r,i,s,o,a,c,u,l,d,f,p,g,y,w){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|i,this.Ch=0|s,this.Cl=0|o,this.Dh=0|a,this.Dl=0|c,this.Eh=0|u,this.El=0|l,this.Fh=0|d,this.Fl=0|f,this.Gh=0|p,this.Gl=0|g,this.Hh=0|y,this.Hl=0|w}process(e,t){for(let E=0;E<16;E++,t+=4)Br[E]=e.getUint32(t),Rr[E]=e.getUint32(t+=4);for(let E=16;E<80;E++){const k=0|Br[E-15],X=0|Rr[E-15],ce=Ir(k,X,1)^Ir(k,X,8)^sf(k,0,7),J=Sr(k,X,1)^Sr(k,X,8)^of(k,X,7),Q=0|Br[E-2],W=0|Rr[E-2],Fe=Ir(Q,W,19)^rs(Q,W,61)^sf(Q,0,6),Ae=Sr(Q,W,19)^is(Q,W,61)^of(Q,W,6),ae=yw(J,Ae,Rr[E-7],Rr[E-16]),F=_w(ae,ce,Fe,Br[E-7],Br[E-16]);Br[E]=0|F,Rr[E]=0|ae}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:d,El:f,Fh:p,Fl:g,Gh:y,Gl:w,Hh:T,Hl:N}=this;for(let E=0;E<80;E++){const k=Ir(d,f,14)^Ir(d,f,18)^rs(d,f,41),X=Sr(d,f,14)^Sr(d,f,18)^is(d,f,41),ce=d&p^~d&y,Q=mw(N,X,f&g^~f&w,Mw[E],Rr[E]),W=bw(Q,T,k,ce,Lw[E],Br[E]),Fe=0|Q,Ae=Ir(r,i,28)^rs(r,i,34)^rs(r,i,39),ae=Sr(r,i,28)^is(r,i,34)^is(r,i,39),F=r&s^r&a^s&a,L=i&o^i&c^o&c;T=0|y,N=0|w,y=0|p,w=0|g,p=0|d,g=0|f,({h:d,l:f}=Fn(0|u,0|l,0|W,0|Fe)),u=0|a,l=0|c,a=0|s,c=0|o,s=0|r,o=0|i;const D=oc(Fe,ae,L);r=ac(D,W,Ae,F),i=0|D}({h:r,l:i}=Fn(0|this.Ah,0|this.Al,0|r,0|i)),({h:s,l:o}=Fn(0|this.Bh,0|this.Bl,0|s,0|o)),({h:a,l:c}=Fn(0|this.Ch,0|this.Cl,0|a,0|c)),({h:u,l}=Fn(0|this.Dh,0|this.Dl,0|u,0|l)),({h:d,l:f}=Fn(0|this.Eh,0|this.El,0|d,0|f)),({h:p,l:g}=Fn(0|this.Fh,0|this.Fl,0|p,0|g)),({h:y,l:w}=Fn(0|this.Gh,0|this.Gl,0|y,0|w)),({h:T,l:N}=Fn(0|this.Hh,0|this.Hl,0|T,0|N)),this.set(r,i,s,o,a,c,u,l,d,f,p,g,y,w,T,N)}roundClean(){In(Br,Rr)}destroy(){In(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class jw extends dc{constructor(){super(48),this.Ah=0|Vt[0],this.Al=0|Vt[1],this.Bh=0|Vt[2],this.Bl=0|Vt[3],this.Ch=0|Vt[4],this.Cl=0|Vt[5],this.Dh=0|Vt[6],this.Dl=0|Vt[7],this.Eh=0|Vt[8],this.El=0|Vt[9],this.Fh=0|Vt[10],this.Fl=0|Vt[11],this.Gh=0|Vt[12],this.Gl=0|Vt[13],this.Hh=0|Vt[14],this.Hl=0|Vt[15]}}const Wt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class $w extends dc{constructor(){super(32),this.Ah=0|Wt[0],this.Al=0|Wt[1],this.Bh=0|Wt[2],this.Bl=0|Wt[3],this.Ch=0|Wt[4],this.Cl=0|Wt[5],this.Dh=0|Wt[6],this.Dl=0|Wt[7],this.Eh=0|Wt[8],this.El=0|Wt[9],this.Fh=0|Wt[10],this.Fl=0|Wt[11],this.Gh=0|Wt[12],this.Gl=0|Wt[13],this.Hh=0|Wt[14],this.Hl=0|Wt[15]}}const xo=os(()=>new kw),zw=os(()=>new dc),qw=os(()=>new jw),Kw=os(()=>new $w),Vw=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Pt=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Ee=new Uint32Array(32);function Fr(n,e,t,r,i,s){const a=i[s+1];let c=Ee[2*n],u=Ee[2*n+1],l=Ee[2*e],d=Ee[2*e+1],f=Ee[2*t],p=Ee[2*t+1],g=Ee[2*r],y=Ee[2*r+1],w=oc(c,l,i[s]);u=ac(w,u,d,a),c=0|w,({Dh:y,Dl:g}={Dh:y^u,Dl:g^c}),({Dh:y,Dl:g}={Dh:lw(0,g),Dl:dw(y)}),({h:p,l:f}=Fn(p,f,y,g)),({Bh:d,Bl:l}={Bh:d^p,Bl:l^f}),({Bh:d,Bl:l}={Bh:Ir(d,l,24),Bl:Sr(d,l,24)}),Ee[2*n]=c,Ee[2*n+1]=u,Ee[2*e]=l,Ee[2*e+1]=d,Ee[2*t]=f,Ee[2*t+1]=p,Ee[2*r]=g,Ee[2*r+1]=y}function Ur(n,e,t,r,i,s){const a=i[s+1];let c=Ee[2*n],u=Ee[2*n+1],l=Ee[2*e],d=Ee[2*e+1],f=Ee[2*t],p=Ee[2*t+1],g=Ee[2*r],y=Ee[2*r+1],w=oc(c,l,i[s]);u=ac(w,u,d,a),c=0|w,({Dh:y,Dl:g}={Dh:y^u,Dl:g^c}),({Dh:y,Dl:g}={Dh:Ir(y,g,16),Dl:Sr(y,g,16)}),({h:p,l:f}=Fn(p,f,y,g)),({Bh:d,Bl:l}={Bh:d^p,Bl:l^f}),({Bh:d,Bl:l}={Bh:rs(d,l,63),Bl:is(d,l,63)}),Ee[2*n]=c,Ee[2*n+1]=u,Ee[2*e]=l,Ee[2*e+1]=d,Ee[2*t]=f,Ee[2*t+1]=p,Ee[2*r]=g,Ee[2*r+1]=y}class Ww extends vo{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,ar(e),ar(t),this.blockLen=e,this.outputLen=t,this.buffer=new Uint8Array(e),this.buffer32=ss(this.buffer)}update(e){Dr(this),Un(e=Nn(e));const{blockLen:t,buffer:r,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===t&&(Or(i),this.compress(i,0,!1),Or(i),this.pos=0);const u=Math.min(t-this.pos,s-c),l=o+c;if(u===t&&!(l%4)&&c+u<s){const d=new Uint32Array(a,l,Math.floor((s-c)/4));Or(d);for(let f=0;c+t<s;f+=i.length,c+=t)this.length+=t,this.compress(d,f,!1);Or(d);continue}r.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){Dr(this),cc(e,this);const{pos:t,buffer32:r}=this;this.finished=!0,In(this.buffer.subarray(t)),Or(r),this.compress(r,0,!0),Or(r);const i=ss(e);this.get().forEach((s,o)=>i[o]=cr(s))}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){const{buffer:t,length:r,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(t),e.destroyed=s,e.finished=i,e.length=r,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class Gw extends Ww{constructor(e={}){const t=void 0===e.dkLen?64:e.dkLen;super(128,t),this.v0l=0|Pt[0],this.v0h=0|Pt[1],this.v1l=0|Pt[2],this.v1h=0|Pt[3],this.v2l=0|Pt[4],this.v2h=0|Pt[5],this.v3l=0|Pt[6],this.v3h=0|Pt[7],this.v4l=0|Pt[8],this.v4h=0|Pt[9],this.v5l=0|Pt[10],this.v5h=0|Pt[11],this.v6l=0|Pt[12],this.v6h=0|Pt[13],this.v7l=0|Pt[14],this.v7h=0|Pt[15],function Hw(n,e={},t,r,i){if(ar(t),n<0||n>t)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(void 0!==s&&(s.length<1||s.length>t))throw new Error("key length must be undefined or 1.."+t);if(void 0!==o&&o.length!==r)throw new Error("salt must be undefined or "+r);if(void 0!==a&&a.length!==i)throw new Error("personalization must be undefined or "+i)}(t,e,64,16,16);let{key:r,personalization:i,salt:s}=e,o=0;if(void 0!==r&&(r=Nn(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,void 0!==s){s=Nn(s);const a=ss(s);this.v4l^=cr(a[0]),this.v4h^=cr(a[1]),this.v5l^=cr(a[2]),this.v5h^=cr(a[3])}if(void 0!==i){i=Nn(i);const a=ss(i);this.v6l^=cr(a[0]),this.v6h^=cr(a[1]),this.v7l^=cr(a[2]),this.v7h^=cr(a[3])}if(void 0!==r){const a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:e,v0h:t,v1l:r,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:d,v5h:f,v6l:p,v6h:g,v7l:y,v7h:w}=this;return[e,t,r,i,s,o,a,c,u,l,d,f,p,g,y,w]}set(e,t,r,i,s,o,a,c,u,l,d,f,p,g,y,w){this.v0l=0|e,this.v0h=0|t,this.v1l=0|r,this.v1h=0|i,this.v2l=0|s,this.v2h=0|o,this.v3l=0|a,this.v3h=0|c,this.v4l=0|u,this.v4h=0|l,this.v5l=0|d,this.v5h=0|f,this.v6l=0|p,this.v6h=0|g,this.v7l=0|y,this.v7h=0|w}compress(e,t,r){this.get().forEach((c,u)=>Ee[u]=c),Ee.set(Pt,16);let{h:i,l:s}=nf(BigInt(this.length));Ee[24]=Pt[8]^s,Ee[25]=Pt[9]^i,r&&(Ee[28]=~Ee[28],Ee[29]=~Ee[29]);let o=0;const a=Vw;for(let c=0;c<12;c++)Fr(0,4,8,12,e,t+2*a[o++]),Ur(0,4,8,12,e,t+2*a[o++]),Fr(1,5,9,13,e,t+2*a[o++]),Ur(1,5,9,13,e,t+2*a[o++]),Fr(2,6,10,14,e,t+2*a[o++]),Ur(2,6,10,14,e,t+2*a[o++]),Fr(3,7,11,15,e,t+2*a[o++]),Ur(3,7,11,15,e,t+2*a[o++]),Fr(0,5,10,15,e,t+2*a[o++]),Ur(0,5,10,15,e,t+2*a[o++]),Fr(1,6,11,12,e,t+2*a[o++]),Ur(1,6,11,12,e,t+2*a[o++]),Fr(2,7,8,13,e,t+2*a[o++]),Ur(2,7,8,13,e,t+2*a[o++]),Fr(3,4,9,14,e,t+2*a[o++]),Ur(3,4,9,14,e,t+2*a[o++]);this.v0l^=Ee[0]^Ee[16],this.v0h^=Ee[1]^Ee[17],this.v1l^=Ee[2]^Ee[18],this.v1h^=Ee[3]^Ee[19],this.v2l^=Ee[4]^Ee[20],this.v2h^=Ee[5]^Ee[21],this.v3l^=Ee[6]^Ee[22],this.v3h^=Ee[7]^Ee[23],this.v4l^=Ee[8]^Ee[24],this.v4h^=Ee[9]^Ee[25],this.v5l^=Ee[10]^Ee[26],this.v5h^=Ee[11]^Ee[27],this.v6l^=Ee[12]^Ee[28],this.v6h^=Ee[13]^Ee[29],this.v7l^=Ee[14]^Ee[30],this.v7h^=Ee[15]^Ee[31],In(Ee)}destroy(){this.destroyed=!0,In(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Yw=function xw(n){const e=(r,i)=>n(i).update(Nn(r)).digest(),t=n({});return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=r=>n(r),e}(n=>new Gw(n));function wf(n){const e=`\x19Ethereum Signed Message:\n${n.length}`,t=(new TextEncoder).encode(e+n);return"0x"+Buffer.from(Bw(t)).toString("hex")}function fc(){return fc=(0,h.A)(function*(n,e,t,r,i,s){switch(t.t){case"eip191":return yield function Xw(n,e,t){return hc.apply(this,arguments)}(n,e,t.s);case"eip1271":return yield function Qw(n,e,t,r,i,s){return pc.apply(this,arguments)}(n,e,t.s,r,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}),fc.apply(this,arguments)}function hc(){return hc=(0,h.A)(function*(n,e,t){return(yield function om(n){return Ta.apply(this,arguments)}({hash:wf(e),signature:t})).toLowerCase()===n.toLowerCase()}),hc.apply(this,arguments)}function pc(){return pc=(0,h.A)(function*(n,e,t,r,i,s){const o=ns(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=t.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),f=a+(e.startsWith("0x")?e:wf(e)).substring(2)+c+l+u,p=yield fetch(`${s||"https://rpc.walletconnect.org/v1"}/?chainId=${r}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:n,data:f},"latest"]})}),{result:g}=yield p.json();return!!g&&g.slice(0,a.length).toLowerCase()===a.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}),pc.apply(this,arguments)}function nv(n){const e=new Uint8Array(Buffer.from(n,"base64")),t=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),r=new Uint8Array(t.length+e.length);r.set(t),r.set(e,t.length);const i=Yw(r,{dkLen:32});return Vi.encode(i)}function vf(n){const e=new Uint8Array(xo(function rv(n){if(n instanceof Uint8Array)return n;if(Array.isArray(n))return new Uint8Array(n);if("object"==typeof n&&null!=n&&n.data)return new Uint8Array(Object.values(n.data));if("object"==typeof n&&n)return new Uint8Array(Object.values(n));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(n)));return Vi.encode(e)}function xf(n){const t=function zm(n,e){return new Ma(e).decode(n)}(Buffer.from(n,"base64")).txn;if(!t)throw new Error("Invalid signed transaction: missing 'txn' field");const r=function Vm(n,e){return new ja(e).encodeSharedRef(n)}(t),i=Buffer.from("TX"),s=Buffer.concat([i,Buffer.from(r)]),o=Kw(s);return cd.encode(o).replace(/=+$/,"")}function gc(n){const e=[];let t=BigInt(n);for(;t>=BigInt(128);)e.push(Number(t&BigInt(127)|BigInt(128))),t>>=BigInt(7);return e.push(Number(t)),Buffer.from(e)}function iv(n){const e=Buffer.from(n.signed.bodyBytes,"base64"),t=Buffer.from(n.signed.authInfoBytes,"base64"),r=Buffer.from(n.signature.signature,"base64"),i=[];i.push(Buffer.from([10])),i.push(gc(e.length)),i.push(e),i.push(Buffer.from([18])),i.push(gc(t.length)),i.push(t),i.push(Buffer.from([26])),i.push(gc(r.length)),i.push(r);const s=Buffer.concat(i),o=xo(s);return Buffer.from(o).toString("hex").toUpperCase()}var ov=Object.defineProperty,av=Object.defineProperties,cv=Object.getOwnPropertyDescriptors,Ef=Object.getOwnPropertySymbols,uv=Object.prototype.hasOwnProperty,lv=Object.prototype.propertyIsEnumerable,Af=(n,e,t)=>e in n?ov(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;const _c=n=>n?.split(":"),mc=n=>{const e=n&&_c(n);if(e)return e[2]+":"+e[3]},Eo=n=>{const e=n&&_c(n);if(e)return e.pop()};function Sf(n){return bc.apply(this,arguments)}function bc(){return bc=(0,h.A)(function*(n){const{cacao:e,projectId:t}=n,{s:r,p:i}=e,s=Df(i,i.iss),o=Eo(i.iss);return yield function Zw(n,e,t,r,i,s){return fc.apply(this,arguments)}(o,s,r,mc(i.iss),t)}),bc.apply(this,arguments)}const Df=(n,e)=>{const t=`${n.domain} wants you to sign in with your Ethereum account:`,r=Eo(e);if(!n.aud&&!n.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=n.statement||void 0;const s=`URI: ${n.aud||n.uri}`,o=`Version: ${n.version}`,a=`Chain ID: ${(n=>{const e=n&&_c(n);if(e)return n.includes("did:pkh:")?e[3]:e[1]})(e)}`,c=`Nonce: ${n.nonce}`,u=`Issued At: ${n.iat}`,l=n.exp?`Expiration Time: ${n.exp}`:void 0,d=n.nbf?`Not Before: ${n.nbf}`:void 0,f=n.requestId?`Request ID: ${n.requestId}`:void 0,p=n.resources?`Resources:${n.resources.map(y=>`\n- ${y}`).join("")}`:void 0,g=xi(n.resources);return g&&(i=function Pf(n="",e){lr(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(n.includes(t))return n;const r=[];let i=0;return Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(d=>({ability:d.split("/")[0],action:d.split("/")[1]}));c.sort((d,f)=>d.action.localeCompare(f.action));const u={};c.forEach(d=>{u[d.ability]||(u[d.ability]=[]),u[d.ability].push(d.action)});const l=Object.keys(u).map(d=>(i++,`(${i}) '${d}': '${u[d].join("', '")}' for '${a}'.`));r.push(l.join(", ").replace(".,","."))}),`${n?n+" ":""}${t}${r.join(" ")}`}(i,Qr(g))),[t,r,"",i,"",s,o,a,c,u,l,d,f,p].filter(y=>null!=y).join("\n")};function lr(n){if(!n)throw new Error("No recap provided, value is undefined");if(!n.att)throw new Error("No `att` property found");const e=Object.keys(n.att);if(null==e||!e.length)throw new Error("No resources found in `att` property");e.forEach(t=>{const r=n.att[t];if(Array.isArray(r))throw new Error(`Resource must be an object: ${t}`);if("object"!=typeof r)throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(r).forEach(i=>{const s=r[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if("object"!=typeof o)throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function Of(n,e,t={}){e=e?.sort((i,s)=>i.localeCompare(s));const r=e.map(i=>({[`${n}/${i}`]:[t]}));return Object.assign({},...r)}function wc(n){return lr(n),`urn:recap:${function yv(n){return Buffer.from(JSON.stringify(n)).toString("base64")}(n).replace(/=/g,"")}`}function Qr(n){const e=function _v(n){return JSON.parse(Buffer.from(n,"base64").toString("utf-8"))}(n.replace("urn:recap:",""));return lr(e),e}function vv(n,e){const i=function xv(n,e){lr(n),lr(e);const t=Object.keys(n.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),r={att:{}};return t.forEach(i=>{var s,o;Object.keys((null==(s=n.att)?void 0:s[i])||{}).concat(Object.keys((null==(o=e.att)?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;r.att[i]=((n,e)=>av(n,cv(e)))(((n,e)=>{for(var t in e||(e={}))uv.call(e,t)&&Af(n,t,e[t]);if(Ef)for(var t of Ef(e))lv.call(e,t)&&Af(n,t,e[t]);return n})({},r.att[i]),{[a]:(null==(c=n.att[i])?void 0:c[a])||(null==(u=e.att[i])?void 0:u[a])})})}),r}(Qr(n),Qr(e));return wc(i)}function Tf(n){var e;const t=Qr(n);lr(t);const r=null==(e=t.att)?void 0:e.eip155;return r?Object.keys(r).map(i=>i.split("/")[1]):[]}function Bf(n){const e=Qr(n);lr(e);const t=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(i=>{var s;null!=(s=i?.[0])&&s.chains&&t.push(i[0].chains)})}),[...new Set(t.flat())]}function xi(n){if(!n)return;const e=n?.[n.length-1];return function Cf(n){return n&&n.includes("urn:recap:")}(e)?e:void 0}function Rf(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&"Uint8Array"===n.constructor.name}function vc(n){if("boolean"!=typeof n)throw new Error(`boolean expected, not ${n}`)}function xc(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function hn(n,...e){if(!Rf(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function Ff(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function Nr(n){return new Uint32Array(n.buffer,n.byteOffset,Math.floor(n.byteLength/4))}function Ei(...n){for(let e=0;e<n.length;e++)n[e].fill(0)}const Sv=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Ec(n){if("string"==typeof n)n=function Dv(n){if("string"!=typeof n)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(n))}(n);else{if(!Rf(n))throw new Error("Uint8Array expected, got "+typeof n);n=Ac(n)}return n}function Uf(n,e,t=!0){if(void 0===e)return new Uint8Array(n);if(e.length!==n)throw new Error("invalid output length, expected "+n+", got: "+e.length);if(t&&!function Bv(n){return n.byteOffset%4==0}(e))throw new Error("invalid output, must be aligned");return e}function Nf(n,e,t,r){if("function"==typeof n.setBigUint64)return n.setBigUint64(e,t,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),u=r?0:4;n.setUint32(e+(r?4:0),o,r),n.setUint32(e+u,a,r)}function Ac(n){return Uint8Array.from(n)}const kf=n=>Uint8Array.from(n.split("").map(e=>e.charCodeAt(0))),Rv=kf("expand 16-byte k"),Fv=kf("expand 32-byte k"),Uv=Nr(Rv),Nv=Nr(Fv);function tt(n,e){return n<<e|n>>>32-e}function Ic(n){return n.byteOffset%4==0}const Lf=2**32-1,Mf=new Uint32Array,Mt=(n,e)=>255&n[e++]|(255&n[e++])<<8;class jv{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,hn(e=Ec(e),32);const t=Mt(e,0),r=Mt(e,2),i=Mt(e,4),s=Mt(e,6),o=Mt(e,8),a=Mt(e,10),c=Mt(e,12),u=Mt(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|r<<3),this.r[2]=7939&(r>>>10|i<<6),this.r[3]=8191&(i>>>7|s<<9),this.r[4]=255&(s>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|a<<2),this.r[7]=8065&(a>>>11|c<<5),this.r[8]=8191&(c>>>8|u<<8),this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Mt(e,16+2*l)}process(e,t,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],d=o[4],f=o[5],p=o[6],g=o[7],y=o[8],w=o[9],T=Mt(e,t+0),N=Mt(e,t+2),E=Mt(e,t+4),k=Mt(e,t+6),X=Mt(e,t+8),ce=Mt(e,t+10),J=Mt(e,t+12),Q=Mt(e,t+14);let W=s[0]+(8191&T),Fe=s[1]+(8191&(T>>>13|N<<3)),Ae=s[2]+(8191&(N>>>10|E<<6)),ae=s[3]+(8191&(E>>>7|k<<9)),F=s[4]+(8191&(k>>>4|X<<12)),L=s[5]+(X>>>1&8191),D=s[6]+(8191&(X>>>14|ce<<2)),O=s[7]+(8191&(ce>>>11|J<<5)),$=s[8]+(8191&(J>>>8|Q<<8)),K=s[9]+(Q>>>5|i),j=0,G=j+W*a+Fe*(5*w)+Ae*(5*y)+ae*(5*g)+F*(5*p);j=G>>>13,G&=8191,G+=L*(5*f)+D*(5*d)+O*(5*l)+$*(5*u)+K*(5*c),j+=G>>>13,G&=8191;let te=j+W*c+Fe*a+Ae*(5*w)+ae*(5*y)+F*(5*g);j=te>>>13,te&=8191,te+=L*(5*p)+D*(5*f)+O*(5*d)+$*(5*l)+K*(5*u),j+=te>>>13,te&=8191;let ee=j+W*u+Fe*c+Ae*a+ae*(5*w)+F*(5*y);j=ee>>>13,ee&=8191,ee+=L*(5*g)+D*(5*p)+O*(5*f)+$*(5*d)+K*(5*l),j+=ee>>>13,ee&=8191;let De=j+W*l+Fe*u+Ae*c+ae*a+F*(5*w);j=De>>>13,De&=8191,De+=L*(5*y)+D*(5*g)+O*(5*p)+$*(5*f)+K*(5*d),j+=De>>>13,De&=8191;let Be=j+W*d+Fe*l+Ae*u+ae*c+F*a;j=Be>>>13,Be&=8191,Be+=L*(5*w)+D*(5*y)+O*(5*g)+$*(5*p)+K*(5*f),j+=Be>>>13,Be&=8191;let Ce=j+W*f+Fe*d+Ae*l+ae*u+F*c;j=Ce>>>13,Ce&=8191,Ce+=L*a+D*(5*w)+O*(5*y)+$*(5*g)+K*(5*p),j+=Ce>>>13,Ce&=8191;let Le=j+W*p+Fe*f+Ae*d+ae*l+F*u;j=Le>>>13,Le&=8191,Le+=L*c+D*a+O*(5*w)+$*(5*y)+K*(5*g),j+=Le>>>13,Le&=8191;let je=j+W*g+Fe*p+Ae*f+ae*d+F*l;j=je>>>13,je&=8191,je+=L*u+D*c+O*a+$*(5*w)+K*(5*y),j+=je>>>13,je&=8191;let et=j+W*y+Fe*g+Ae*p+ae*f+F*d;j=et>>>13,et&=8191,et+=L*l+D*u+O*c+$*a+K*(5*w),j+=et>>>13,et&=8191;let ze=j+W*w+Fe*y+Ae*g+ae*p+F*f;j=ze>>>13,ze&=8191,ze+=L*d+D*l+O*u+$*c+K*a,j+=ze>>>13,ze&=8191,j=(j<<2)+j|0,j=j+G|0,G=8191&j,j>>>=13,te+=j,s[0]=G,s[1]=te,s[2]=ee,s[3]=De,s[4]=Be,s[5]=Ce,s[6]=Le,s[7]=je,s[8]=et,s[9]=ze}finalize(){const{h:e,pad:t}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(1^i)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+t[0];e[0]=65535&o;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=65535&o;Ei(r)}update(e){Ff(this),hn(e=Ec(e));const{buffer:t,blockLen:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)t.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(t,0,!1),this.pos=0);else for(;r<=i-s;s+=r)this.process(e,s)}return this}destroy(){Ei(this.h,this.r,this.buffer,this.pad)}digestInto(e){Ff(this),function Av(n,e){hn(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}(e,this),this.finished=!0;const{buffer:t,h:r}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}}const zv=function $v(n){const e=(r,i)=>n(i).update(Ec(r)).digest(),t=n(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=r=>n(r),e}(n=>new jv(n)),Kv=function Mv(n,e){const{allowShortKeys:t,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=function Ov(n,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign(n,e)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if("function"!=typeof n)throw new Error("core must be a function");return xc(i),xc(o),vc(s),vc(t),(a,c,u,l,d=0)=>{hn(a),hn(c),hn(u);const f=u.length;if(void 0===l&&(l=new Uint8Array(f)),hn(l),xc(d),d<0||d>=Lf)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);const p=[];let y,w,g=a.length;if(32===g)p.push(y=Ac(a)),w=Nv;else{if(16!==g||!t)throw new Error(`arx: invalid 32-byte key, got length=${g}`);y=new Uint8Array(32),y.set(a),y.set(a,16),w=Uv,p.push(y)}Ic(c)||p.push(c=Ac(c));const T=Nr(y);if(r){if(24!==c.length)throw new Error("arx: extended nonce must be 24 bytes");r(w,T,Nr(c.subarray(0,16)),T),c=c.subarray(16)}const N=16-i;if(N!==c.length)throw new Error(`arx: nonce must be ${N} or 16 bytes`);if(12!==N){const k=new Uint8Array(12);k.set(c,s?0:12-c.length),p.push(c=k)}const E=Nr(c);return function Lv(n,e,t,r,i,s,o,a){const c=i.length,u=new Uint8Array(64),l=Nr(u),d=Ic(i)&&Ic(s),f=d?Nr(i):Mf,p=d?Nr(s):Mf;for(let g=0;g<c;o++){if(n(e,t,r,l,o,a),o>=Lf)throw new Error("arx: counter overflow");const y=Math.min(64,c-g);if(d&&64===y){const w=g/4;if(g%4!=0)throw new Error("arx: invalid block position");for(let N,T=0;T<16;T++)N=w+T,p[N]=f[N]^l[T];g+=64;continue}for(let T,w=0;w<y;w++)T=g+w,s[T]=i[T]^u[w];g+=y}}(n,w,T,E,u,l,d,o),Ei(...p),l}}(function qv(n,e,t,r,i,s=20){let o=n[0],a=n[1],c=n[2],u=n[3],l=e[0],d=e[1],f=e[2],p=e[3],g=e[4],y=e[5],w=e[6],T=e[7],N=i,E=t[0],k=t[1],X=t[2],ce=o,J=a,Q=c,W=u,Fe=l,Ae=d,ae=f,F=p,L=g,D=y,O=w,$=T,K=N,j=E,G=k,te=X;for(let De=0;De<s;De+=2)ce=ce+Fe|0,K=tt(K^ce,16),L=L+K|0,Fe=tt(Fe^L,12),ce=ce+Fe|0,K=tt(K^ce,8),L=L+K|0,Fe=tt(Fe^L,7),J=J+Ae|0,j=tt(j^J,16),D=D+j|0,Ae=tt(Ae^D,12),J=J+Ae|0,j=tt(j^J,8),D=D+j|0,Ae=tt(Ae^D,7),Q=Q+ae|0,G=tt(G^Q,16),O=O+G|0,ae=tt(ae^O,12),Q=Q+ae|0,G=tt(G^Q,8),O=O+G|0,ae=tt(ae^O,7),W=W+F|0,te=tt(te^W,16),$=$+te|0,F=tt(F^$,12),W=W+F|0,te=tt(te^W,8),$=$+te|0,F=tt(F^$,7),ce=ce+Ae|0,te=tt(te^ce,16),O=O+te|0,Ae=tt(Ae^O,12),ce=ce+Ae|0,te=tt(te^ce,8),O=O+te|0,Ae=tt(Ae^O,7),J=J+ae|0,K=tt(K^J,16),$=$+K|0,ae=tt(ae^$,12),J=J+ae|0,K=tt(K^J,8),$=$+K|0,ae=tt(ae^$,7),Q=Q+F|0,j=tt(j^Q,16),L=L+j|0,F=tt(F^L,12),Q=Q+F|0,j=tt(j^Q,8),L=L+j|0,F=tt(F^L,7),W=W+Fe|0,G=tt(G^W,16),D=D+G|0,Fe=tt(Fe^D,12),W=W+Fe|0,G=tt(G^W,8),D=D+G|0,Fe=tt(Fe^D,7);let ee=0;r[ee++]=o+ce|0,r[ee++]=a+J|0,r[ee++]=c+Q|0,r[ee++]=u+W|0,r[ee++]=l+Fe|0,r[ee++]=d+Ae|0,r[ee++]=f+ae|0,r[ee++]=p+F|0,r[ee++]=g+L|0,r[ee++]=y+D|0,r[ee++]=w+O|0,r[ee++]=T+$|0,r[ee++]=N+K|0,r[ee++]=E+j|0,r[ee++]=k+G|0,r[ee++]=X+te|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),Vv=new Uint8Array(16),jf=(n,e)=>{n.update(e);const t=e.length%16;t&&n.update(Vv.subarray(t))},Hv=new Uint8Array(32);function $f(n,e,t,r,i){const s=n(e,t,Hv),o=zv.create(s);i&&jf(o,i),jf(o,r);const a=function Tv(n,e,t){vc(t);const r=new Uint8Array(16),i=function Iv(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}(r);return Nf(i,0,BigInt(e),t),Nf(i,8,BigInt(n),t),r}(r.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Ei(s,a),c}const zf=((n,e)=>{function t(r,...i){if(hn(r),!Sv)throw new Error("Non little-endian hardware is not yet supported");if(void 0!==n.nonceLength){const u=i[0];if(!u)throw new Error("nonce / iv required");n.varSizeNonce?hn(u):hn(u,n.nonceLength)}const s=n.tagLength;s&&void 0!==i[1]&&hn(i[1]);const o=e(r,...i),a=(u,l)=>{if(void 0!==l){if(2!==u)throw new Error("cipher output not supported");hn(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,hn(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(hn(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(t,n),t})({blockSize:64,nonceLength:12,tagLength:16},(n=>(e,t,r)=>({encrypt(i,s){const o=i.length;(s=Uf(o+16,s,!1)).set(i);const a=s.subarray(0,-16);n(e,t,a,a,1);const c=$f(n,e,t,a,r);return s.set(c,o),Ei(c),s},decrypt(i,s){s=Uf(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=$f(n,e,t,o,r);if(!function Cv(n,e){if(n.length!==e.length)return!1;let t=0;for(let r=0;r<n.length;r++)t|=n[r]^e[r];return 0===t}(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),n(e,t,s,s,1),Ei(c),s}}))(Kv));class qf extends vo{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,bo(e);const r=Nn(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),In(s)}update(e){return Dr(this),this.iHash.update(e),this}digestInto(e){Dr(this),Un(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Io=(n,e,t)=>new qf(n,e).update(t).digest();Io.create=(n,e)=>new qf(n,e);const Sc=Uint8Array.from([0]),Kf=Uint8Array.of(),So=xo,Dc=BigInt(0),Oc=BigInt(1);function Do(n,e=""){if("boolean"!=typeof n)throw new Error((e&&`"${e}"`)+"expected boolean, got type="+typeof n);return n}function ei(n,e,t=""){const r=mo(n),i=n?.length,s=void 0!==e;if(!r||s&&i!==e)throw new Error((t&&`"${t}" `)+"expected Uint8Array"+(s?` of length ${e}`:"")+", got "+(r?`length=${i}`:"type="+typeof n));return n}function Oo(n){const e=n.toString(16);return 1&e.length?"0"+e:e}function Vf(n){if("string"!=typeof n)throw new Error("hex string expected, got "+typeof n);return""===n?Dc:BigInt("0x"+n)}function Co(n){return Vf(vi(n))}function Po(n){return Un(n),Vf(vi(Uint8Array.from(n).reverse()))}function Cc(n,e){return wo(n.toString(16).padStart(2*e,"0"))}function Pc(n,e){return Cc(n,e).reverse()}function Gt(n,e,t){let r;if("string"==typeof e)try{r=wo(e)}catch(s){throw new Error(n+" must be hex string or Uint8Array, cause: "+s)}else{if(!mo(e))throw new Error(n+" must be hex string or Uint8Array");r=Uint8Array.from(e)}const i=r.length;if("number"==typeof t&&i!==t)throw new Error(n+" of length "+t+" expected, got "+i);return r}const Tc=n=>"bigint"==typeof n&&Dc<=n;function Bc(n,e,t,r){if(!function Zv(n,e,t){return Tc(n)&&Tc(e)&&Tc(t)&&e<=n&&n<t}(e,t,r))throw new Error("expected valid "+n+": "+t+" <= n < "+r+", got "+e)}function Hf(n){let e;for(e=0;n>Dc;n>>=Oc,e+=1);return e}const cs=n=>(Oc<<BigInt(n))-Oc;function To(n,e,t={}){if(!n||"object"!=typeof n)throw new Error("expected valid options object");function r(i,s,o){const a=n[i];if(o&&void 0===a)return;const c=typeof a;if(c!==s||null===a)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>r(i,s,!1)),Object.entries(t).forEach(([i,s])=>r(i,s,!0))}function Wf(n){const e=new WeakMap;return(t,...r)=>{const i=e.get(t);if(void 0!==i)return i;const s=n(t,...r);return e.set(t,s),s}}const pn=BigInt(0),nn=BigInt(1),ti=BigInt(2),Gf=BigInt(3),Yf=BigInt(4),Jf=BigInt(5),Qv=BigInt(7),Zf=BigInt(8),ex=BigInt(9),Xf=BigInt(16);function wn(n,e){const t=n%e;return t>=pn?t:e+t}function kn(n,e,t){let r=n;for(;e-- >pn;)r*=r,r%=t;return r}function Qf(n,e){if(n===pn)throw new Error("invert: expected non-zero number");if(e<=pn)throw new Error("invert: expected positive modulus, got "+e);let t=wn(n,e),r=e,i=pn,s=nn;for(;t!==pn;){const a=r%t,c=i-s*(r/t);r=t,t=a,i=s,s=c}if(r!==nn)throw new Error("invert: does not exist");return wn(i,e)}function Rc(n,e,t){if(!n.eql(n.sqr(e),t))throw new Error("Cannot find square root")}function eh(n,e){const r=n.pow(e,(n.ORDER+nn)/Yf);return Rc(n,r,e),r}function tx(n,e){const t=(n.ORDER-Jf)/Zf,r=n.mul(e,ti),i=n.pow(r,t),s=n.mul(e,i),o=n.mul(n.mul(s,ti),i),a=n.mul(s,n.sub(o,n.ONE));return Rc(n,a,e),a}function th(n){if(n<Gf)throw new Error("sqrt is not defined for small field");let e=n-nn,t=0;for(;e%ti===pn;)e/=ti,t++;let r=ti;const i=kr(n);for(;1===rh(i,r);)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===t)return eh;let s=i.pow(r,e);const o=(e+nn)/ti;return function(a,c){if(a.is0(c))return c;if(1!==rh(a,c))throw new Error("Cannot find square root");let u=t,l=a.mul(a.ONE,s),d=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(d,a.ONE);){if(a.is0(d))return a.ZERO;let p=1,g=a.sqr(d);for(;!a.eql(g,a.ONE);)if(p++,g=a.sqr(g),p===u)throw new Error("Cannot find square root");const y=nn<<BigInt(u-p-1),w=a.pow(l,y);u=p,l=a.sqr(w),d=a.mul(d,l),f=a.mul(f,w)}return f}}const ix=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function nh(n,e,t=!1){const r=new Array(e.length).fill(t?n.ZERO:void 0),i=e.reduce((o,a,c)=>n.is0(a)?o:(r[c]=o,n.mul(o,a)),n.ONE),s=n.inv(i);return e.reduceRight((o,a,c)=>n.is0(a)?o:(r[c]=n.mul(o,r[c]),n.mul(o,a)),s),r}function rh(n,e){const r=n.pow(e,(n.ORDER-nn)/ti),i=n.eql(r,n.ONE),s=n.eql(r,n.ZERO),o=n.eql(r,n.neg(n.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function ih(n,e){void 0!==e&&ar(e);const t=void 0!==e?e:n.toString(2).length;return{nBitLength:t,nByteLength:Math.ceil(t/8)}}function kr(n,e,t=!1,r={}){if(n<=pn)throw new Error("invalid field: expected ORDER > 0, got "+n);let i,s,a,o=!1;if("object"==typeof e&&null!=e){if(r.sqrt||t)throw new Error("cannot specify opts in two arguments");e.BITS&&(i=e.BITS),e.sqrt&&(s=e.sqrt),"boolean"==typeof e.isLE&&(t=e.isLE),"boolean"==typeof e.modFromBytes&&(o=e.modFromBytes),a=e.allowedLengths}else"number"==typeof e&&(i=e),r.sqrt&&(s=r.sqrt);const{nBitLength:c,nByteLength:u}=ih(n,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const d=Object.freeze({ORDER:n,isLE:t,BITS:c,BYTES:u,MASK:cs(c),ZERO:pn,ONE:nn,allowedLengths:a,create:f=>wn(f,n),isValid:f=>{if("bigint"!=typeof f)throw new Error("invalid field element: expected bigint, got "+typeof f);return pn<=f&&f<n},is0:f=>f===pn,isValidNot0:f=>!d.is0(f)&&d.isValid(f),isOdd:f=>(f&nn)===nn,neg:f=>wn(-f,n),eql:(f,p)=>f===p,sqr:f=>wn(f*f,n),add:(f,p)=>wn(f+p,n),sub:(f,p)=>wn(f-p,n),mul:(f,p)=>wn(f*p,n),pow:(f,p)=>function ox(n,e,t){if(t<pn)throw new Error("invalid exponent, negatives unsupported");if(t===pn)return n.ONE;if(t===nn)return e;let r=n.ONE,i=e;for(;t>pn;)t&nn&&(r=n.mul(r,i)),i=n.sqr(i),t>>=nn;return r}(d,f,p),div:(f,p)=>wn(f*Qf(p,n),n),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>Qf(f,n),sqrt:s||(f=>(l||(l=function rx(n){return n%Yf===Gf?eh:n%Zf===Jf?tx:n%Xf===ex?function nx(n){const e=kr(n),t=th(n),r=t(e,e.neg(e.ONE)),i=t(e,r),s=t(e,e.neg(r)),o=(n+Qv)/Xf;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,r);const d=a.mul(u,i),f=a.mul(u,s),p=a.eql(a.sqr(l),c),g=a.eql(a.sqr(d),c);u=a.cmov(u,l,p),l=a.cmov(f,d,g);const y=a.eql(a.sqr(l),c),w=a.cmov(u,l,y);return Rc(a,w,c),w}}(n):th(n)}(n)),l(d,f))),toBytes:f=>t?Pc(f,u):Cc(f,u),fromBytes:(f,p=!0)=>{if(a){if(!a.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const y=new Uint8Array(u);y.set(f,t?0:y.length-f.length),f=y}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let g=t?Po(f):Co(f);if(o&&(g=wn(g,n)),!p&&!d.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:f=>nh(d,f),cmov:(f,p,g)=>g?p:f});return Object.freeze(d)}function sh(n){if("bigint"!=typeof n)throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function oh(n){const e=sh(n);return e+Math.ceil(e/2)}const Ai=BigInt(0),ni=BigInt(1);function Bo(n,e){const t=e.negate();return n?t:e}function Fc(n,e){const t=nh(n.Fp,e.map(r=>r.Z));return e.map((r,i)=>n.fromAffine(r.toAffine(t[i])))}function ah(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function Uc(n,e){ah(n,e);const i=2**n;return{windows:Math.ceil(e/n)+1,windowSize:2**(n-1),mask:cs(n),maxNumber:i,shiftBy:BigInt(n)}}function ch(n,e,t){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=t;let a=Number(n&i),c=n>>o;a>r&&(a-=s,c+=ni);const u=e*r;return{nextN:c,offset:u+Math.abs(a)-1,isZero:0===a,isNeg:a<0,isNegF:e%2!=0,offsetF:u}}const Nc=new WeakMap,uh=new WeakMap;function kc(n){return uh.get(n)||1}function lh(n){if(n!==Ai)throw new Error("invalid wNAF")}class lx{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let i=e;for(;t>Ai;)t&ni&&(r=r.add(i)),i=i.double(),t>>=ni;return r}precomputeWindow(e,t){const{windows:r,windowSize:i}=Uc(t,this.bits),s=[];let o=e,a=o;for(let c=0;c<r;c++){a=o,s.push(a);for(let u=1;u<i;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,t,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=Uc(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:d,isNegF:f,offsetF:p}=ch(r,a,o);r=c,l?s=s.add(Bo(f,t[p])):i=i.add(Bo(d,t[u]))}return lh(r),{p:i,f:s}}wNAFUnsafe(e,t,r,i=this.ZERO){const s=Uc(e,this.bits);for(let o=0;o<s.windows&&r!==Ai;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=ch(r,o,s);if(r=a,!u){const d=t[c];i=i.add(l?d.negate():d)}}return lh(r),i}getPrecomputes(e,t,r){let i=Nc.get(t);return i||(i=this.precomputeWindow(t,e),1!==e&&("function"==typeof r&&(i=r(i)),Nc.set(t,i))),i}cached(e,t,r){const i=kc(e);return this.wNAF(i,this.getPrecomputes(i,e,r),t)}unsafe(e,t,r,i){const s=kc(e);return 1===s?this._unsafeLadder(e,t,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),t,i)}createCache(e,t){ah(t,this.bits),uh.set(e,t),Nc.delete(e)}hasCache(e){return 1!==kc(e)}}function dh(n,e,t){if(e){if(e.ORDER!==n)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return function sx(n){To(n,ix.reduce((r,i)=>(r[i]="function",r),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"}))}(e),e}return kr(n,{isLE:t})}BigInt(0),BigInt(1),BigInt(2),BigInt(8),df("HashToScalar-");const us=BigInt(0),Ii=BigInt(1),Ro=BigInt(2);const yx=BigInt(1),fh=BigInt(2),_x=BigInt(3),mx=BigInt(5),hh=(BigInt(8),BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"));function xx(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}const Ex=kr([hh,BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")][0],{isLE:!0}),Lc=(()=>{const n=Ex.ORDER;return function gx(n){const e=function px(n){return To(n,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...n})}(n),{P:t,type:r,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a="x25519"===r;if(!a&&"x448"!==r)throw new Error("invalid type");const c=o||Xr,u=a?255:448,l=a?32:56,d=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?Ro**BigInt(254):Ro**BigInt(447),g=a?BigInt(8)*Ro**BigInt(251)-Ii:BigInt(4)*Ro**BigInt(445)-Ii,y=p+g+Ii,w=ae=>wn(ae,t),T=N(d);function N(ae){return Pc(w(ae),l)}function X(ae,F){const L=function Q(ae,F){Bc("u",ae,us,t),Bc("scalar",F,p,y);const L=F,D=ae;let O=Ii,$=us,K=ae,j=Ii,G=us;for(let ee=BigInt(u-1);ee>=us;ee--){const De=L>>ee&Ii;G^=De,({x_2:O,x_3:K}=J(G,O,K)),({x_2:$,x_3:j}=J(G,$,j)),G=De;const Be=O+$,Ce=w(Be*Be),Le=O-$,je=w(Le*Le),et=Ce-je,ze=K+j,It=w((K-j)*Be),Zt=w(ze*Le),Tn=It+Zt,yr=It-Zt;K=w(Tn*Tn),j=w(D*w(yr*yr)),O=w(Ce*je),$=w(et*(Ce+w(f*et)))}({x_2:O,x_3:K}=J(G,O,K)),({x_2:$,x_3:j}=J(G,$,j));const te=s($);return w(O*te)}(function E(ae){const F=Gt("u coordinate",ae,l);return a&&(F[31]&=127),w(Po(F))}(F),function k(ae){return Po(i(Gt("scalar",ae,l)))}(ae));if(L===us)throw new Error("invalid private or public key received");return N(L)}function ce(ae){return X(ae,T)}function J(ae,F,L){const D=w(ae*(F-L));return{x_2:F=w(F-D),x_3:L=w(L+D)}}const W={secretKey:l,publicKey:l,seed:l},Fe=(ae=c(l))=>(Un(ae,W.seed),ae);return{keygen:function Ae(ae){const F=Fe(ae);return{secretKey:F,publicKey:ce(F)}},getSharedSecret:(ae,F)=>X(ae,F),getPublicKey:ae=>ce(ae),scalarMult:X,scalarMultBase:ce,utils:{randomSecretKey:Fe,randomPrivateKey:Fe},GuBytes:T.slice(),lengths:W}}({P:n,type:"x25519",powPminus2:e=>{const{pow_p_5_8:t,b2:r}=function vx(n){const e=BigInt(10),t=BigInt(20),r=BigInt(40),i=BigInt(80),s=hh,o=n*n%s*n%s,a=kn(o,fh,s)*o%s,c=kn(a,yx,s)*n%s,u=kn(c,mx,s)*c%s,l=kn(u,e,s)*u%s,d=kn(l,t,s)*l%s,f=kn(d,r,s)*d%s,p=kn(f,i,s)*f%s,g=kn(p,i,s)*f%s,y=kn(g,e,s)*u%s;return{pow_p_5_8:kn(y,fh,s)*n%s,b2:o}}(e);return wn(kn(t,_x,n)*r,n)},adjustScalarBytes:xx})})(),ph=(n,e)=>(n+(n>=0?e:-e)/gh)/e;function Mc(n){if(!["compact","recovered","der"].includes(n))throw new Error('Signature format must be "compact", "recovered", or "der"');return n}function jc(n,e){const t={};for(let r of Object.keys(e))t[r]=void 0===n[r]?e[r]:n[r];return Do(t.lowS,"lowS"),Do(t.prehash,"prehash"),void 0!==t.format&&Mc(t.format),t}class Ix extends Error{constructor(e=""){super(e)}}const dr={Err:Ix,_tlv:{encode:(n,e)=>{const{Err:t}=dr;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(1&e.length)throw new t("tlv.encode: unpadded data");const r=e.length/2,i=Oo(r);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=r>127?Oo(i.length/2|128):"";return Oo(n)+s+i+e},decode(n,e){const{Err:t}=dr;let r=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==n)throw new t("tlv.decode: wrong tlv");const i=e[r++];let o=0;if(128&i){const c=127&i;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new t("tlv.decode: length bytes not complete");if(0===u[0])throw new t("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(r+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}else o=i;const a=e.subarray(r,r+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(n){const{Err:e}=dr;if(n<fr)throw new e("integer: negative integers are not allowed");let t=Oo(n);if(8&Number.parseInt(t[0],16)&&(t="00"+t),1&t.length)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(n){const{Err:e}=dr;if(128&n[0])throw new e("invalid signature integer: negative");if(0===n[0]&&!(128&n[1]))throw new e("invalid signature integer: unnecessary leading zero");return Co(n)}},toSig(n){const{Err:e,_int:t,_tlv:r}=dr,i=Gt("signature",n),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(u)}},hexFromSig(n){const{_tlv:e,_int:t}=dr,r=e.encode(2,t.encode(n.r)),i=e.encode(2,t.encode(n.s));return e.encode(48,r+i)}},fr=BigInt(0),Si=BigInt(1),gh=BigInt(2),Fo=BigInt(3),Sx=BigInt(4);function Di(n,e){const{BYTES:t}=n;let r;if("bigint"==typeof e)r=e;else{let i=Gt("private key",e);try{r=n.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${t}, got ${typeof e}`)}}if(!n.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function Dx(n,e={}){const t=function hx(n,e,t={},r){if(void 0===r&&(r="edwards"===n),!e||"object"!=typeof e)throw new Error(`expected valid ${n} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!("bigint"==typeof c&&c>Ai))throw new Error(`CURVE.${a} must be positive bigint`)}const i=dh(e.p,t.Fp,r),s=dh(e.n,t.Fn,r),o=["Gx","Gy","a","weierstrass"===n?"b":"d"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return{CURVE:e=Object.freeze(Object.assign({},e)),Fp:i,Fn:s}}("weierstrass",n,e),{Fp:r,Fn:i}=t;let s=t.CURVE;const{h:o,n:a}=s;To(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!r.is0(s.a)||"bigint"!=typeof c.beta||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=_h(r,i);function l(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}const p=e.toBytes||function d(ae,F,L){const{x:D,y:O}=F.toAffine(),$=r.toBytes(D);return Do(L,"isCompressed"),L?(l(),Cr(yh(!r.isOdd(O)),$)):Cr(Uint8Array.of(4),$,r.toBytes(O))},g=e.fromBytes||function f(ae){ei(ae,void 0,"Point");const{publicKey:F,publicKeyUncompressed:L}=u,D=ae.length,O=ae[0],$=ae.subarray(1);if(D!==F||2!==O&&3!==O){if(D===L&&4===O){const K=r.BYTES,j=r.fromBytes($.subarray(0,K)),G=r.fromBytes($.subarray(K,2*K));if(!w(j,G))throw new Error("bad point: is not on curve");return{x:j,y:G}}throw new Error(`bad point: got length ${D}, expected compressed=${F} or uncompressed=${L}`)}{const K=r.fromBytes($);if(!r.isValid(K))throw new Error("bad point: is not on curve, wrong x");const j=y(K);let G;try{G=r.sqrt(j)}catch(ee){const De=ee instanceof Error?": "+ee.message:"";throw new Error("bad point: is not on curve, sqrt error"+De)}return l(),!(1&~O)!==r.isOdd(G)&&(G=r.neg(G)),{x:K,y:G}}};function y(ae){const F=r.sqr(ae),L=r.mul(F,ae);return r.add(r.add(L,r.mul(ae,s.a)),s.b)}function w(ae,F){const L=r.sqr(F),D=y(ae);return r.eql(L,D)}if(!w(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const T=r.mul(r.pow(s.a,Fo),Sx),N=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(T,N)))throw new Error("bad curve params: a or b");function E(ae,F,L=!1){if(!r.isValid(F)||L&&r.is0(F))throw new Error(`bad point coordinate ${ae}`);return F}function k(ae){if(!(ae instanceof W))throw new Error("ProjectivePoint expected")}function X(ae){if(!c||!c.basises)throw new Error("no endo");return function Ax(n,e,t){const[[r,i],[s,o]]=e,a=ph(o*n,t),c=ph(-i*n,t);let u=n-a*r-c*s,l=-a*i-c*o;const d=u<fr,f=l<fr;d&&(u=-u),f&&(l=-l);const p=cs(Math.ceil(Hf(t)/2))+Si;if(u<fr||u>=p||l<fr||l>=p)throw new Error("splitScalar (endomorphism): failed, k="+n);return{k1neg:d,k1:u,k2neg:f,k2:l}}(ae,c.basises,i.ORDER)}const ce=Wf((ae,F)=>{const{X:L,Y:D,Z:O}=ae;if(r.eql(O,r.ONE))return{x:L,y:D};const $=ae.is0();null==F&&(F=$?r.ONE:r.inv(O));const K=r.mul(L,F),j=r.mul(D,F),G=r.mul(O,F);if($)return{x:r.ZERO,y:r.ZERO};if(!r.eql(G,r.ONE))throw new Error("invZ was invalid");return{x:K,y:j}}),J=Wf(ae=>{if(ae.is0()){if(e.allowInfinityPoint&&!r.is0(ae.Y))return;throw new Error("bad point: ZERO")}const{x:F,y:L}=ae.toAffine();if(!r.isValid(F)||!r.isValid(L))throw new Error("bad point: x or y not field elements");if(!w(F,L))throw new Error("bad point: equation left != right");if(!ae.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function Q(ae,F,L,D,O){return L=new W(r.mul(L.X,ae),L.Y,L.Z),F=Bo(D,F),L=Bo(O,L),F.add(L)}class W{constructor(F,L,D){this.X=E("x",F),this.Y=E("y",L,!0),this.Z=E("z",D),Object.freeze(this)}static CURVE(){return s}static fromAffine(F){const{x:L,y:D}=F||{};if(!F||!r.isValid(L)||!r.isValid(D))throw new Error("invalid affine point");if(F instanceof W)throw new Error("projective point not allowed");return r.is0(L)&&r.is0(D)?W.ZERO:new W(L,D,r.ONE)}static fromBytes(F){const L=W.fromAffine(g(ei(F,void 0,"point")));return L.assertValidity(),L}static fromHex(F){return W.fromBytes(Gt("pointHex",F))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(F=8,L=!0){return Ae.createCache(this,F),L||this.multiply(Fo),this}assertValidity(){J(this)}hasEvenY(){const{y:F}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(F)}equals(F){k(F);const{X:L,Y:D,Z:O}=this,{X:$,Y:K,Z:j}=F,G=r.eql(r.mul(L,j),r.mul($,O)),te=r.eql(r.mul(D,j),r.mul(K,O));return G&&te}negate(){return new W(this.X,r.neg(this.Y),this.Z)}double(){const{a:F,b:L}=s,D=r.mul(L,Fo),{X:O,Y:$,Z:K}=this;let j=r.ZERO,G=r.ZERO,te=r.ZERO,ee=r.mul(O,O),De=r.mul($,$),Be=r.mul(K,K),Ce=r.mul(O,$);return Ce=r.add(Ce,Ce),te=r.mul(O,K),te=r.add(te,te),j=r.mul(F,te),G=r.mul(D,Be),G=r.add(j,G),j=r.sub(De,G),G=r.add(De,G),G=r.mul(j,G),j=r.mul(Ce,j),te=r.mul(D,te),Be=r.mul(F,Be),Ce=r.sub(ee,Be),Ce=r.mul(F,Ce),Ce=r.add(Ce,te),te=r.add(ee,ee),ee=r.add(te,ee),ee=r.add(ee,Be),ee=r.mul(ee,Ce),G=r.add(G,ee),Be=r.mul($,K),Be=r.add(Be,Be),ee=r.mul(Be,Ce),j=r.sub(j,ee),te=r.mul(Be,De),te=r.add(te,te),te=r.add(te,te),new W(j,G,te)}add(F){k(F);const{X:L,Y:D,Z:O}=this,{X:$,Y:K,Z:j}=F;let G=r.ZERO,te=r.ZERO,ee=r.ZERO;const De=s.a,Be=r.mul(s.b,Fo);let Ce=r.mul(L,$),Le=r.mul(D,K),je=r.mul(O,j),et=r.add(L,D),ze=r.add($,K);et=r.mul(et,ze),ze=r.add(Ce,Le),et=r.sub(et,ze),ze=r.add(L,O);let rt=r.add($,j);return ze=r.mul(ze,rt),rt=r.add(Ce,je),ze=r.sub(ze,rt),rt=r.add(D,O),G=r.add(K,j),rt=r.mul(rt,G),G=r.add(Le,je),rt=r.sub(rt,G),ee=r.mul(De,ze),G=r.mul(Be,je),ee=r.add(G,ee),G=r.sub(Le,ee),ee=r.add(Le,ee),te=r.mul(G,ee),Le=r.add(Ce,Ce),Le=r.add(Le,Ce),je=r.mul(De,je),ze=r.mul(Be,ze),Le=r.add(Le,je),je=r.sub(Ce,je),je=r.mul(De,je),ze=r.add(ze,je),Ce=r.mul(Le,ze),te=r.add(te,Ce),Ce=r.mul(rt,ze),G=r.mul(et,G),G=r.sub(G,Ce),Ce=r.mul(et,Le),ee=r.mul(rt,ee),ee=r.add(ee,Ce),new W(G,te,ee)}subtract(F){return this.add(F.negate())}is0(){return this.equals(W.ZERO)}multiply(F){const{endo:L}=e;if(!i.isValidNot0(F))throw new Error("invalid scalar: out of range");let D,O;const $=K=>Ae.cached(this,K,j=>Fc(W,j));if(L){const{k1neg:K,k1:j,k2neg:G,k2:te}=X(F),{p:ee,f:De}=$(j),{p:Be,f:Ce}=$(te);O=De.add(Ce),D=Q(L.beta,ee,Be,K,G)}else{const{p:K,f:j}=$(F);D=K,O=j}return Fc(W,[D,O])[0]}multiplyUnsafe(F){const{endo:L}=e,D=this;if(!i.isValid(F))throw new Error("invalid scalar: out of range");if(F===fr||D.is0())return W.ZERO;if(F===Si)return D;if(Ae.hasCache(this))return this.multiply(F);if(L){const{k1neg:O,k1:$,k2neg:K,k2:j}=X(F),{p1:G,p2:te}=function dx(n,e,t,r){let i=e,s=n.ZERO,o=n.ZERO;for(;t>Ai||r>Ai;)t&ni&&(s=s.add(i)),r&ni&&(o=o.add(i)),i=i.double(),t>>=ni,r>>=ni;return{p1:s,p2:o}}(W,D,$,j);return Q(L.beta,G,te,O,K)}return Ae.unsafe(D,F)}multiplyAndAddUnsafe(F,L,D){const O=this.multiplyUnsafe(L).add(F.multiplyUnsafe(D));return O.is0()?void 0:O}toAffine(F){return ce(this,F)}isTorsionFree(){const{isTorsionFree:F}=e;return o===Si||(F?F(W,this):Ae.unsafe(this,a).is0())}clearCofactor(){const{clearCofactor:F}=e;return o===Si?this:F?F(W,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(F=!0){return Do(F,"isCompressed"),this.assertValidity(),p(W,this,F)}toHex(F=!0){return vi(this.toBytes(F))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(F=!0){return this.toBytes(F)}_setWindowSize(F){this.precompute(F)}static normalizeZ(F){return Fc(W,F)}static msm(F,L){return function fx(n,e,t,r){(function cx(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})})(t,n),function ux(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}(r,e);const i=t.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=n.ZERO,a=Hf(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=cs(c),l=new Array(Number(u)+1).fill(o);let f=o;for(let p=Math.floor((e.BITS-1)/c)*c;p>=0;p-=c){l.fill(o);for(let y=0;y<s;y++){const T=Number(r[y]>>BigInt(p)&u);l[T]=l[T].add(t[y])}let g=o;for(let y=l.length-1,w=o;y>0;y--)w=w.add(l[y]),g=g.add(w);if(f=f.add(g),0!==p)for(let y=0;y<c;y++)f=f.double()}return f}(W,i,F,L)}static fromPrivateKey(F){return W.BASE.multiply(Di(i,F))}}W.BASE=new W(s.Gx,s.Gy,r.ONE),W.ZERO=new W(r.ZERO,r.ONE,r.ZERO),W.Fp=r,W.Fn=i;const Fe=i.BITS,Ae=new lx(W,e.endo?Math.ceil(Fe/2):Fe);return W.BASE.precompute(8),W}function yh(n){return Uint8Array.of(n?2:3)}function _h(n,e){return{secretKey:e.BYTES,publicKey:1+n.BYTES,publicKeyUncompressed:1+2*n.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Cx(n,e,t={}){bo(e),To(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=t.randomBytes||Xr,i=t.hmac||((L,...D)=>Io(e,L,Cr(...D))),{Fp:s,Fn:o}=n,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:d,utils:f,lengths:p}=function Ox(n,e={}){const{Fn:t}=n,r=e.randomBytes||Xr,i=Object.assign(_h(n.Fp,t),{seed:oh(t.ORDER)});function s(f){try{return!!Di(t,f)}catch{return!1}}function a(f=r(i.seed)){return function ax(n,e,t=!1){const r=n.length,i=sh(e),s=oh(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const a=wn(t?Po(n):Co(n),e-nn)+nn;return t?Pc(a,i):Cc(a,i)}(ei(f,i.seed,"seed"),t.ORDER)}function c(f,p=!0){return n.BASE.multiply(Di(t,f)).toBytes(p)}function l(f){if("bigint"==typeof f)return!1;if(f instanceof n)return!0;const{secretKey:p,publicKey:g,publicKeyUncompressed:y}=i;if(t.allowedLengths||p===g)return;const w=Gt("key",f).length;return w===g||w===y}return Object.freeze({getPublicKey:c,getSharedSecret:function d(f,p,g=!0){if(!0===l(f))throw new Error("first arg must be private key");if(!1===l(p))throw new Error("second arg must be public key");const y=Di(t,f);return n.fromHex(p).multiply(y).toBytes(g)},keygen:function u(f){const p=a(f);return{secretKey:p,publicKey:c(p)}},Point:n,utils:{isValidSecretKey:s,isValidPublicKey:function o(f,p){const{publicKey:g,publicKeyUncompressed:y}=i;try{const w=f.length;return!(!0===p&&w!==g||!1===p&&w!==y||!n.fromBytes(f))}catch{return!1}},randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:f=>Di(t,f),precompute:(f=8,p=n.BASE)=>p.precompute(f,!1)},lengths:i})}(n,t),g={prehash:!1,lowS:"boolean"==typeof t.lowS&&t.lowS,format:void 0,extraEntropy:!1},y="compact";function w(L){return L>a>>Si}function T(L,D){if(!o.isValidNot0(D))throw new Error(`invalid signature ${L}: out of range 1..Point.Fn.ORDER`);return D}class E{constructor(D,O,$){this.r=T("r",D),this.s=T("s",O),null!=$&&(this.recovery=$),Object.freeze(this)}static fromBytes(D,O=y){let $;if(function N(L,D){Mc(D);const O=p.signature;ei(L,"compact"===D?O:"recovered"===D?O+1:void 0,`${D} signature`)}(D,O),"der"===O){const{r:te,s:ee}=dr.toSig(ei(D));return new E(te,ee)}"recovered"===O&&($=D[0],O="compact",D=D.subarray(1));const K=o.BYTES,j=D.subarray(0,K),G=D.subarray(K,2*K);return new E(o.fromBytes(j),o.fromBytes(G),$)}static fromHex(D,O){return this.fromBytes(wo(D),O)}addRecoveryBit(D){return new E(this.r,this.s,D)}recoverPublicKey(D){const O=s.ORDER,{r:$,s:K,recovery:j}=this;if(null==j||![0,1,2,3].includes(j))throw new Error("recovery id invalid");if(a*gh<O&&j>1)throw new Error("recovery id is ambiguous for h>1 curve");const G=2===j||3===j?$+a:$;if(!s.isValid(G))throw new Error("recovery id 2 or 3 invalid");const te=s.toBytes(G),ee=n.fromBytes(Cr(yh(!(1&j)),te)),De=o.inv(G),Be=X(Gt("msgHash",D)),Ce=o.create(-Be*De),Le=o.create(K*De),je=n.BASE.multiplyUnsafe(Ce).add(ee.multiplyUnsafe(Le));if(je.is0())throw new Error("point at infinify");return je.assertValidity(),je}hasHighS(){return w(this.s)}toBytes(D=y){if(Mc(D),"der"===D)return wo(dr.hexFromSig(this));const O=o.toBytes(this.r),$=o.toBytes(this.s);if("recovered"===D){if(null==this.recovery)throw new Error("recovery bit must be present");return Cr(Uint8Array.of(this.recovery),O,$)}return Cr(O,$)}toHex(D){return vi(this.toBytes(D))}assertValidity(){}static fromCompact(D){return E.fromBytes(Gt("sig",D),"compact")}static fromDER(D){return E.fromBytes(Gt("sig",D),"der")}normalizeS(){return this.hasHighS()?new E(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return vi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return vi(this.toBytes("compact"))}}const k=t.bits2int||function(L){if(L.length>8192)throw new Error("input is too large");const D=Co(L),O=8*L.length-c;return O>0?D>>BigInt(O):D},X=t.bits2int_modN||function(L){return o.create(k(L))},ce=cs(c);function J(L){return Bc("num < 2^"+c,L,fr,ce),o.toBytes(L)}function Q(L,D){return ei(L,void 0,"message"),D?ei(e(L),void 0,"prehashed message"):L}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:d,utils:f,lengths:p,Point:n,sign:function Fe(L,D,O={}){L=Gt("message",L);const{seed:$,k2sig:K}=function W(L,D,O){if(["recovered","canonical"].some(Le=>Le in O))throw new Error("sign() legacy options not supported");const{lowS:$,prehash:K,extraEntropy:j}=jc(O,g);L=Q(L,K);const G=X(L),te=Di(o,D),ee=[J(te),J(G)];if(null!=j&&!1!==j){const Le=!0===j?r(p.secretKey):j;ee.push(Gt("extraEntropy",Le))}const De=Cr(...ee),Be=G;return{seed:De,k2sig:function Ce(Le){const je=k(Le);if(!o.isValidNot0(je))return;const et=o.inv(je),ze=n.BASE.multiply(je).toAffine(),rt=o.create(ze.x);if(rt===fr)return;const It=o.create(et*o.create(Be+rt*te));if(It===fr)return;let Zt=(ze.x===rt?0:2)|Number(ze.y&Si),Tn=It;return $&&w(It)&&(Tn=o.neg(It),Zt^=1),new E(rt,Tn,Zt)}}}(L,D,O);return function Xv(n,e,t){if("number"!=typeof n||n<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof t)throw new Error("hmacFn must be a function");const r=f=>new Uint8Array(f),i=f=>Uint8Array.of(f);let s=r(n),o=r(n),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...f)=>t(o,s,...f),l=(f=r(0))=>{o=u(i(0),f),s=u(),0!==f.length&&(o=u(i(1),f),s=u())},d=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){s=u();const g=s.slice();p.push(g),f+=s.length}return Cr(...p)};return(f,p)=>{let g;for(c(),l(f);!(g=p(d()));)l();return c(),g}}(e.outputLen,o.BYTES,i)($,K)},verify:function ae(L,D,O,$={}){const{lowS:K,prehash:j,format:G}=jc($,g);if(O=Gt("publicKey",O),D=Q(Gt("message",D),j),"strict"in $)throw new Error("options.strict was renamed to lowS");const te=void 0===G?function Ae(L){let D;const O="string"==typeof L||mo(L),$=!O&&null!==L&&"object"==typeof L&&"bigint"==typeof L.r&&"bigint"==typeof L.s;if(!O&&!$)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if($)D=new E(L.r,L.s);else if(O){try{D=E.fromBytes(Gt("sig",L),"der")}catch(K){if(!(K instanceof dr.Err))throw K}if(!D)try{D=E.fromBytes(Gt("sig",L),"compact")}catch{return!1}}return D||!1}(L):E.fromBytes(Gt("sig",L),G);if(!1===te)return!1;try{const ee=n.fromBytes(O);if(K&&te.hasHighS())return!1;const{r:De,s:Be}=te,Ce=X(D),Le=o.inv(Be),je=o.create(Ce*Le),et=o.create(De*Le),ze=n.BASE.multiplyUnsafe(je).add(ee.multiplyUnsafe(et));return!ze.is0()&&o.create(ze.x)===De}catch{return!1}},recoverPublicKey:function F(L,D,O={}){const{prehash:$}=jc(O,g);return D=Q(D,$),E.fromBytes(L,"recovered").recoverPublicKey(D).toBytes()},Signature:E,hash:e})}function Rx(n){const{CURVE:e,curveOpts:t,hash:r,ecdsaOpts:i}=function Tx(n){const{CURVE:e,curveOpts:t}=function Px(n){const e={a:n.a,b:n.b,p:n.Fp.ORDER,n:n.n,h:n.h,Gx:n.Gx,Gy:n.Gy},t=n.Fp;let r=n.allowedPrivateKeyLengths?Array.from(new Set(n.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;return{CURVE:e,curveOpts:{Fp:t,Fn:kr(e.n,{BITS:n.nBitLength,allowedLengths:r,modFromBytes:n.wrapPrivateKey}),allowInfinityPoint:n.allowInfinityPoint,endo:n.endo,isTorsionFree:n.isTorsionFree,clearCofactor:n.clearCofactor,fromBytes:n.fromBytes,toBytes:n.toBytes}}}(n);return{CURVE:e,curveOpts:t,hash:n.hash,ecdsaOpts:{hmac:n.hmac,randomBytes:n.randomBytes,lowS:n.lowS,bits2int:n.bits2int,bits2int_modN:n.bits2int_modN}}}(n);return function Bx(n,e){const t=e.Point;return Object.assign({},e,{ProjectivePoint:t,CURVE:Object.assign({},n,ih(t.Fn.ORDER,t.Fn.BITS))})}(n,Cx(Dx(e,t),r,i))}function $c(n,e){const t=r=>Rx({...n,hash:r});return{...t(e),create:t}}const mh={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},bh={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},wh={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},Fx=kr(mh.p),Ux=kr(bh.p),Nx=kr(wh.p),kx=$c({...mh,Fp:Fx,lowS:!1},xo);$c({...bh,Fp:Ux,lowS:!1},qw),$c({...wh,Fp:Nx,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},zw);const Lx=kx,rn="base16",gn="base64pad",Lr="base64url",ls="utf8";function qc(){return dn(Xr(32),rn)}function Uo(n){return dn(So(An(n,rn)),rn)}function Sn(n){return dn(So(An(n,ls)),rn)}function Ah(n){return An(`${n}`,"base10")}function ri(n){return Number(dn(n,"base10"))}function Ih(n){return n.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Sh(n){const e=n.replace(/-/g,"+").replace(/_/g,"/");return e+"=".repeat((4-e.length%4)%4)}function Dh(n){if(2===ri(n.type))return dn(Xi([n.type,n.sealed]),gn);if(1===ri(n.type)){if(typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return dn(Xi([n.type,n.senderPublicKey,n.iv,n.sealed]),gn)}return dn(Xi([n.type,n.iv,n.sealed]),gn)}function hs(n){const t=An((n.encoding||gn)===Lr?Sh(n.encoded):n.encoded,gn),r=t.slice(0,1);if(1===ri(r)){const c=33,u=c+12,l=t.slice(1,c),d=t.slice(c,u);return{type:r,sealed:t.slice(u),iv:d,senderPublicKey:l}}if(2===ri(r))return{type:r,sealed:t.slice(1),iv:Xr(12)};const o=t.slice(1,13);return{type:r,sealed:t.slice(13),iv:o}}function Oh(n){const e=n?.type||0;if(1===e){if(typeof n?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof n?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:n?.senderPublicKey,receiverPublicKey:n?.receiverPublicKey}}function Ch(n){return 1===n.type&&"string"==typeof n.senderPublicKey&&"string"==typeof n.receiverPublicKey}function Ph(n){return 2===n.type}function No(n){return n?.relay||{protocol:"irn"}}function Oi(n){const e=D1[n];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${n}`);return e}var Jx=Object.defineProperty,Zx=Object.defineProperties,Xx=Object.getOwnPropertyDescriptors,Th=Object.getOwnPropertySymbols,Qx=Object.prototype.hasOwnProperty,e2=Object.prototype.propertyIsEnumerable,Bh=(n,e,t)=>e in n?Jx(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Kc=(n,e)=>{for(var t in e||(e={}))Qx.call(e,t)&&Bh(n,t,e[t]);if(Th)for(var t of Th(e))e2.call(e,t)&&Bh(n,t,e[t]);return n};function n2(n,e="-"){const t={},r="relay"+e;return Object.keys(n).forEach(i=>{if(i.startsWith(r)){const s=i.replace(r,"");t[s]=n[i]}}),t}function Rh(n){if(!n.includes("wc:")){const u=ef(n);null!=u&&u.includes("wc:")&&(n=u)}const e=(n=(n=n.includes("wc://")?n.replace("wc://",""):n).includes("wc:")?n.replace("wc:",""):n).indexOf(":"),t=-1!==n.indexOf("?")?n.indexOf("?"):void 0,r=n.substring(0,e),i=n.substring(e+1,t).split("@"),s=typeof t<"u"?n.substring(t):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c="string"==typeof a.methods?a.methods.split(","):void 0;return{protocol:r,topic:r2(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:n2(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function r2(n){return n.startsWith("//")?n.substring(2):n}function Fh(n){const e=new URLSearchParams,t=Kc(Kc(((n,e)=>Zx(n,Xx(e)))(Kc({},function i2(n,e="-"){const r={};return Object.keys(n).forEach(i=>{n[i]&&(r["relay"+e+i]=n[i])}),r}(n.relay)),{symKey:n.symKey}),n.expiryTimestamp&&{expiryTimestamp:n.expiryTimestamp.toString()}),n.methods&&{methods:n.methods.join(",")});return Object.entries(t).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{void 0!==i&&e.append(r,String(i))}),`${n.protocol}:${n.topic}@${n.version}?${e}`}function ko(n,e,t){return`${n}?wc_ev=${t}&topic=${e}`}var s2=Object.defineProperty,o2=Object.defineProperties,a2=Object.getOwnPropertyDescriptors,Uh=Object.getOwnPropertySymbols,c2=Object.prototype.hasOwnProperty,u2=Object.prototype.propertyIsEnumerable,Nh=(n,e,t)=>e in n?s2(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,l2=(n,e)=>{for(var t in e||(e={}))c2.call(e,t)&&Nh(n,t,e[t]);if(Uh)for(var t of Uh(e))u2.call(e,t)&&Nh(n,t,e[t]);return n},d2=(n,e)=>o2(n,a2(e));function Ci(n){const e=[];return n.forEach(t=>{const[r,i]=t.split(":");e.push(`${r}:${i}`)}),e}function kh(n){return n.includes(":")}function g2(n){return kh(n)?n.split(":")[0]:n}function Lo(n){var e,t,r;const i={};if(!ps(n))return i;for(const[s,o]of Object.entries(n)){const a=kh(s)?[s]:o.chains,c=o.methods||[],u=o.events||[],l=g2(s);i[l]=d2(l2({},i[l]),{chains:Rn(a,null==(e=i[l])?void 0:e.chains),methods:Rn(c,null==(t=i[l])?void 0:t.methods),events:Rn(u,null==(r=i[l])?void 0:r.events)})}return i}function Lh(n,e){const t=function y2(n){const e={};return n?.forEach(t=>{var r;const[i,s]=t.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(t),null==(r=e[i].chains)||r.push(`${i}:${s}`)}),e}(e=e.map(r=>r.replace("did:pkh:","")));for(const[r,i]of Object.entries(t))i.methods=i.methods?Rn(i.methods,n):n,i.events=["chainChanged","accountsChanged"];return t}const m2={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},b2={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ge(n,e){const{message:t,code:r}=b2[n];return{message:e?`${t} ${e}`:t,code:r}}function _t(n,e){const{message:t,code:r}=m2[n];return{message:e?`${t} ${e}`:t,code:r}}function Pi(n,e){return!!Array.isArray(n)&&(!(typeof e<"u"&&n.length)||n.every(e))}function ps(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}function Tt(n){return typeof n>"u"}function Et(n,e){return!(!e||!Tt(n))||"string"==typeof n&&!!n.trim().length}function Vc(n,e){return!(!e||!Tt(n))||"number"==typeof n&&!isNaN(n)}function Mo(n){return!(!Et(n,!1)||!n.includes(":"))&&2===n.split(":").length}function Mh(n){let e=!0;return Pi(n)?n.length&&(e=n.every(t=>Et(t,!1))):e=!1,e}function jh(n,e){let t=null;return Object.values(n).forEach(r=>{if(t)return;const i=function P2(n,e){let t=null;return Mh(n?.methods)?Mh(n?.events)||(t=_t("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=_t("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}(r,`${e}, namespace`);i&&(t=i)}),t}function jo(n,e){let t=null;if(n&&ps(n)){const r=jh(n,e);r&&(t=r);const i=function C2(n,e){let t=null;return Object.values(n).forEach(r=>{if(t)return;const i=function O2(n,e){let t=null;return Pi(n)?n.forEach(r=>{t||function v2(n){if(Et(n,!1)&&n.includes(":")){const e=n.split(":");if(3===e.length)return!!e[2]&&Mo(e[0]+":"+e[1])}return!1}(r)||(t=_t("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):t=_t("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}(r?.accounts,`${e} namespace`);i&&(t=i)}),t}(n,e);i&&(t=i)}else t=ge("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function $h(n){return Et(n.protocol,!0)}function yn(n){return typeof n<"u"&&null!==typeof n}function zh(n,e){return!(!Mo(e)||!function f2(n){const e=[];return Object.values(n).forEach(t=>{e.push(...Ci(t.accounts))}),e}(n).includes(e))}function Hc(n,e,t){let r=null;const i=function j2(n){const e={};return Object.keys(n).forEach(t=>{var r;t.includes(":")?e[t]=n[t]:null==(r=n[t].chains)||r.forEach(i=>{e[i]={methods:n[t].methods,events:n[t].events}})}),e}(n),s=function $2(n){const e={};return Object.keys(n).forEach(t=>{t.includes(":")?e[t]=n[t]:Ci(n[t].accounts)?.forEach(i=>{e[i]={accounts:n[t].accounts.filter(s=>s.includes(`${i}:`)),methods:n[t].methods,events:n[t].events}})}),e}(e),o=Object.keys(i),a=Object.keys(s),c=qh(Object.keys(n)),u=qh(Object.keys(e)),l=c.filter(d=>!u.includes(d));return l.length&&(r=ge("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.\n      Required: ${l.toString()}\n      Received: ${Object.keys(e).toString()}`)),Jr(o,a)||(r=ge("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.\n      Required: ${o.toString()}\n      Approved: ${a.toString()}`)),Object.keys(e).forEach(d=>{if(!d.includes(":")||r)return;const f=Ci(e[d].accounts);f.includes(d)||(r=ge("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${d}\n        Required: ${d}\n        Approved: ${f.toString()}`))}),o.forEach(d=>{r||(Jr(i[d].methods,s[d].methods)?Jr(i[d].events,s[d].events)||(r=ge("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${d}`)):r=ge("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${d}`))}),r}function qh(n){return[...new Set(n.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Kh(){const n=bi();return new Promise(e=>{switch(n){case"browser":e(function q2(){return mi()&&navigator?.onLine}());break;case"react-native":e(function K2(){return Wc.apply(this,arguments)}());break;default:e(!0)}})}function Wc(){return(Wc=(0,h.A)(function*(){return!(Er()&&typeof global<"u"&&null!=global&&global.NetInfo)||(yield null==global?void 0:global.NetInfo.fetch())?.isConnected})).apply(this,arguments)}const Gc={};class gs{static get(e){return Gc[e]}static set(e,t){Gc[e]=t}static delete(e){delete Gc[e]}}function Yc(n){return new Uint8Array(n.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function rE(n){const e=Uint8Array.from(Buffer.from(n.signature,"hex")),t=function J2(n){const e=Vi.decode(n);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}(n.transaction.address),r=function Z2({publicKey:n,signature:e,payload:t}){var r;const i=Yc(t.method),s=128|parseInt((null==(r=t.version)?void 0:r.toString())||"4"),o=function eE(n){const e=Vi.decode(n)[0];return 42===e?0:60===e?2:1}(t.address),a="00"===t.era?new Uint8Array([0]):Yc(t.era);if(1!==a.length&&2!==a.length)throw new Error("Invalid era length");const c=parseInt(t.nonce,16),u=new Uint8Array([255&c,c>>8&255]),l=BigInt(`0x${function Q2(n){return n.startsWith("0x")?n.slice(2):n}(t.tip)}`),d=function nE(n){if(n<BigInt(1)<<BigInt(6))return new Uint8Array([Number(n<<BigInt(2))]);if(n<BigInt(1)<<BigInt(14)){const e=n<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}if(n<BigInt(1)<<BigInt(30)){const e=n<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}throw new Error("BigInt compact encoding not supported > 2^30")}(l),f=new Uint8Array([0,...n,o,...e,...a,...u,...d,...i]),p=function tE(n){if(n<64)return new Uint8Array([n<<2]);if(n<16384){const e=n<<2|1;return new Uint8Array([255&e,e>>8&255])}if(n<1<<30){const e=n<<2|2;return new Uint8Array([255&e,e>>8&255,e>>16&255,e>>24&255])}throw new Error("Compact encoding > 2^30 not supported")}(f.length+1);return new Uint8Array([...p,s,...f])}({publicKey:t,signature:e,payload:n.transaction});return function X2(n){const e=Yc(n),t=(0,O1.blake2b)(e,void 0,32);return"0x"+Buffer.from(t).toString("hex")}(Buffer.from(r).toString("hex"))}const iE="PARSE_ERROR",sE="INVALID_REQUEST",oE="METHOD_NOT_FOUND",aE="INVALID_PARAMS",Vh="INTERNAL_ERROR",Jc="SERVER_ERROR",cE=[-32700,-32600,-32601,-32602,-32603],ys={[iE]:{code:-32700,message:"Parse error"},[sE]:{code:-32600,message:"Invalid Request"},[oE]:{code:-32601,message:"Method not found"},[aE]:{code:-32602,message:"Invalid params"},[Vh]:{code:-32603,message:"Internal error"},[Jc]:{code:-32e3,message:"Server error"}},Hh=Jc;function Gh(n){return Object.keys(ys).includes(n)?ys[n]:ys[Hh]}var dE=U(3601);function qn(n=3){return Date.now()*Math.pow(10,n)+Math.floor(Math.random()*Math.pow(10,n))}function Mr(n=6){return BigInt(qn(n))}function pr(n,e,t){return{id:t||qn(),jsonrpc:"2.0",method:n,params:e}}function $o(n,e){return{id:n,jsonrpc:"2.0",result:e}}function Zc(n,e,t){return{id:n,jsonrpc:"2.0",error:fE(e,t)}}function fE(n,e){return typeof n>"u"?Gh(Vh):("string"==typeof n&&(n=Object.assign(Object.assign({},Gh(Jc)),{message:n})),typeof e<"u"&&(n.data=e),function Wh(n){return cE.includes(n)}(n.code)&&(n=function Yh(n){const e=Object.values(ys).find(t=>t.code===n);return e||ys[Hh]}(n.code)),n)}class Jh{}class hE extends Jh{constructor(){super()}}class pE extends hE{constructor(e){super()}}function Xh(n){return function Zh(n,e){const t=function _E(n){const e=n.match(new RegExp(/^\w+:/,"gi"));if(e&&e.length)return e[0]}(n);return!(typeof t>"u")&&new RegExp(e).test(t)}(n,"^wss?:")}function mE(n){return new RegExp("wss?://localhost(:d{2,5})?").test(n)}function Qh(n){return"object"==typeof n&&"id"in n&&"jsonrpc"in n&&"2.0"===n.jsonrpc}function Xc(n){return Qh(n)&&"method"in n}function zo(n){return Qh(n)&&(Kn(n)||Dn(n))}function Kn(n){return"result"in n}function Dn(n){return"error"in n}class bE extends pE{constructor(e){super(e),this.events=new Y.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}connect(){var e=this;return(0,h.A)(function*(t=e.connection){yield e.open(t)}).apply(this,arguments)}disconnect(){var e=this;return(0,h.A)(function*(){yield e.close()})()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}request(e,t){var r=this;return(0,h.A)(function*(){return r.requestStrict(pr(e.method,e.params||[],e.id||Mr().toString()),t)})()}requestStrict(e,t){var r=this;return(0,h.A)(function*(){return new Promise(function(){var i=(0,h.A)(function*(s,o){if(!r.connection.connected)try{yield r.open()}catch(a){o(a)}r.events.on(`${e.id}`,a=>{Dn(a)?o(a.error):s(a.result)});try{yield r.connection.send(e,t)}catch(a){o(a)}});return function(s,o){return i.apply(this,arguments)}}())})()}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),zo(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&3e3===e.code&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}open(){var e=this;return(0,h.A)(function*(t=e.connection){e.connection===t&&e.connection.connected||(e.connection.connected&&e.close(),"string"==typeof t&&(yield e.connection.open(t),t=e.connection),e.connection=e.setConnection(t),yield e.connection.open(),e.registerEventListeners(),e.events.emit("connect"))}).apply(this,arguments)}close(){var e=this;return(0,h.A)(function*(){yield e.connection.close()})()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const ep=n=>n.split("?")[0],xE=typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:U(3806);class EE{constructor(e){if(this.url=e,this.events=new Y.EventEmitter,this.registering=!1,!Xh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}open(){var e=this;return(0,h.A)(function*(t=e.url){yield e.register(t)}).apply(this,arguments)}close(){var e=this;return(0,h.A)(function*(){return new Promise((t,r)=>{typeof e.socket>"u"?r(new Error("Connection already closed")):(e.socket.onclose=i=>{e.onClose(i),t()},e.socket.close())})})()}send(e){var t=this;return(0,h.A)(function*(){typeof t.socket>"u"&&(t.socket=yield t.register());try{t.socket.send(Ne(e))}catch(r){t.onError(e.id,r)}})()}register(e=this.url){if(!Xh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((r,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,r)=>{const i=(0,dE.isReactNative)()?void 0:{rejectUnauthorized:!mE(e)},s=new xE(e,[],i);typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u"?s.onerror=o=>{r(this.emitError(o.error))}:s.on("error",o=>{r(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),t(s)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t="string"==typeof e.data?Ue(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const r=this.parseError(t),s=Zc(e,r.message||r.toString());this.events.emit("payload",s)}parseError(e,t=this.url){return function lE(n,e,t){return n.message.includes("getaddrinfo ENOTFOUND")||n.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):n}(e,ep(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}emitError(e){const t=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${ep(this.url)}`));return this.events.emit("register_error",t),t}}const qo="core",Vn=`wc@2:${qo}:`,IE={database:":memory:"},ip="client_ed25519_seed",DE=m.ONE_DAY,BE=m.SIX_HOURS,op="wss://relay.walletconnect.org",vt_publish="relayer_publish",Qc="2.21.9",pt={link_mode:"link_mode",relay:"relay"},ap="WALLETCONNECT_LINK_MODE_APPS",vn_created="subscription_created",vn_deleted="subscription_deleted",ms={wc_pairingDelete:{req:{ttl:m.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:m.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:m.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:m.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:m.ONE_DAY,prompt:!1,tag:0},res:{ttl:m.ONE_DAY,prompt:!1,tag:0}}},Cn_expired="expirer_expired",cp="https://verify.walletconnect.org",bs=cp,JE=`${bs}/v3`,ZE=["https://verify.walletconnect.com",cp];var o3=function i3(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<n.length;i++){var s=n.charAt(i),o=s.charCodeAt(0);if(255!==t[o])throw new TypeError(s+" is ambiguous");t[o]=i}var a=n.length,c=n.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function f(g){if("string"!=typeof g)throw new TypeError("Expected String");if(0===g.length)return new Uint8Array;var y=0;if(" "!==g[y]){for(var w=0,T=0;g[y]===c;)w++,y++;for(var N=(g.length-y)*u+1>>>0,E=new Uint8Array(N);g[y];){var k=t[g.charCodeAt(y)];if(255===k)return;for(var X=0,ce=N-1;(0!==k||X<T)&&-1!==ce;ce--,X++)E[ce]=(k+=a*E[ce]>>>0)%256>>>0,k=k/256>>>0;if(0!==k)throw new Error("Non-zero carry");T=X,y++}if(" "!==g[y]){for(var J=N-T;J!==N&&0===E[J];)J++;for(var Q=new Uint8Array(w+(N-J)),W=w;J!==N;)Q[W++]=E[J++];return Q}}}return{encode:function d(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===g.length)return"";for(var y=0,w=0,T=0,N=g.length;T!==N&&0===g[T];)T++,y++;for(var E=(N-T)*l+1>>>0,k=new Uint8Array(E);T!==N;){for(var X=g[T],ce=0,J=E-1;(0!==X||ce<w)&&-1!==J;J--,ce++)k[J]=(X+=256*k[J]>>>0)%a>>>0,X=X/a>>>0;if(0!==X)throw new Error("Non-zero carry");w=ce,T++}for(var Q=E-w;Q!==E&&0===k[Q];)Q++;for(var W=c.repeat(y);Q<E;++Q)W+=n.charAt(k[Q]);return W},decodeUnsafe:f,decode:function p(g){var y=f(g);if(y)return y;throw new Error(`Non-${e} character`)}}};const up=n=>{if(n instanceof Uint8Array&&"Uint8Array"===n.constructor.name)return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")};class u3{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class l3{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return lp(this,e)}}class d3{constructor(e){this.decoders=e}or(e){return lp(this,e)}decode(e){const r=this.decoders[e[0]];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const lp=(n,e)=>new d3({...n.decoders||{[n.prefix]:n},...e.decoders||{[e.prefix]:e}});class f3{constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new u3(e,t,r),this.decoder=new l3(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Vo=({name:n,prefix:e,encode:t,decode:r})=>new f3(n,e,t,r),xs=({prefix:n,name:e,alphabet:t})=>{const{encode:r,decode:i}=o3(t,e);return Vo({prefix:n,name:e,encode:r,decode:s=>up(i(s))})},jt=({name:n,prefix:e,bitsPerChar:t,alphabet:r})=>Vo({prefix:e,name:n,encode:i=>((n,e,t)=>{const r="="===e[e.length-1],i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<n.length;++c)for(a=a<<8|n[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),r)for(;s.length*t&7;)s+="=";return s})(i,r,t),decode:i=>((n,e,t,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=n.length;for(;"="===n[s-1];)--s;const o=new Uint8Array(s*t/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const d=i[n[l]];if(void 0===d)throw new SyntaxError(`Non-${r} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(i,r,t,n)}),g3=Vo({prefix:"\0",name:"identity",encode:n=>(n=>(new TextDecoder).decode(n))(n),decode:n=>(n=>(new TextEncoder).encode(n))(n)});var y3=Object.freeze({__proto__:null,identity:g3});const _3=jt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var m3=Object.freeze({__proto__:null,base2:_3});const b3=jt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var w3=Object.freeze({__proto__:null,base8:b3});const v3=xs({prefix:"9",name:"base10",alphabet:"0123456789"});var x3=Object.freeze({__proto__:null,base10:v3});const E3=jt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),A3=jt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var I3=Object.freeze({__proto__:null,base16:E3,base16upper:A3});const S3=jt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),D3=jt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),O3=jt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),C3=jt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),P3=jt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),T3=jt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),B3=jt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),R3=jt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),F3=jt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var U3=Object.freeze({__proto__:null,base32:S3,base32upper:D3,base32pad:O3,base32padupper:C3,base32hex:P3,base32hexupper:T3,base32hexpad:B3,base32hexpadupper:R3,base32z:F3});const N3=xs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),k3=xs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var L3=Object.freeze({__proto__:null,base36:N3,base36upper:k3});const M3=xs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),j3=xs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var $3=Object.freeze({__proto__:null,base58btc:M3,base58flickr:j3});const z3=jt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),q3=jt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),K3=jt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),V3=jt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var H3=Object.freeze({__proto__:null,base64:z3,base64pad:q3,base64url:K3,base64urlpad:V3});const dp=Array.from("\u{1f680}\u{1fa90}\u2604\u{1f6f0}\u{1f30c}\u{1f311}\u{1f312}\u{1f313}\u{1f314}\u{1f315}\u{1f316}\u{1f317}\u{1f318}\u{1f30d}\u{1f30f}\u{1f30e}\u{1f409}\u2600\u{1f4bb}\u{1f5a5}\u{1f4be}\u{1f4bf}\u{1f602}\u2764\u{1f60d}\u{1f923}\u{1f60a}\u{1f64f}\u{1f495}\u{1f62d}\u{1f618}\u{1f44d}\u{1f605}\u{1f44f}\u{1f601}\u{1f525}\u{1f970}\u{1f494}\u{1f496}\u{1f499}\u{1f622}\u{1f914}\u{1f606}\u{1f644}\u{1f4aa}\u{1f609}\u263a\u{1f44c}\u{1f917}\u{1f49c}\u{1f614}\u{1f60e}\u{1f607}\u{1f339}\u{1f926}\u{1f389}\u{1f49e}\u270c\u2728\u{1f937}\u{1f631}\u{1f60c}\u{1f338}\u{1f64c}\u{1f60b}\u{1f497}\u{1f49a}\u{1f60f}\u{1f49b}\u{1f642}\u{1f493}\u{1f929}\u{1f604}\u{1f600}\u{1f5a4}\u{1f603}\u{1f4af}\u{1f648}\u{1f447}\u{1f3b6}\u{1f612}\u{1f92d}\u2763\u{1f61c}\u{1f48b}\u{1f440}\u{1f62a}\u{1f611}\u{1f4a5}\u{1f64b}\u{1f61e}\u{1f629}\u{1f621}\u{1f92a}\u{1f44a}\u{1f973}\u{1f625}\u{1f924}\u{1f449}\u{1f483}\u{1f633}\u270b\u{1f61a}\u{1f61d}\u{1f634}\u{1f31f}\u{1f62c}\u{1f643}\u{1f340}\u{1f337}\u{1f63b}\u{1f613}\u2b50\u2705\u{1f97a}\u{1f308}\u{1f608}\u{1f918}\u{1f4a6}\u2714\u{1f623}\u{1f3c3}\u{1f490}\u2639\u{1f38a}\u{1f498}\u{1f620}\u261d\u{1f615}\u{1f33a}\u{1f382}\u{1f33b}\u{1f610}\u{1f595}\u{1f49d}\u{1f64a}\u{1f639}\u{1f5e3}\u{1f4ab}\u{1f480}\u{1f451}\u{1f3b5}\u{1f91e}\u{1f61b}\u{1f534}\u{1f624}\u{1f33c}\u{1f62b}\u26bd\u{1f919}\u2615\u{1f3c6}\u{1f92b}\u{1f448}\u{1f62e}\u{1f646}\u{1f37b}\u{1f343}\u{1f436}\u{1f481}\u{1f632}\u{1f33f}\u{1f9e1}\u{1f381}\u26a1\u{1f31e}\u{1f388}\u274c\u270a\u{1f44b}\u{1f630}\u{1f928}\u{1f636}\u{1f91d}\u{1f6b6}\u{1f4b0}\u{1f353}\u{1f4a2}\u{1f91f}\u{1f641}\u{1f6a8}\u{1f4a8}\u{1f92c}\u2708\u{1f380}\u{1f37a}\u{1f913}\u{1f619}\u{1f49f}\u{1f331}\u{1f616}\u{1f476}\u{1f974}\u25b6\u27a1\u2753\u{1f48e}\u{1f4b8}\u2b07\u{1f628}\u{1f31a}\u{1f98b}\u{1f637}\u{1f57a}\u26a0\u{1f645}\u{1f61f}\u{1f635}\u{1f44e}\u{1f932}\u{1f920}\u{1f927}\u{1f4cc}\u{1f535}\u{1f485}\u{1f9d0}\u{1f43e}\u{1f352}\u{1f617}\u{1f911}\u{1f30a}\u{1f92f}\u{1f437}\u260e\u{1f4a7}\u{1f62f}\u{1f486}\u{1f446}\u{1f3a4}\u{1f647}\u{1f351}\u2744\u{1f334}\u{1f4a3}\u{1f438}\u{1f48c}\u{1f4cd}\u{1f940}\u{1f922}\u{1f445}\u{1f4a1}\u{1f4a9}\u{1f450}\u{1f4f8}\u{1f47b}\u{1f910}\u{1f92e}\u{1f3bc}\u{1f975}\u{1f6a9}\u{1f34e}\u{1f34a}\u{1f47c}\u{1f48d}\u{1f4e3}\u{1f942}"),W3=dp.reduce((n,e,t)=>(n[t]=e,n),[]),G3=dp.reduce((n,e,t)=>(n[e.codePointAt(0)]=t,n),[]),Z3=Vo({prefix:"\u{1f680}",name:"base256emoji",encode:function Y3(n){return n.reduce((e,t)=>e+W3[t],"")},decode:function J3(n){const e=[];for(const t of n){const r=G3[t.codePointAt(0)];if(void 0===r)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}});var X3=Object.freeze({__proto__:null,base256emoji:Z3}),fp=128,tA=-128,nA=Math.pow(2,31),iA=128,pp=127,sA=Math.pow(2,7),oA=Math.pow(2,14),aA=Math.pow(2,21),cA=Math.pow(2,28),uA=Math.pow(2,35),lA=Math.pow(2,42),dA=Math.pow(2,49),fA=Math.pow(2,56),hA=Math.pow(2,63),gA={encode:function hp(n,e,t){e=e||[];for(var r=t=t||0;n>=nA;)e[t++]=255&n|fp,n/=128;for(;n&tA;)e[t++]=255&n|fp,n>>>=7;return e[t]=0|n,hp.bytes=t-r+1,e},decode:function eu(n,r){var o,t=0,i=0,s=r=r||0,a=n.length;do{if(s>=a)throw eu.bytes=0,new RangeError("Could not decode varint");o=n[s++],t+=i<28?(o&pp)<<i:(o&pp)*Math.pow(2,i),i+=7}while(o>=iA);return eu.bytes=s-r,t},encodingLength:function(n){return n<sA?1:n<oA?2:n<aA?3:n<cA?4:n<uA?5:n<lA?6:n<dA?7:n<fA?8:n<hA?9:10}},gp=gA;const yp=(n,e,t=0)=>(gp.encode(n,e,t),e),_p=n=>gp.encodingLength(n),tu=(n,e)=>{const t=e.byteLength,r=_p(n),i=r+_p(t),s=new Uint8Array(i+t);return yp(n,s,0),yp(t,s,r),s.set(e,i),new yA(n,t,e,s)};class yA{constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}const mp=({name:n,code:e,encode:t})=>new _A(n,e,t);class _A{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?tu(this.code,t):t.then(r=>tu(this.code,r))}throw Error("Unknown type, must be binary type")}}const bp=n=>function(){var e=(0,h.A)(function*(t){return new Uint8Array(yield crypto.subtle.digest(n,t))});return function(t){return e.apply(this,arguments)}}(),mA=mp({name:"sha2-256",code:18,encode:bp("SHA-256")}),bA=mp({name:"sha2-512",code:19,encode:bp("SHA-512")});Object.freeze({__proto__:null,sha256:mA,sha512:bA});const vp=up;Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:vp,digest:n=>tu(0,vp(n))}}),new TextEncoder,new TextDecoder;const xp={...y3,...m3,...w3,...x3,...I3,...U3,...L3,...$3,...H3,...X3};function Ep(n){return null!=globalThis.Buffer?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function Ap(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}const Ip=Ap("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>(new TextEncoder).encode(n.substring(1))),nu=Ap("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{const e=function EA(n=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?Ep(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}((n=n.substring(1)).length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),AA={utf8:Ip,"utf-8":Ip,hex:xp.base16,latin1:nu,ascii:nu,binary:nu,...xp};var SA=Object.defineProperty,Wn=(n,e,t)=>((n,e,t)=>e in n?SA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class OA{constructor(e,t){var r=this;this.core=e,this.logger=t,Wn(this,"keychain",new Map),Wn(this,"name","keychain"),Wn(this,"version","0.3"),Wn(this,"initialized",!1),Wn(this,"storagePrefix",Vn),Wn(this,"init",(0,h.A)(function*(){if(!r.initialized){const i=yield r.getKeyChain();typeof i<"u"&&(r.keychain=i),r.initialized=!0}})),Wn(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),Wn(this,"set",function(){var i=(0,h.A)(function*(s,o){r.isInitialized(),r.keychain.set(s,o),yield r.persist()});return function(s,o){return i.apply(this,arguments)}}()),Wn(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:o}=ge("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(o)}return s}),Wn(this,"del",function(){var i=(0,h.A)(function*(s){r.isInitialized(),r.keychain.delete(s),yield r.persist()});return function(s){return i.apply(this,arguments)}}()),this.core=e,this.logger=Xt(t,this.name)}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}setKeyChain(e){var t=this;return(0,h.A)(function*(){yield t.core.storage.setItem(t.storageKey,tc(e))})()}getKeyChain(){var e=this;return(0,h.A)(function*(){const t=yield e.core.storage.getItem(e.storageKey);return typeof t<"u"?nc(t):void 0})()}persist(){var e=this;return(0,h.A)(function*(){yield e.setKeyChain(e.keychain)})()}isInitialized(){if(!this.initialized){const{message:e}=ge("NOT_INITIALIZED",this.name);throw new Error(e)}}}var CA=Object.defineProperty,$t=(n,e,t)=>((n,e,t)=>e in n?CA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class TA{constructor(e,t,r){var i=this;this.core=e,this.logger=t,$t(this,"name","crypto"),$t(this,"keychain"),$t(this,"randomSessionIdentifier",qc()),$t(this,"initialized",!1),$t(this,"init",(0,h.A)(function*(){i.initialized||(yield i.keychain.init(),i.initialized=!0)})),$t(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),$t(this,"getClientId",(0,h.A)(function*(){return i.isInitialized(),Sl(Dl(yield i.getClientSeed()).publicKey)})),$t(this,"generateKeyPair",()=>{this.isInitialized();const s=function jx(){const n=Lc.utils.randomPrivateKey(),e=Lc.getPublicKey(n);return{privateKey:dn(n,rn),publicKey:dn(e,rn)}}();return this.setPrivateKey(s.publicKey,s.privateKey)}),$t(this,"signJWT",function(){var s=(0,h.A)(function*(o){i.isInitialized();const c=Dl(yield i.getClientSeed()),u=i.randomSessionIdentifier;return yield function b_(n,e,t,r){return Ia.apply(this,arguments)}(u,o,DE,c)});return function(o){return s.apply(this,arguments)}}()),$t(this,"generateSharedKey",(s,o,a)=>{this.isInitialized();const u=function $x(n,e){const t=Lc.getSharedSecret(An(n,rn),An(e,rn));return dn(((n,e,t,r,i)=>function Yv(n,e,t,r=32){bo(n),ar(r);const i=n.outputLen;if(r>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/i);void 0===t&&(t=Kf);const o=new Uint8Array(s*i),a=Io.create(n,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)Sc[0]=l+1,c.update(0===l?Kf:u).update(t).update(Sc).digestInto(u),o.set(u,i*l),a._cloneInto(c);return a.destroy(),c.destroy(),In(u,Sc),o.slice(0,r)}(n,function Gv(n,e,t){return bo(n),void 0===t&&(t=new Uint8Array(n.outputLen)),Io(n,Nn(t),Nn(e))}(n,e,t),r,i))(So,t,void 0,void 0,32),rn)}(this.getPrivateKey(s),o);return this.setSymKey(u,a)}),$t(this,"setSymKey",function(){var s=(0,h.A)(function*(o,a){i.isInitialized();const c=a||Uo(o);return yield i.keychain.set(c,o),c});return function(o,a){return s.apply(this,arguments)}}()),$t(this,"deleteKeyPair",function(){var s=(0,h.A)(function*(o){i.isInitialized(),yield i.keychain.del(o)});return function(o){return s.apply(this,arguments)}}()),$t(this,"deleteSymKey",function(){var s=(0,h.A)(function*(o){i.isInitialized(),yield i.keychain.del(o)});return function(o){return s.apply(this,arguments)}}()),$t(this,"encode",function(){var s=(0,h.A)(function*(o,a,c){i.isInitialized();const u=Oh(c),l=Ne(a);if(Ph(u))return function Kx(n,e){const t=Ah(2),r=Xr(12),s=Dh({type:t,sealed:An(n,ls),iv:r});return e===Lr?Ih(s):s}(l,c?.encoding);if(Ch(u)){const g=u.senderPublicKey,y=u.receiverPublicKey;o=yield i.generateSharedKey(g,y)}const d=i.getSymKey(o),{type:f,senderPublicKey:p}=u;return function zx(n){const e=Ah(typeof n.type<"u"?n.type:0);if(1===ri(e)&&typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof n.senderPublicKey<"u"?An(n.senderPublicKey,rn):void 0,r=typeof n.iv<"u"?An(n.iv,rn):Xr(12),i=An(n.symKey,rn),o=Dh({type:e,sealed:zf(i,r).encrypt(An(n.message,ls)),iv:r,senderPublicKey:t});return n.encoding===Lr?Ih(o):o}({type:f,symKey:d,message:l,senderPublicKey:p,encoding:c?.encoding})});return function(o,a,c){return s.apply(this,arguments)}}()),$t(this,"decode",function(){var s=(0,h.A)(function*(o,a,c){i.isInitialized();const u=function Hx(n,e){const t=hs({encoded:n,encoding:e?.encoding});return Oh({type:ri(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?dn(t.senderPublicKey,rn):void 0,receiverPublicKey:e?.receiverPublicKey})}(a,c);if(Ph(u)){const l=function Vx(n,e){const{sealed:t}=hs({encoded:n,encoding:e});return dn(t,ls)}(a,c?.encoding);return Ue(l)}if(Ch(u)){const l=u.receiverPublicKey,d=u.senderPublicKey;o=yield i.generateSharedKey(l,d)}try{const d=function qx(n){const e=An(n.symKey,rn),{sealed:t,iv:r}=hs({encoded:n.encoded,encoding:n.encoding}),i=zf(e,r).decrypt(t);if(null===i)throw new Error("Failed to decrypt");return dn(i,ls)}({symKey:i.getSymKey(o),encoded:a,encoding:c?.encoding});return Ue(d)}catch(l){i.logger.error(`Failed to decode message from topic: '${o}', clientId: '${yield i.getClientId()}'`),i.logger.error(l)}});return function(o,a,c){return s.apply(this,arguments)}}()),$t(this,"getPayloadType",(s,o=gn)=>ri(hs({encoded:s,encoding:o}).type)),$t(this,"getPayloadSenderPublicKey",(s,o=gn)=>{const a=hs({encoded:s,encoding:o});return a.senderPublicKey?dn(a.senderPublicKey,rn):void 0}),this.core=e,this.logger=Xt(t,this.name),this.keychain=r||new OA(this.core,this.logger)}get context(){return an(this.logger)}setPrivateKey(e,t){var r=this;return(0,h.A)(function*(){return yield r.keychain.set(e,t),e})()}getPrivateKey(e){return this.keychain.get(e)}getClientSeed(){var e=this;return(0,h.A)(function*(){let t="";try{t=e.keychain.get(ip)}catch{t=qc(),yield e.keychain.set(ip,t)}return function IA(n,e="utf8"){const t=AA[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?t.decoder.decode(`${t.prefix}${n}`):Ep(globalThis.Buffer.from(n,"utf-8"))}(t,"base16")})()}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=ge("NOT_INITIALIZED",this.name);throw new Error(e)}}}var BA=Object.defineProperty,RA=Object.defineProperties,FA=Object.getOwnPropertyDescriptors,Sp=Object.getOwnPropertySymbols,UA=Object.prototype.hasOwnProperty,NA=Object.prototype.propertyIsEnumerable,ru=(n,e,t)=>e in n?BA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,xn=(n,e,t)=>ru(n,"symbol"!=typeof e?e+"":e,t);class MA extends wg{constructor(e,t){var r;super(e,t),r=this,this.logger=e,this.core=t,xn(this,"messages",new Map),xn(this,"messagesWithoutClientAck",new Map),xn(this,"name","messages"),xn(this,"version","0.3"),xn(this,"initialized",!1),xn(this,"storagePrefix",Vn),xn(this,"init",(0,h.A)(function*(){if(!r.initialized){r.logger.trace("Initialized");try{const i=yield r.getRelayerMessages();typeof i<"u"&&(r.messages=i);const s=yield r.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(r.messagesWithoutClientAck=s),r.logger.debug(`Successfully Restored records for ${r.name}`),r.logger.trace({type:"method",method:"restore",size:r.messages.size})}catch(i){r.logger.debug(`Failed to Restore records for ${r.name}`),r.logger.error(i)}finally{r.initialized=!0}}})),xn(this,"set",function(){var i=(0,h.A)(function*(s,o,a){r.isInitialized();const c=Sn(o);let u=r.messages.get(s);if(typeof u>"u"&&(u={}),typeof u[c]<"u")return c;if(u[c]=o,r.messages.set(s,u),"inbound"===a){const l=r.messagesWithoutClientAck.get(s)||{};r.messagesWithoutClientAck.set(s,((n,e)=>RA(n,FA(e)))(((n,e)=>{for(var t in e||(e={}))UA.call(e,t)&&ru(n,t,e[t]);if(Sp)for(var t of Sp(e))NA.call(e,t)&&ru(n,t,e[t]);return n})({},l),{[c]:o}))}return yield r.persist(),c});return function(s,o,a){return i.apply(this,arguments)}}()),xn(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),xn(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const o of i){const a=this.messagesWithoutClientAck.get(o)||{};s[o]=Object.values(a)}return s}),xn(this,"has",(i,s)=>(this.isInitialized(),typeof this.get(i)[Sn(s)]<"u")),xn(this,"ack",function(){var i=(0,h.A)(function*(s,o){r.isInitialized();const a=r.messagesWithoutClientAck.get(s);typeof a>"u"||(delete a[Sn(o)],0===Object.keys(a).length?r.messagesWithoutClientAck.delete(s):r.messagesWithoutClientAck.set(s,a),yield r.persist())});return function(s,o){return i.apply(this,arguments)}}()),xn(this,"del",function(){var i=(0,h.A)(function*(s){r.isInitialized(),r.messages.delete(s),r.messagesWithoutClientAck.delete(s),yield r.persist()});return function(s){return i.apply(this,arguments)}}()),this.logger=Xt(e,this.name),this.core=t}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}setRelayerMessages(e){var t=this;return(0,h.A)(function*(){yield t.core.storage.setItem(t.storageKey,tc(e))})()}setRelayerMessagesWithoutClientAck(e){var t=this;return(0,h.A)(function*(){yield t.core.storage.setItem(t.storageKeyWithoutClientAck,tc(e))})()}getRelayerMessages(){var e=this;return(0,h.A)(function*(){const t=yield e.core.storage.getItem(e.storageKey);return typeof t<"u"?nc(t):void 0})()}getRelayerMessagesWithoutClientAck(){var e=this;return(0,h.A)(function*(){const t=yield e.core.storage.getItem(e.storageKeyWithoutClientAck);return typeof t<"u"?nc(t):void 0})()}persist(){var e=this;return(0,h.A)(function*(){yield e.setRelayerMessages(e.messages),yield e.setRelayerMessagesWithoutClientAck(e.messagesWithoutClientAck)})()}isInitialized(){if(!this.initialized){const{message:e}=ge("NOT_INITIALIZED",this.name);throw new Error(e)}}}var jA=Object.defineProperty,$A=Object.defineProperties,zA=Object.getOwnPropertyDescriptors,Dp=Object.getOwnPropertySymbols,qA=Object.prototype.hasOwnProperty,KA=Object.prototype.propertyIsEnumerable,iu=(n,e,t)=>e in n?jA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ti=(n,e)=>{for(var t in e||(e={}))qA.call(e,t)&&iu(n,t,e[t]);if(Dp)for(var t of Dp(e))KA.call(e,t)&&iu(n,t,e[t]);return n},Op=(n,e)=>$A(n,zA(e)),Pn=(n,e,t)=>iu(n,"symbol"!=typeof e?e+"":e,t);class VA extends vg{constructor(e,t){var r;super(e,t),r=this,this.relayer=e,this.logger=t,Pn(this,"events",new Y.EventEmitter),Pn(this,"name","publisher"),Pn(this,"queue",new Map),Pn(this,"publishTimeout",(0,m.toMiliseconds)(m.ONE_MINUTE)),Pn(this,"initialPublishTimeout",(0,m.toMiliseconds)(15*m.ONE_SECOND)),Pn(this,"needsTransportRestart",!1),Pn(this,"publish",function(){var i=(0,h.A)(function*(s,o,a){var c,u,l,d,f;r.logger.debug("Publishing Payload"),r.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:a}});const p=a?.ttl||BE,g=a?.prompt||!1,y=a?.tag||0,w=a?.id||Mr().toString(),T=Oi(No().protocol),N={id:w,method:a?.publishMethod||T.publish,params:Ti({topic:s,message:o,ttl:p,prompt:g,tag:y,attestation:a?.attestation},a?.tvf)},E=`Failed to publish payload, please try again. id:${w} tag:${y}`;try{Tt(null==(c=N.params)?void 0:c.prompt)&&(null==(u=N.params)||delete u.prompt),Tt(null==(l=N.params)?void 0:l.tag)&&(null==(d=N.params)||delete d.tag);const k=new Promise(function(){var X=(0,h.A)(function*(ce){const J=({id:W})=>{var Fe;(null==(Fe=N.id)?void 0:Fe.toString())===W.toString()&&(r.removeRequestFromQueue(W),r.relayer.events.removeListener(vt_publish,J),ce())};r.relayer.events.on(vt_publish,J);const Q=$n(new Promise((W,Fe)=>{r.rpcPublish(N,a).then(W).catch(Ae=>{r.logger.warn(Ae,Ae?.message),Fe(Ae)})}),r.initialPublishTimeout,`Failed initial publish, retrying.... id:${w} tag:${y}`);try{yield Q,r.events.removeListener(vt_publish,J)}catch(W){r.queue.set(w,{request:N,opts:a,attempt:1}),r.logger.warn(W,W?.message)}});return function(ce){return X.apply(this,arguments)}}());r.logger.trace({type:"method",method:"publish",params:{id:w,topic:s,message:o,opts:a}}),yield $n(k,r.publishTimeout,E)}catch(k){if(r.logger.debug("Failed to Publish Payload"),r.logger.error(k),null!=(f=a?.internal)&&f.throwOnFailedPublish)throw k}finally{r.queue.delete(w)}});return function(s,o,a){return i.apply(this,arguments)}}()),Pn(this,"publishCustom",function(){var i=(0,h.A)(function*(s){var o,a,c,u,l;r.logger.debug("Publishing custom payload"),r.logger.trace({type:"method",method:"publishCustom",params:s});const{payload:d,opts:f={}}=s,{attestation:p,tvf:g,publishMethod:y,prompt:w,tag:T,ttl:N=m.FIVE_MINUTES}=f,E=f.id||Mr().toString(),k=Oi(No().protocol),X=y||k.publish,ce={id:E,method:X,params:Ti(Op(Ti({},d),{ttl:N,prompt:w,tag:T,attestation:p}),g)},J=`Failed to publish custom payload, please try again. id:${E} tag:${T}`;try{Tt(null==(o=ce.params)?void 0:o.prompt)&&(null==(a=ce.params)||delete a.prompt),Tt(null==(c=ce.params)?void 0:c.tag)&&(null==(u=ce.params)||delete u.tag);const Q=new Promise(function(){var W=(0,h.A)(function*(Fe){const Ae=({id:F})=>{var L;(null==(L=ce.id)?void 0:L.toString())===F.toString()&&(r.removeRequestFromQueue(F),r.relayer.events.removeListener(vt_publish,Ae),Fe())};r.relayer.events.on(vt_publish,Ae);const ae=$n(new Promise((F,L)=>{r.rpcPublish(ce,f).then(F).catch(D=>{r.logger.warn(D,D?.message),L(D)})}),r.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${X} id:${E} tag:${T}`);try{yield ae,r.events.removeListener(vt_publish,Ae)}catch(F){r.queue.set(E,{request:ce,opts:f,attempt:1}),r.logger.warn(F,F?.message)}});return function(Fe){return W.apply(this,arguments)}}());r.logger.trace({type:"method",method:"publish",params:{id:E,payload:d,opts:f}}),yield $n(Q,r.publishTimeout,J)}catch(Q){if(r.logger.debug("Failed to Publish Payload"),r.logger.error(Q),null!=(l=f?.internal)&&l.throwOnFailedPublish)throw Q}finally{r.queue.delete(E)}});return function(s){return i.apply(this,arguments)}}()),Pn(this,"on",(i,s)=>{this.events.on(i,s)}),Pn(this,"once",(i,s)=>{this.events.once(i,s)}),Pn(this,"off",(i,s)=>{this.events.off(i,s)}),Pn(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=Xt(t,this.name),this.registerEventListeners()}get context(){return an(this.logger)}rpcPublish(e,t){var r=this;return(0,h.A)(function*(){r.logger.debug("Outgoing Relay Payload"),r.logger.trace({type:"message",direction:"outgoing",request:e});const i=yield r.relayer.request(e);return r.relayer.events.emit(vt_publish,Ti(Ti({},e),t)),r.logger.debug("Successfully Published Payload"),i})()}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){var e=this;this.queue.forEach(function(){var t=(0,h.A)(function*(r,i){var s;const o=r.attempt+1;e.queue.set(i,Op(Ti({},r),{attempt:o})),e.logger.warn({},`Publisher: queue->publishing: ${r.request.id}, tag: ${null==(s=r.request.params)?void 0:s.tag}, attempt: ${o}`),yield e.rpcPublish(r.request,r.opts),e.logger.warn({},`Publisher: queue->published: ${r.request.id}`)});return function(r,i){return t.apply(this,arguments)}}())}registerEventListeners(){this.relayer.core.heartbeat.on(fe_pulse,()=>{if(this.needsTransportRestart)return this.needsTransportRestart=!1,void this.relayer.events.emit("relayer_connection_stalled");this.checkQueue()}),this.relayer.on("relayer_message_ack",e=>{this.removeRequestFromQueue(e.id.toString())})}}var HA=Object.defineProperty,Bi=(n,e,t)=>((n,e,t)=>e in n?HA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class GA{constructor(){Bi(this,"map",new Map),Bi(this,"set",(e,t)=>{const r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])}),Bi(this,"get",e=>this.map.get(e)||[]),Bi(this,"exists",(e,t)=>this.get(e).includes(t)),Bi(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,t))return;const i=r.filter(s=>s!==t);i.length?this.map.set(e,i):this.map.delete(e)}),Bi(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var YA=Object.defineProperty,JA=Object.defineProperties,ZA=Object.getOwnPropertyDescriptors,Cp=Object.getOwnPropertySymbols,XA=Object.prototype.hasOwnProperty,QA=Object.prototype.propertyIsEnumerable,su=(n,e,t)=>e in n?YA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Es=(n,e)=>{for(var t in e||(e={}))XA.call(e,t)&&su(n,t,e[t]);if(Cp)for(var t of Cp(e))QA.call(e,t)&&su(n,t,e[t]);return n},ou=(n,e)=>JA(n,ZA(e)),dt=(n,e,t)=>su(n,"symbol"!=typeof e?e+"":e,t);class e8 extends Dg{constructor(e,t){var r;super(e,t),r=this,this.relayer=e,this.logger=t,dt(this,"subscriptions",new Map),dt(this,"topicMap",new GA),dt(this,"events",new Y.EventEmitter),dt(this,"name","subscription"),dt(this,"version","0.3"),dt(this,"pending",new Map),dt(this,"cached",[]),dt(this,"initialized",!1),dt(this,"storagePrefix",Vn),dt(this,"subscribeTimeout",(0,m.toMiliseconds)(m.ONE_MINUTE)),dt(this,"initialSubscribeTimeout",(0,m.toMiliseconds)(15*m.ONE_SECOND)),dt(this,"clientId"),dt(this,"batchSubscribeTopicsLimit",500),dt(this,"init",(0,h.A)(function*(){r.initialized||(r.logger.trace("Initialized"),r.registerEventListeners(),yield r.restore()),r.initialized=!0})),dt(this,"subscribe",function(){var i=(0,h.A)(function*(s,o){var a;r.isInitialized(),r.logger.debug("Subscribing Topic"),r.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}});try{const c=No(o),u={topic:s,relay:c,transportType:o?.transportType};null!=(a=o?.internal)&&a.skipSubscribe||r.pending.set(s,u);const l=yield r.rpcSubscribe(s,c,o);return"string"==typeof l&&(r.onSubscribe(l,u),r.logger.debug("Successfully Subscribed Topic"),r.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}})),l}catch(c){throw r.logger.debug("Failed to Subscribe Topic"),r.logger.error(c),c}});return function(s,o){return i.apply(this,arguments)}}()),dt(this,"unsubscribe",function(){var i=(0,h.A)(function*(s,o){r.isInitialized(),typeof o?.id<"u"?yield r.unsubscribeById(s,o.id,o):yield r.unsubscribeByTopic(s,o)});return function(s,o){return i.apply(this,arguments)}}()),dt(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),dt(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(o=>o.topic===i))})),dt(this,"on",(i,s)=>{this.events.on(i,s)}),dt(this,"once",(i,s)=>{this.events.once(i,s)}),dt(this,"off",(i,s)=>{this.events.off(i,s)}),dt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),dt(this,"start",(0,h.A)(function*(){yield r.onConnect()})),dt(this,"stop",(0,h.A)(function*(){yield r.onDisconnect()})),dt(this,"restart",(0,h.A)(function*(){yield r.restore(),yield r.onRestart()})),dt(this,"checkPending",(0,h.A)(function*(){if(!(0!==r.pending.size||r.initialized&&r.relayer.connected))return;const i=[];r.pending.forEach(s=>{i.push(s)}),yield r.batchSubscribe(i)})),dt(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(fe_pulse,(0,h.A)(function*(){yield r.checkPending()})),this.events.on(vn_created,function(){var i=(0,h.A)(function*(s){const o=vn_created;r.logger.info(`Emitting ${o}`),r.logger.debug({type:"event",event:o,data:s}),yield r.persist()});return function(s){return i.apply(this,arguments)}}()),this.events.on(vn_deleted,function(){var i=(0,h.A)(function*(s){const o=vn_deleted;r.logger.info(`Emitting ${o}`),r.logger.debug({type:"event",event:o,data:s}),yield r.persist()});return function(s){return i.apply(this,arguments)}}())}),this.relayer=e,this.logger=Xt(t,this.name),this.clientId=""}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}unsubscribeByTopic(e,t){var r=this;return(0,h.A)(function*(){const i=r.topicMap.get(e);yield Promise.all(i.map(function(){var s=(0,h.A)(function*(o){return yield r.unsubscribeById(e,o,t)});return function(o){return s.apply(this,arguments)}}()))})()}unsubscribeById(e,t,r){var i=this;return(0,h.A)(function*(){i.logger.debug("Unsubscribing Topic"),i.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{const s=No(r);yield i.restartToComplete({topic:e,id:t,relay:s}),yield i.rpcUnsubscribe(e,t,s);const o=_t("USER_DISCONNECTED",`${i.name}, ${e}`);yield i.onUnsubscribe(e,t,o),i.logger.debug("Successfully Unsubscribed Topic"),i.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(s){throw i.logger.debug("Failed to Unsubscribe Topic"),i.logger.error(s),s}})()}rpcSubscribe(e,t,r){var i=this;return(0,h.A)(function*(){var s,o;const a=yield i.getSubscriptionId(e);if(null!=(s=r?.internal)&&s.skipSubscribe)return a;(!r||r?.transportType===pt.relay)&&(yield i.restartToComplete({topic:e,id:e,relay:t}));const c={method:Oi(t.protocol).subscribe,params:{topic:e}};i.logger.debug("Outgoing Relay Payload"),i.logger.trace({type:"payload",direction:"outgoing",request:c});const u=null==(o=r?.internal)?void 0:o.throwOnFailedPublish;try{if(r?.transportType===pt.link_mode)return setTimeout(()=>{(i.relayer.connected||i.relayer.connecting)&&i.relayer.request(c).catch(f=>i.logger.warn(f))},(0,m.toMiliseconds)(m.ONE_SECOND)),a;const l=new Promise(function(){var f=(0,h.A)(function*(p){const g=y=>{y.topic===e&&(i.events.removeListener(vn_created,g),p(y.id))};i.events.on(vn_created,g);try{const y=yield $n(new Promise((w,T)=>{i.relayer.request(c).catch(N=>{i.logger.warn(N,N?.message),T(N)}).then(w)}),i.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);i.events.removeListener(vn_created,g),p(y)}catch{}});return function(p){return f.apply(this,arguments)}}()),d=yield $n(l,i.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!d&&u)throw new Error(`Subscribing to ${e} failed, please try again`);return d?a:null}catch(l){if(i.logger.debug("Outgoing Relay Subscribe Payload stalled"),i.relayer.events.emit("relayer_connection_stalled"),u)throw l}return null})()}rpcBatchSubscribe(e){var t=this;return(0,h.A)(function*(){if(!e.length)return;const i={method:Oi(e[0].relay.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};t.logger.debug("Outgoing Relay Payload"),t.logger.trace({type:"payload",direction:"outgoing",request:i});try{yield yield $n(new Promise(s=>{t.relayer.request(i).catch(o=>t.logger.warn(o)).then(s)}),t.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{t.relayer.events.emit("relayer_connection_stalled")}})()}rpcBatchFetchMessages(e){var t=this;return(0,h.A)(function*(){if(!e.length)return;const i={method:Oi(e[0].relay.protocol).batchFetchMessages,params:{topics:e.map(o=>o.topic)}};let s;t.logger.debug("Outgoing Relay Payload"),t.logger.trace({type:"payload",direction:"outgoing",request:i});try{s=yield yield $n(new Promise((o,a)=>{t.relayer.request(i).catch(c=>{t.logger.warn(c),a(c)}).then(o)}),t.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{t.relayer.events.emit("relayer_connection_stalled")}return s})()}rpcUnsubscribe(e,t,r){const i={method:Oi(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,t){this.setSubscription(e,ou(Es({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Es({},t)),this.pending.delete(t.topic)})}onUnsubscribe(e,t,r){var i=this;return(0,h.A)(function*(){i.events.removeAllListeners(t),i.hasSubscription(t,e)&&i.deleteSubscription(t,r),yield i.relayer.messages.del(e)})()}setRelayerSubscriptions(e){var t=this;return(0,h.A)(function*(){yield t.relayer.core.storage.setItem(t.storageKey,e)})()}getRelayerSubscriptions(){var e=this;return(0,h.A)(function*(){return yield e.relayer.core.storage.getItem(e.storageKey)})()}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,Es({},t)),this.topicMap.set(t.topic,e),this.events.emit(vn_created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:r}=ge("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(vn_deleted,ou(Es({},r),{reason:t}))}persist(){var e=this;return(0,h.A)(function*(){yield e.setRelayerSubscriptions(e.values),e.events.emit("subscription_sync")})()}onRestart(){var e=this;return(0,h.A)(function*(){if(e.cached.length){const t=[...e.cached],r=Math.ceil(e.cached.length/e.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const s=t.splice(0,e.batchSubscribeTopicsLimit);yield e.batchSubscribe(s)}}e.events.emit("subscription_resubscribed")})()}restore(){var e=this;return(0,h.A)(function*(){try{const t=yield e.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(e.subscriptions.size&&!t.every(r=>{var i;return r.topic===(null==(i=e.subscriptions.get(r.id))?void 0:i.topic)})){const{message:r}=ge("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(r),e.logger.error(`${e.name}: ${JSON.stringify(e.values)}`),new Error(r)}e.cached=t,e.logger.debug(`Successfully Restored subscriptions for ${e.name}`),e.logger.trace({type:"method",method:"restore",subscriptions:e.values})}catch(t){e.logger.debug(`Failed to Restore subscriptions for ${e.name}`),e.logger.error(t)}})()}batchSubscribe(e){var t=this;return(0,h.A)(function*(){e.length&&(yield t.rpcBatchSubscribe(e),t.onBatchSubscribe(yield Promise.all(e.map(function(){var r=(0,h.A)(function*(i){return ou(Es({},i),{id:yield t.getSubscriptionId(i.topic)})});return function(i){return r.apply(this,arguments)}}()))))})()}batchFetchMessages(e){var t=this;return(0,h.A)(function*(){if(!e.length)return;t.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=yield t.rpcBatchFetchMessages(e);r&&r.messages&&(yield function cw(n){return new Promise(e=>setTimeout(e,n))}((0,m.toMiliseconds)(m.ONE_SECOND)),yield t.relayer.handleBatchMessageEvents(r.messages))})()}onConnect(){var e=this;return(0,h.A)(function*(){yield e.restart(),e.reset()})()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=ge("NOT_INITIALIZED",this.name);throw new Error(e)}}restartToComplete(e){var t=this;return(0,h.A)(function*(){!t.relayer.connected&&!t.relayer.connecting&&(t.cached.push(e),yield t.relayer.transportOpen())})()}getClientId(){var e=this;return(0,h.A)(function*(){return e.clientId||(e.clientId=yield e.relayer.core.crypto.getClientId()),e.clientId})()}getSubscriptionId(e){var t=this;return(0,h.A)(function*(){return Sn(e+(yield t.getClientId()))})()}}var t8=Object.defineProperty,Pp=Object.getOwnPropertySymbols,n8=Object.prototype.hasOwnProperty,r8=Object.prototype.propertyIsEnumerable,au=(n,e,t)=>e in n?t8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Tp=(n,e)=>{for(var t in e||(e={}))n8.call(e,t)&&au(n,t,e[t]);if(Pp)for(var t of Pp(e))r8.call(e,t)&&au(n,t,e[t]);return n},nt=(n,e,t)=>au(n,"symbol"!=typeof e?e+"":e,t);class i8 extends xg{constructor(e){var t;super(e),t=this,nt(this,"protocol","wc"),nt(this,"version",2),nt(this,"core"),nt(this,"logger"),nt(this,"events",new Y.EventEmitter),nt(this,"provider"),nt(this,"messages"),nt(this,"subscriber"),nt(this,"publisher"),nt(this,"name","relayer"),nt(this,"transportExplicitlyClosed",!1),nt(this,"initialized",!1),nt(this,"connectionAttemptInProgress",!1),nt(this,"relayUrl"),nt(this,"projectId"),nt(this,"packageName"),nt(this,"bundleId"),nt(this,"hasExperiencedNetworkDisruption",!1),nt(this,"pingTimeout"),nt(this,"heartBeatTimeout",(0,m.toMiliseconds)(m.THIRTY_SECONDS+m.FIVE_SECONDS)),nt(this,"reconnectTimeout"),nt(this,"connectPromise"),nt(this,"reconnectInProgress",!1),nt(this,"requestsInFlight",[]),nt(this,"connectTimeout",(0,m.toMiliseconds)(15*m.ONE_SECOND)),nt(this,"request",function(){var r=(0,h.A)(function*(i){var s,o;t.logger.debug("Publishing Request Payload");const a=i.id||Mr().toString();yield t.toEstablishConnection();try{t.logger.trace({id:a,method:i.method,topic:null==(s=i.params)?void 0:s.topic},"relayer.request - publishing...");const c=`${a}:${(null==(o=i.params)?void 0:o.tag)||""}`;t.requestsInFlight.push(c);const u=yield t.provider.request(i);return t.requestsInFlight=t.requestsInFlight.filter(l=>l!==c),u}catch(c){throw t.logger.debug(`Failed to Publish Request: ${a}`),c}});return function(i){return r.apply(this,arguments)}}()),nt(this,"resetPingTimeout",()=>{yo()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(o=null==(s=null==(i=null==(r=this.provider)?void 0:r.connection)?void 0:i.socket)?void 0:s.terminate)||o.call(s)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),nt(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),nt(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1f6dc}"),this.startPingTimeout(),this.events.emit("relayer_connect")}),nt(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1f6d1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),nt(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit("relayer_error",r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),nt(this,"registerProviderListeners",()=>{this.provider.on("payload",this.onPayloadHandler),this.provider.on("connect",this.onConnectHandler),this.provider.on("disconnect",this.onDisconnectHandler),this.provider.on("error",this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?Xt(e.logger,this.name):Qn()(na({level:e.logger||"error"})),this.messages=new MA(this.logger,e.core),this.subscriber=new e8(this,this.logger),this.publisher=new VA(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||op,function q1(){return Er()&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"&&"android"===(null==global?void 0:global.Platform.OS)}()?this.packageName=Hd():function K1(){return Er()&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"&&"ios"===(null==global?void 0:global.Platform.OS)}()&&(this.bundleId=Hd()),this.provider={}}init(){var e=this;return(0,h.A)(function*(){e.logger.trace("Initialized"),e.registerEventListeners(),yield Promise.all([e.messages.init(),e.subscriber.init()]),e.initialized=!0,e.transportOpen().catch(t=>e.logger.warn(t,t?.message))})()}get context(){return an(this.logger)}get connected(){var e,t,r;return 1===(null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.readyState)||!1}get connecting(){var e,t,r;return 0===(null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.readyState)||void 0!==this.connectPromise||!1}publish(e,t,r){var i=this;return(0,h.A)(function*(){i.isInitialized(),yield i.publisher.publish(e,t,r),yield i.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:pt.relay},"outbound")})()}publishCustom(e){var t=this;return(0,h.A)(function*(){t.isInitialized(),yield t.publisher.publishCustom(e)})()}subscribe(e,t){var r=this;return(0,h.A)(function*(){var i,s,o;r.isInitialized(),(null==t||!t.transportType||"relay"===t?.transportType)&&(yield r.toEstablishConnection());const a=typeof(null==(i=t?.internal)?void 0:i.throwOnFailedPublish)>"u"||(null==(s=t?.internal)?void 0:s.throwOnFailedPublish);let u,c=(null==(o=r.subscriber.topicMap.get(e))?void 0:o[0])||"";const l=d=>{d.topic===e&&(r.subscriber.off(vn_created,l),u())};return yield Promise.all([new Promise(d=>{u=d,r.subscriber.on(vn_created,l)}),new Promise(function(){var d=(0,h.A)(function*(f,p){c=(yield r.subscriber.subscribe(e,Tp({internal:{throwOnFailedPublish:a}},t)).catch(g=>{a&&p(g)}))||c,f()});return function(f,p){return d.apply(this,arguments)}}())]),c})()}unsubscribe(e,t){var r=this;return(0,h.A)(function*(){r.isInitialized(),yield r.subscriber.unsubscribe(e,t)})()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}transportDisconnect(){var e=this;return(0,h.A)(function*(){e.provider.disconnect&&(e.hasExperiencedNetworkDisruption||e.connected)?yield $n(e.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>e.onProviderDisconnect()):e.onProviderDisconnect()})()}transportClose(){var e=this;return(0,h.A)(function*(){e.transportExplicitlyClosed=!0,yield e.transportDisconnect()})()}transportOpen(e){var t=this;return(0,h.A)(function*(){if(t.subscriber.hasAnyTopics){if(t.connectPromise?(t.logger.debug({},"Waiting for existing connection attempt to resolve..."),yield t.connectPromise,t.logger.debug({},"Existing connection attempt resolved")):(t.connectPromise=new Promise(function(){var r=(0,h.A)(function*(i,s){yield t.connect(e).then(i).catch(s).finally(()=>{t.connectPromise=void 0})});return function(i,s){return r.apply(this,arguments)}}()),yield t.connectPromise),!t.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${t.relayUrl}`)}else t.logger.info("Starting WS connection skipped because the client has no topics to work with.")})()}restartTransport(e){var t=this;return(0,h.A)(function*(){t.logger.debug({},"Restarting transport..."),!t.connectionAttemptInProgress&&(t.relayUrl=e||t.relayUrl,yield t.confirmOnlineStateOrThrow(),yield t.transportClose(),yield t.transportOpen())})()}confirmOnlineStateOrThrow(){return(0,h.A)(function*(){if(!(yield Kh()))throw new Error("No internet connection detected. Please restart your network and try again.")})()}handleBatchMessageEvents(e){var t=this;return(0,h.A)(function*(){if(0===e?.length)return void t.logger.trace("Batch message events is empty. Ignoring...");const r=e.sort((i,s)=>i.publishedAt-s.publishedAt);t.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{yield t.onMessageEvent(i)}catch(s){t.logger.warn(s,"Error while processing batch message event: "+s?.message)}t.logger.trace(`Batch of ${r.length} message events processed`)})()}onLinkMessageEvent(e,t){var r=this;return(0,h.A)(function*(){const{topic:i}=e;if(!t.sessionExists){const o={topic:i,expiry:Ct(m.FIVE_MINUTES),relay:{protocol:"irn"},active:!1};yield r.core.pairing.pairings.set(i,o)}r.events.emit("relayer_message",e),yield r.recordMessageEvent(e,"inbound")})()}connect(e){var t=this;return(0,h.A)(function*(){yield t.confirmOnlineStateOrThrow(),e&&e!==t.relayUrl&&(t.relayUrl=e,yield t.transportDisconnect()),t.connectionAttemptInProgress=!0,t.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(t.transportExplicitlyClosed)break;t.logger.debug({},`Connecting to ${t.relayUrl}, attempt: ${r}...`),yield t.createProvider(),yield new Promise(function(){var i=(0,h.A)(function*(s,o){const a=()=>{o(new Error("Connection interrupted while trying to connect"))};t.provider.once("disconnect",a),yield $n(new Promise((c,u)=>{t.provider.connect().then(c).catch(u)}),t.connectTimeout,`Socket stalled when trying to connect to ${t.relayUrl}`).catch(c=>{o(c)}).finally(()=>{t.provider.off("disconnect",a),clearTimeout(t.reconnectTimeout)}),yield new Promise(function(){var c=(0,h.A)(function*(u,l){const d=()=>{o(new Error("Connection interrupted while trying to subscribe"))};t.provider.once("disconnect",d),yield t.subscriber.start().then(u).catch(l).finally(()=>{t.provider.off("disconnect",d)})});return function(u,l){return c.apply(this,arguments)}}()),t.hasExperiencedNetworkDisruption=!1,s()});return function(s,o){return i.apply(this,arguments)}}())}catch(i){yield t.subscriber.stop(),t.logger.warn({},i.message),t.hasExperiencedNetworkDisruption=!0}finally{t.connectionAttemptInProgress=!1}if(t.connected){t.logger.debug({},`Connected to ${t.relayUrl} successfully on attempt: ${r}`);break}yield new Promise(i=>setTimeout(i,(0,m.toMiliseconds)(1*r))),r++}})()}startPingTimeout(){var e,t,r,i,s;if(yo())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(s=null==(i=null==(r=this.provider)?void 0:r.connection)?void 0:i.socket)||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}createProvider(){var e=this;return(0,h.A)(function*(){e.provider.connection&&e.unregisterProviderListeners();const t=yield e.core.crypto.signJWT(e.relayUrl);e.provider=new bE(new EE(function Y1({protocol:n,version:e,relayUrl:t,sdkVersion:r,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=t.split("?"),l=Gd(n,e,r),f=function V1(n,e){const t=new URLSearchParams(n);return Object.entries(e).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{null!=i&&t.set(r,String(i))}),t.toString()}(u[1]||"",{auth:i,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0});return u[0]+"?"+f}({sdkVersion:Qc,protocol:e.protocol,version:e.version,relayUrl:e.relayUrl,projectId:e.projectId,auth:t,useOnCloseEvent:!0,bundleId:e.bundleId,packageName:e.packageName}))),e.registerProviderListeners()})()}recordMessageEvent(e,t){var r=this;return(0,h.A)(function*(){const{topic:i,message:s}=e;yield r.messages.set(i,s,t)})()}shouldIgnoreMessageEvent(e){var t=this;return(0,h.A)(function*(){const{topic:r,message:i}=e;if(!i||0===i.length)return t.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!(yield t.subscriber.isKnownTopic(r)))return t.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const s=t.messages.has(r,i);return s&&t.logger.warn(`Ignoring duplicate message: ${i}`),s})()}onProviderPayload(e){var t=this;return(0,h.A)(function*(){if(t.logger.debug("Incoming Relay Payload"),t.logger.trace({type:"payload",direction:"incoming",payload:e}),Xc(e)){if(!e.method.endsWith("_subscription"))return;const r=e.params,{topic:i,message:s,publishedAt:o,attestation:a}=r.data,c={topic:i,message:s,publishedAt:o,transportType:pt.relay,attestation:a};t.logger.debug("Emitting Relayer Payload"),t.logger.trace(Tp({type:"event",event:r.id},c)),t.events.emit(r.id,c),yield t.acknowledgePayload(e),yield t.onMessageEvent(c)}else zo(e)&&t.events.emit("relayer_message_ack",e)})()}onMessageEvent(e){var t=this;return(0,h.A)(function*(){(yield t.shouldIgnoreMessageEvent(e))||(yield t.recordMessageEvent(e,"inbound"),t.events.emit("relayer_message",e))})()}acknowledgePayload(e){var t=this;return(0,h.A)(function*(){const r=$o(e.id,!0);yield t.provider.connection.send(r)})()}unregisterProviderListeners(){this.provider.off("payload",this.onPayloadHandler),this.provider.off("connect",this.onConnectHandler),this.provider.off("disconnect",this.onDisconnectHandler),this.provider.off("error",this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}registerEventListeners(){var e=this;return(0,h.A)(function*(){let t=yield Kh();(function H2(n){switch(bi()){case"browser":!function W2(n){!Er()&&mi()&&(window.addEventListener("online",()=>n(!0)),window.addEventListener("offline",()=>n(!1)))}(n);break;case"react-native":!function G2(n){Er()&&typeof global<"u"&&null!=global&&global.NetInfo&&global?.NetInfo.addEventListener(e=>n(e?.isConnected))}(n)}})(function(){var r=(0,h.A)(function*(i){t!==i&&(t=i,i?yield e.transportOpen().catch(s=>e.logger.error(s,s?.message)):(e.hasExperiencedNetworkDisruption=!0,yield e.transportDisconnect(),e.transportExplicitlyClosed=!1))});return function(i){return r.apply(this,arguments)}}()),e.core.heartbeat.on(fe_pulse,(0,h.A)(function*(){if(!e.transportExplicitlyClosed&&!e.connected&&function Y2(){var n;return!mi()||!(0,ir.getDocument)()||"visible"===(null==(n=(0,ir.getDocument)())?void 0:n.visibilityState)}())try{yield e.confirmOnlineStateOrThrow(),yield e.transportOpen()}catch(r){e.logger.warn(r,r?.message)}}))})()}onProviderDisconnect(){var e=this;return(0,h.A)(function*(){clearTimeout(e.pingTimeout),e.events.emit("relayer_disconnect"),e.connectionAttemptInProgress=!1,!e.reconnectInProgress&&(e.reconnectInProgress=!0,yield e.subscriber.stop(),e.subscriber.hasAnyTopics&&(e.transportExplicitlyClosed||(e.reconnectTimeout=setTimeout((0,h.A)(function*(){yield e.transportOpen().catch(t=>e.logger.error(t,t?.message)),e.reconnectTimeout=void 0,e.reconnectInProgress=!1}),(0,m.toMiliseconds)(.1)))))})()}isInitialized(){if(!this.initialized){const{message:e}=ge("NOT_INITIALIZED",this.name);throw new Error(e)}}toEstablishConnection(){var e=this;return(0,h.A)(function*(){if(yield e.confirmOnlineStateOrThrow(),!e.connected){if(e.connectPromise)return void(yield e.connectPromise);yield e.connect()}})()}}function Bp(n){return Object.getOwnPropertySymbols(n).filter(e=>Object.prototype.propertyIsEnumerable.call(n,e))}function Rp(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":Object.prototype.toString.call(n)}const Fp="[object Arguments]",cu="[object Object]";function P8(){}function Up(n){if(!n||"object"!=typeof n)return!1;const e=Object.getPrototypeOf(n);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&"[object Object]"===Object.prototype.toString.call(n)}function As(n,e,t,r,i,s,o){const a=o(n,e,t,r,i,s);if(void 0!==a)return a;if(typeof n==typeof e)switch(typeof n){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return n===e;case"number":return n===e||Object.is(n,e);case"object":return Is(n,e,s,o)}return Is(n,e,s,o)}function Is(n,e,t,r){if(Object.is(n,e))return!0;let i=Rp(n),s=Rp(e);if(i===Fp&&(i=cu),s===Fp&&(s=cu),i!==s)return!1;switch(i){case"[object String]":return n.toString()===e.toString();case"[object Number]":return function s8(n,e){return n===e||Number.isNaN(n)&&Number.isNaN(e)}(n.valueOf(),e.valueOf());case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(n.valueOf(),e.valueOf());case"[object RegExp]":return n.source===e.source&&n.flags===e.flags;case"[object Function]":return n===e}const o=(t=t??new Map).get(n),a=t.get(e);if(null!=o&&null!=a)return o===e;t.set(n,e),t.set(e,n);try{switch(i){case"[object Map]":if(n.size!==e.size)return!1;for(const[c,u]of n.entries())if(!e.has(c)||!As(u,e.get(c),c,n,e,t,r))return!1;return!0;case"[object Set]":{if(n.size!==e.size)return!1;const c=Array.from(n.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const d=c[l],f=u.findIndex(p=>As(d,p,void 0,n,e,t,r));if(-1===f)return!1;u.splice(f,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if(typeof Buffer<"u"&&Buffer.isBuffer(n)!==Buffer.isBuffer(e)||n.length!==e.length)return!1;for(let c=0;c<n.length;c++)if(!As(n[c],e[c],c,n,e,t,r))return!1;return!0;case"[object ArrayBuffer]":return n.byteLength===e.byteLength&&Is(new Uint8Array(n),new Uint8Array(e),t,r);case"[object DataView]":return n.byteLength===e.byteLength&&n.byteOffset===e.byteOffset&&Is(new Uint8Array(n),new Uint8Array(e),t,r);case"[object Error]":return n.name===e.name&&n.message===e.message;case cu:{if(!(Is(n.constructor,e.constructor,t,r)||Up(n)&&Up(e)))return!1;const c=[...Object.keys(n),...Bp(n)],u=[...Object.keys(e),...Bp(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){const d=c[l],f=n[d];if(!Object.hasOwn(e,d))return!1;if(!As(f,e[d],d,n,e,t,r))return!1}return!0}default:return!1}}finally{t.delete(n),t.delete(e)}}var R8=Object.defineProperty,Np=Object.getOwnPropertySymbols,F8=Object.prototype.hasOwnProperty,U8=Object.prototype.propertyIsEnumerable,uu=(n,e,t)=>e in n?R8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,kp=(n,e)=>{for(var t in e||(e={}))F8.call(e,t)&&uu(n,t,e[t]);if(Np)for(var t of Np(e))U8.call(e,t)&&uu(n,t,e[t]);return n},_n=(n,e,t)=>uu(n,"symbol"!=typeof e?e+"":e,t);class oi extends Eg{constructor(e,t,r,i=Vn,s=void 0){var o;super(e,t,r,i),o=this,this.core=e,this.logger=t,this.name=r,_n(this,"map",new Map),_n(this,"version","0.3"),_n(this,"cached",[]),_n(this,"initialized",!1),_n(this,"getKey"),_n(this,"storagePrefix",Vn),_n(this,"recentlyDeleted",[]),_n(this,"recentlyDeletedLimit",200),_n(this,"init",(0,h.A)(function*(){o.initialized||(o.logger.trace("Initialized"),yield o.restore(),o.cached.forEach(a=>{o.getKey&&null!==a&&!Tt(a)?o.map.set(o.getKey(a),a):function E2(n){var e;return null==(e=n?.proposer)?void 0:e.publicKey}(a)?o.map.set(a.id,a):function A2(n){return n?.topic}(a)&&o.map.set(a.topic,a)}),o.cached=[],o.initialized=!0)})),_n(this,"set",function(){var a=(0,h.A)(function*(c,u){o.isInitialized(),o.map.has(c)?yield o.update(c,u):(o.logger.debug("Setting value"),o.logger.trace({type:"method",method:"set",key:c,value:u}),o.map.set(c,u),yield o.persist())});return function(c,u){return a.apply(this,arguments)}}()),_n(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),_n(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(c=>Object.keys(a).every(u=>function B8(n,e){return function T8(n,e,t){return As(n,e,void 0,void 0,void 0,void 0,t)}(n,e,P8)}(c[u],a[u]))):this.values)),_n(this,"update",function(){var a=(0,h.A)(function*(c,u){o.isInitialized(),o.logger.debug("Updating value"),o.logger.trace({type:"method",method:"update",key:c,update:u});const l=kp(kp({},o.getData(c)),u);o.map.set(c,l),yield o.persist()});return function(c,u){return a.apply(this,arguments)}}()),_n(this,"delete",function(){var a=(0,h.A)(function*(c,u){o.isInitialized(),o.map.has(c)&&(o.logger.debug("Deleting value"),o.logger.trace({type:"method",method:"delete",key:c,reason:u}),o.map.delete(c),o.addToRecentlyDeleted(c),yield o.persist())});return function(c,u){return a.apply(this,arguments)}}()),this.logger=Xt(t,this.name),this.storagePrefix=i,this.getKey=s}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}setDataStore(e){var t=this;return(0,h.A)(function*(){yield t.core.storage.setItem(t.storageKey,e)})()}getDataStore(){var e=this;return(0,h.A)(function*(){return yield e.core.storage.getItem(e.storageKey)})()}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:i}=ge("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:r}=ge("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}persist(){var e=this;return(0,h.A)(function*(){yield e.setDataStore(e.values)})()}restore(){var e=this;return(0,h.A)(function*(){try{const t=yield e.getDataStore();if(typeof t>"u"||!t.length)return;if(e.map.size){const{message:r}=ge("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(r),new Error(r)}e.cached=t,e.logger.debug(`Successfully Restored value for ${e.name}`),e.logger.trace({type:"method",method:"restore",value:e.values})}catch(t){e.logger.debug(`Failed to Restore value for ${e.name}`),e.logger.error(t)}})()}isInitialized(){if(!this.initialized){const{message:e}=ge("NOT_INITIALIZED",this.name);throw new Error(e)}}}var N8=Object.defineProperty,Xe=(n,e,t)=>((n,e,t)=>e in n?N8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class L8{constructor(e,t){var r=this;this.core=e,this.logger=t,Xe(this,"name","pairing"),Xe(this,"version","0.3"),Xe(this,"events",new(M())),Xe(this,"pairings"),Xe(this,"initialized",!1),Xe(this,"storagePrefix",Vn),Xe(this,"ignoredPayloadTypes",[1]),Xe(this,"registeredMethods",[]),Xe(this,"init",(0,h.A)(function*(){r.initialized||(yield r.pairings.init(),yield r.cleanup(),r.registerRelayerEvents(),r.registerExpirerEvents(),r.initialized=!0,r.logger.trace("Initialized"))})),Xe(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),Xe(this,"create",function(){var i=(0,h.A)(function*(s){r.isInitialized();const o=qc(),a=yield r.core.crypto.setSymKey(o),c=Ct(m.FIVE_MINUTES),u={protocol:"irn"},l={topic:a,expiry:c,relay:u,active:!1,methods:s?.methods},d=Fh({protocol:r.core.protocol,version:r.core.version,topic:a,symKey:o,relay:u,expiryTimestamp:c,methods:s?.methods});return r.events.emit("pairing_create",l),r.core.expirer.set(a,c),yield r.pairings.set(a,l),yield r.core.relayer.subscribe(a,{transportType:s?.transportType,internal:s?.internal}),{topic:a,uri:d}});return function(s){return i.apply(this,arguments)}}()),Xe(this,"pair",function(){var i=(0,h.A)(function*(s){r.isInitialized();const o=r.core.eventClient.createEvent({properties:{topic:s?.uri,trace:["pairing_started"]}});r.isValidPair(s,o);const{topic:a,symKey:c,relay:u,expiryTimestamp:l,methods:d}=Rh(s.uri);let f;if(o.props.properties.topic=a,o.addTrace("pairing_uri_validation_success"),o.addTrace("pairing_uri_not_expired"),r.pairings.keys.includes(a)){if(f=r.pairings.get(a),o.addTrace("existing_pairing"),f.active)throw o.setError("active_pairing_already_exists"),new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);o.addTrace("pairing_not_expired")}const p=l||Ct(m.FIVE_MINUTES),g={topic:a,relay:u,expiry:p,active:!1,methods:d};r.core.expirer.set(a,p),yield r.pairings.set(a,g),o.addTrace("store_new_pairing"),s.activatePairing&&(yield r.activate({topic:a})),r.events.emit("pairing_create",g),o.addTrace("emit_inactive_pairing"),r.core.crypto.keychain.has(a)||(yield r.core.crypto.setSymKey(c,a)),o.addTrace("subscribing_pairing_topic");try{yield r.core.relayer.confirmOnlineStateOrThrow()}catch{o.setError("no_internet_connection")}try{yield r.core.relayer.subscribe(a,{relay:u})}catch(y){throw o.setError("subscribe_pairing_topic_failure"),y}return o.addTrace("subscribe_pairing_topic_success"),g});return function(s){return i.apply(this,arguments)}}()),Xe(this,"activate",function(){var i=(0,h.A)(function*({topic:s}){r.isInitialized();const o=Ct(m.FIVE_MINUTES);r.core.expirer.set(s,o),yield r.pairings.update(s,{active:!0,expiry:o})});return function(s){return i.apply(this,arguments)}}()),Xe(this,"ping",function(){var i=(0,h.A)(function*(s){r.isInitialized(),yield r.isValidPing(s),r.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:o}=s;if(r.pairings.keys.includes(o)){const a=yield r.sendRequest(o,"wc_pairingPing",{}),{done:c,resolve:u,reject:l}=Zr();r.events.once(ot("pairing_ping",a),({error:d})=>{d?l(d):u()}),yield c()}});return function(s){return i.apply(this,arguments)}}()),Xe(this,"updateExpiry",function(){var i=(0,h.A)(function*({topic:s,expiry:o}){r.isInitialized(),yield r.pairings.update(s,{expiry:o})});return function(s){return i.apply(this,arguments)}}()),Xe(this,"updateMetadata",function(){var i=(0,h.A)(function*({topic:s,metadata:o}){r.isInitialized(),yield r.pairings.update(s,{peerMetadata:o})});return function(s){return i.apply(this,arguments)}}()),Xe(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),Xe(this,"disconnect",function(){var i=(0,h.A)(function*(s){r.isInitialized(),yield r.isValidDisconnect(s);const{topic:o}=s;r.pairings.keys.includes(o)&&(yield r.sendRequest(o,"wc_pairingDelete",_t("USER_DISCONNECTED")),yield r.deletePairing(o))});return function(s){return i.apply(this,arguments)}}()),Xe(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:o,expiry:a,methods:c}=i,u=this.core.crypto.keychain.get(s);return Fh({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:u,relay:o,expiryTimestamp:a,methods:c})}),Xe(this,"sendRequest",function(){var i=(0,h.A)(function*(s,o,a){const c=pr(o,a),u=yield r.core.crypto.encode(s,c),l=ms[o].req;return r.core.history.set(s,c),r.core.relayer.publish(s,u,l),c.id});return function(s,o,a){return i.apply(this,arguments)}}()),Xe(this,"sendResult",function(){var i=(0,h.A)(function*(s,o,a){const c=$o(s,a),u=yield r.core.crypto.encode(o,c),l=(yield r.core.history.get(o,s)).request.method,d=ms[l].res;yield r.core.relayer.publish(o,u,d),yield r.core.history.resolve(c)});return function(s,o,a){return i.apply(this,arguments)}}()),Xe(this,"sendError",function(){var i=(0,h.A)(function*(s,o,a){const c=Zc(s,a),u=yield r.core.crypto.encode(o,c),l=(yield r.core.history.get(o,s)).request.method,d=ms[l]?ms[l].res:ms.unregistered_method.res;yield r.core.relayer.publish(o,u,d),yield r.core.history.resolve(c)});return function(s,o,a){return i.apply(this,arguments)}}()),Xe(this,"deletePairing",function(){var i=(0,h.A)(function*(s,o){yield r.core.relayer.unsubscribe(s),yield Promise.all([r.pairings.delete(s,_t("USER_DISCONNECTED")),r.core.crypto.deleteSymKey(s),o?Promise.resolve():r.core.expirer.del(s)])});return function(s,o){return i.apply(this,arguments)}}()),Xe(this,"cleanup",(0,h.A)(function*(){const i=r.pairings.getAll().filter(s=>Ar(s.expiry));yield Promise.all(i.map(s=>r.deletePairing(s.topic)))})),Xe(this,"onRelayEventRequest",function(){var i=(0,h.A)(function*(s){const{topic:o,payload:a}=s;switch(a.method){case"wc_pairingPing":return yield r.onPairingPingRequest(o,a);case"wc_pairingDelete":return yield r.onPairingDeleteRequest(o,a);default:return yield r.onUnknownRpcMethodRequest(o,a)}});return function(s){return i.apply(this,arguments)}}()),Xe(this,"onRelayEventResponse",function(){var i=(0,h.A)(function*(s){const{topic:o,payload:a}=s,c=(yield r.core.history.get(o,a.id)).request.method;return"wc_pairingPing"===c?r.onPairingPingResponse(o,a):r.onUnknownRpcMethodResponse(c)});return function(s){return i.apply(this,arguments)}}()),Xe(this,"onPairingPingRequest",function(){var i=(0,h.A)(function*(s,o){const{id:a}=o;try{r.isValidPing({topic:s}),yield r.sendResult(a,s,!0),r.events.emit("pairing_ping",{id:a,topic:s})}catch(c){yield r.sendError(a,s,c),r.logger.error(c)}});return function(s,o){return i.apply(this,arguments)}}()),Xe(this,"onPairingPingResponse",(i,s)=>{const{id:o}=s;setTimeout(()=>{Kn(s)?this.events.emit(ot("pairing_ping",o),{}):Dn(s)&&this.events.emit(ot("pairing_ping",o),{error:s.error})},500)}),Xe(this,"onPairingDeleteRequest",function(){var i=(0,h.A)(function*(s,o){const{id:a}=o;try{r.isValidDisconnect({topic:s}),yield r.deletePairing(s),r.events.emit("pairing_delete",{id:a,topic:s})}catch(c){yield r.sendError(a,s,c),r.logger.error(c)}});return function(s,o){return i.apply(this,arguments)}}()),Xe(this,"onUnknownRpcMethodRequest",function(){var i=(0,h.A)(function*(s,o){const{id:a,method:c}=o;try{if(r.registeredMethods.includes(c))return;const u=_t("WC_METHOD_UNSUPPORTED",c);yield r.sendError(a,s,u),r.logger.error(u)}catch(u){yield r.sendError(a,s,u),r.logger.error(u)}});return function(s,o){return i.apply(this,arguments)}}()),Xe(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(_t("WC_METHOD_UNSUPPORTED",i))}),Xe(this,"isValidPair",(i,s)=>{var o;if(!yn(i)){const{message:c}=ge("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError("malformed_pairing_uri"),new Error(c)}if(!function x2(n){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(Et(n,!1))return!!e(n)||e(ef(n))}catch{}return!1}(i.uri)){const{message:c}=ge("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError("malformed_pairing_uri"),new Error(c)}const a=Rh(i?.uri);if(null==(o=a?.relay)||!o.protocol){const{message:c}=ge("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError("malformed_pairing_uri"),new Error(c)}if(null==a||!a.symKey){const{message:c}=ge("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError("malformed_pairing_uri"),new Error(c)}if(null!=a&&a.expiryTimestamp&&(0,m.toMiliseconds)(a?.expiryTimestamp)<Date.now()){s.setError("pairing_expired");const{message:c}=ge("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(c)}}),Xe(this,"isValidPing",function(){var i=(0,h.A)(function*(s){if(!yn(s)){const{message:a}=ge("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(a)}const{topic:o}=s;yield r.isValidPairingTopic(o)});return function(s){return i.apply(this,arguments)}}()),Xe(this,"isValidDisconnect",function(){var i=(0,h.A)(function*(s){if(!yn(s)){const{message:a}=ge("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(a)}const{topic:o}=s;yield r.isValidPairingTopic(o)});return function(s){return i.apply(this,arguments)}}()),Xe(this,"isValidPairingTopic",function(){var i=(0,h.A)(function*(s){if(!Et(s,!1)){const{message:o}=ge("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(o)}if(!r.pairings.keys.includes(s)){const{message:o}=ge("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(o)}if(Ar(r.pairings.get(s).expiry)){yield r.deletePairing(s);const{message:o}=ge("EXPIRED",`pairing topic: ${s}`);throw new Error(o)}});return function(s){return i.apply(this,arguments)}}()),this.core=e,this.logger=Xt(t,this.name),this.pairings=new oi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return an(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=ge("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){var e=this;this.core.relayer.on("relayer_message",function(){var t=(0,h.A)(function*(r){const{topic:i,message:s,transportType:o}=r;if(e.pairings.keys.includes(i)&&o!==pt.link_mode&&!e.ignoredPayloadTypes.includes(e.core.crypto.getPayloadType(s)))try{const a=yield e.core.crypto.decode(i,s);Xc(a)?(e.core.history.set(i,a),yield e.onRelayEventRequest({topic:i,payload:a})):zo(a)&&(yield e.core.history.resolve(a),yield e.onRelayEventResponse({topic:i,payload:a}),e.core.history.delete(i,a.id)),yield e.core.relayer.messages.ack(i,s)}catch(a){e.logger.error(a)}});return function(r){return t.apply(this,arguments)}}())}registerExpirerEvents(){var e=this;this.core.expirer.on(Cn_expired,function(){var t=(0,h.A)(function*(r){const{topic:i}=Jd(r.target);i&&e.pairings.keys.includes(i)&&(yield e.deletePairing(i,!0),e.events.emit("pairing_expire",{topic:i}))});return function(r){return t.apply(this,arguments)}}())}}var M8=Object.defineProperty,zt=(n,e,t)=>((n,e,t)=>e in n?M8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class $8 extends bg{constructor(e,t){var r;super(e,t),r=this,this.core=e,this.logger=t,zt(this,"records",new Map),zt(this,"events",new Y.EventEmitter),zt(this,"name","history"),zt(this,"version","0.3"),zt(this,"cached",[]),zt(this,"initialized",!1),zt(this,"storagePrefix",Vn),zt(this,"init",(0,h.A)(function*(){r.initialized||(r.logger.trace("Initialized"),yield r.restore(),r.cached.forEach(i=>r.records.set(i.id,i)),r.cached=[],r.registerEventListeners(),r.initialized=!0)})),zt(this,"set",(i,s,o)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:o}),this.records.has(s.id))return;const a={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:o,expiry:Ct(m.THIRTY_DAYS)};this.records.set(a.id,a),this.persist(),this.events.emit("history_created",a)}),zt(this,"resolve",function(){var i=(0,h.A)(function*(s){if(r.isInitialized(),r.logger.debug("Updating JSON-RPC response history record"),r.logger.trace({type:"method",method:"update",response:s}),!r.records.has(s.id))return;const o=yield r.getRecord(s.id);typeof o.response>"u"&&(o.response=Dn(s)?{error:s.error}:{result:s.result},r.records.set(o.id,o),r.persist(),r.events.emit("history_updated",o))});return function(s){return i.apply(this,arguments)}}()),zt(this,"get",function(){var i=(0,h.A)(function*(s,o){return r.isInitialized(),r.logger.debug("Getting record"),r.logger.trace({type:"method",method:"get",topic:s,id:o}),yield r.getRecord(o)});return function(s,o){return i.apply(this,arguments)}}()),zt(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(o=>{if(o.topic===i){if(typeof s<"u"&&o.id!==s)return;this.records.delete(o.id),this.events.emit("history_deleted",o)}}),this.persist()}),zt(this,"exists",function(){var i=(0,h.A)(function*(s,o){return r.isInitialized(),!!r.records.has(o)&&(yield r.getRecord(o)).topic===s});return function(s,o){return i.apply(this,arguments)}}()),zt(this,"on",(i,s)=>{this.events.on(i,s)}),zt(this,"once",(i,s)=>{this.events.once(i,s)}),zt(this,"off",(i,s)=>{this.events.off(i,s)}),zt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Xt(t,this.name)}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const r={topic:t.topic,request:pr(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}setJsonRpcRecords(e){var t=this;return(0,h.A)(function*(){yield t.core.storage.setItem(t.storageKey,e)})()}getJsonRpcRecords(){var e=this;return(0,h.A)(function*(){return yield e.core.storage.getItem(e.storageKey)})()}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:r}=ge("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}persist(){var e=this;return(0,h.A)(function*(){yield e.setJsonRpcRecords(e.values),e.events.emit("history_sync")})()}restore(){var e=this;return(0,h.A)(function*(){try{const t=yield e.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(e.records.size){const{message:r}=ge("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(r),new Error(r)}e.cached=t,e.logger.debug(`Successfully Restored records for ${e.name}`),e.logger.trace({type:"method",method:"restore",records:e.values})}catch(t){e.logger.debug(`Failed to Restore records for ${e.name}`),e.logger.error(t)}})()}registerEventListeners(){this.events.on("history_created",e=>{const t="history_created";this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on("history_updated",e=>{const t="history_updated";this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on("history_deleted",e=>{const t="history_deleted";this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(fe_pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,m.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit("history_deleted",t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=ge("NOT_INITIALIZED",this.name);throw new Error(e)}}}var z8=Object.defineProperty,Yt=(n,e,t)=>((n,e,t)=>e in n?z8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class K8 extends Og{constructor(e,t){var r;super(e,t),r=this,this.core=e,this.logger=t,Yt(this,"expirations",new Map),Yt(this,"events",new Y.EventEmitter),Yt(this,"name","expirer"),Yt(this,"version","0.3"),Yt(this,"cached",[]),Yt(this,"initialized",!1),Yt(this,"storagePrefix",Vn),Yt(this,"init",(0,h.A)(function*(){r.initialized||(r.logger.trace("Initialized"),yield r.restore(),r.cached.forEach(i=>r.expirations.set(i.target,i)),r.cached=[],r.registerEventListeners(),r.initialized=!0)})),Yt(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Yt(this,"set",(i,s)=>{this.isInitialized();const o=this.formatTarget(i),a={target:o,expiry:s};this.expirations.set(o,a),this.checkExpiry(o,a),this.events.emit("expirer_created",{target:o,expiration:a})}),Yt(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),Yt(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),o=this.getExpiration(s);this.expirations.delete(s),this.events.emit("expirer_deleted",{target:s,expiration:o})}}),Yt(this,"on",(i,s)=>{this.events.on(i,s)}),Yt(this,"once",(i,s)=>{this.events.once(i,s)}),Yt(this,"off",(i,s)=>{this.events.off(i,s)}),Yt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Xt(t,this.name)}get context(){return an(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return function Q1(n){return Yd("topic",n)}(e);if("number"==typeof e)return function ew(n){return Yd("id",n)}(e);const{message:t}=ge("UNKNOWN_TYPE","Target type: "+typeof e);throw new Error(t)}setExpirations(e){var t=this;return(0,h.A)(function*(){yield t.core.storage.setItem(t.storageKey,e)})()}getExpirations(){var e=this;return(0,h.A)(function*(){return yield e.core.storage.getItem(e.storageKey)})()}persist(){var e=this;return(0,h.A)(function*(){yield e.setExpirations(e.values),e.events.emit("expirer_sync")})()}restore(){var e=this;return(0,h.A)(function*(){try{const t=yield e.getExpirations();if(typeof t>"u"||!t.length)return;if(e.expirations.size){const{message:r}=ge("RESTORE_WILL_OVERRIDE",e.name);throw e.logger.error(r),new Error(r)}e.cached=t,e.logger.debug(`Successfully Restored expirations for ${e.name}`),e.logger.trace({type:"method",method:"restore",expirations:e.values})}catch(t){e.logger.debug(`Failed to Restore expirations for ${e.name}`),e.logger.error(t)}})()}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:r}=ge("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return t}checkExpiry(e,t){const{expiry:r}=t;(0,m.toMiliseconds)(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Cn_expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(fe_pulse,()=>this.checkExpirations()),this.events.on("expirer_created",e=>{const t="expirer_created";this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Cn_expired,e=>{const t=Cn_expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on("expirer_deleted",e=>{const t="expirer_deleted";this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=ge("NOT_INITIALIZED",this.name);throw new Error(e)}}}var V8=Object.defineProperty,At=(n,e,t)=>((n,e,t)=>e in n?V8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class W8 extends Cg{constructor(e,t,r){var i;super(e,t,r),i=this,this.core=e,this.logger=t,this.store=r,At(this,"name","verify-api"),At(this,"abortController"),At(this,"isDevEnv"),At(this,"verifyUrlV3",JE),At(this,"storagePrefix",Vn),At(this,"version",2),At(this,"publicKey"),At(this,"fetchPromise"),At(this,"init",(0,h.A)(function*(){var s;i.isDevEnv||(i.publicKey=yield i.store.getItem(i.storeKey),i.publicKey&&(0,m.toMiliseconds)(null==(s=i.publicKey)?void 0:s.expiresAt)<Date.now()&&(i.logger.debug("verify v2 public key expired"),yield i.removePublicKey()))})),At(this,"register",function(){var s=(0,h.A)(function*(o){if(!mi()||i.isDevEnv)return;const a=window.location.origin,{id:c,decryptedId:u}=o,l=`${i.verifyUrlV3}/attestation?projectId=${i.core.projectId}&origin=${a}&id=${c}&decryptedId=${u}`;try{const d=(0,ir.getDocument)(),f=i.startAbortTimer(5*m.ONE_SECOND),p=yield new Promise((g,y)=>{const w=()=>{window.removeEventListener("message",N),d.body.removeChild(T),y("attestation aborted")};i.abortController.signal.addEventListener("abort",w);const T=d.createElement("iframe");T.src=l,T.style.display="none",T.addEventListener("error",w,{signal:i.abortController.signal});const N=E=>{if(E.data&&"string"==typeof E.data)try{const k=JSON.parse(E.data);if("verify_attestation"===k.type){if(Vs(k.attestation).payload.id!==c)return;clearInterval(f),d.body.removeChild(T),i.abortController.signal.removeEventListener("abort",w),window.removeEventListener("message",N),g(null===k.attestation?"":k.attestation)}}catch(k){i.logger.warn(k)}};d.body.appendChild(T),window.addEventListener("message",N,{signal:i.abortController.signal})});return i.logger.debug("jwt attestation",p),p}catch(d){i.logger.warn(d)}return""});return function(o){return s.apply(this,arguments)}}()),At(this,"resolve",function(){var s=(0,h.A)(function*(o){if(i.isDevEnv)return"";const{attestationId:a,hash:c,encryptedId:u}=o;if(""===a)return void i.logger.debug("resolve: attestationId is empty, skipping");if(a){if(Vs(a).payload.id!==u)return;const d=yield i.isValidJwtAttestation(a);if(d)return d.isVerified?d:void i.logger.warn("resolve: jwt attestation: origin url not verified")}if(!c)return;const l=i.getVerifyUrl(o?.verifyUrl);return i.fetchAttestation(c,l)});return function(o){return s.apply(this,arguments)}}()),At(this,"fetchAttestation",function(){var s=(0,h.A)(function*(o,a){i.logger.debug(`resolving attestation: ${o} from url: ${a}`);const c=i.startAbortTimer(5*m.ONE_SECOND),u=yield fetch(`${a}/attestation/${o}?v2Supported=true`,{signal:i.abortController.signal});return clearTimeout(c),200===u.status?yield u.json():void 0});return function(o,a){return s.apply(this,arguments)}}()),At(this,"getVerifyUrl",s=>{let o=s||bs;return ZE.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${bs}`),o=bs),o}),At(this,"fetchPublicKey",(0,h.A)(function*(){try{i.logger.debug(`fetching public key from: ${i.verifyUrlV3}`);const s=i.startAbortTimer(m.FIVE_SECONDS),o=yield fetch(`${i.verifyUrlV3}/public-key`,{signal:i.abortController.signal});return clearTimeout(s),yield o.json()}catch(s){i.logger.warn(s)}})),At(this,"persistPublicKey",function(){var s=(0,h.A)(function*(o){i.logger.debug("persisting public key to local storage",o),yield i.store.setItem(i.storeKey,o),i.publicKey=o});return function(o){return s.apply(this,arguments)}}()),At(this,"removePublicKey",(0,h.A)(function*(){i.logger.debug("removing verify v2 public key from storage"),yield i.store.removeItem(i.storeKey),i.publicKey=void 0})),At(this,"isValidJwtAttestation",function(){var s=(0,h.A)(function*(o){const a=yield i.getPublicKey();try{if(a)return i.validateAttestation(o,a)}catch(u){i.logger.error(u),i.logger.warn("error validating attestation")}const c=yield i.fetchAndPersistPublicKey();try{if(c)return i.validateAttestation(o,c)}catch(u){i.logger.error(u),i.logger.warn("error validating attestation")}});return function(o){return s.apply(this,arguments)}}()),At(this,"getPublicKey",(0,h.A)(function*(){return i.publicKey?i.publicKey:yield i.fetchAndPersistPublicKey()})),At(this,"fetchAndPersistPublicKey",(0,h.A)(function*(){if(i.fetchPromise)return yield i.fetchPromise,i.publicKey;i.fetchPromise=new Promise(function(){var o=(0,h.A)(function*(a){const c=yield i.fetchPublicKey();c&&(yield i.persistPublicKey(c),a(c))});return function(a){return o.apply(this,arguments)}}());const s=yield i.fetchPromise;return i.fetchPromise=void 0,s})),At(this,"validateAttestation",(s,o)=>{const a=function Gx(n,e){const[t,r,i]=n.split("."),s=Buffer.from(Sh(i),"base64");if(64!==s.length)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),u=So(`${t}.${r}`),l=function Wx(n){const e=Buffer.from(n.x,"base64"),t=Buffer.from(n.y,"base64");return Xi([new Uint8Array([4]),e,t])}(e);if(!Lx.verify(Xi([o,a]),u,l))throw new Error("Invalid signature");return Vs(n).payload}(s,o.publicKey),c={hasExpired:(0,m.toMiliseconds)(a.exp)<Date.now(),payload:a};if(c.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:c.payload.origin,isScam:c.payload.isScam,isVerified:c.payload.isVerified}}),this.logger=Xt(t,this.name),this.abortController=new AbortController,this.isDevEnv=sc(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return an(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,m.toMiliseconds)(e))}}var G8=Object.defineProperty,Lp=(n,e,t)=>((n,e,t)=>e in n?G8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class J8 extends Pg{constructor(e,t){var r;super(e,t),r=this,this.projectId=e,this.logger=t,Lp(this,"context","echo"),Lp(this,"registerDeviceToken",function(){var i=(0,h.A)(function*(s){const{clientId:o,token:a,notificationType:c,enableEncrypted:u=!1}=s,l=`https://echo.walletconnect.com/${r.projectId}/clients`;yield fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:c,token:a,always_raw:u})})});return function(s){return i.apply(this,arguments)}}()),this.logger=Xt(t,this.context)}}var Z8=Object.defineProperty,Mp=Object.getOwnPropertySymbols,X8=Object.prototype.hasOwnProperty,Q8=Object.prototype.propertyIsEnumerable,lu=(n,e,t)=>e in n?Z8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ss=(n,e)=>{for(var t in e||(e={}))X8.call(e,t)&&lu(n,t,e[t]);if(Mp)for(var t of Mp(e))Q8.call(e,t)&&lu(n,t,e[t]);return n},Ut=(n,e,t)=>lu(n,"symbol"!=typeof e?e+"":e,t);class eI extends Tg{constructor(e,t,r=!0){var i;super(e,t,r),i=this,this.core=e,this.logger=t,Ut(this,"context","event-client"),Ut(this,"storagePrefix",Vn),Ut(this,"storageVersion",.1),Ut(this,"events",new Map),Ut(this,"shouldPersist",!1),Ut(this,"init",(0,h.A)(function*(){if(!sc())try{const s={eventId:Qd(),timestamp:Date.now(),domain:i.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:yield i.core.crypto.getClientId(),user_agent:Gd(i.core.relayer.protocol,i.core.relayer.version,Qc)}}};yield i.sendEvent([s])}catch(s){i.logger.warn(s)}})),Ut(this,"createEvent",s=>{const{event:o="ERROR",type:a="",properties:{topic:c,trace:u}}=s,l=Qd(),d=this.core.projectId||"",f=Date.now(),p=Ss({eventId:l,timestamp:f,props:{event:o,type:a,properties:{topic:c,trace:u}},bundleId:d,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,p),this.shouldPersist=!0),p}),Ut(this,"getEvent",s=>{const{eventId:o,topic:a}=s;if(o)return this.events.get(o);const c=Array.from(this.events.values()).find(u=>u.props.properties.topic===a);return c?Ss(Ss({},c),this.setMethods(c.eventId)):void 0}),Ut(this,"deleteEvent",s=>{const{eventId:o}=s;this.events.delete(o),this.shouldPersist=!0}),Ut(this,"setEventListeners",()=>{this.core.heartbeat.on(fe_pulse,(0,h.A)(function*(){i.shouldPersist&&(yield i.persist()),i.events.forEach(s=>{(0,m.fromMiliseconds)(Date.now())-(0,m.fromMiliseconds)(s.timestamp)>86400&&(i.events.delete(s.eventId),i.shouldPersist=!0)})}))}),Ut(this,"setMethods",s=>({addTrace:o=>this.addTrace(s,o),setError:o=>this.setError(s,o)})),Ut(this,"addTrace",(s,o)=>{const a=this.events.get(s);a&&(a.props.properties.trace.push(o),this.events.set(s,a),this.shouldPersist=!0)}),Ut(this,"setError",(s,o)=>{const a=this.events.get(s);a&&(a.props.type=o,a.timestamp=Date.now(),this.events.set(s,a),this.shouldPersist=!0)}),Ut(this,"persist",(0,h.A)(function*(){yield i.core.storage.setItem(i.storageKey,Array.from(i.events.values())),i.shouldPersist=!1})),Ut(this,"restore",(0,h.A)(function*(){try{const s=(yield i.core.storage.getItem(i.storageKey))||[];if(!s.length)return;s.forEach(o=>{i.events.set(o.eventId,Ss(Ss({},o),i.setMethods(o.eventId)))})}catch(s){i.logger.warn(s)}})),Ut(this,"submit",(0,h.A)(function*(){if(!i.telemetryEnabled||0===i.events.size)return;const s=[];for(const[o,a]of i.events)a.props.type&&s.push(a);if(0!==s.length)try{if((yield i.sendEvent(s)).ok)for(const o of s)i.events.delete(o.eventId),i.shouldPersist=!0}catch(o){i.logger.warn(o)}})),Ut(this,"sendEvent",function(){var s=(0,h.A)(function*(o){const a=i.getAppDomain()?"":"&sp=desktop";return yield fetch(`https://pulse.walletconnect.org/batch?projectId=${i.core.projectId}&st=events_sdk&sv=js-${Qc}${a}`,{method:"POST",body:JSON.stringify(o)})});return function(o){return s.apply(this,arguments)}}()),Ut(this,"getAppDomain",()=>Wd().url),this.logger=Xt(t,this.context),this.telemetryEnabled=r,r?this.restore().then((0,h.A)(function*(){yield i.submit(),i.setEventListeners()})):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var tI=Object.defineProperty,jp=Object.getOwnPropertySymbols,nI=Object.prototype.hasOwnProperty,rI=Object.prototype.propertyIsEnumerable,du=(n,e,t)=>e in n?tI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$p=(n,e)=>{for(var t in e||(e={}))nI.call(e,t)&&du(n,t,e[t]);if(jp)for(var t of jp(e))rI.call(e,t)&&du(n,t,e[t]);return n},ft=(n,e,t)=>du(n,"symbol"!=typeof e?e+"":e,t);class fu extends gg{constructor(e){var t,r;super(e),t=this,ft(this,"protocol","wc"),ft(this,"version",2),ft(this,"name",qo),ft(this,"relayUrl"),ft(this,"projectId"),ft(this,"customStoragePrefix"),ft(this,"events",new Y.EventEmitter),ft(this,"logger"),ft(this,"heartbeat"),ft(this,"relayer"),ft(this,"crypto"),ft(this,"storage"),ft(this,"history"),ft(this,"expirer"),ft(this,"pairing"),ft(this,"verify"),ft(this,"echoClient"),ft(this,"linkModeSupportedApps"),ft(this,"eventClient"),ft(this,"initialized",!1),ft(this,"logChunkController"),ft(this,"on",(c,u)=>this.events.on(c,u)),ft(this,"once",(c,u)=>this.events.once(c,u)),ft(this,"off",(c,u)=>this.events.off(c,u)),ft(this,"removeListener",(c,u)=>this.events.removeListener(c,u)),ft(this,"dispatchEnvelope",({topic:c,message:u,sessionExists:l})=>{if(!c||!u)return;const d={topic:c,message:u,publishedAt:Date.now(),transportType:pt.link_mode};this.relayer.onLinkMessageEvent(d,{sessionExists:l})});const i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(c){console.warn("Failed to copy global core",c)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||op,this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=na({level:"string"==typeof e?.logger&&e.logger?e.logger:"error",name:qo}),{logger:o,chunkLoggerController:a}=function fg(n){return typeof n.loggerOverride<"u"&&"string"!=typeof n.loggerOverride?{logger:n.loggerOverride,chunkLoggerController:null}:typeof window<"u"?function lg(n){var e,t;const r=new Vr(null==(e=n.opts)?void 0:e.level,n.maxSizeInBytes);return{logger:Qn()(Us(Fs({},n.opts),{level:"trace",browser:Us(Fs({},null==(t=n.opts)?void 0:t.browser),{write:i=>r.write(i)})})),chunkLoggerController:r}}(n):function dg(n){var e;const t=new fi(null==(e=n.opts)?void 0:e.level,n.maxSizeInBytes);return{logger:Qn()(Us(Fs({},n.opts),{level:"trace"}),t),chunkLoggerController:t}}(n)}({opts:s,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=a,null!=(r=this.logChunkController)&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=(0,h.A)(function*(){var c,u;null!=(c=t.logChunkController)&&c.downloadLogsBlobInBrowser&&(null==(u=t.logChunkController)||u.downloadLogsBlobInBrowser({clientId:yield t.crypto.getClientId()}))})),this.logger=Xt(o,this.name),this.heartbeat=new _,this.crypto=new TA(this,this.logger,e?.keychain),this.history=new $8(this,this.logger),this.expirer=new K8(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new Li($p($p({},IE),e?.storageOptions)),this.relayer=new i8({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new L8(this,this.logger),this.verify=new W8(this,this.logger,this.storage),this.echoClient=new J8(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new eI(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static init(e){return(0,h.A)(function*(){const t=new fu(e);yield t.initialize();const r=yield t.crypto.getClientId();return yield t.storage.setItem("WALLETCONNECT_CLIENT_ID",r),t})()}get context(){return an(this.logger)}start(){var e=this;return(0,h.A)(function*(){e.initialized||(yield e.initialize())})()}getLogsBlob(){var e=this;return(0,h.A)(function*(){var t;return null==(t=e.logChunkController)?void 0:t.logsToBlob({clientId:yield e.crypto.getClientId()})})()}addLinkModeSupportedApp(e){var t=this;return(0,h.A)(function*(){t.linkModeSupportedApps.includes(e)||(t.linkModeSupportedApps.push(e),yield t.storage.setItem(ap,t.linkModeSupportedApps))})()}initialize(){var e=this;return(0,h.A)(function*(){e.logger.trace("Initialized");try{yield e.crypto.init(),yield e.history.init(),yield e.expirer.init(),yield e.relayer.init(),yield e.heartbeat.init(),yield e.pairing.init(),e.linkModeSupportedApps=(yield e.storage.getItem(ap))||[],e.initialized=!0,e.logger.info("Core Initialization Success")}catch(t){throw e.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),e.logger.error(t.message),t}})()}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,r=`${t}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[t]}catch(t){return void console.warn("Failed to get global WalletConnect core",t)}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${(null==(t=e.opts)?void 0:t.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}const iI=fu,hu="wc@2:client:",Vp="WALLETCONNECT_DEEPLINK_CHOICE",Hp="Proposal expired",Ri=m.SEVEN_DAYS,qt={wc_sessionPropose:{req:{ttl:m.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:m.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:m.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:m.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:m.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:m.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:m.ONE_DAY,prompt:!1,tag:1104},res:{ttl:m.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:m.ONE_DAY,prompt:!1,tag:1106},res:{ttl:m.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:m.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:m.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:m.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:m.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:m.ONE_DAY,prompt:!1,tag:1112},res:{ttl:m.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:m.ONE_DAY,prompt:!1,tag:1114},res:{ttl:m.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:m.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:m.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:m.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:m.FIVE_MINUTES,prompt:!1,tag:1119}}},gu={min:m.FIVE_MINUTES,max:m.SEVEN_DAYS},cI={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},lI=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],Ho="wc@1.5:auth:",Wo=`${Ho}:PUB_KEY`;var yI=Object.defineProperty,_I=Object.defineProperties,mI=Object.getOwnPropertyDescriptors,Wp=Object.getOwnPropertySymbols,bI=Object.prototype.hasOwnProperty,wI=Object.prototype.propertyIsEnumerable,yu=(n,e,t)=>e in n?yI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ct=(n,e)=>{for(var t in e||(e={}))bI.call(e,t)&&yu(n,t,e[t]);if(Wp)for(var t of Wp(e))wI.call(e,t)&&yu(n,t,e[t]);return n},Jt=(n,e)=>_I(n,mI(e)),se=(n,e,t)=>yu(n,"symbol"!=typeof e?e+"":e,t);class vI extends Ug{constructor(e){var t;super(e),t=this,se(this,"name","engine"),se(this,"events",new(M())),se(this,"initialized",!1),se(this,"requestQueue",{state:"IDLE",queue:[]}),se(this,"sessionRequestQueue",{state:"IDLE",queue:[]}),se(this,"emittedSessionRequests",new uw({limit:500})),se(this,"requestQueueDelay",m.ONE_SECOND),se(this,"expectedPairingMethodMap",new Map),se(this,"recentlyDeletedMap",new Map),se(this,"recentlyDeletedLimit",200),se(this,"relayMessageCache",[]),se(this,"pendingSessions",new Map),se(this,"init",(0,h.A)(function*(){t.initialized||(yield t.cleanup(),t.registerRelayerEvents(),t.registerExpirerEvents(),t.registerPairingEvents(),yield t.registerLinkModeListeners(),t.client.core.pairing.register({methods:Object.keys(qt)}),t.initialized=!0,setTimeout((0,h.A)(function*(){yield t.processPendingMessageEvents(),t.sessionRequestQueue.queue=t.getPendingSessionRequests(),t.processSessionRequestQueue()}),(0,m.toMiliseconds)(t.requestQueueDelay)))})),se(this,"connect",function(){var r=(0,h.A)(function*(i){t.isInitialized(),yield t.confirmOnlineStateOrThrow();const s=Jt(ct({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});yield t.isValidConnect(s),s.optionalNamespaces=function _2(n,e){var t,r,i,s,o,a;const c=Lo(n),u=Lo(e),l={},d=Object.keys(c).concat(Object.keys(u));for(const f of d)l[f]={chains:Rn(null==(t=c[f])?void 0:t.chains,null==(r=u[f])?void 0:r.chains),methods:Rn(null==(i=c[f])?void 0:i.methods,null==(s=u[f])?void 0:s.methods),events:Rn(null==(o=c[f])?void 0:o.events,null==(a=u[f])?void 0:a.events)};return l}(s.requiredNamespaces,s.optionalNamespaces),s.requiredNamespaces={};const{pairingTopic:o,requiredNamespaces:a,optionalNamespaces:c,sessionProperties:u,scopedProperties:l,relays:d}=s;let p,f=o,g=!1;try{if(f){const Q=t.client.core.pairing.pairings.get(f);t.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),g=Q.active}}catch(Q){throw t.client.logger.error(`connect() -> pairing.get(${f}) failed`),Q}if(!f||!g){const{topic:Q,uri:W}=yield t.client.core.pairing.create({internal:{skipSubscribe:!0}});f=Q,p=W}if(!f){const{message:Q}=ge("NO_MATCHING_KEY",`connect() pairing topic: ${f}`);throw new Error(Q)}const y=yield t.client.core.crypto.generateKeyPair(),w=qt.wc_sessionPropose.req.ttl||m.FIVE_MINUTES,T=Ct(w),N=Jt(ct(ct({requiredNamespaces:a,optionalNamespaces:c,relays:d??[{protocol:"irn"}],proposer:{publicKey:y,metadata:t.client.metadata},expiryTimestamp:T,pairingTopic:f},u&&{sessionProperties:u}),l&&{scopedProperties:l}),{id:qn()}),E=ot("session_connect",N.id),{reject:k,resolve:X,done:ce}=Zr(w,Hp),J=({id:Q})=>{Q===N.id&&(t.client.events.off("proposal_expire",J),t.pendingSessions.delete(N.id),t.events.emit(E,{error:{message:Hp,code:0}}))};return t.client.events.on("proposal_expire",J),t.events.once(E,({error:Q,session:W})=>{t.client.events.off("proposal_expire",J),Q?k(Q):W&&X(W)}),yield t.sendProposeSession({proposal:N,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:N.id}}}),yield t.setProposal(N.id,N),{uri:p,approval:ce}});return function(i){return r.apply(this,arguments)}}()),se(this,"pair",function(){var r=(0,h.A)(function*(i){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{return yield t.client.core.pairing.pair(i)}catch(s){throw t.client.logger.error("pair() failed"),s}});return function(i){return r.apply(this,arguments)}}()),se(this,"approve",function(){var r=(0,h.A)(function*(i){var s,o,a;const c=t.client.core.eventClient.createEvent({properties:{topic:null==(s=i?.id)?void 0:s.toString(),trace:["session_approve_started"]}});try{t.isInitialized(),yield t.confirmOnlineStateOrThrow()}catch(Ae){throw c.setError("no_internet_connection"),Ae}try{yield t.isValidProposalId(i?.id)}catch(Ae){throw t.client.logger.error(`approve() -> proposal.get(${i?.id}) failed`),c.setError("proposal_not_found"),Ae}try{yield t.isValidApprove(i)}catch(Ae){throw t.client.logger.error("approve() -> isValidApprove() failed"),c.setError("session_approve_namespace_validation_failure"),Ae}const{id:u,relayProtocol:l,namespaces:d,sessionProperties:f,scopedProperties:p,sessionConfig:g}=i,y=t.client.proposal.get(u);t.client.core.eventClient.deleteEvent({eventId:c.eventId});const{pairingTopic:w,proposer:T,requiredNamespaces:N,optionalNamespaces:E}=y;let k=null==(o=t.client.core.eventClient)?void 0:o.getEvent({topic:w});k||(k=null==(a=t.client.core.eventClient)?void 0:a.createEvent({type:"session_approve_started",properties:{topic:w,trace:["session_approve_started","session_namespaces_validation_success"]}}));const X=yield t.client.core.crypto.generateKeyPair(),ce=T.publicKey,J=yield t.client.core.crypto.generateSharedKey(X,ce),Q=ct(ct(ct({relay:{protocol:l??"irn"},namespaces:d,controller:{publicKey:X,metadata:t.client.metadata},expiry:Ct(Ri)},f&&{sessionProperties:f}),p&&{scopedProperties:p}),g&&{sessionConfig:g}),W=pt.relay;k.addTrace("subscribing_session_topic");try{yield t.client.core.relayer.subscribe(J,{transportType:W,internal:{skipSubscribe:!0}})}catch(Ae){throw k.setError("subscribe_session_topic_failure"),Ae}k.addTrace("subscribe_session_topic_success");const Fe=Jt(ct({},Q),{topic:J,requiredNamespaces:N,optionalNamespaces:E,pairingTopic:w,acknowledged:!1,self:Q.controller,peer:{publicKey:T.publicKey,metadata:T.metadata},controller:X,transportType:pt.relay});yield t.client.session.set(J,Fe),k.addTrace("store_session");try{yield t.sendApproveSession({sessionTopic:J,proposal:y,pairingProposalResponse:{relay:{protocol:l??"irn"},responderPublicKey:X},sessionSettleRequest:Q,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:u}}}),k.addTrace("session_approve_publish_success")}catch(Ae){throw t.client.logger.error(Ae),t.client.session.delete(J,_t("USER_DISCONNECTED")),yield t.client.core.relayer.unsubscribe(J),Ae}return t.client.core.eventClient.deleteEvent({eventId:k.eventId}),yield t.client.core.pairing.updateMetadata({topic:w,metadata:T.metadata}),yield t.deleteProposal(u),yield t.client.core.pairing.activate({topic:w}),yield t.setExpiry(J,Ct(Ri)),{topic:J,acknowledged:()=>Promise.resolve(t.client.session.get(J))}});return function(i){return r.apply(this,arguments)}}()),se(this,"reject",function(){var r=(0,h.A)(function*(i){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidReject(i)}catch(c){throw t.client.logger.error("reject() -> isValidReject() failed"),c}const{id:s,reason:o}=i;let a;try{a=t.client.proposal.get(s).pairingTopic}catch(c){throw t.client.logger.error(`reject() -> proposal.get(${s}) failed`),c}a&&(yield t.sendError({id:s,topic:a,error:o,rpcOpts:qt.wc_sessionPropose.reject})),yield t.deleteProposal(s)});return function(i){return r.apply(this,arguments)}}()),se(this,"update",function(){var r=(0,h.A)(function*(i){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidUpdate(i)}catch(p){throw t.client.logger.error("update() -> isValidUpdate() failed"),p}const{topic:s,namespaces:o}=i,{done:a,resolve:c,reject:u}=Zr(),l=qn(),d=Mr().toString(),f=t.client.session.get(s).namespaces;return t.events.once(ot("session_update",l),({error:p})=>{p?u(p):c()}),yield t.client.session.update(s,{namespaces:o}),yield t.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:o},throwOnFailedPublish:!0,clientRpcId:l,relayRpcId:d}).catch(p=>{t.client.logger.error(p),t.client.session.update(s,{namespaces:f}),u(p)}),{acknowledged:a}});return function(i){return r.apply(this,arguments)}}()),se(this,"extend",function(){var r=(0,h.A)(function*(i){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidExtend(i)}catch(l){throw t.client.logger.error("extend() -> isValidExtend() failed"),l}const{topic:s}=i,o=qn(),{done:a,resolve:c,reject:u}=Zr();return t.events.once(ot("session_extend",o),({error:l})=>{l?u(l):c()}),yield t.setExpiry(s,Ct(Ri)),t.sendRequest({topic:s,method:"wc_sessionExtend",params:{},clientRpcId:o,throwOnFailedPublish:!0}).catch(l=>{u(l)}),{acknowledged:a}});return function(i){return r.apply(this,arguments)}}()),se(this,"request",function(){var r=(0,h.A)(function*(i){t.isInitialized();try{yield t.isValidRequest(i)}catch(N){throw t.client.logger.error("request() -> isValidRequest() failed"),N}const{chainId:s,request:o,topic:a,expiry:c=qt.wc_sessionRequest.req.ttl}=i,u=t.client.session.get(a);u?.transportType===pt.relay&&(yield t.confirmOnlineStateOrThrow());const l=qn(),d=Mr().toString(),{done:f,resolve:p,reject:g}=Zr(c,"Request expired. Please try again.");t.events.once(ot("session_request",l),({error:N,result:E})=>{N?g(N):p(E)});const y="wc_sessionRequest",w=t.getAppLinkIfEnabled(u.peer.metadata,u.transportType);if(w)return yield t.sendRequest({clientRpcId:l,relayRpcId:d,topic:a,method:y,params:{request:Jt(ct({},o),{expiryTimestamp:Ct(c)}),chainId:s},expiry:c,throwOnFailedPublish:!0,appLink:w}).catch(N=>g(N)),t.client.events.emit("session_request_sent",{topic:a,request:o,chainId:s,id:l}),yield f();const T={request:Jt(ct({},o),{expiryTimestamp:Ct(c)}),chainId:s};return yield Promise.all([new Promise(function(){var N=(0,h.A)(function*(E){yield t.sendRequest({clientRpcId:l,relayRpcId:d,topic:a,method:y,params:T,expiry:c,throwOnFailedPublish:!0,tvf:t.getTVFParams(l,T)}).catch(k=>g(k)),t.client.events.emit("session_request_sent",{topic:a,request:o,chainId:s,id:l}),E()});return function(E){return N.apply(this,arguments)}}()),new Promise(function(){var N=(0,h.A)(function*(E){var k;if(null==(k=u.sessionConfig)||!k.disableDeepLink){const X=yield function iw(n,e){return ic.apply(this,arguments)}(t.client.core.storage,Vp);yield function tw(n){return rc.apply(this,arguments)}({id:l,topic:a,wcDeepLink:X})}E()});return function(E){return N.apply(this,arguments)}}()),f()]).then(N=>N[2])});return function(i){return r.apply(this,arguments)}}()),se(this,"respond",function(){var r=(0,h.A)(function*(i){t.isInitialized(),yield t.isValidRespond(i);const{topic:s,response:o}=i,{id:a}=o,c=t.client.session.get(s);c.transportType===pt.relay&&(yield t.confirmOnlineStateOrThrow());const u=t.getAppLinkIfEnabled(c.peer.metadata,c.transportType);Kn(o)?yield t.sendResult({id:a,topic:s,result:o.result,throwOnFailedPublish:!0,appLink:u}):Dn(o)&&(yield t.sendError({id:a,topic:s,error:o.error,appLink:u})),t.cleanupAfterResponse(i)});return function(i){return r.apply(this,arguments)}}()),se(this,"ping",function(){var r=(0,h.A)(function*(i){t.isInitialized(),yield t.confirmOnlineStateOrThrow();try{yield t.isValidPing(i)}catch(o){throw t.client.logger.error("ping() -> isValidPing() failed"),o}const{topic:s}=i;if(t.client.session.keys.includes(s)){const o=qn(),a=Mr().toString(),{done:c,resolve:u,reject:l}=Zr();t.events.once(ot("session_ping",o),({error:d})=>{d?l(d):u()}),yield Promise.all([t.sendRequest({topic:s,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:o,relayRpcId:a}),c()])}else t.client.core.pairing.pairings.keys.includes(s)&&(t.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),yield t.client.core.pairing.ping({topic:s}))});return function(i){return r.apply(this,arguments)}}()),se(this,"emit",function(){var r=(0,h.A)(function*(i){t.isInitialized(),yield t.confirmOnlineStateOrThrow(),yield t.isValidEmit(i);const{topic:s,event:o,chainId:a}=i,c=Mr().toString(),u=qn();yield t.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:o,chainId:a},throwOnFailedPublish:!0,relayRpcId:c,clientRpcId:u})});return function(i){return r.apply(this,arguments)}}()),se(this,"disconnect",function(){var r=(0,h.A)(function*(i){t.isInitialized(),yield t.confirmOnlineStateOrThrow(),yield t.isValidDisconnect(i);const{topic:s}=i;if(t.client.session.keys.includes(s))yield t.sendRequest({topic:s,method:"wc_sessionDelete",params:_t("USER_DISCONNECTED"),throwOnFailedPublish:!0}),yield t.deleteSession({topic:s,emitEvent:!1});else{if(!t.client.core.pairing.pairings.keys.includes(s)){const{message:o}=ge("MISMATCHED_TOPIC",`Session or pairing topic not found: ${s}`);throw new Error(o)}yield t.client.core.pairing.disconnect({topic:s})}});return function(i){return r.apply(this,arguments)}}()),se(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>function w2(n,e){const{requiredNamespaces:t}=e,r=Object.keys(n.namespaces),i=Object.keys(t);let s=!0;return!!Jr(i,r)&&(r.forEach(o=>{const{accounts:a,methods:c,events:u}=n.namespaces[o],l=Ci(a),d=t[o];Jr(Xa(o,d),l)&&Jr(d.methods,c)&&Jr(d.events,u)||(s=!1)}),s)}(i,r)))),se(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),se(this,"authenticate",function(){var r=(0,h.A)(function*(i,s){var o;t.isInitialized(),t.isValidAuthenticate(i);const a=s&&t.client.core.linkModeSupportedApps.includes(s)&&(null==(o=t.client.metadata.redirect)?void 0:o.linkMode),c=a?pt.link_mode:pt.relay;c===pt.relay&&(yield t.confirmOnlineStateOrThrow());const{chains:u,statement:l="",uri:d,domain:f,nonce:p,type:g,exp:y,nbf:w,methods:T=[],expiry:N}=i,E=[...i.resources||[]],{topic:k,uri:X}=yield t.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:c});t.client.logger.info({message:"Generated new pairing",pairing:{topic:k,uri:X}});const ce=yield t.client.core.crypto.generateKeyPair(),J=Uo(ce);if(yield Promise.all([t.client.auth.authKeys.set(Wo,{responseTopic:J,publicKey:ce}),t.client.auth.pairingTopics.set(J,{topic:J,pairingTopic:k})]),yield t.client.core.relayer.subscribe(J,{transportType:c}),t.client.logger.info(`sending request to new pairing topic: ${k}`),T.length>0){const{namespace:te}=ns(u[0]);let ee=function wv(n,e,t){const r=function mv(n,e,t,r={}){return t?.sort((i,s)=>i.localeCompare(s)),{att:{[n]:Of(e,t,r)}}}(n,e,t);return wc(r)}(te,"request",T);xi(E)&&(ee=vv(ee,E.pop())),E.push(ee)}const Q=N&&N>qt.wc_sessionAuthenticate.req.ttl?N:qt.wc_sessionAuthenticate.req.ttl,W={authPayload:{type:g??"caip122",chains:u,statement:l,aud:d,domain:f,version:"1",nonce:p,iat:(new Date).toISOString(),exp:y,nbf:w,resources:E},requester:{publicKey:ce,metadata:t.client.metadata},expiryTimestamp:Ct(Q)},Ae={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:u,methods:[...new Set(["personal_sign",...T])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:k,proposer:{publicKey:ce,metadata:t.client.metadata},expiryTimestamp:Ct(qt.wc_sessionPropose.req.ttl),id:qn()},{done:ae,resolve:F,reject:L}=Zr(Q,"Request expired"),D=qn(),O=ot("session_connect",Ae.id),$=ot("session_request",D),K=function(){var te=(0,h.A)(function*({error:ee,session:De}){t.events.off($,j),ee?L(ee):De&&F({session:De})});return function(De){return te.apply(this,arguments)}}(),j=function(){var te=(0,h.A)(function*(ee){var De,Be,Ce;if(yield t.deletePendingAuthRequest(D,{message:"fulfilled",code:0}),ee.error){const Zt=_t("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return ee.error.code===Zt.code?void 0:(t.events.off(O,K),L(ee.error.message))}yield t.deleteProposal(Ae.id),t.events.off(O,K);const{cacaos:Le,responder:je}=ee.result,et=[],ze=[];for(const Zt of Le){(yield Sf({cacao:Zt,projectId:t.client.core.projectId}))||(t.client.logger.error(Zt,"Signature verification failed"),L(_t("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Tn}=Zt,yr=xi(Tn.resources),Yo=[mc(Tn.iss)],bu=Eo(Tn.iss);if(yr){const Cs=Tf(yr),wu=Bf(yr);et.push(...Cs),Yo.push(...wu)}for(const Cs of Yo)ze.push(`${Cs}:${bu}`)}const rt=yield t.client.core.crypto.generateSharedKey(ce,je.publicKey);let It;et.length>0&&(It={topic:rt,acknowledged:!0,self:{publicKey:ce,metadata:t.client.metadata},peer:je,controller:je.publicKey,expiry:Ct(Ri),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:k,namespaces:Lh([...new Set(et)],[...new Set(ze)]),transportType:c},yield t.client.core.relayer.subscribe(rt,{transportType:c}),yield t.client.session.set(rt,It),k&&(yield t.client.core.pairing.updateMetadata({topic:k,metadata:je.metadata})),It=t.client.session.get(rt)),null!=(De=t.client.metadata.redirect)&&De.linkMode&&null!=(Be=je.metadata.redirect)&&Be.linkMode&&null!=(Ce=je.metadata.redirect)&&Ce.universal&&s&&(t.client.core.addLinkModeSupportedApp(je.metadata.redirect.universal),t.client.session.update(rt,{transportType:pt.link_mode})),F({auths:Le,session:It})});return function(De){return te.apply(this,arguments)}}();let G;t.events.once(O,K),t.events.once($,j);try{if(a){const te=pr("wc_sessionAuthenticate",W,D);t.client.core.history.set(k,te);const ee=yield t.client.core.crypto.encode("",te,{type:2,encoding:Lr});G=ko(s,k,ee)}else yield Promise.all([t.sendRequest({topic:k,method:"wc_sessionAuthenticate",params:W,expiry:i.expiry,throwOnFailedPublish:!0,clientRpcId:D}),t.sendRequest({topic:k,method:"wc_sessionPropose",params:Ae,expiry:qt.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:Ae.id})])}catch(te){throw t.events.off(O,K),t.events.off($,j),te}return yield t.setProposal(Ae.id,Ae),yield t.setAuthRequest(D,{request:Jt(ct({},W),{verifyContext:{}}),pairingTopic:k,transportType:c}),{uri:G??X,response:ae}});return function(i,s){return r.apply(this,arguments)}}()),se(this,"approveSessionAuthenticate",function(){var r=(0,h.A)(function*(i){const{id:s,auths:o}=i,a=t.client.core.eventClient.createEvent({properties:{topic:s.toString(),trace:["authenticated_session_approve_started"]}});try{t.isInitialized()}catch(N){throw a.setError("no_internet_connection"),N}const c=t.getPendingAuthRequest(s);if(!c)throw a.setError("authenticated_session_pending_request_not_found"),new Error(`Could not find pending auth request with id ${s}`);const u=c.transportType||pt.relay;u===pt.relay&&(yield t.confirmOnlineStateOrThrow());const l=c.requester.publicKey,d=yield t.client.core.crypto.generateKeyPair(),f=Uo(l),p={type:1,receiverPublicKey:l,senderPublicKey:d},g=[],y=[];for(const N of o){if(!(yield Sf({cacao:N,projectId:t.client.core.projectId}))){a.setError("invalid_cacao");const J=_t("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw yield t.sendError({id:s,topic:f,error:J,encodeOpts:p}),new Error(J.message)}a.addTrace("cacaos_verified");const{p:E}=N,k=xi(E.resources),X=[mc(E.iss)],ce=Eo(E.iss);if(k){const J=Tf(k),Q=Bf(k);g.push(...J),X.push(...Q)}for(const J of X)y.push(`${J}:${ce}`)}const w=yield t.client.core.crypto.generateSharedKey(d,l);let T;if(a.addTrace("create_authenticated_session_topic"),g?.length>0){T={topic:w,acknowledged:!0,self:{publicKey:d,metadata:t.client.metadata},peer:{publicKey:l,metadata:c.requester.metadata},controller:l,expiry:Ct(Ri),authentication:o,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:c.pairingTopic,namespaces:Lh([...new Set(g)],[...new Set(y)]),transportType:u},a.addTrace("subscribing_authenticated_session_topic");try{yield t.client.core.relayer.subscribe(w,{transportType:u})}catch(N){throw a.setError("subscribe_authenticated_session_topic_failure"),N}a.addTrace("subscribe_authenticated_session_topic_success"),yield t.client.session.set(w,T),a.addTrace("store_authenticated_session"),yield t.client.core.pairing.updateMetadata({topic:c.pairingTopic,metadata:c.requester.metadata})}a.addTrace("publishing_authenticated_session_approve");try{yield t.sendResult({topic:f,id:s,result:{cacaos:o,responder:{publicKey:d,metadata:t.client.metadata}},encodeOpts:p,throwOnFailedPublish:!0,appLink:t.getAppLinkIfEnabled(c.requester.metadata,u)})}catch(N){throw a.setError("authenticated_session_approve_publish_failure"),N}return yield t.client.auth.requests.delete(s,{message:"fulfilled",code:0}),yield t.client.core.pairing.activate({topic:c.pairingTopic}),t.client.core.eventClient.deleteEvent({eventId:a.eventId}),{session:T}});return function(i){return r.apply(this,arguments)}}()),se(this,"rejectSessionAuthenticate",function(){var r=(0,h.A)(function*(i){t.isInitialized();const{id:s,reason:o}=i,a=t.getPendingAuthRequest(s);if(!a)throw new Error(`Could not find pending auth request with id ${s}`);a.transportType===pt.relay&&(yield t.confirmOnlineStateOrThrow());const c=a.requester.publicKey,u=yield t.client.core.crypto.generateKeyPair(),l=Uo(c),d={type:1,receiverPublicKey:c,senderPublicKey:u};yield t.sendError({id:s,topic:l,error:o,encodeOpts:d,rpcOpts:qt.wc_sessionAuthenticate.reject,appLink:t.getAppLinkIfEnabled(a.requester.metadata,a.transportType)}),yield t.client.auth.requests.delete(s,{message:"rejected",code:0}),yield t.deleteProposal(s)});return function(i){return r.apply(this,arguments)}}()),se(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:s}=r;return Df(i,s)}),se(this,"processRelayMessageCache",()=>{setTimeout((0,h.A)(function*(){if(0!==t.relayMessageCache.length)for(;t.relayMessageCache.length>0;)try{const r=t.relayMessageCache.shift();r&&(yield t.onRelayMessage(r))}catch(r){t.client.logger.error(r)}}),50)}),se(this,"cleanupDuplicatePairings",function(){var r=(0,h.A)(function*(i){if(i.pairingTopic)try{const s=t.client.core.pairing.pairings.get(i.pairingTopic),o=t.client.core.pairing.pairings.getAll().filter(a=>{var c,u;return(null==(c=a.peerMetadata)?void 0:c.url)&&(null==(u=a.peerMetadata)?void 0:u.url)===i.peer.metadata.url&&a.topic&&a.topic!==s.topic});if(0===o.length)return;t.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),yield Promise.all(o.map(a=>t.client.core.pairing.disconnect({topic:a.topic}))),t.client.logger.info("Duplicate pairings clean up finished")}catch(s){t.client.logger.error(s)}});return function(i){return r.apply(this,arguments)}}()),se(this,"deleteSession",function(){var r=(0,h.A)(function*(i){var s;const{topic:o,expirerHasDeleted:a=!1,emitEvent:c=!0,id:u=0}=i,{self:l}=t.client.session.get(o);yield t.client.core.relayer.unsubscribe(o),yield t.client.session.delete(o,_t("USER_DISCONNECTED")),t.addToRecentlyDeleted(o,"session"),t.client.core.crypto.keychain.has(l.publicKey)&&(yield t.client.core.crypto.deleteKeyPair(l.publicKey)),t.client.core.crypto.keychain.has(o)&&(yield t.client.core.crypto.deleteSymKey(o)),a||t.client.core.expirer.del(o),t.client.core.storage.removeItem(Vp).catch(d=>t.client.logger.warn(d)),t.getPendingSessionRequests().forEach(d=>{d.topic===o&&t.deletePendingSessionRequest(d.id,_t("USER_DISCONNECTED"))}),o===(null==(s=t.sessionRequestQueue.queue[0])?void 0:s.topic)&&(t.sessionRequestQueue.state="IDLE"),c&&t.client.events.emit("session_delete",{id:u,topic:o})});return function(i){return r.apply(this,arguments)}}()),se(this,"deleteProposal",function(){var r=(0,h.A)(function*(i,s){if(s)try{const o=t.client.proposal.get(i);t.client.core.eventClient.getEvent({topic:o.pairingTopic})?.setError("proposal_expired")}catch{}yield Promise.all([t.client.proposal.delete(i,_t("USER_DISCONNECTED")),s?Promise.resolve():t.client.core.expirer.del(i)]),t.addToRecentlyDeleted(i,"proposal")});return function(i,s){return r.apply(this,arguments)}}()),se(this,"deletePendingSessionRequest",function(){var r=(0,h.A)(function*(i,s,o=!1){yield Promise.all([t.client.pendingRequest.delete(i,s),o?Promise.resolve():t.client.core.expirer.del(i)]),t.addToRecentlyDeleted(i,"request"),t.sessionRequestQueue.queue=t.sessionRequestQueue.queue.filter(a=>a.id!==i),o&&(t.sessionRequestQueue.state="IDLE",t.client.events.emit("session_request_expire",{id:i}))});return function(i,s){return r.apply(this,arguments)}}()),se(this,"deletePendingAuthRequest",function(){var r=(0,h.A)(function*(i,s,o=!1){yield Promise.all([t.client.auth.requests.delete(i,s),o?Promise.resolve():t.client.core.expirer.del(i)])});return function(i,s){return r.apply(this,arguments)}}()),se(this,"setExpiry",function(){var r=(0,h.A)(function*(i,s){t.client.session.keys.includes(i)&&(t.client.core.expirer.set(i,s),yield t.client.session.update(i,{expiry:s}))});return function(i,s){return r.apply(this,arguments)}}()),se(this,"setProposal",function(){var r=(0,h.A)(function*(i,s){t.client.core.expirer.set(i,Ct(qt.wc_sessionPropose.req.ttl)),yield t.client.proposal.set(i,s)});return function(i,s){return r.apply(this,arguments)}}()),se(this,"setAuthRequest",function(){var r=(0,h.A)(function*(i,s){const{request:o,pairingTopic:a,transportType:c=pt.relay}=s;t.client.core.expirer.set(i,o.expiryTimestamp),yield t.client.auth.requests.set(i,{authPayload:o.authPayload,requester:o.requester,expiryTimestamp:o.expiryTimestamp,id:i,pairingTopic:a,verifyContext:o.verifyContext,transportType:c})});return function(i,s){return r.apply(this,arguments)}}()),se(this,"setPendingSessionRequest",function(){var r=(0,h.A)(function*(i){const{id:s,topic:o,params:a,verifyContext:c}=i,u=a.request.expiryTimestamp||Ct(qt.wc_sessionRequest.req.ttl);t.client.core.expirer.set(s,u),yield t.client.pendingRequest.set(s,{id:s,topic:o,params:a,verifyContext:c})});return function(i){return r.apply(this,arguments)}}()),se(this,"sendRequest",function(){var r=(0,h.A)(function*(i){const{topic:s,method:o,params:a,expiry:c,relayRpcId:u,clientRpcId:l,throwOnFailedPublish:d,appLink:f,tvf:p,publishOpts:g={}}=i,y=pr(o,a,l);let w;const T=!!f;try{const k=T?Lr:gn;w=yield t.client.core.crypto.encode(s,y,{encoding:k})}catch(k){throw yield t.cleanup(),t.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${s} failed`),k}let N;if(lI.includes(o)){const k=Sn(JSON.stringify(y)),X=Sn(w);N=yield t.client.core.verify.register({id:X,decryptedId:k})}const E=ct(ct({},qt[o].req),g);if(E.attestation=N,c&&(E.ttl=c),u&&(E.id=u),t.client.core.history.set(s,y),T){const k=ko(f,s,w);yield global.Linking.openURL(k,t.client.name)}else E.tvf=Jt(ct({},p),{correlationId:y.id}),d?(E.internal=Jt(ct({},E.internal),{throwOnFailedPublish:!0}),yield t.client.core.relayer.publish(s,w,E)):t.client.core.relayer.publish(s,w,E).catch(k=>t.client.logger.error(k));return y.id});return function(i){return r.apply(this,arguments)}}()),se(this,"sendProposeSession",function(){var r=(0,h.A)(function*(i){const{proposal:s,publishOpts:o}=i,a=pr("wc_sessionPropose",s,s.id);t.client.core.history.set(s.pairingTopic,a);const c=yield t.client.core.crypto.encode(s.pairingTopic,a,{encoding:gn}),u=Sn(JSON.stringify(a)),l=Sn(c),d=yield t.client.core.verify.register({id:l,decryptedId:u});yield t.client.core.relayer.publishCustom({payload:{pairingTopic:s.pairingTopic,sessionProposal:c},opts:Jt(ct({},o),{publishMethod:"wc_proposeSession",attestation:d})})});return function(i){return r.apply(this,arguments)}}()),se(this,"sendApproveSession",function(){var r=(0,h.A)(function*(i){const{sessionTopic:s,pairingProposalResponse:o,proposal:a,sessionSettleRequest:c,publishOpts:u}=i,l=$o(a.id,o),d=yield t.client.core.crypto.encode(a.pairingTopic,l,{encoding:gn}),f=pr("wc_sessionSettle",c,u?.id),p=yield t.client.core.crypto.encode(s,f,{encoding:gn});t.client.core.history.set(s,f),yield t.client.core.relayer.publishCustom({payload:{sessionTopic:s,pairingTopic:a.pairingTopic,sessionProposalResponse:d,sessionSettlementRequest:p},opts:Jt(ct({},u),{publishMethod:"wc_approveSession"})})});return function(i){return r.apply(this,arguments)}}()),se(this,"sendResult",function(){var r=(0,h.A)(function*(i){const{id:s,topic:o,result:a,throwOnFailedPublish:c,encodeOpts:u,appLink:l}=i,d=$o(s,a);let f;const p=l&&typeof(null==global?void 0:global.Linking)<"u";try{const w=p?Lr:gn;f=yield t.client.core.crypto.encode(o,d,Jt(ct({},u||{}),{encoding:w}))}catch(w){throw yield t.cleanup(),t.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${o} failed`),w}let g,y;try{g=yield t.client.core.history.get(o,s);const w=g.request;try{y=t.getTVFParams(s,w.params,a)}catch(T){t.client.logger.warn(`sendResult() -> getTVFParams() failed: ${T?.message}`)}}catch(w){throw t.client.logger.error(`sendResult() -> history.get(${o}, ${s}) failed`),w}if(p){const w=ko(l,o,f);yield global.Linking.openURL(w,t.client.name)}else{const T=qt[g.request.method].res;T.tvf=Jt(ct({},y),{correlationId:s}),c?(T.internal=Jt(ct({},T.internal),{throwOnFailedPublish:!0}),yield t.client.core.relayer.publish(o,f,T)):t.client.core.relayer.publish(o,f,T).catch(N=>t.client.logger.error(N))}yield t.client.core.history.resolve(d)});return function(i){return r.apply(this,arguments)}}()),se(this,"sendError",function(){var r=(0,h.A)(function*(i){const{id:s,topic:o,error:a,encodeOpts:c,rpcOpts:u,appLink:l}=i,d=Zc(s,a);let f;const p=l&&typeof(null==global?void 0:global.Linking)<"u";try{const y=p?Lr:gn;f=yield t.client.core.crypto.encode(o,d,Jt(ct({},c||{}),{encoding:y}))}catch(y){throw yield t.cleanup(),t.client.logger.error(`sendError() -> core.crypto.encode() for topic ${o} failed`),y}let g;try{g=yield t.client.core.history.get(o,s)}catch(y){throw t.client.logger.error(`sendError() -> history.get(${o}, ${s}) failed`),y}if(p){const y=ko(l,o,f);yield global.Linking.openURL(y,t.client.name)}else t.client.core.relayer.publish(o,f,u||qt[g.request.method].res);yield t.client.core.history.resolve(d)});return function(i){return r.apply(this,arguments)}}()),se(this,"cleanup",(0,h.A)(function*(){const r=[],i=[];t.client.session.getAll().forEach(s=>{let o=!1;Ar(s.expiry)&&(o=!0),t.client.core.crypto.keychain.has(s.topic)||(o=!0),o&&r.push(s.topic)}),t.client.proposal.getAll().forEach(s=>{Ar(s.expiryTimestamp)&&i.push(s.id)}),yield Promise.all([...r.map(s=>t.deleteSession({topic:s})),...i.map(s=>t.deleteProposal(s))])})),se(this,"onProviderMessageEvent",function(){var r=(0,h.A)(function*(i){!t.initialized||t.relayMessageCache.length>0?t.relayMessageCache.push(i):yield t.onRelayMessage(i)});return function(i){return r.apply(this,arguments)}}()),se(this,"onRelayEventRequest",function(){var r=(0,h.A)(function*(i){t.requestQueue.queue.push(i),yield t.processRequestsQueue()});return function(i){return r.apply(this,arguments)}}()),se(this,"processRequestsQueue",(0,h.A)(function*(){if("ACTIVE"!==t.requestQueue.state){for(t.client.logger.info(`Request queue starting with ${t.requestQueue.queue.length} requests`);t.requestQueue.queue.length>0;){t.requestQueue.state="ACTIVE";const r=t.requestQueue.queue.shift();if(r)try{yield t.processRequest(r)}catch(i){t.client.logger.warn(i)}}t.requestQueue.state="IDLE"}else t.client.logger.info("Request queue already active, skipping...")})),se(this,"processRequest",function(){var r=(0,h.A)(function*(i){const{topic:s,payload:o,attestation:a,transportType:c,encryptedId:u}=i,l=o.method;if(!t.shouldIgnorePairingRequest({topic:s,requestMethod:l}))switch(l){case"wc_sessionPropose":return yield t.onSessionProposeRequest({topic:s,payload:o,attestation:a,encryptedId:u});case"wc_sessionSettle":return yield t.onSessionSettleRequest(s,o);case"wc_sessionUpdate":return yield t.onSessionUpdateRequest(s,o);case"wc_sessionExtend":return yield t.onSessionExtendRequest(s,o);case"wc_sessionPing":return yield t.onSessionPingRequest(s,o);case"wc_sessionDelete":return yield t.onSessionDeleteRequest(s,o);case"wc_sessionRequest":return yield t.onSessionRequest({topic:s,payload:o,attestation:a,encryptedId:u,transportType:c});case"wc_sessionEvent":return yield t.onSessionEventRequest(s,o);case"wc_sessionAuthenticate":return yield t.onSessionAuthenticateRequest({topic:s,payload:o,attestation:a,encryptedId:u,transportType:c});default:return t.client.logger.info(`Unsupported request method ${l}`)}});return function(i){return r.apply(this,arguments)}}()),se(this,"onRelayEventResponse",function(){var r=(0,h.A)(function*(i){const{topic:s,payload:o,transportType:a}=i,c=(yield t.client.core.history.get(s,o.id)).request.method;switch(c){case"wc_sessionPropose":return t.onSessionProposeResponse(s,o,a);case"wc_sessionSettle":return t.onSessionSettleResponse(s,o);case"wc_sessionUpdate":return t.onSessionUpdateResponse(s,o);case"wc_sessionExtend":return t.onSessionExtendResponse(s,o);case"wc_sessionPing":return t.onSessionPingResponse(s,o);case"wc_sessionRequest":return t.onSessionRequestResponse(s,o);case"wc_sessionAuthenticate":return t.onSessionAuthenticateResponse(s,o);default:return t.client.logger.info(`Unsupported response method ${c}`)}});return function(i){return r.apply(this,arguments)}}()),se(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:s}=ge("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),se(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:s}=r,o=this.expectedPairingMethodMap.get(i);return!(!o||o.includes(s)||!(o.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0))}),se(this,"onSessionProposeRequest",function(){var r=(0,h.A)(function*(i){const{topic:s,payload:o,attestation:a,encryptedId:c}=i,{params:u,id:l}=o;try{const d=t.client.core.eventClient.getEvent({topic:s});0===t.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),d?.setError("proposal_listener_not_found")),t.isValidConnect(ct({},o.params));const f=u.expiryTimestamp||Ct(qt.wc_sessionPropose.req.ttl),p=ct({id:l,pairingTopic:s,expiryTimestamp:f,attestation:a,encryptedId:c},u);yield t.setProposal(l,p);const g=yield t.getVerifyContext({attestationId:a,hash:Sn(JSON.stringify(o)),encryptedId:c,metadata:p.proposer.metadata});d?.addTrace("emit_session_proposal"),t.client.events.emit("session_proposal",{id:l,params:p,verifyContext:g})}catch(d){yield t.sendError({id:l,topic:s,error:d,rpcOpts:qt.wc_sessionPropose.autoReject}),t.client.logger.error(d)}});return function(i){return r.apply(this,arguments)}}()),se(this,"onSessionProposeResponse",function(){var r=(0,h.A)(function*(i,s,o){const{id:a}=s;if(Kn(s)){const{result:c}=s;t.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const u=t.client.proposal.get(a);t.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:u});const l=u.proposer.publicKey;t.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:l});const d=c.responderPublicKey;t.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:d});const f=yield t.client.core.crypto.generateSharedKey(l,d);t.pendingSessions.set(a,{sessionTopic:f,pairingTopic:i,proposalId:a,publicKey:l});const p=yield t.client.core.relayer.subscribe(f,{transportType:o});t.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:p}),yield t.client.core.pairing.activate({topic:i})}else if(Dn(s)){yield t.deleteProposal(a);const c=ot("session_connect",a);if(0===t.events.listenerCount(c))throw new Error(`emitting ${c} without any listeners, 954`);t.events.emit(c,{error:s.error})}});return function(i,s,o){return r.apply(this,arguments)}}()),se(this,"onSessionSettleRequest",function(){var r=(0,h.A)(function*(i,s){const{id:o,params:a}=s;try{t.isValidSessionSettleRequest(a);const{relay:c,controller:u,expiry:l,namespaces:d,sessionProperties:f,scopedProperties:p,sessionConfig:g}=s.params,y=[...t.pendingSessions.values()].find(N=>N.sessionTopic===i);if(!y)return t.client.logger.error(`Pending session not found for topic ${i}`);const w=t.client.proposal.get(y.proposalId),T=Jt(ct(ct(ct({topic:i,relay:c,expiry:l,namespaces:d,acknowledged:!0,pairingTopic:y.pairingTopic,requiredNamespaces:w.requiredNamespaces,optionalNamespaces:w.optionalNamespaces,controller:u.publicKey,self:{publicKey:y.publicKey,metadata:t.client.metadata},peer:{publicKey:u.publicKey,metadata:u.metadata}},f&&{sessionProperties:f}),p&&{scopedProperties:p}),g&&{sessionConfig:g}),{transportType:pt.relay});yield t.client.session.set(T.topic,T),yield t.setExpiry(T.topic,T.expiry),yield t.client.core.pairing.updateMetadata({topic:y.pairingTopic,metadata:T.peer.metadata}),t.client.events.emit("session_connect",{session:T}),t.events.emit(ot("session_connect",y.proposalId),{session:T}),t.pendingSessions.delete(y.proposalId),t.deleteProposal(y.proposalId,!1),t.cleanupDuplicatePairings(T),yield t.sendResult({id:s.id,topic:i,result:!0})}catch(c){yield t.sendError({id:o,topic:i,error:c}),t.client.logger.error(c)}});return function(i,s){return r.apply(this,arguments)}}()),se(this,"onSessionSettleResponse",function(){var r=(0,h.A)(function*(i,s){const{id:o}=s;Kn(s)?(yield t.client.session.update(i,{acknowledged:!0}),t.events.emit(ot("session_approve",o),{})):Dn(s)&&(yield t.client.session.delete(i,_t("USER_DISCONNECTED")),t.events.emit(ot("session_approve",o),{error:s.error}))});return function(i,s){return r.apply(this,arguments)}}()),se(this,"onSessionUpdateRequest",function(){var r=(0,h.A)(function*(i,s){const{params:o,id:a}=s;try{const c=`${i}_session_update`,u=gs.get(c);if(u&&t.isRequestOutOfSync(u,a))return t.client.logger.warn(`Discarding out of sync request - ${a}`),void t.sendError({id:a,topic:i,error:_t("INVALID_UPDATE_REQUEST")});t.isValidUpdate(ct({topic:i},o));try{gs.set(c,a),yield t.client.session.update(i,{namespaces:o.namespaces}),yield t.sendResult({id:a,topic:i,result:!0})}catch(l){throw gs.delete(c),l}t.client.events.emit("session_update",{id:a,topic:i,params:o})}catch(c){yield t.sendError({id:a,topic:i,error:c}),t.client.logger.error(c)}});return function(i,s){return r.apply(this,arguments)}}()),se(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),se(this,"onSessionUpdateResponse",(r,i)=>{const{id:s}=i,o=ot("session_update",s);if(0===this.events.listenerCount(o))throw new Error(`emitting ${o} without any listeners`);Kn(i)?this.events.emit(ot("session_update",s),{}):Dn(i)&&this.events.emit(ot("session_update",s),{error:i.error})}),se(this,"onSessionExtendRequest",function(){var r=(0,h.A)(function*(i,s){const{id:o}=s;try{t.isValidExtend({topic:i}),yield t.setExpiry(i,Ct(Ri)),yield t.sendResult({id:o,topic:i,result:!0}),t.client.events.emit("session_extend",{id:o,topic:i})}catch(a){yield t.sendError({id:o,topic:i,error:a}),t.client.logger.error(a)}});return function(i,s){return r.apply(this,arguments)}}()),se(this,"onSessionExtendResponse",(r,i)=>{const{id:s}=i,o=ot("session_extend",s);if(0===this.events.listenerCount(o))throw new Error(`emitting ${o} without any listeners`);Kn(i)?this.events.emit(ot("session_extend",s),{}):Dn(i)&&this.events.emit(ot("session_extend",s),{error:i.error})}),se(this,"onSessionPingRequest",function(){var r=(0,h.A)(function*(i,s){const{id:o}=s;try{t.isValidPing({topic:i}),yield t.sendResult({id:o,topic:i,result:!0,throwOnFailedPublish:!0}),t.client.events.emit("session_ping",{id:o,topic:i})}catch(a){yield t.sendError({id:o,topic:i,error:a}),t.client.logger.error(a)}});return function(i,s){return r.apply(this,arguments)}}()),se(this,"onSessionPingResponse",(r,i)=>{const{id:s}=i,o=ot("session_ping",s);setTimeout(()=>{if(0===this.events.listenerCount(o))throw new Error(`emitting ${o} without any listeners 2176`);Kn(i)?this.events.emit(ot("session_ping",s),{}):Dn(i)&&this.events.emit(ot("session_ping",s),{error:i.error})},500)}),se(this,"onSessionDeleteRequest",function(){var r=(0,h.A)(function*(i,s){const{id:o}=s;try{t.isValidDisconnect({topic:i,reason:s.params}),yield Promise.all([new Promise(a=>{t.client.core.relayer.once(vt_publish,(0,h.A)(function*(){a(yield t.deleteSession({topic:i,id:o}))}))}),t.sendResult({id:o,topic:i,result:!0}),t.cleanupPendingSentRequestsForTopic({topic:i,error:_t("USER_DISCONNECTED")})]).catch(a=>t.client.logger.error(a))}catch(a){t.client.logger.error(a)}});return function(i,s){return r.apply(this,arguments)}}()),se(this,"onSessionRequest",function(){var r=(0,h.A)(function*(i){var s,o,a;const{topic:c,payload:u,attestation:l,encryptedId:d,transportType:f}=i,{id:p,params:g}=u;try{yield t.isValidRequest(ct({topic:c},g));const y=t.client.session.get(c),T={id:p,topic:c,params:g,verifyContext:yield t.getVerifyContext({attestationId:l,hash:Sn(JSON.stringify(pr("wc_sessionRequest",g,p))),encryptedId:d,metadata:y.peer.metadata,transportType:f})};yield t.setPendingSessionRequest(T),f===pt.link_mode&&null!=(s=y.peer.metadata.redirect)&&s.universal&&t.client.core.addLinkModeSupportedApp(null==(o=y.peer.metadata.redirect)?void 0:o.universal),null!=(a=t.client.signConfig)&&a.disableRequestQueue?t.emitSessionRequest(T):(t.addSessionRequestToSessionRequestQueue(T),t.processSessionRequestQueue())}catch(y){yield t.sendError({id:p,topic:c,error:y}),t.client.logger.error(y)}});return function(i){return r.apply(this,arguments)}}()),se(this,"onSessionRequestResponse",(r,i)=>{const{id:s}=i,o=ot("session_request",s);if(0===this.events.listenerCount(o))throw new Error(`emitting ${o} without any listeners`);Kn(i)?this.events.emit(ot("session_request",s),{result:i.result}):Dn(i)&&this.events.emit(ot("session_request",s),{error:i.error})}),se(this,"onSessionEventRequest",function(){var r=(0,h.A)(function*(i,s){const{id:o,params:a}=s;try{const c=`${i}_session_event_${a.event.name}`,u=gs.get(c);if(u&&t.isRequestOutOfSync(u,o))return void t.client.logger.info(`Discarding out of sync request - ${o}`);t.isValidEmit(ct({topic:i},a)),t.client.events.emit("session_event",{id:o,topic:i,params:a}),gs.set(c,o)}catch(c){yield t.sendError({id:o,topic:i,error:c}),t.client.logger.error(c)}});return function(i,s){return r.apply(this,arguments)}}()),se(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),Kn(i)?this.events.emit(ot("session_request",s),{result:i.result}):Dn(i)&&this.events.emit(ot("session_request",s),{error:i.error})}),se(this,"onSessionAuthenticateRequest",function(){var r=(0,h.A)(function*(i){var s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=i;try{const{requester:d,authPayload:f,expiryTimestamp:p}=a.params,g=yield t.getVerifyContext({attestationId:c,hash:Sn(JSON.stringify(a)),encryptedId:u,metadata:d.metadata,transportType:l}),y={requester:d,pairingTopic:o,id:a.id,authPayload:f,verifyContext:g,expiryTimestamp:p};yield t.setAuthRequest(a.id,{request:y,pairingTopic:o,transportType:l}),l===pt.link_mode&&null!=(s=d.metadata.redirect)&&s.universal&&t.client.core.addLinkModeSupportedApp(d.metadata.redirect.universal),t.client.events.emit("session_authenticate",{topic:o,params:a.params,id:a.id,verifyContext:g})}catch(d){t.client.logger.error(d);const f=a.params.requester.publicKey,p=yield t.client.core.crypto.generateKeyPair(),g=t.getAppLinkIfEnabled(a.params.requester.metadata,l),y={type:1,receiverPublicKey:f,senderPublicKey:p};yield t.sendError({id:a.id,topic:o,error:d,encodeOpts:y,rpcOpts:qt.wc_sessionAuthenticate.autoReject,appLink:g})}});return function(i){return r.apply(this,arguments)}}()),se(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),se(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state="IDLE",this.processSessionRequestQueue()},(0,m.toMiliseconds)(this.requestQueueDelay))}),se(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(o=>o.topic===r&&"wc_sessionRequest"===o.request.method).forEach(o=>{const c=ot("session_request",o.request.id);if(0===this.events.listenerCount(c))throw new Error(`emitting ${c} without any listeners`);this.events.emit(ot("session_request",o.request.id),{error:i})})}),se(this,"processSessionRequestQueue",()=>{if("ACTIVE"===this.sessionRequestQueue.state)return void this.client.logger.info("session request queue is already active.");const r=this.sessionRequestQueue.queue[0];if(r)try{this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}else this.client.logger.info("session request queue is empty.")}),se(this,"emitSessionRequest",r=>{this.emittedSessionRequests.has(r.id)?this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`):(this.sessionRequestQueue.state="ACTIVE",this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r))}),se(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:pr("wc_sessionPropose",Jt(ct({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),se(this,"isValidConnect",function(){var r=(0,h.A)(function*(i){if(!yn(i)){const{message:d}=ge("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(d)}const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:u,relays:l}=i;if(Tt(s)||(yield t.isValidPairingTopic(s)),!function B2(n,e){let t=!1;return e&&!n?t=!0:n&&Pi(n)&&n.length&&n.forEach(r=>{t=$h(r)}),t}(l,!0)){const{message:d}=ge("MISSING_OR_INVALID",`connect() relays: ${l}`);throw new Error(d)}if(!Tt(o)&&0!==ps(o)){const d="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(t.client.logger.level)?console.warn(d):t.client.logger.warn(d),t.validateNamespaces(o,"requiredNamespaces")}if(!Tt(a)&&0!==ps(a)&&t.validateNamespaces(a,"optionalNamespaces"),Tt(c)||t.validateSessionProps(c,"sessionProperties"),!Tt(u)){t.validateSessionProps(u,"scopedProperties");const d=Object.keys(o||{}).concat(Object.keys(a||{}));if(!Object.keys(u).every(f=>d.includes(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(u)}, required/optional namespaces: ${JSON.stringify(d)}`)}});return function(i){return r.apply(this,arguments)}}()),se(this,"validateNamespaces",(r,i)=>{const s=function T2(n,e,t){let r=null;if(n&&ps(n)){const i=jh(n,e);i&&(r=i);const s=function D2(n,e,t){let r=null;return Object.entries(n).forEach(([i,s])=>{if(r)return;const o=function S2(n,e,t){let r=null;return Pi(e)&&e.length?e.forEach(i=>{r||Mo(i)||(r=_t("UNSUPPORTED_CHAINS",`${t}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):Mo(n)||(r=_t("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}(i,Xa(i,s),`${e} ${t}`);o&&(r=o)}),r}(n,e,t);s&&(r=s)}else r=ge("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return r}(r,"connect()",i);if(s)throw new Error(s.message)}),se(this,"isValidApprove",function(){var r=(0,h.A)(function*(i){if(!yn(i))throw new Error(ge("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:s,namespaces:o,relayProtocol:a,sessionProperties:c,scopedProperties:u}=i;t.checkRecentlyDeleted(s),yield t.isValidProposalId(s);const l=t.client.proposal.get(s),d=jo(o,"approve()");if(d)throw new Error(d.message);const f=Hc(l.requiredNamespaces,o,"approve()");if(f)throw new Error(f.message);if(!Et(a,!0)){const{message:p}=ge("MISSING_OR_INVALID",`approve() relayProtocol: ${a}`);throw new Error(p)}if(Tt(c)||t.validateSessionProps(c,"sessionProperties"),!Tt(u)){t.validateSessionProps(u,"scopedProperties");const p=new Set(Object.keys(o));if(!Object.keys(u).every(g=>p.has(g.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(u)}, approved namespaces: ${Array.from(p).join(", ")}`)}});return function(i){return r.apply(this,arguments)}}()),se(this,"isValidReject",function(){var r=(0,h.A)(function*(i){if(!yn(i)){const{message:a}=ge("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(a)}const{id:s,reason:o}=i;if(t.checkRecentlyDeleted(s),yield t.isValidProposalId(s),!function F2(n){return!!(n&&"object"==typeof n&&n.code&&Vc(n.code,!1)&&n.message&&Et(n.message,!1))}(o)){const{message:a}=ge("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(a)}});return function(i){return r.apply(this,arguments)}}()),se(this,"isValidSessionSettleRequest",r=>{if(!yn(r)){const{message:l}=ge("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:s,namespaces:o,expiry:a}=r;if(!$h(i)){const{message:l}=ge("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const c=function I2(n,e){let t=null;return Et(n?.publicKey,!1)||(t=ge("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);const u=jo(o,"onSessionSettleRequest()");if(u)throw new Error(u.message);if(Ar(a)){const{message:l}=ge("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),se(this,"isValidUpdate",function(){var r=(0,h.A)(function*(i){if(!yn(i)){const{message:l}=ge("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(l)}const{topic:s,namespaces:o}=i;t.checkRecentlyDeleted(s),yield t.isValidSessionTopic(s);const a=t.client.session.get(s),c=jo(o,"update()");if(c)throw new Error(c.message);const u=Hc(a.requiredNamespaces,o,"update()");if(u)throw new Error(u.message)});return function(i){return r.apply(this,arguments)}}()),se(this,"isValidExtend",function(){var r=(0,h.A)(function*(i){if(!yn(i)){const{message:o}=ge("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(o)}const{topic:s}=i;t.checkRecentlyDeleted(s),yield t.isValidSessionTopic(s)});return function(i){return r.apply(this,arguments)}}()),se(this,"isValidRequest",function(){var r=(0,h.A)(function*(i){if(!yn(i)){const{message:l}=ge("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(l)}const{topic:s,request:o,chainId:a,expiry:c}=i;t.checkRecentlyDeleted(s),yield t.isValidSessionTopic(s);const{namespaces:u}=t.client.session.get(s);if(!zh(u,a)){const{message:l}=ge("MISSING_OR_INVALID",`request() chainId: ${a}`);throw new Error(l)}if(!function U2(n){return!(Tt(n)||!Et(n.method,!1))}(o)){const{message:l}=ge("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(l)}if(!function L2(n,e,t){return!!Et(t,!1)&&function h2(n,e){const t=[];return Object.values(n).forEach(r=>{Ci(r.accounts).includes(e)&&t.push(...r.methods)}),t}(n,e).includes(t)}(u,a,o.method)){const{message:l}=ge("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(l)}if(c&&!function z2(n,e){return Vc(n,!1)&&n<=e.max&&n>=e.min}(c,gu)){const{message:l}=ge("MISSING_OR_INVALID",`request() expiry: ${c}. Expiry must be a number (in seconds) between ${gu.min} and ${gu.max}`);throw new Error(l)}});return function(i){return r.apply(this,arguments)}}()),se(this,"isValidRespond",function(){var r=(0,h.A)(function*(i){var s;if(!yn(i)){const{message:c}=ge("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(c)}const{topic:o,response:a}=i;try{yield t.isValidSessionTopic(o)}catch(c){throw null!=(s=i?.response)&&s.id&&t.cleanupAfterResponse(i),c}if(!function N2(n){return!(Tt(n)||Tt(n.result)&&Tt(n.error)||!Vc(n.id,!1)||!Et(n.jsonrpc,!1))}(a)){const{message:c}=ge("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(c)}});return function(i){return r.apply(this,arguments)}}()),se(this,"isValidPing",function(){var r=(0,h.A)(function*(i){if(!yn(i)){const{message:o}=ge("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:s}=i;yield t.isValidSessionOrPairingTopic(s)});return function(i){return r.apply(this,arguments)}}()),se(this,"isValidEmit",function(){var r=(0,h.A)(function*(i){if(!yn(i)){const{message:u}=ge("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(u)}const{topic:s,event:o,chainId:a}=i;yield t.isValidSessionTopic(s);const{namespaces:c}=t.client.session.get(s);if(!zh(c,a)){const{message:u}=ge("MISSING_OR_INVALID",`emit() chainId: ${a}`);throw new Error(u)}if(!function k2(n){return!(Tt(n)||!Et(n.name,!1))}(o)){const{message:u}=ge("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(u)}if(!function M2(n,e,t){return!!Et(t,!1)&&function p2(n,e){const t=[];return Object.values(n).forEach(r=>{Ci(r.accounts).includes(e)&&t.push(...r.events)}),t}(n,e).includes(t)}(c,a,o.name)){const{message:u}=ge("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(u)}});return function(i){return r.apply(this,arguments)}}()),se(this,"isValidDisconnect",function(){var r=(0,h.A)(function*(i){if(!yn(i)){const{message:o}=ge("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:s}=i;yield t.isValidSessionOrPairingTopic(s)});return function(i){return r.apply(this,arguments)}}()),se(this,"isValidAuthenticate",r=>{const{chains:i,uri:s,domain:o,nonce:a}=r;if(!Array.isArray(i)||0===i.length)throw new Error("chains is required and must be a non-empty array");if(!Et(s,!1))throw new Error("uri is required parameter");if(!Et(o,!1))throw new Error("domain is required parameter");if(!Et(a,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(u=>ns(u).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:c}=ns(i[0]);if("eip155"!==c)throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),se(this,"getVerifyContext",function(){var r=(0,h.A)(function*(i){const{attestationId:s,hash:o,encryptedId:a,metadata:c,transportType:u}=i,l={verified:{verifyUrl:c.verifyUrl||bs,validation:"UNKNOWN",origin:c.url||""}};try{if(u===pt.link_mode){const f=t.getAppLinkIfEnabled(c,u);return l.verified.validation=f&&new URL(f).origin===new URL(c.url).origin?"VALID":"INVALID",l}const d=yield t.client.core.verify.resolve({attestationId:s,hash:o,encryptedId:a,verifyUrl:c.verifyUrl});d&&(l.verified.origin=d.origin,l.verified.isScam=d.isScam,l.verified.validation=d.origin===new URL(c.url).origin?"VALID":"INVALID")}catch(d){t.client.logger.warn(d)}return t.client.logger.debug(`Verify context: ${JSON.stringify(l)}`),l});return function(i){return r.apply(this,arguments)}}()),se(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((s,o)=>{if(null==s){const{message:a}=ge("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[o]}`);throw new Error(a)}})}),se(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return"object"==typeof i?i:void 0}),se(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const o=this.recentlyDeletedLimit/2;for(const a of this.recentlyDeletedMap.keys()){if(s++>=o)break;this.recentlyDeletedMap.delete(a)}}}),se(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:s}=ge("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(s)}}),se(this,"isLinkModeEnabled",(r,i)=>{var s,o,a,c,u,l,d,f,p;return!(!r||i!==pt.link_mode)&&!0===(null==(o=null==(s=this.client.metadata)?void 0:s.redirect)?void 0:o.linkMode)&&void 0!==(null==(c=null==(a=this.client.metadata)?void 0:a.redirect)?void 0:c.universal)&&""!==(null==(l=null==(u=this.client.metadata)?void 0:u.redirect)?void 0:l.universal)&&void 0!==(null==(d=r?.redirect)?void 0:d.universal)&&""!==(null==(f=r?.redirect)?void 0:f.universal)&&!0===(null==(p=r?.redirect)?void 0:p.linkMode)&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(null==global?void 0:global.Linking)<"u"}),se(this,"getAppLinkIfEnabled",(r,i)=>{var s;return this.isLinkModeEnabled(r,i)?null==(s=r?.redirect)?void 0:s.universal:void 0}),se(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=Xd(r,"topic")||"",s=decodeURIComponent(Xd(r,"wc_ev")||""),o=this.client.session.keys.includes(i);o&&this.client.session.update(i,{transportType:pt.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:o})}),se(this,"registerLinkModeListeners",(0,h.A)(function*(){var r;if(sc()||Er()&&null!=(r=t.client.metadata.redirect)&&r.linkMode){const i=null==global?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",t.handleLinkModeMessage,t.client.name);const s=yield i.getInitialURL();s&&setTimeout(()=>{t.handleLinkModeMessage({url:s})},50)}}})),se(this,"getTVFParams",(r,i,s)=>{var o,a,c;if(null==(o=i.request)||!o.method)return{};const u={correlationId:r,rpcMethods:[i.request.method],chainId:i.chainId};try{const l=this.extractTxHashesFromResult(i.request,s);u.txHashes=l,u.contractAddresses=this.isValidContractData(i.request.params)?[null==(c=null==(a=i.request.params)?void 0:a[0])?void 0:c.to]:[]}catch(l){this.client.logger.warn("Error getting TVF params",l)}return u}),se(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const s=r?.data||(null==(i=r?.[0])?void 0:i.data);if(!s.startsWith("0x"))return!1;const o=s.slice(2);return!!/^[0-9a-fA-F]*$/.test(o)&&o.length%2==0}catch{}return!1}),se(this,"extractTxHashesFromResult",(r,i)=>{var s;try{if(!i)return[];const o=r.method,a=cI[o];if("sui_signTransaction"===o)return[nv(i.transactionBytes)];if("near_signTransaction"===o)return[vf(i)];if("near_signTransactions"===o)return i.map(u=>vf(u));if("xrpl_signTransactionFor"===o||"xrpl_signTransaction"===o)return[null==(s=i.tx_json)?void 0:s.hash];if("polkadot_signTransaction"===o)return[rE({transaction:r.params.transactionPayload,signature:i.signature})];if("algo_signTxn"===o)return Pi(i)?i.map(u=>xf(u)):[xf(i)];if("cosmos_signDirect"===o)return[iv(i)];if("wallet_sendCalls"===o)return function sv(n){var e,t;const r=[];try{if("string"==typeof n)return r.push(n),r;if("object"!=typeof n)return r;null!=n&&n.id&&r.push(n.id);const i=null==(t=null==(e=n?.capabilities)?void 0:e.caip345)?void 0:t.transactionHashes;i&&r.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return r}(i);if("string"==typeof i)return[i];const c=i[a.key];if(Pi(c))return"solana_signAllTransactions"===o?c.map(u=>function tv(n){const e=atob(n),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);const r=t[0];if(0===r)throw new Error("No signatures found");if(t.length<1+64*r)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const s=Buffer.from(n,"base64").slice(1,65);return Vi.encode(s)}(u)):c;if("string"==typeof c)return[c]}catch(o){this.client.logger.warn("Error extracting tx hashes from result",o)}return[]})}processPendingMessageEvents(){var e=this;return(0,h.A)(function*(){try{const r=e.client.core.relayer.messages.getWithoutAck(e.client.session.keys);for(const[i,s]of Object.entries(r))for(const o of s)try{yield e.onProviderMessageEvent({topic:i,message:o,publishedAt:Date.now()})}catch{e.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${o}`)}}catch(t){e.client.logger.warn("processPendingMessageEvents failed",t)}})()}isInitialized(){if(!this.initialized){const{message:e}=ge("NOT_INITIALIZED",this.name);throw new Error(e)}}confirmOnlineStateOrThrow(){var e=this;return(0,h.A)(function*(){yield e.client.core.relayer.confirmOnlineStateOrThrow()})()}registerRelayerEvents(){this.client.core.relayer.on("relayer_message",e=>{this.onProviderMessageEvent(e)})}onRelayMessage(e){var t=this;return(0,h.A)(function*(){const{topic:r,message:i,attestation:s,transportType:o}=e,{publicKey:a}=t.client.auth.authKeys.keys.includes(Wo)?t.client.auth.authKeys.get(Wo):{responseTopic:void 0,publicKey:void 0};try{const c=yield t.client.core.crypto.decode(r,i,{receiverPublicKey:a,encoding:o===pt.link_mode?Lr:gn});Xc(c)?(t.client.core.history.set(r,c),yield t.onRelayEventRequest({topic:r,payload:c,attestation:s,transportType:o,encryptedId:Sn(i)})):zo(c)?(yield t.client.core.history.resolve(c),yield t.onRelayEventResponse({topic:r,payload:c,transportType:o}),t.client.core.history.delete(r,c.id)):yield t.onRelayEventUnknownPayload({topic:r,payload:c,transportType:o}),yield t.client.core.relayer.messages.ack(r,i)}catch(c){t.client.logger.error(c)}})()}registerExpirerEvents(){var e=this;this.client.core.expirer.on(Cn_expired,function(){var t=(0,h.A)(function*(r){const{topic:i,id:s}=Jd(r.target);return s&&e.client.pendingRequest.keys.includes(s)?yield e.deletePendingSessionRequest(s,ge("EXPIRED"),!0):s&&e.client.auth.requests.keys.includes(s)?yield e.deletePendingAuthRequest(s,ge("EXPIRED"),!0):void(i?e.client.session.keys.includes(i)&&(yield e.deleteSession({topic:i,expirerHasDeleted:!0}),e.client.events.emit("session_expire",{topic:i})):s&&(yield e.deleteProposal(s,!0),e.client.events.emit("proposal_expire",{id:s})))});return function(r){return t.apply(this,arguments)}}())}registerPairingEvents(){this.client.core.pairing.events.on("pairing_create",e=>this.onPairingCreated(e)),this.client.core.pairing.events.on("pairing_delete",e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Et(e,!1)){const{message:t}=ge("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=ge("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Ar(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=ge("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}isValidSessionTopic(e){var t=this;return(0,h.A)(function*(){if(!Et(e,!1)){const{message:r}=ge("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(t.checkRecentlyDeleted(e),!t.client.session.keys.includes(e)){const{message:r}=ge("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Ar(t.client.session.get(e).expiry)){yield t.deleteSession({topic:e});const{message:r}=ge("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!t.client.core.crypto.keychain.has(e)){const{message:r}=ge("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw yield t.deleteSession({topic:e}),new Error(r)}})()}isValidSessionOrPairingTopic(e){var t=this;return(0,h.A)(function*(){if(t.checkRecentlyDeleted(e),t.client.session.keys.includes(e))yield t.isValidSessionTopic(e);else{if(!t.client.core.pairing.pairings.keys.includes(e)){if(Et(e,!1)){const{message:r}=ge("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}{const{message:r}=ge("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}t.isValidPairingTopic(e)}})()}isValidProposalId(e){var t=this;return(0,h.A)(function*(){if(!function R2(n){return"number"==typeof n}(e)){const{message:r}=ge("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!t.client.proposal.keys.includes(e)){const{message:r}=ge("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Ar(t.client.proposal.get(e).expiryTimestamp)){yield t.deleteProposal(e);const{message:r}=ge("EXPIRED",`proposal id: ${e}`);throw new Error(r)}})()}}class xI extends oi{constructor(e,t){super(e,t,"proposal",hu),this.core=e,this.logger=t}}class EI extends oi{constructor(e,t){super(e,t,"session",hu),this.core=e,this.logger=t}}class AI extends oi{constructor(e,t){super(e,t,"request",hu,r=>r.id),this.core=e,this.logger=t}}class II extends oi{constructor(e,t){super(e,t,"authKeys",Ho,()=>Wo),this.core=e,this.logger=t}}class SI extends oi{constructor(e,t){super(e,t,"pairingTopics",Ho),this.core=e,this.logger=t}}class DI extends oi{constructor(e,t){super(e,t,"requests",Ho,r=>r.id),this.core=e,this.logger=t}}var OI=Object.defineProperty,_u=(n,e,t)=>((n,e,t)=>e in n?OI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class PI{constructor(e,t){this.core=e,this.logger=t,_u(this,"authKeys"),_u(this,"pairingTopics"),_u(this,"requests"),this.authKeys=new II(this.core,this.logger),this.pairingTopics=new SI(this.core,this.logger),this.requests=new DI(this.core,this.logger)}init(){var e=this;return(0,h.A)(function*(){yield e.authKeys.init(),yield e.pairingTopics.init(),yield e.requests.init()})()}}var TI=Object.defineProperty,Qe=(n,e,t)=>((n,e,t)=>e in n?TI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t)(n,"symbol"!=typeof e?e+"":e,t);class mu extends Fg{constructor(e){var t;super(e),t=this,Qe(this,"protocol","wc"),Qe(this,"version",2),Qe(this,"name","client"),Qe(this,"metadata"),Qe(this,"core"),Qe(this,"logger"),Qe(this,"events",new Y.EventEmitter),Qe(this,"engine"),Qe(this,"session"),Qe(this,"proposal"),Qe(this,"pendingRequest"),Qe(this,"auth"),Qe(this,"signConfig"),Qe(this,"on",(i,s)=>this.events.on(i,s)),Qe(this,"once",(i,s)=>this.events.once(i,s)),Qe(this,"off",(i,s)=>this.events.off(i,s)),Qe(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),Qe(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),Qe(this,"connect",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.connect(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"pair",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.pair(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"approve",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.approve(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"reject",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.reject(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"update",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.update(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"extend",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.extend(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"request",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.request(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"respond",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.respond(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"ping",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.ping(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"emit",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.emit(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"disconnect",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.disconnect(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),Qe(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),Qe(this,"authenticate",function(){var i=(0,h.A)(function*(s,o){try{return yield t.engine.authenticate(s,o)}catch(a){throw t.logger.error(a.message),a}});return function(s,o){return i.apply(this,arguments)}}()),Qe(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),Qe(this,"approveSessionAuthenticate",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.approveSessionAuthenticate(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),Qe(this,"rejectSessionAuthenticate",function(){var i=(0,h.A)(function*(s){try{return yield t.engine.rejectSessionAuthenticate(s)}catch(o){throw t.logger.error(o.message),o}});return function(s){return i.apply(this,arguments)}}()),this.name=e?.name||"client",this.metadata=function H1(n){var e,t;const r=Wd();try{return null!=n&&n.url&&r.url&&new URL(n.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${n.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),n.url=r.url),null!=(e=n?.icons)&&e.length&&n.icons.length>0&&(n.icons=n.icons.filter(i=>""!==i)),((n,e)=>U1(n,N1(e)))(qd(qd({},r),n),{url:n?.url||r.url,name:n?.name||r.name,description:n?.description||r.description,icons:null!=(t=n?.icons)&&t.length&&n.icons.length>0?n.icons:r.icons})}catch(i){return console.warn("Error populating app metadata",i),n||r}}(e?.metadata),this.signConfig=e?.signConfig;const r=typeof e?.logger<"u"&&"string"!=typeof e?.logger?e.logger:Qn()(na({level:e?.logger||"error"}));this.core=e?.core||new iI(e),this.logger=Xt(r,this.name),this.session=new EI(this.core,this.logger),this.proposal=new xI(this.core,this.logger),this.pendingRequest=new AI(this.core,this.logger),this.engine=new vI(this),this.auth=new PI(this.core,this.logger)}static init(e){return(0,h.A)(function*(){const t=new mu(e);return yield t.initialize(),t})()}get context(){return an(this.logger)}get pairing(){return this.core.pairing.pairings}initialize(){var e=this;return(0,h.A)(function*(){e.logger.trace("Initialized");try{yield e.core.start(),yield e.session.init(),yield e.proposal.init(),yield e.pendingRequest.init(),yield e.auth.init(),yield e.engine.init(),e.logger.info("SignClient Initialization Success")}catch(t){throw e.logger.info("SignClient Initialization Failure"),e.logger.error(t.message),t}})()}}const RI=mu;var ai=U(297);class FI{constructor(e){this.openModal=ai.D8.open,this.closeModal=ai.D8.close,this.subscribeModal=ai.D8.subscribe,this.setTheme=ai.lH.setThemeConfig,ai.lH.setThemeConfig(e),ai.mb.setConfig(e),this.initUi()}initUi(){return(0,h.A)(function*(){if(typeof window<"u"){yield U.e(4936).then(U.bind(U,4936));const e=document.createElement("wcm-modal");document.body.insertAdjacentElement("beforeend",e),ai.IN.setIsUiLoaded(!0)}})()}}var Gp,UI=U(5312);class Yn{static info(e,...t){this.isDevelopment&&console.log(`[INFO] ${e}`,...t)}static success(e,...t){this.isDevelopment&&console.log(`%c[SUCCESS] ${e}`,"color: #4CAF50",...t)}static warn(e,...t){this.isDevelopment&&console.warn(`[WARN] ${e}`,...t)}static error(e,...t){console.error(`[ERROR] ${e}`,...t)}static debug(e,...t){this.isDevelopment&&console.debug(`[DEBUG] ${e}`,...t)}static#e=Gp=()=>this.isDevelopment=!UI.c.production}Gp();const Go={info:Yn.info.bind(Yn),success:Yn.success.bind(Yn),warn:Yn.warn.bind(Yn),error:Yn.error.bind(Yn),debug:Yn.debug.bind(Yn)},ci="chia:mainnet";var Ds=function(n){return n.Chip0002GetPublicKeys="chip0002_getPublicKeys",n.Chip0002GetAssetBalance="chip0002_getAssetBalance",n.Chip0002SignMessage="chip0002_signMessage",n.LogIn="chia_logIn",n.GetWallets="chia_getWallets",n.GetTransaction="chia_getTransaction",n.GetWalletBalance="chia_getWalletBalance",n.GetCurrentAddress="chia_getCurrentAddress",n.GetPublicKey="chia_getPublicKey",n.Send="chia_send",n.SignMessageById="chia_signMessageById",n.SignMessageByAddress="chia_signMessageByAddress",n.GetAddress="chia_getAddress",n.TakeOffer="take_offer",n.TakeOfferSage="chia_takeOffer",n.VerifySignature="chia_verifySignature",n.GetNextAddress="chia_getNextAddress",n.GetSyncStatus="chia_getSyncStatus",n.GetAllOffers="chia_getAllOffers",n.GetOffersCount="chia_getOffersCount",n.CreateOfferForIds="chia_createOfferForIds",n.CancelOffer="chia_cancelOffer",n.CheckOfferValidity="chia_checkOfferValidity",n.GetOfferSummary="chia_getOfferSummary",n.GetOfferData="chia_getOfferData",n.GetOfferRecord="chia_getOfferRecord",n.CreateNewCatWallet="chia_createNewCATWallet",n.GetCatWalletInfo="chia_getCATWalletInfo",n.GetCatAssetId="chia_getCATAssetId",n.SpendCat="chia_spendCAT",n.AddCatToken="chia_addCATToken",n.GetNfts="chia_getNfts",n.GetNftInfo="chia_getNFTInfo",n.MintNft="chia_mintNFT",n.TransferNft="chia_transferNFT",n.GetNftsCount="chia_getNFTsCount",n.CreateNewDidWallet="chia_createNewDIDWallet",n.SetDidName="chia_setDIDName",n.SetNftDid="chia_setNFTDID",n.GetNftWalletsWithDids="chia_getNFTWalletsWithDIDs",n.GetWalletAddresses="chia_getWalletAddresses",n}(Ds||{}),Os=function(n){return n.SessionProposal="session_proposal",n.SessionRequest="session_request",n.SessionDelete="session_delete",n.SessionUpdate="session_update",n.ChainChanged="chainChanged",n.AccountsChanged="accountsChanged",n}(Os||{}),ui=function(n){return n.CHIA="chia",n.ETHEREUM="ethereum",n.POLYGON="polygon",n.ARBITRUM="arbitrum",n}(ui||{}),Yp=U(2615),jI=U(9893);let $I=(()=>{var n;class e{constructor(r){this.toastController=r,this.STORAGE_KEY="haraas-walletconnect-session",this.signClient=null,this.wcModal=null,this.currentSession=null,this.connectionStatus$=new pe.t("disconnected"),this.accounts$=new pe.t([]),this.currentChain$=new pe.t(null),this.sessionData$=new pe.t(null),this.sessionEvents$=new ie.B,this.autoReconnectAttempted=!1,this.initializeWalletConnect()}initializeWalletConnect(){var r=this;return(0,h.A)(function*(){try{Go.info("\u{1f517} WalletConnect: Initializing..."),r.signClient=yield RI.init({projectId:"9be9ce1e75b40a68c7b11027b15ec6d5",metadata:{name:"HaRaaS",description:"HaRaaS - Blockchain Application Platform",url:"https://haraas.app",icons:["https://haraas.app/assets/images/logo.png"]}}),r.wcModal=new FI({projectId:"9be9ce1e75b40a68c7b11027b15ec6d5",themeMode:"dark"}),r.setupEventListeners(),yield r.checkExistingSessions(),Go.success("\u2705 WalletConnect: Initialized successfully")}catch(i){Go.error("\u274c WalletConnect: Failed to initialize:",i),yield r.toast("Failed to initialize WalletConnect")}})()}setupEventListeners(){this.signClient&&(this.signClient.on("session_proposal",r=>this.onSessionProposal(r)),this.signClient.on("session_request",r=>this.onSessionRequest(r)),this.signClient.on("session_delete",r=>this.onSessionDelete(r)),this.signClient.on("session_update",r=>this.onSessionUpdate(r)),Go.info("\u{1f3a7} WalletConnect: Event listeners set up"))}checkExistingSessions(){var r=this;return(0,h.A)(function*(){if(r.signClient&&!r.autoReconnectAttempted){try{const i=r.signClient.session.getAll();if(console.log("\u{1f50d} WalletConnect: Checking existing sessions:",i.length),i.length>0){r.currentSession=i[i.length-1],r.updateSessionData(),r.connectionStatus$.next("connected"),console.log("\u2705 WalletConnect: Restored existing session");try{console.log("\u{1f50d} WalletConnect: Updating accounts from restored session..."),yield r.updateAccountsFromWallet(),yield r.toast("WalletConnect session restored")}catch(o){console.warn("\u26a0\ufe0f WalletConnect: Failed to update accounts from restored session:",o),yield r.toast("WalletConnect session restored")}}}catch(i){console.error("\u274c WalletConnect: Error checking existing sessions:",i)}r.autoReconnectAttempted=!0}})()}connect(){var r=this;return(0,h.A)(function*(){if(!r.signClient)throw new Error("WalletConnect not initialized");if("connected"!==r.connectionStatus$.value)try{r.connectionStatus$.next("connecting"),console.log("\u{1f517} WalletConnect: Starting connection..."),console.log("\u{1f50d} Debug CHIA_CHAIN constant:",ci),console.log("\u{1f50d} Debug typeof CHIA_CHAIN:","string");const i={chia:{methods:["chip0002_getPublicKeys","chia_signMessageByAddress","chia_getAddress","chia_takeOffer","chia_send","chip0002_getAssetBalance"],chains:["chia:mainnet"],events:[]}};if(console.log("\u{1f527} Final namespace object:",JSON.stringify(i,null,2)),console.log("\u{1f527} Namespace keys:",Object.keys(i)),console.log("\u{1f527} Chia namespace exists:",!!i.chia),console.log("\u{1f527} Chia methods:",i.chia.methods),console.log("\u{1f527} Chia chains:",i.chia.chains),!i.chia)throw new Error("Chia namespace not properly constructed");if(!i.chia.methods||0===i.chia.methods.length)throw new Error("Chia namespace has no methods");if(!i.chia.chains||0===i.chia.chains.length)throw new Error("Chia namespace has no chains");console.log("\u2705 Namespace validation passed, calling signClient.connect...");const{uri:s,approval:o}=yield r.signClient.connect({requiredNamespaces:i});s&&(console.log("\u{1f4f1} WalletConnect: Opening modal..."),r.wcModal&&r.wcModal.openModal({uri:s}));const a=yield o();r.currentSession=a,r.updateSessionData(),r.connectionStatus$.next("connected"),r.wcModal&&r.wcModal.closeModal();try{console.log("\u{1f50d} WalletConnect: Updating accounts from wallet..."),yield r.updateAccountsFromWallet()}catch(c){console.warn("\u26a0\ufe0f WalletConnect: Failed to update accounts:",c)}yield r.toast("WalletConnect connected successfully"),console.log("\u2705 WalletConnect: Connected successfully")}catch(i){throw console.error("\u274c WalletConnect: Connection error:",i),r.connectionStatus$.next("disconnected"),r.wcModal&&r.wcModal.closeModal(),yield r.toast(`Connection failed: ${i instanceof Error?i.message:"Unknown error"}`),i}else yield r.toast("WalletConnect already connected")})()}disconnect(){var r=this;return(0,h.A)(function*(){try{r.signClient&&r.currentSession&&(yield r.signClient.disconnect({topic:r.currentSession.topic,reason:_t("USER_DISCONNECTED")})),r.currentSession=null,r.clearSessionData(),r.connectionStatus$.next("disconnected"),yield r.toast("WalletConnect disconnected"),console.log("\u2705 WalletConnect: Disconnected successfully")}catch(i){console.error("\u274c WalletConnect: Disconnect error:",i),r.currentSession=null,r.clearSessionData(),r.connectionStatus$.next("disconnected")}})()}forceReconnect(){var r=this;return(0,h.A)(function*(){console.log("\u{1f504} Force reconnecting to update WalletConnect methods..."),yield r.disconnect(),yield new Promise(i=>setTimeout(i,1e3)),yield r.connect()})()}sendRequest(r,i,s){var o=this;return(0,h.A)(function*(){if(!o.signClient||!o.currentSession)throw new Error("WalletConnect not connected");const a=s||ci;try{console.log(`\u{1f4e4} WalletConnect: Sending ${r} request...`,{params:i,chainId:a});const c=yield o.signClient.request({topic:o.currentSession.topic,chainId:a,request:{method:r,params:i}});return console.log(`\u2705 WalletConnect: ${r} response:`,c),c}catch(c){throw console.error(`\u274c WalletConnect: ${r} error:`,c),c}})()}getChiaAddress(){var r=this;return(0,h.A)(function*(){return r.sendRequest(Ds.GetAddress,{})})()}updateAccountsFromWallet(){var r=this;return(0,h.A)(function*(){if(r.currentSession)try{console.log("\u{1f50d} Attempting to get Chia address...");const i=yield r.getChiaAddress();console.log("\u2705 Chia address response received:",i);const s="string"==typeof i?i:i.address||i;console.log("\u2705 Chia address extracted:",s);const o=[{address:s,chainId:ci,walletType:ui.CHIA}];r.accounts$.next(o),r.sessionData$.next({topic:r.currentSession.topic,accounts:o,chains:[ci],metadata:r.currentSession.peer.metadata}),console.log("\u2705 WalletConnect: Addresses updated successfully")}catch(i){throw console.error("\u274c Failed to fetch wallet address:",i),i}})()}signChiaMessage(r,i){var s=this;return(0,h.A)(function*(){return s.sendRequest(Ds.SignMessageByAddress,{message:r,address:i})})()}takeOffer(r){var i=this;return(0,h.A)(function*(s,o=0){return i.sendRequest(Ds.TakeOfferSage,{offer:s,fee:o})}).apply(this,arguments)}sendTransaction(r){var i=this;return(0,h.A)(function*(){try{const s=r.memos?.map(c=>{const l=(new TextEncoder).encode(c);return Array.from(l).map(f=>f.toString(16).padStart(2,"0")).join("")});console.log("\u{1f517} Sage wallet sending transaction via chia_send:",{address:r.address.substring(0,8)+"...",amount:r.amount,assetId:r.assetId||"XCH",fee:r.fee||0,memos:r.memos,hexMemos:s});const o=yield i.sendRequest(Ds.Send,{assetId:r.assetId,amount:r.amount,fee:r.fee,address:r.address,memos:s});return console.log("\u2705 Sage wallet transaction result:",o),{success:!0,txId:o?.transaction_id||o?.id||o?.txId||"unknown"}}catch(s){return console.error("\u274c Sage wallet transaction error:",s),{success:!1,error:s.message||"Transaction failed"}}})()}mintFromCollection(r){var i=this;return(0,h.A)(function*(){try{console.log("\u{1f517} Sage wallet minting from collection:",{collectionId:r.collectionId.substring(0,16)+"...",objectId:r.objectId.substring(0,16)+"...",deployerWallet:r.deployerWallet.substring(0,8)+"...",priceInMojos:r.priceInMojos});const{MemoGenerator:s}=yield U.e(4037).then(U.bind(U,4037)),o={...r.options};r.targetWallet&&(o.target_wallet=r.targetWallet);const a=s.collectionMint(r.collectionId,r.objectId,r.deployerWallet,r.priceInMojos,Object.keys(o).length>0?o:{});return console.log("\u{1f4dd} Generated memo for Sage:",a),yield i.sendTransaction({address:r.deployerWallet,amount:r.priceInMojos,memos:[a],fee:0})}catch(s){return console.error("\u274c Sage wallet minting error:",s),{success:!1,error:s.message||"Minting failed"}}})()}onSessionProposal(r){console.log("\u{1f4cb} WalletConnect: Session proposal received:",r),this.sessionEvents$.next({event:Os.SessionProposal,data:r})}onSessionRequest(r){console.log("\u{1f4e8} WalletConnect: Session request received:",r),this.sessionEvents$.next({event:Os.SessionRequest,data:r})}onSessionDelete(r){console.log("\u{1f5d1}\ufe0f WalletConnect: Session deleted:",r),this.currentSession=null,this.clearSessionData(),this.connectionStatus$.next("disconnected"),this.sessionEvents$.next({event:Os.SessionDelete,data:r})}onSessionUpdate(r){console.log("\u{1f504} WalletConnect: Session updated:",r),this.updateSessionData(),this.sessionEvents$.next({event:Os.SessionUpdate,data:r})}updateSessionData(){if(!this.currentSession)return;const r=[],i=[];Object.entries(this.currentSession.namespaces).forEach(([o,a])=>{console.log(`\u{1f50d} DEBUG: Namespace ${o} methods:`,a.methods),console.log("\u{1f50d} DEBUG: Does namespace support 'chia_send'?",a.methods?.includes("chia_send")),a.chains?.forEach(c=>{i.push(c),a.accounts.forEach(u=>{const[l,d]=u.split(":").slice(-2);r.push({address:d,chainId:c,walletType:this.getWalletTypeFromChain(c)})})})}),this.accounts$.next(r),this.currentChain$.next(i[0]||null),this.sessionData$.next({topic:this.currentSession.topic,accounts:r,chains:i,metadata:this.currentSession.peer.metadata})}clearSessionData(){this.accounts$.next([]),this.currentChain$.next(null),this.sessionData$.next(null),typeof localStorage<"u"&&localStorage.removeItem(this.STORAGE_KEY)}getWalletTypeFromChain(r){return r.includes("chia")?ui.CHIA:"eip155:1"===r?ui.ETHEREUM:"eip155:137"===r?ui.POLYGON:"eip155:42161"===r?ui.ARBITRUM:ui.ETHEREUM}toast(r){var i=this;return(0,h.A)(function*(){(yield i.toastController.create({message:r,duration:2e3,position:"top",cssClass:"walletconnect-toast",buttons:[{icon:"close",role:"cancel"}]})).present()})()}debugConfig(){console.log("\u{1f50d} WalletConnect Debug Configuration:"),console.log("SignClient initialized:",!!this.signClient),console.log("Modal initialized:",!!this.wcModal),console.log("Current session:",this.currentSession),console.log("Connection status:",this.connectionStatus$.value),console.log("CHIA_CHAIN constant:",ci),console.log("Test namespaces configuration:",{chia:{methods:["chip0002_getPublicKeys","chia_signMessageByAddress","chia_getAddress","chia_takeOffer","chip0002_getAssetBalance"],chains:[ci],events:[]}})}static#e=n=()=>(this.\u0275fac=function(i){return new(i||e)(Yp.KVO(jI.K_))},this.\u0275prov=Yp.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}))}return n(),e})()},9083:(Ve,A,U)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});const V=U(584);V.__exportStar(U(5543),A),V.__exportStar(U(9746),A)},9746:(Ve,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.ONE_YEAR=A.FOUR_WEEKS=A.THREE_WEEKS=A.TWO_WEEKS=A.ONE_WEEK=A.THIRTY_DAYS=A.SEVEN_DAYS=A.FIVE_DAYS=A.THREE_DAYS=A.ONE_DAY=A.TWENTY_FOUR_HOURS=A.TWELVE_HOURS=A.SIX_HOURS=A.THREE_HOURS=A.ONE_HOUR=A.SIXTY_MINUTES=A.THIRTY_MINUTES=A.TEN_MINUTES=A.FIVE_MINUTES=A.ONE_MINUTE=A.SIXTY_SECONDS=A.THIRTY_SECONDS=A.TEN_SECONDS=A.FIVE_SECONDS=A.ONE_SECOND=void 0,A.ONE_SECOND=1,A.FIVE_SECONDS=5,A.TEN_SECONDS=10,A.THIRTY_SECONDS=30,A.SIXTY_SECONDS=60,A.ONE_MINUTE=A.SIXTY_SECONDS,A.FIVE_MINUTES=5*A.ONE_MINUTE,A.TEN_MINUTES=10*A.ONE_MINUTE,A.THIRTY_MINUTES=30*A.ONE_MINUTE,A.SIXTY_MINUTES=60*A.ONE_MINUTE,A.ONE_HOUR=A.SIXTY_MINUTES,A.THREE_HOURS=3*A.ONE_HOUR,A.SIX_HOURS=6*A.ONE_HOUR,A.TWELVE_HOURS=12*A.ONE_HOUR,A.TWENTY_FOUR_HOURS=24*A.ONE_HOUR,A.ONE_DAY=A.TWENTY_FOUR_HOURS,A.THREE_DAYS=3*A.ONE_DAY,A.FIVE_DAYS=5*A.ONE_DAY,A.SEVEN_DAYS=7*A.ONE_DAY,A.THIRTY_DAYS=30*A.ONE_DAY,A.ONE_WEEK=A.SEVEN_DAYS,A.TWO_WEEKS=2*A.ONE_WEEK,A.THREE_WEEKS=3*A.ONE_WEEK,A.FOUR_WEEKS=4*A.ONE_WEEK,A.ONE_YEAR=365*A.ONE_DAY},9823:(Ve,A,U)=>{const V=U(504);function C(Y,M,m){const q=Y[M]+Y[m];let ue=Y[M+1]+Y[m+1];q>=4294967296&&ue++,Y[M]=q,Y[M+1]=ue}function _e(Y,M,m,q){let ue=Y[M]+m;m<0&&(ue+=4294967296);let B=Y[M+1]+q;ue>=4294967296&&B++,Y[M]=ue,Y[M+1]=B}function de(Y,M){return Y[M]^Y[M+1]<<8^Y[M+2]<<16^Y[M+3]<<24}function ve(Y,M,m,q,ue,B){const fe=Pe[ue],_=Pe[ue+1],I=Pe[B],b=Pe[B+1];C(oe,Y,M),_e(oe,Y,fe,_);let x=oe[q]^oe[Y],S=oe[q+1]^oe[Y+1];oe[q]=S,oe[q+1]=x,C(oe,m,q),x=oe[M]^oe[m],S=oe[M+1]^oe[m+1],oe[M]=x>>>24^S<<8,oe[M+1]=S>>>24^x<<8,C(oe,Y,M),_e(oe,Y,I,b),x=oe[q]^oe[Y],S=oe[q+1]^oe[Y+1],oe[q]=x>>>16^S<<16,oe[q+1]=S>>>16^x<<16,C(oe,m,q),x=oe[M]^oe[m],S=oe[M+1]^oe[m+1],oe[M]=S>>>31^x<<1,oe[M+1]=x>>>31^S<<1}const be=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),he=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map(function(Y){return 2*Y})),oe=new Uint32Array(32),Pe=new Uint32Array(32);function le(Y,M){let m=0;for(m=0;m<16;m++)oe[m]=Y.h[m],oe[m+16]=be[m];for(oe[24]=oe[24]^Y.t,oe[25]=oe[25]^Y.t/4294967296,M&&(oe[28]=~oe[28],oe[29]=~oe[29]),m=0;m<32;m++)Pe[m]=de(Y.b,4*m);for(m=0;m<12;m++)ve(0,8,16,24,he[16*m+0],he[16*m+1]),ve(2,10,18,26,he[16*m+2],he[16*m+3]),ve(4,12,20,28,he[16*m+4],he[16*m+5]),ve(6,14,22,30,he[16*m+6],he[16*m+7]),ve(0,10,20,30,he[16*m+8],he[16*m+9]),ve(2,12,22,24,he[16*m+10],he[16*m+11]),ve(4,14,16,26,he[16*m+12],he[16*m+13]),ve(6,8,18,28,he[16*m+14],he[16*m+15]);for(m=0;m<16;m++)Y.h[m]=Y.h[m]^oe[m]^oe[m+16]}const Z=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function me(Y,M,m,q){if(0===Y||Y>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(M&&M.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(m&&16!==m.length)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(q&&16!==q.length)throw new Error("Illegal personal, expected Uint8Array with length is 16");const ue={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:Y};Z.fill(0),Z[0]=Y,M&&(Z[1]=M.length),Z[2]=1,Z[3]=1,m&&Z.set(m,32),q&&Z.set(q,48);for(let B=0;B<16;B++)ue.h[B]=be[B]^de(Z,4*B);return M&&(xe(ue,M),ue.c=128),ue}function xe(Y,M){for(let m=0;m<M.length;m++)128===Y.c&&(Y.t+=Y.c,le(Y,!1),Y.c=0),Y.b[Y.c++]=M[m]}function h(Y){for(Y.t+=Y.c;Y.c<128;)Y.b[Y.c++]=0;le(Y,!0);const M=new Uint8Array(Y.outlen);for(let m=0;m<Y.outlen;m++)M[m]=Y.h[m>>2]>>8*(3&m);return M}function pe(Y,M,m,q,ue){m=m||64,Y=V.normalizeInput(Y),q&&(q=V.normalizeInput(q)),ue&&(ue=V.normalizeInput(ue));const B=me(m,M,q,ue);return xe(B,Y),h(B)}Ve.exports={blake2b:pe,blake2bHex:function ie(Y,M,m,q,ue){const B=pe(Y,M,m,q,ue);return V.toHex(B)},blake2bInit:me,blake2bUpdate:xe,blake2bFinal:h}}}]);